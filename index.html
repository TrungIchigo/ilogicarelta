<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> <!-- Tối ưu viewport cho mobile -->
    <title>i-LogiCare (Mobile)</title>
    <link rel="icon" type="image/png" href="images/car.png"> <!-- Giả sử logo vẫn dùng được -->
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Google Fonts (Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Remove Font Awesome CDN -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.7.0/fonts/remixicon.css" rel="stylesheet">
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <!-- Supabase CDN script -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <style>
        /* Base Styles */
        :root {
            /* Colors */
            --primary: #5AAF4B;
            --primary-dark: #4a9c3d;
            --primary-light: #7bc36e;
            --secondary: #202D4A;
            --secondary-dark: #1a2540;
            --secondary-light: #2d3f66;
            --accent: #FFC107;
            --accent-dark: #e6ae06;
            --accent-light: #ffcd38;
            --neutral-light: #F3F4F6;
            --neutral-dark: #1F2937;
            --white: #FFFFFF;
            --black: #000000;
            --danger-color: #d0011b;
            
            /* Typography */
            --font-family-base: 'Inter', sans-serif;
            --font-size-base: 14px;
            --font-size-sm: 12px;
            --font-size-lg: 16px;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-bold: 600;
            
            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            
            /* Border & Shadow */
            --border-radius-sm: 4px;
            --border-radius-md: 8px;
            --border-radius-lg: 12px;
            --border-color: #E5E7EB;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 6px rgba(0,0,0,0.1);

            /* Layout */
            --header-height: 60px;
            --bottom-nav-height: 70px;
        }

        /* Reset & Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-base);
            font-size: var(--font-size-base);
            color: var(--neutral-dark);
            background-color: var(--neutral-light);
            padding-bottom: var(--bottom-nav-height);
            line-height: 1.5;
        }

        /* Header */
        .header {
            background: var(--primary);
            color: var(--white);
            position: sticky;
            z-index: 1020;
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0 8px; /* Giảm padding để tối ưu cho màn hình nhỏ */
            min-width: 0; /* Cho phép flex shrink */
        }

        /* Specific header alignment fix */
        #plp-header {
            padding: 8px; /* Padding nhỏ hơn cho màn hình nhỏ */
        }

        #plp-header .d-flex {
            gap: 4px; /* Khoảng cách nhỏ hơn giữa các elements */
            align-items: center;
            justify-content: space-between; /* Đảm bảo phân bố đều */
        }

        .header-search {
            flex: 1;
            margin: 0 var(--spacing-sm);
            width: 100%;
            max-width: calc(100% - 120px); /* Để lại khoảng trống cho logo và các nút action */
        }

        .header-search-input {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--border-radius-sm);
            background-color: var(--color-white);
            color: var(--color-neutral-dark);
            font-size: var(--font-size-base);
        }

        .header-search-input::placeholder {
            color: var(--neutral-dark);
            opacity: 0.7;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .header-action-btn {
            color: var(--white);
            background: none;
            border: none;
            padding: var(--spacing-xs);
            cursor: pointer;
            font-size: var(--font-size-lg);
        }

        /* Bottom Navigation Bar */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--white);
            display: flex;
            justify-content: space-around;
            padding: var(--spacing-sm);
            box-shadow: var(--shadow-sm);
            z-index: 1020;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--neutral-dark);
            text-decoration: none;
            font-size: var(--font-size-sm);
        }

        .bottom-nav-item--active {
            color: var(--primary);
        }

        .bottom-nav-icon {
            font-size: 24px;
            margin-bottom: var(--spacing-xs);
            color: var(--neutral-dark);
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .bottom-nav-icon.active {
            color: var(--primary);
        }

        .bottom-nav-icon:hover {
            color: var(--primary-dark);
            text-decoration: none;
        }

        .mobile-product-card-shopee {
            border: 1px solid var(--border-color, #eee);
            border-radius: 4px; /* Ít bo góc hơn */
            background-color: var(--white);
            font-size: 12px; /* Cỡ chữ cơ bản nhỏ hơn */
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: transform 0.1s ease-in-out; /* Hiệu ứng nhẹ khi chạm */
        }

        .mobile-product-card-shopee:active {
            transform: scale(0.98); /* Thu nhỏ nhẹ khi chạm */
        }


        /* Product Card */

        .product-card-img-container {
            aspect-ratio: 1 / 1; /* Đảm bảo ảnh vuông */
            overflow: hidden;
            position: relative; /* Cho overlay badges */
            background-color: #f9f9f9; /* Nền nhạt nếu ảnh không tải được */
        }

        .product-card {
            background-color: var(--white);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .product-card-img {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: contain; /* Hoặc cover tùy ý */
        }

        /* Overlay Badges */
        .product-overlays {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 4px;
            display: flex;
            justify-content: space-between; /* Đặt Mall bên trái, Discount bên phải */
            align-items: flex-start;
            pointer-events: none; /* Để click vẫn xuyên qua được */
            z-index: 1;
        }
        .overlay-badge {
            font-size: 9px; /* Rất nhỏ */
            padding: 2px 4px;
            font-weight: bold;
            border-radius: 2px;
            text-transform: uppercase;
            line-height: 1;
        }
        .overlay-badge-mall {
            background-color: #d0011b; /* Màu đỏ Shopee Mall */
            color: white;
            margin-right: 2px;
        }
        .overlay-badge-discount {
            background-color: rgba(255, 216, 64, 0.9); /* Màu vàng nhạt có trong suốt */
            color: #d0011b; /* Màu chữ đỏ */
            border: 1px solid #d0011b; /* Viền đỏ */
            display: flex;
            flex-direction: column; /* Xếp % và chữ GIẢM theo chiều dọc */
            align-items: center;
            padding: 0; /* Reset padding */
            line-height: 1.1;
        }
        .overlay-badge-discount .percent {
            font-size: 10px; /* % to hơn */
            padding: 1px 3px;
            display: block;
        }
        .overlay-badge-discount .label {
            font-size: 7px; /* Chữ GIẢM nhỏ hơn */
            background-color: #d0011b; /* Nền đỏ */
            color: white;
            display: block;
            width: 100%;
            padding: 1px 3px;
            border-radius: 0 0 1px 1px; /* Bo góc dưới */
        }
        /* Stock Overlay */
        .stock-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255, 255, 255, 0.6); /* Lớp phủ trắng mờ */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2; /* Nằm trên ảnh */
        }

        /* Card Body */
        .mobile-product-card-shopee .card-body {
            padding: 8px; /* Padding nhỏ */
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .mobile-product-card-shopee .product-card-title {
            font-size: 13px; /* Cỡ chữ tên SP */
            font-weight: 400; /* Không quá đậm */
            line-height: 1.3;
            min-height: 2.6em; /* Tối thiểu 2 dòng */
            margin-bottom: 4px;
            color: var(--text-color);
            /* CSS ngắt dòng */
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        /* Price Area */
        .price-container {
            display: flex;
            align-items: baseline; /* Căn theo baseline */
            gap: 4px; /* Khoảng cách nhỏ */
            flex-wrap: wrap; /* Cho phép xuống dòng nếu cần */
        }
        .shopee-price {
            font-size: 16px; /* Giá chính to */
            font-weight: 500;
            color: var(--primary-dark);
        }

        /* Extra Tags (SPayLater...) */
        .extra-tags {
            margin-top: 2px; /* Khoảng cách nhỏ trên */
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        .extra-tag {
            font-size: 9px;
            padding: 1px 3px;
            border: 1px solid var(--border-color);
            border-radius: 2px;
            color: var(--text-light);
        }
        .tag-spaylater {
            border-color: #00a79d; /* Màu SPayLater */
            color: #00a79d;
        }

        /* Rating & Sold Info */
        .rating-sold-info {
            font-size: 11px; /* Cỡ chữ nhỏ */
            color: rgba(0,0,0,0.54); /* Màu xám nhạt */
            margin-top: 4px;
        }
        .rating-stars i {
            font-size: 10px; /* Sao nhỏ */
            color: #FFD700; /* Màu vàng */
            vertical-align: baseline;
        }
        .rating-stars {
            margin-right: 2px;
            font-size: 10px; /* Sao nhỏ */
            color: #FFD700; /* Màu vàng */
        }
        
        .sold-count {
            /* Có thể không cần style gì thêm */
        }
        .location {
            font-size: 10px;
        }
        /* === Hết Styling Mobile Product Card === */

        /* Category Section */
        .category-section {
            padding: var(--spacing-md);
            background-color: var(--white);
            margin-bottom: var(--spacing-md);
        }

        .category-section-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--spacing-md);
        }

        .category-item-image {
            width: 100%;
            height: auto;
            border-radius: var(--border-radius-sm);
        }

        .category-item-name {
            font-size: var(--font-size-sm);
            text-align: center;
            margin-top: var(--spacing-xs);
        }

        /* Search Suggestions */
        .suggestion-item {
            padding: var(--spacing-sm) var(--spacing-md);
            cursor: pointer;
        }

        /* Shortcut Menu */
        .shortcut-menu {
            padding: 12px 0;
            background: var(--primary);
            margin-bottom: 16px;
            position: relative;
        }

        .shortcut-menu-scroll {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            gap: 16px;
            padding: 0 12px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .shortcut-menu-scroll::-webkit-scrollbar {
            display: none;
        }

        /* Custom Scroll Indicator Container */
        .shortcut-menu::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: 8px;
            transform: translateX(-50%);
            width: 40%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        /* Active Scroll Indicator */
        .shortcut-menu::before {
            content: '';
            position: absolute;
            left: 50%;
            bottom: 8px;
            transform: translateX(-50%);
            width: 15%;
            height: 4px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 2px;
            z-index: 1;
            transition: transform 0.3s ease;
        }

        .shortcut-menu-item {
            flex: 0 0 auto;
            width: 70px;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .shortcut-menu-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
        }

        .shortcut-menu-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .shortcut-menu-text {
            color: white;
            font-size: 12px;
            text-align: center;
            line-height: 1.2;
             display: -webkit-box;
             -webkit-line-clamp: 2;
             -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 2.4em;
        }

        /* Header Icons */
        .header-icon {
            font-size: 20px; /* Giảm size cho màn hình nhỏ */
            color: var(--white);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px; /* Giảm width cho màn hình nhỏ */
            width: 40px; /* Fixed width */
            height: 40px; /* Giảm height cho màn hình nhỏ */
            border-radius: var(--border-radius-sm);
            text-decoration: none;
            flex-shrink: 0; /* Không cho phép co lại */
            margin: 0 2px; /* Thêm margin nhỏ giữa các icon */
        }

        /* PLP Header Specific Styles */
        #plp-header .header-icon {
            margin: 0 2px; /* Thêm margin nhỏ */
            padding: 0; /* Reset padding */
        }

        #plp-header .search-container {
            flex: 1; /* Chiếm không gian còn lại */
            margin: 0 8px; /* Margin đồng nhất */
        }

        /* Search Icons */
        .search-icon {
            padding: 0.4rem; /* Giảm padding */
            color: var(--neutral-dark);
            display: flex;
            align-items: center;
            background: transparent;
            border: none;
            text-decoration: none;
            flex-shrink: 0; /* Không cho phép co lại */
        }

        .search-icon.camera-icon {
            border: none;
            background: none;
            padding-right: 0.4rem; /* Giảm padding */
            text-decoration: none;
            flex-shrink: 0; /* Không cho phép co lại */
        }

        /* Mobile Contact Icons */
        .mobile-contact-icon {
            width: 40px;
            height: 40px;
            background: var(--neutral-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            flex-shrink: 0;
            text-decoration: none;
        }

        /* Bottom Navigation Icons */
        .bottom-nav-icon {
            font-size: 24px;
            color: var(--neutral-dark);
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--spacing-xs) 0;
        }

        .bottom-nav-icon span {
            font-size: 12px;
        }

        .bottom-nav-icon.active {
            color: var(--primary);
        }

        .bottom-nav-icon.active i {
            font-weight: bold;
        }

        .bottom-nav-icon:hover {
            color: var(--primary-dark);
            text-decoration: none;
        }

        /* Cart Section Mobile Styles */
        .mobile-cart {
            padding-bottom: var(--bottom-nav-height);
        }

        .mobile-cart-header {
            position: sticky;
            top: var(--header-height);
            background-color: var(--color-white);
            z-index: 1010;
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
             display: flex;
             align-items: center;
            gap: var(--spacing-sm);
        }

        .mobile-cart-item {
            background: var(--color-white);
            padding: var(--spacing-md);
             border-bottom: 1px solid var(--border-color);
            display: grid;
            grid-template-columns: 80px 1fr auto;
            gap: var(--spacing-sm);
            align-items: start;
        }

        .mobile-cart-item-img {
            width: 80px;
            height: 80px;
             object-fit: contain;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: var(--spacing-xs);
        }

        .mobile-cart-item-details {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .mobile-cart-item-name {
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-base);
            color: var(--color-neutral-dark);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .mobile-cart-item-price {
            color: var(--color-primary);
            font-weight: var(--font-weight-bold);
        }

        .mobile-cart-quantity {
              display: flex;
              align-items: center;
            gap: var(--spacing-xs);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: var(--spacing-xs);
        }

        .mobile-cart-quantity-btn {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            color: var(--color-neutral-dark);
        }

        .mobile-cart-quantity-input {
             width: 40px;
             text-align: center;
            border: none;
            font-size: var(--font-size-base);
            -moz-appearance: textfield;
        }

        .mobile-cart-quantity-input::-webkit-outer-spin-button,
        .mobile-cart-quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .mobile-cart-remove {
            color: var(--color-neutral-dark);
             background: none;
             border: none;
            padding: var(--spacing-xs);
        }

        .mobile-cart-summary {
            position: fixed;
            bottom: var(--bottom-nav-height);
            left: 0;
            right: 0;
            background: var(--color-white);
            padding: var(--spacing-md);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1010;
        }

        .mobile-cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        /* === CSS cho Swipe to Delete Cart Item === */
        .mobile-cart-item-swipe-wrapper {
            overflow: hidden; /* Quan trọng để ẩn phần nút xóa khi chưa trượt */
            border-radius: 8px; /* Bo góc cho wrapper */
            /* box-shadow: var(--shadow-sm); */ /* Có thể bỏ nếu cart-item-content đã có */
        }

        .mobile-cart-item-content {
            transition: transform 0.3s ease-out; /* Hiệu ứng trượt mượt */
            z-index: 1; /* Nằm trên nút xóa */
            /* Các style cũ của mobile-cart-item có thể chuyển vào đây */
        }

        .mobile-cart-item-content.swiped {
            transform: translateX(-70px); /* Độ rộng của nút xóa */
        }

        .swipe-delete-action {
            opacity: 0; /* Ban đầu ẩn */
            transition: opacity 0.3s ease-out;
            /* Thêm style để đảm bảo click được */
            pointer-events: none;
        }

        .mobile-cart-item-content.swiped + .swipe-delete-action,
        .mobile-cart-item-swipe-wrapper:hover .swipe-delete-action { /* Hiện khi wrapper được hover hoặc content đã swiped */
            opacity: 1;
            pointer-events: auto; /* Cho phép click khi hiện */
            z-index: 0; /* Đưa lên trên content một chút khi hover/swipe (nếu cần) hoặc giữ nguyên */
        }

        /* CSS cho Quantity Controls (Cập nhật từ code bạn gửi) */
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 4px; /* Khoảng cách nhỏ hơn */
        }
        .quantity-btn {
            width: 28px; /* Nhỏ hơn */
            height: 28px;
            border: 1px solid var(--border-color);
            background: var(--bg-light);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--neutral-dark);
            font-size: 0.9rem; /* Icon nhỏ hơn */
            padding: 0;
        }
        .quantity-btn:active {
            background-color: var(--border-color);
        }
        .quantity-input {
            width: 35px; /* Hẹp hơn */
            height: 28px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            text-align: center;
            font-size: 0.9rem;
            padding: 0;
            -moz-appearance: textfield;
        }
        .quantity-input::-webkit-outer-spin-button,
        .quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* === Hết CSS Swipe to Delete === */

        /* === CSS cho Popup Xác nhận Xóa === */
        .delete-confirm-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6); /* Lớp phủ mờ hơn */
            display: none; /* Ban đầu ẩn */
            justify-content: center;
            align-items: center;
            z-index: 2000; /* Cao hơn các element khác */
            padding: 1rem;
        }
        .delete-confirm-popup.show {
            display: flex;
        }
        .delete-confirm-content {
            background: white;
            border-radius: var(--border-radius-lg);
            width: 90%;
            max-width: 320px; /* Kích thước popup nhỏ hơn */
            padding: 1.5rem;
            text-align: center;
            animation: popup-scale-in 0.3s ease-out;
        }
        @keyframes popup-scale-in {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .delete-confirm-content h5 {
            font-weight: 600;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }
        .delete-confirm-content p {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }
        .delete-confirm-actions {
            display: flex;
            gap: 0.75rem;
        }
        .delete-confirm-actions button {
            flex: 1;
            padding: 0.6rem;
            border-radius: var(--border-radius-md);
            font-weight: 500;
            font-size: 0.9rem;
        }
        .btn-confirm-delete {
            background: var(--danger-color);
            color: white;
            border: none;
        }
        .btn-cancel-delete {
            background: var(--neutral-light);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
        /* === Hết CSS Popup Xác nhận Xóa === */

        /* Contact Section Mobile Styles */
        .mobile-contact-card {
            background: var(--color-white);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            box-shadow: var(--shadow-sm);
        }

        .mobile-contact-info {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .mobile-contact-item {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
        }

        .mobile-contact-icon {
            width: 40px;
            height: 40px;
            background: var(--color-neutral-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-primary);
            flex-shrink: 0;
            text-decoration: none;
        }

        .mobile-contact-text {
            flex-grow: 1;
        }

        .mobile-contact-label {
            font-weight: var(--font-weight-medium);
            margin-bottom: var(--spacing-xs);
        }

        .mobile-contact-form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .mobile-contact-input {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: var(--spacing-sm);
            font-size: var(--font-size-base);
        }

        .mobile-contact-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Helper to hide sections - Single definition */
        .section-hidden {
            display: none !important;
        }
        
        /* Search Bar */
        .search-container {
            display: flex;
            align-items: center;
            background-color: var(--white);
            border-radius: var(--border-radius-md);
            border: 1px solid rgba(255, 255, 255, 0.25);
            width: 100%;
            min-width: 0; /* Cho phép shrink */
            flex: 1; /* Chiếm không gian còn lại */
            min-height: 44px; /* Đảm bảo chiều cao cố định */
            margin: 0 8px; /* Margin nhỏ hơn cho màn hình nhỏ */
        }

        .search-input-group {
            display: flex;
            align-items: center;
            width: 100%;
            background: transparent;
            height: 100%; /* Chiếm toàn bộ chiều cao container */
        }

        /* PLP Search Container Specific */
        #plp-header .search-container {
            margin: 0; /* Reset margin để tránh bị lệch */
            flex: 1; /* Chiếm toàn bộ không gian còn lại */
        }

        .search-input {
            flex: 1;
            padding: 0.5rem;
            min-width: 0; /* Cho phép shrink */
            border: none;
            background: transparent;
            font-size: var(--font-size-base);
            color: var(--neutral-dark);
        }

        .search-input:focus {
            outline: none;
        }

        .search-icon {
            padding: 0.5rem;
            color: var(--neutral-dark);
            display: flex;
            align-items: center;
            background: transparent;
            border: none;
            text-decoration: none;
        }

        .search-icon.camera-icon {
            border: none;
            background: none;
            padding-right: var(--spacing-sm);
            text-decoration: none;
        }

        /* Brand Logos */
        .brand-scroll {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding: 4px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .brand-scroll::-webkit-scrollbar {
            display: none;
        }

        .brand-logo {
            flex: 0 0 auto;
            width: 80px;
            height: 40px;
            padding: 6px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .brand-logo img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* Filter Header */
        .filter-header {
            position: sticky;
            top: 50px;
            z-index: 900;
            background: var(--neutral-light);
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            box-shadow: var(--shadow-sm);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Quantity Input */
        .quantity-input {
            width: 40px;
            text-align: center;
            border: none;
            box-shadow: none;
            -moz-appearance: textfield;
        }

        .quantity-input::-webkit-outer-spin-button,
        .quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Cart Badge */
        .cart-badge {
            display: none;
        }

        .cart-badge.visible {
            display: inline-block;
        }

        /* Add this to your existing styles */
        .shortcut-menu {
            --scroll-position: translateX(0%);
        }

        .shortcut-menu::before {
            transform: translateX(-50%) var(--scroll-position);
        }

        /* Header Quick Actions */
        .header-quick-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--primary);
            position: relative;
            padding: 8px 0;
        }

        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-color);
            transition: all 0.2s ease;
            position: relative;
            flex: 1;
        }

        .quick-action-btn i {
            font-size: 24px;
            margin-bottom: 4px;
            color: var(--primary);
        }

        .quick-action-btn span {
            font-size: 12px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .quick-action-btn:active {
            transform: scale(0.95);
        }

        /* Add new styles for bottom nav */
        .bottom-nav {
            background-color: var(--white);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            height: var(--bottom-nav-height);
            padding: 0;
        }

        .bottom-nav-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--neutral-dark);
            text-decoration: none;
            font-size: var(--font-size-sm);
            padding: 8px 0;
            flex: 1;
        }

        .bottom-nav-icon i {
            font-size: 24px;
        }

        .bottom-nav-icon span {
            font-size: 10px;
        }

        .bottom-nav-icon.active {
            color: var(--primary);
        }

        /* Center Tab Styling */
        .bottom-nav-icon--center {
            margin-top: -15px;
        }

        .bottom-nav-icon-circle {
            width: 48px;
            height: 48px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2px;
        }

        .bottom-nav-icon--center i {
            color: white;
            font-size: 24px;
            margin: 0;
        }

        .bottom-nav-icon--center span {
            color: var(--primary);
            font-weight: 500;
        }

        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            text-decoration: none;
            gap: 4px;
        }

        .quick-action-btn i {
            font-size: 24px;
        }

        .quick-action-btn span {
            font-size: 12px;
            text-align: center;
            white-space: nowrap;
        }

        .btn-outline-primary {
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-outline-secondary {
            border-color: var(--primary-dark);
            color: var(--primary-dark);
            background-color: white;
        }

        .partner-brands {
            background: white;
            padding: 16px;
            margin-bottom: 8px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--neutral-dark);
        }

        .brand-scroll {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding: 4px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .brand-scroll::-webkit-scrollbar {
            display: none;
        }

        .brand-logo {
            flex: 0 0 auto;
            width: 80px;
            height: 40px;
            padding: 6px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .brand-logo img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .plp-header {
            position: sticky;
            top: 0;
            z-index: 1020;
            background: var(--primary);
            padding: 12px;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .filter-btn {
            background: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
        }

        .sort-bar {
            padding: 8px 12px;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .results-count {
            font-size: 14px;
            color: var(--neutral-dark);
        }

        .sort-dropdown {
            width: 140px;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            padding: 8px;
            background: var(--neutral-light);
        }

        .loading-indicator {
            text-align: center;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: var(--neutral-dark);
        }

        /* Filter Offcanvas Styles */
        .offcanvas {
            max-width: 85%;
        }

        .filter-section {
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .filter-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .price-range {
            padding: 0 8px;
        }

        .price-inputs {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
        }

        .price-inputs input {
            width: 100%;
            font-size: 14px;
        }

        .offcanvas-footer {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            background: white;
        }

        /* Product Card Styles */
        .product-card {
            background: white;
            border-radius: var(--border-radius-sm);
            overflow: hidden;
        }

        .product-card-img {
            width: 100%;
            aspect-ratio: 1;
            object-fit: contain;
        }

        .product-card-content {
            padding: 8px;
        }

        .product-card-title {
            font-size: 14px;
            line-height: 1.3;
            height: 2.6em;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            margin-bottom: 4px;
        }

        .product-card-price {
            color: var(--primary);
            font-weight: 600;
            font-size: 16px;
        }

        .product-card-sold {
            font-size: 12px;
            color: #666;
        }

        /* PDP Styles */
        .pdp-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1020;
            background: transparent;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-back {
            color: white;
            text-decoration: none;
            font-size: 24px;
            display: flex;
            align-items: center;

        }

        .pdp-header-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            font-size: x-large;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .pdp-gallery {
            position: relative;
            width: 100%;
            height: 350px;
            background: #f8f9fa;
            margin-bottom: 1rem;
        }

        .swiper-container {
            width: 100%;
            height: 100%;
        }

        .swiper-slide {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
        }

        .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .swiper-pagination {
            position: absolute;
            bottom: 10px !important;
        }

        .swiper-button-next,
        .swiper-button-prev {
            background: rgba(255, 255, 255, 0.9);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            color: #333;
        }

        .swiper-button-next:after,
        .swiper-button-prev:after {
            font-size: 18px;
        }

        .swiper-pagination-bullet {
            width: 8px;
            height: 8px;
            background: #fff;
            opacity: 0.5;
        }

        .swiper-pagination-bullet-active {
            opacity: 1;
            background: #007bff;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .pdp-info {
            background: white;
            border-radius: 20px 20px 0 0;
            margin-top: -20px;
            position: relative;
            z-index: 1;
            padding: 20px 16px;
        }

        .pdp-basic-info {
            margin-bottom: 16px;
        }

        .product-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .product-meta {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }

        .separator {
            margin: 0 8px;
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .current-price {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-dark);
            font-weight: bold;
        }

        .original-price {
            font-size: 14px;
            color: #999;
            text-decoration: line-through;
        }

        .discount-tag {
            font-size: 12px;
            color: var(--primary);
            background: rgba(90, 175, 75, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .pdp-compatibility,
        .pdp-specs,
        .pdp-description,
        .pdp-shop-info {
            padding: 16px 0;
            border-top: 8px solid var(--neutral-light);
        }

        .specs-table {
            width: 100%;
            font-size: 14px;
        }

        .specs-table td {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .specs-table td:first-child {
            color: #666;
            width: 40%;
        }

        .pdp-shop-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .shop-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            overflow: hidden;
        }

        .shop-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .shop-details {
            flex: 1;
        }

        .shop-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .shop-rating {
            font-size: 13px;
            color: #666;
        }

        .pdp-action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 8px 16px;
            border-top: 1px solid var(--border-color);
            z-index: 1020;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: auto auto 1fr;
            gap: 8px;
        }

        .btn-chat,
        .btn-cart {
            display: flex;
            color: var(--primary);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            background: white;
            border: 1px solid var(--primary-light);
            border-radius: var(--border-radius-md);
            padding: 8px;
        }

        .btn-chat i,
        .btn-cart i {
            font-size: 20px;
        }

        .btn-buy {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px;
            font-weight: 500;
        }

        /* Cart Styles */
        .cart-header,
        .checkout-header {
            position: sticky;
            top: 0;
            background: var(--primary);
            z-index: 1020;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .cart-header h1,
        .checkout-header h1 {
            flex: 1;
            font-size: 14px;
            font-weight: 600;
            margin: 0;
        }

        .cart-content,
        .checkout-content {
            padding: 16px;
            padding-top: 70px; /* Account for fixed header */
        }

        .cart-items,
        .checkout-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .cart-item {
            background: white;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            padding: 12px;
            display: grid;
            grid-template-columns: 80px 1fr auto;
            gap: 12px;
            align-items: start;
        }

        .cart-item .item-image {
            width: 80px;
            height: 80px;
            border-radius: 4px;
            overflow: hidden;
        }

        .cart-item .item-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .cart-item .item-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .cart-item .item-name {
            font-size: 14px;
            font-weight: 500;
            margin: 0;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .cart-item .item-price {
            color: var(--primary);
            font-weight: 500;
            font-size: 16px;
        }

        .cart-item .item-quantity {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cart-item .quantity-btn {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: var(--gray-600);
        }

        .cart-item .quantity-input {
            width: 40px;
            height: 28px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }

        .cart-item .btn-remove {
            background: none;
            border: none;
            color: var(--gray-600);
            padding: 4px;
            font-size: 20px;
        }

        .cart-summary {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 16px;
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .summary-row.total {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            font-weight: 600;
            font-size: 16px;
        }

        .cart-footer,
        .checkout-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 16px;
            border-top: 1px solid var(--border-color);
            z-index: 1020;
        }

        .voucher-input {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .voucher-input input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
        }

        .btn-apply {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            font-weight: 500;
        }

        .btn-checkout,
        .btn-place-order {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            font-size: 16px;
        }

        /* Checkout Styles */
        .checkout-section {
            background: #f5f5f5;
            min-height: 100vh;
            padding-bottom: 80px; /* Space for bottom bar */
        }

        .checkout-header {
            background: var(--primary);
            color: white;
            padding: 12px 16px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .checkout-header .btn-back {
            background: none;
            border: none;
            color: white;
            padding: 0;
        }

        .checkout-header .header-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .checkout-address {
            background: white;
            padding: 16px;
            margin-bottom: 8px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .address-icon {
            color: var(--primary);
            font-size: 20px;
        }

        .address-details {
            flex: 1;
        }

        .address-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .address-phone {
            color: #666;
            margin-bottom: 4px;
        }

        .address-text {
            font-size: 14px;
            line-height: 1.4;
        }

        .checkout-shop {
            background: white;
            margin-bottom: 8px;
        }

        .shop-header {
            padding: 12px 16px;
            border-bottom: 1px solid #f5f5f5;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .shop-name {
            font-weight: 600;
            margin: 0;
        }

        .checkout-items {
            padding: 0 16px;
        }

        .checkout-item {
            padding: 12px 0;
            display: flex;
            gap: 12px;
            border-bottom: 1px solid #f5f5f5;
        }

        .checkout-item:last-child {
            border-bottom: none;
        }

        .item-image {
            width: 80px;
            height: 80px;
            border: 1px solid #f5f5f5;
            border-radius: 4px;
            overflow: hidden;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .item-details {
            flex: 1;
        }

        .item-name {
            font-size: 14px;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .item-variant {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .item-price {
            color: var(--primary);
            font-weight: 500;
        }

        .item-quantity {
            font-size: 14px;
            color: #666;
        }

        .shipping-section {
            background: white;
            padding: 16px;
            margin-bottom: 8px;
        }

        .shipping-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .shipping-title {
            font-weight: 600;
            margin: 0;
        }

        .shipping-options {
            border: 1px solid #f5f5f5;
            border-radius: 4px;
        }

        .shipping-option {
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid #f5f5f5;
            cursor: pointer;
        }

        .shipping-option:last-child {
            border-bottom: none;
        }

        .shipping-option.selected {
            background: #fafafa;
        }

        .shipping-option-details {
            flex: 1;
        }

        .shipping-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .shipping-info {
            font-size: 12px;
            color: #666;
        }

        .shipping-fee {
            color: var(--primary);
            font-weight: 500;
        }

        .payment-section {
            background: white;
            padding: 16px;
            margin-bottom: 8px;
        }

        .payment-header {
            margin-bottom: 12px;
        }

        .payment-title {
            font-weight: 600;
            margin: 0;
        }

        .payment-methods {
            border: 1px solid #f5f5f5;
            border-radius: 4px;
        }

        .payment-method {
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid #f5f5f5;
            cursor: pointer;
        }

        .payment-method:last-child {
            border-bottom: none;
        }

        .payment-method.selected {
            background: #fafafa;
        }

        .payment-method-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .payment-method-details {
            flex: 1;
        }

        .payment-name {
            font-weight: 500;
        }

        .payment-info {
            font-size: 12px;
            color: #666;
        }

        .onestop-balance {
            background: #f8f8f8;
            padding: 8px 12px;
            margin-top: 8px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .balance-amount {
            font-weight: 500;
            color: var(--primary);
        }

        .btn-topup {
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
        }

        .checkout-summary {
            background: white;
            padding: 16px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .summary-row:last-child {
            margin-bottom: 0;
            padding-top: 8px;
            border-top: 1px solid #f5f5f5;
        }

        .total-amount {
            color: var(--primary);
            font-size: 16px;
            font-weight: 600;
        }

        .checkout-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 12px 16px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .checkout-total {
            text-align: right;
        }

        .total-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 2px;
        }

        .total-value {
            color: var(--primary);
            font-size: 18px;
            font-weight: 600;
        }

        .btn-place-order {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-weight: 500;
        }

        /* Notification Styles */
        .notification-tabs {
            position: sticky;
            top: 56px;
            background: white;
            z-index: 999;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-tabs {
            border: none;
            padding: 0 16px;
        }

        .nav-tabs .nav-link {
            border: none;
            color: #666;
            font-weight: 500;
            padding: 12px 16px;
            position: relative;
        }

        .nav-tabs .nav-link.active {
            color: var(--primary);
            background: none;
        }

        .nav-tabs .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 16px;
            right: 16px;
            height: 2px;
            background: var(--primary);
        }

        .notification-list {
            margin-top: 0;
            background: white;
        }

        .notification-item {
            display: flex;
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            gap: 12px;
            text-decoration: none;
            color: inherit;
        }

        .notification-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 500;
            margin-bottom: 4px;
            color: #333;
            font-size: 14px;
            line-height: 1.4;
        }

        .notification-time {
            font-size: 12px;
            color: #999;
        }

        .notification-item.unread {
            background-color: #f8f9fa;
        }

        .notification-item.unread .notification-title {
            color: #000;
            font-weight: 600;
        }

        .notification-badge {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            margin-top: 8px;
        }

        .mark-all-read {
            color: white;
            text-decoration: none;
            font-size: 14px;
            padding: 4px 8px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 4px;
        }

        /* Checkout Header Styles */
        #checkout-header {
            background: var(--primary);
            z-index: 1020;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        #checkout-header .header-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
            color: white;
            text-align: center;
        }

        #checkout-header .btn-back {
            color: white;
            text-decoration: none;
            font-size: 24px;
            display: flex;
            align-items: center;
            background: none;
            border: none;
            padding: 0;
        }

        /* Auth Headers Styles (Login & Register) */
        #login-header,
        #register-header {
            background: var(--primary);
            z-index: 1020;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        #login-header .header-title,
        #register-header .header-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
            color: white;
            text-align: center;
        }

        #login-header .btn-back,
        #register-header .btn-back {
            color: white;
            text-decoration: none;
            font-size: 24px;
            display: flex;
            align-items: center;
            background: none;
            border: none;
            padding: 0;
        }

        /* Auth Content Styles */
        .auth-content {
            padding-top: calc(var(--header-height) + 16px);
            padding-bottom: var(--bottom-nav-height);
            padding-left: 16px;
            padding-right: 16px;
        }

        /* Auth Headers Styles (Login & Register) */
        #login-header,
        #register-header {
            background: var(--primary);
            z-index: 1020;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        /* Auth Content Styles */
        .auth-content {
            padding-top: calc(var(--header-height) + 16px);
            padding-bottom: var(--bottom-nav-height);
            padding-left: 16px;
            padding-right: 16px;
        }

        /* Thêm styles cho tags */
        .product-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        .product-tag {
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 2px;
            color: #757575;
            background: #f5f5f5;
            border: 1px solid #ebebeb;
        }
        .tag-authentic {
            color: var(--primary);
            background: white;
            border-color: var(--primary-dark);
        }
        .tag-deal {
            color: #ee4d2d;
            background: #fff1f0;
            border-color: #ffccc7;
        }
        .tag-freeship {
            color: #00bfa5;
            background: #e5f6f4;
            border-color: #b4e6e2;
        }
        .tag-cashback {
            color: #f5a623;
            background: #fff8e4;
            border-color: #ffecc7;
        }
        .tag-partner {
            color: #2673dd;
            background: #e8f2ff;
            border-color: #c5d7f2;
        }
        .price-container {
            display: flex;
            align-items: baseline;
            gap: 4px;
            flex-wrap: wrap;
        }

        .original-price {
            color: #757575;
            font-size: 11px;
            text-decoration: line-through;
        }

        /* Account Section Styles */
        .account-info {
            background-color: var(--primary);
            padding: 1rem;
            color: white;
        }

        /* Settings Section Styles */
        .settings-content {
            background-color: #f8f9fa;
            min-height: 100vh;
        }

        .settings-menu {
            overflow: hidden;
        }

        .settings-item {
            text-decoration: none;
            color: inherit;
            background: white;
            transition: background-color 0.2s;
        }

        .settings-item:hover {
            background-color: #f8f9fa;
            color: inherit;
        }

        .settings-item:last-child {
            border-bottom: none !important;
        }

        .settings-section-title {
            background-color: #f8f9fa;
        }

        .form-check-input:checked {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .account-avatar {
            width: 60px;
            height: 60px;
            object-fit: cover;
        }

        .account-username {
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
            color: white;
        }

        .order-status-grid {
            background: white;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .order-status-item {
            text-decoration: none;
            color: inherit;
            text-align: center;
            position: relative;
            display: block;
        }

        .order-status-item i {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: block;
        }

        .order-status-item .badge {
            position: absolute;
            top: -8px;
            transform: translateX(50%);
            font-size: 0.8rem;
            font-weight: 700;
            min-width: 2.2em;
            min-height: 2.2em;
            border-radius: 1.1em;
            background: #dc3545; /* bg-danger */
            color: #fff;
            box-shadow: 0 2px 8px rgba(220,53,69,0.15);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
            border: 2px solid #fff;
        }

        .utilities-section {
            background: white;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title a {
            font-size: 0.875rem;
            color: var(--primary);
            text-decoration: none;
        }

        .utility-list .list-group-item {
            border: none;
            padding: 0.75rem 0;
        }

        .utility-list .list-group-item i {
            font-size: 1.25rem;
            color: var(--primary);
        }

        /* Seller Registration & Center Button Styles */
        .seller-registration-btn,
        .seller-center-btn {
            border-radius: 12px !important;
            margin-bottom: 8px;
            padding: 12px 16px !important;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .seller-registration-btn {
            background: linear-gradient(135deg, rgba(90, 175, 75, 0.1) 0%, rgba(90, 175, 75, 0.05) 100%);
            border-color: rgba(90, 175, 75, 0.2);
        }

        .seller-registration-btn:hover {
            background: linear-gradient(135deg, rgba(90, 175, 75, 0.15) 0%, rgba(90, 175, 75, 0.08) 100%);
            border-color: rgba(90, 175, 75, 0.3);
        }

        .seller-center-btn {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .seller-center-btn:hover {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(16, 185, 129, 0.08) 100%);
            border-color: rgba(16, 185, 129, 0.3);
        }

        .seller-registration-btn .ri-store-3-line,
        .seller-center-btn .ri-dashboard-3-line {
            font-size: 24px;
        }

        /* Settings Section Styles */
        .settings-content {
            padding-bottom: var(--bottom-nav-height);
        }

        .list-group-header {
            background-color: var(--light);
            font-weight: 500;
        }

        .list-group-item i {
            font-size: 20px;
            color: var(--gray);
        }

        .list-group-item:active {
            background-color: var(--light);
        }

        /* Ensure consistent icon sizes */
        .list-group-item .ri-arrow-right-s-line {
            font-size: 20px;
            color: var(--gray-400);
        }

        /* Style for the language selection */
        .list-group-item .text-secondary {
            font-size: 14px;
        }

        /* Logout button styling */
        .btn-outline-danger {
            border-width: 1px;
            font-weight: 500;
        }

        .btn-outline-danger:active {
            transform: scale(0.98);
        }

        /* Sort Bar Styles */
        .sort-bar-mobile {
            background: var(--white);
            border-bottom: 1px solid var(--border-color);
        }

        .sort-option {
            color: var(--gray-600);
            font-size: 13px;
            padding: 4px 8px;
            border: none;
            background: none;
            position: relative;
            min-width: 70px;
        }

        .sort-option.active {
            color: var(--primary);
            font-weight: 500;
        }

        .sort-option.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 8px;
            right: 8px;
            height: 2px;
            background: var(--primary);
            border-radius: 1px;
        }

        .sort-option i {
            font-size: 16px;
            vertical-align: middle;
            margin-left: 2px;
        }

        /* Price Section Styles */
        .price-container {
            display: flex;
            align-items: baseline;
            flex-wrap: wrap;
            gap: 4px;
        }

        .original-price {
            color: rgba(0,0,0,0.54);
            text-decoration: line-through;
            font-size: 12px;
        }

        .discount-percent {
            color: #EE4D2D;
            font-size: 11px;
            font-weight: 500;
            background: #fff1f0;
            border-color: #ffccc7;
            border-radius: 2px;
            padding: 2px 4px;
        }

        .sold-count {
            font-size: 14px;
        }

        /* Button Styles */
        .btn-cart {
            display: flex;
            color: var(--primary);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            background: white;
            border: 1px solid var(--primary-light);
            border-radius: var(--border-radius-md);
            padding: 8px;
        }

        .btn-primary {
            padding: 8px;
            background-color: var(--primary);
            color: white;
            border: none !important;
        }

        /* Toast Message Styles */
        .toast-message {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 24px;
            z-index: 1050;
            animation: fadeInOut 3s ease;
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toast-content i {
            font-size: 20px;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, 20px); }
            10% { opacity: 1; transform: translate(-50%, 0); }
            90% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -20px); }
        }

        /* Product Gallery Styles */
        .pdp-gallery {
            position: relative;
            width: 100%;
            height: 350px;
            background: #f8f9fa;
            margin-bottom: 1rem;
        }

        .swiper-container {
            width: 100%;
            height: 100%;
        }

        .swiper-slide {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
        }

        .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .swiper-pagination {
            position: absolute;
            bottom: 10px !important;
        }

        .swiper-button-next,
        .swiper-button-prev {
            background: rgba(255, 255, 255, 0.9);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            color: #333;
        }

        .swiper-button-next:after,
        .swiper-button-prev:after {
            font-size: 18px;
        }

        .swiper-pagination-bullet {
            width: 8px;
            height: 8px;
            background: #fff;
            opacity: 0.5;
        }

        .swiper-pagination-bullet-active {
            opacity: 1;
            background: #007bff;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .swiper-pagination-bullet {
            width: 8px;
            height: 8px;
            background: #fff;
            opacity: 0.5;
        }

        .swiper-pagination-bullet-active {
            opacity: 1;
            background: #007bff;
        }

        .swiper-container {
            width: 100%;
            height: 100%;
        }

        .swiper-slide {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
        }

        .confirm-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .confirm-popup.show {
            display: flex;
        }

        .confirm-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 360px;
            padding: 20px;
            animation: popup-in 0.3s ease-out;
        }

        @keyframes popup-in {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .confirm-header {
            text-align: center;
            margin-bottom: 16px;
        }

        .confirm-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            margin: 0;
        }

        .confirm-body {
            margin-bottom: 20px;
        }

        .confirm-amount {
            text-align: center;
            font-size: 24px;
            font-weight: 600;
            color: var(--primary);
            margin: 12px 0;
        }

        .confirm-details {
            background: #f8f8f8;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
        }

        .confirm-detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .confirm-detail-row:last-child {
            margin-bottom: 0;
        }

        .confirm-actions {
            display: flex;
            gap: 12px;
        }

        .confirm-actions button {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-cancel {
            background: #f5f5f5;
            color: #666;
        }

        .btn-confirm {
            background: var(--primary);
            color: white;
        }

        .toast-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-light);
            color: white;
            padding: 12px 4px;
            border-radius: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 2100;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .toast-notification.show {
            opacity: 0.7;
        }

        .toast-notification i {
            font-size: 18px;
            color: white;
        }

        /* Flying cart animation */
        .flying-item {
            position: fixed;
            z-index: 9999;
            pointer-events: none;
            transition: all 0.8s cubic-bezier(0.19, 1, 0.22, 1);
            width: 50px;
            height: 50px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        @keyframes addToCart {
            0% {
                transform: scale(1.5) translateY(0);
                opacity: 1;
            }
            80% {
                transform: scale(0.5) translateY(0);
                opacity: 0.8;
            }
            100% {
                transform: scale(0.3) translateY(0);
                opacity: 0;
            }
        }

        /* Voucher Section Styles */
        .voucher-section {
            background: white;
            margin-top: 8px;
            padding: 12px 16px;
        }

        .voucher-header {
            margin-bottom: 8px;
        }

        .voucher-title {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .voucher-title i {
            color: var(--primary);
            font-size: 18px;
        }

        .voucher-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            border: 1px dashed #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        .voucher-content:active {
            background: #f5f5f5;
        }

        .voucher-input {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
        }

        .voucher-input i {
            color: var(--primary);
        }

        /* Voucher Dialog Styles */
        .voucher-dialog {
            position: fixed;
            bottom: 73px;
            left: 0;
            right: 0;
            background: white;
            border-radius: 16px 16px 0 0;
            z-index: 1000;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
        }

        .voucher-dialog.show {
            transform: translateY(0);
        }

        .voucher-dialog-header {
            padding: 16px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .voucher-dialog-title {
            font-size: 16px;
            font-weight: 500;
        }

        .voucher-dialog-close {
            border: none;
            background: none;
            padding: 8px;
            color: #666;
        }

        .voucher-dialog-content {
            padding: 16px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .voucher-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .voucher-input-field {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .voucher-apply-btn {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            font-weight: 500;
        }

        .voucher-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .voucher-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 8px;
        }

        .voucher-item-icon {
            width: 40px;
            height: 40px;
            background: #f5f5f5;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        .voucher-item-details {
            flex: 1;
        }

        .voucher-item-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .voucher-item-desc {
            font-size: 12px;
            color: #666;
        }

        .voucher-item-action {
            padding: 6px 12px;
            border: 1px solid var(--primary);
            border-radius: 4px;
            color: var(--primary);
            background: white;
            font-size: 12px;
        }

        .voucher-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-out;
        }

        .voucher-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .summary-row.total-row {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #eee;
        }

        .discount-amount {
            color: #ee4d2d;
        }

        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            text-decoration: none;
            gap: 4px;
            width: 100%;
            max-width: 120px;
            padding: 4px;
        }

        .quick-action-btn i {
            font-size: 24px;
        }

        .quick-action-btn span {
            font-size: 12px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        /* PDP Gallery Styles */
        .pdp-gallery {
            position: relative;
            width: 100%;
            height: 350px;
            background: #f8f9fa;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .swiper-container {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .swiper-slide {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
            width: 100% !important;
        }

        .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Fix for swiper wrapper */
        .swiper-wrapper {
            width: 100%;
            height: 100%;
        }

        /* Ensure navigation buttons don't cause overflow */
        .swiper-button-next,
        .swiper-button-prev {
            background: rgba(255, 255, 255, 0.9);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            color: #333;
            transform: translateX(0);
        }

        .swiper-button-next {
            right: 10px;
        }

        .swiper-button-prev {
            left: 10px;
        }

        /* Language Selector Styles */
        .language-selector {
            position: relative;
            display: inline-flex;
            align-items: center;
        }

        .language-dropdown {
            position: absolute;
            right: 0; /* Căn phải để không bị tràn */
            top: 50px; /* Giảm khoảng cách */
            background: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            width: 160px; /* Giảm width cho màn hình nhỏ */
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
            display: none;
        }

        /* Responsive adjustments for very small screens */
        @media (max-width: 360px) {
            .header {
                padding: 0 4px; /* Padding rất nhỏ cho màn hình rất nhỏ */
                height: 70px; /* Giảm chiều cao header */
            }
            
            .header-icon {
                font-size: 18px; /* Icon nhỏ hơn */
                min-width: 36px;
                width: 36px;
                height: 36px;
                margin: 0 1px; /* Margin rất nhỏ */
            }
            
            .search-container {
                margin: 0 4px; /* Margin rất nhỏ */
                min-height: 36px; /* Chiều cao nhỏ hơn */
            }
            
            .search-icon {
                padding: 0.3rem; /* Padding rất nhỏ */
            }
            
            .search-icon.camera-icon {
                padding-right: 0.3rem;
            }
            
            .language-dropdown {
                width: 140px; /* Width nhỏ hơn cho màn hình rất nhỏ */
                top: 45px;
            }
            
            #plp-header {
                padding: 4px; /* Padding rất nhỏ */
            }
            
            #plp-header .d-flex {
                gap: 2px; /* Gap rất nhỏ */
            }
        }

        @media (max-width: 320px) {
            .header {
                padding: 0 2px; /* Padding cực nhỏ */
                height: 65px;
            }
            
            .header-icon {
                font-size: 16px;
                min-width: 32px;
                width: 32px;
                height: 32px;
                margin: 0;
            }
            
            .search-container {
                margin: 0 2px;
                min-height: 32px;
            }
            
            .search-icon {
                padding: 0.2rem;
            }
            
            .search-icon.camera-icon {
                padding-right: 0.2rem;
            }
            
            .language-dropdown {
                width: 120px;
                top: 40px;
            }
        }

        .language-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            display: block;
        }

        .language-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: black;
            text-decoration: none;
            transition: background-color 0.2s ease;
            width: 100%;
            box-sizing: border-box;
        }

        .language-item .flag {
            font-size: 20px;
            margin-right: 12px;
        }

        .language-item .lang-text {
            flex: 1;
        }

        .language-item .active-indicator {
            opacity: 0;
            color: var(--primary);            
            transition: opacity 0.2s ease;
        }

        .language-item[data-lang="vi"] .active-indicator {
            opacity: 1;
        }


        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: white;
            transition: all 0.2s ease;
            position: relative;
            flex: 1;
        }

        .quick-action-btn i {
            font-size: 24px;
            margin-bottom: 4px;
            color: white;
        }

        .quick-action-btn span {
            font-size: 12px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .quick-action-btn:active {
            transform: scale(0.95);
        }

        .pdp-reviews {
            padding: 16px;
            background: #fff;
            margin-top: 8px;
        }

        .reviews-header {
            margin-bottom: 20px;
        }

        .rating-summary {
            display: flex;
            gap: 24px;
            align-items: flex-start;
            padding: 16px;
            background: var(--neutral-light);
            border-radius: 8px;
        }

        .average-rating {
            text-align: center;
            min-width: 120px;
        }

        .rating-number {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
        }

        .rating-stars {
            color: var(--accent);
            font-size: 20px;
            margin: 8px 0;
        }

        .total-reviews {
            color: #666;
            font-size: 14px;
        }

        .rating-bars {
            flex: 1;
        }

        .rating-bar-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .star-label {
            width: 60px;
            font-size: 14px;
        }

        .progress {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 0 12px;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            border-radius: 4px;
        }

        .percent {
            width: 40px;
            font-size: 14px;
            text-align: right;
        }

        .review-list {
            margin-top: 20px;
        }

        .review-item {
            padding: 16px;
            border-bottom: 1px solid #eee;
        }

        .reviewer-info {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .reviewer-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            object-fit: cover;
        }

        .reviewer-details {
            flex: 1;
        }

        .reviewer-name {
            font-weight: 500;
        }

        .review-date {
            font-size: 12px;
            color: #666;
        }

        .review-rating {
            color: var(--accent);
            font-size: 16px;
            margin-bottom: 8px;
        }

        .review-content {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .review-images {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .review-images img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
        }

        .count {
            width: 40px;
            font-size: 14px;
            text-align: right;
            color: var(--primary);
            font-weight: 500;
        }

        .view-all-reviews {
            margin-top: 20px;
            text-align: center;
        }

        .btn-view-all {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 12px;
            background: var(--neutral-light);
            border: none;
            border-radius: 8px;
            color: var(--primary);
            font-weight: 500;
            gap: 8px;
            transition: background-color 0.2s;
        }

        .btn-view-all:hover {
            background: #e8e8e8;
        }

        .btn-view-all i {
            font-size: 20px;
        }

        /* Cart Styles */
        .cart-content {
            padding: 16px;
            background: #f5f5f5;
        }

        .cart-item {
            display: flex;
            padding: 16px;
            background: #fff;
            border-radius: 8px;
            margin-bottom: 12px;
            gap: 12px;
            align-items: flex-start;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .item-checkbox {
            padding-top: 8px;
        }

        .item-image {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            background: #f8f8f8;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .item-details {
            flex: 1;
        }

        .item-name {
            font-size: 14px;
            margin-bottom: 4px;
            color: var(--neutral-dark);
            font-weight: 500;
            line-height: 1.4;
        }

        .item-variant {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            display: inline-block;
            background: var(--neutral-light);
            padding: 2px 8px;
            border-radius: 4px;
        }

        .item-price {
            margin-bottom: 12px;
        }

        .current-price {
            font-weight: 600;
            color: var(--primary);
            margin-right: 8px;
            font-size: 15px;
        }

        .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 13px;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-quantity {
            width: 28px;
            height: 28px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--neutral-dark);
            transition: all 0.2s;
        }

        .btn-quantity:active {
            background: #f5f5f5;
            transform: scale(0.95);
        }

        .quantity-input {
            width: 40px;
            height: 28px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }

        .cart-summary {
            background: #fff;
            padding: 16px;
            margin-top: 16px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
            color: #666;
        }

        .summary-row.total {
            font-weight: 600;
            color: var(--primary);
            font-size: 16px;
            margin-top: 16px;
            margin-bottom: 0;
            padding-top: 12px;
            border-top: 1px solid #eee;
        }

        .cart-footer {
            padding: 16px;
            background: #fff;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .voucher-input {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .voucher-input input {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 14px;
        }

        .btn-apply {
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            font-weight: 500;
        }

        .btn-checkout {
            width: 100%;
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-weight: 500;
            font-size: 16px;
        }

        /* Voucher Popup Styles */
        .voucher-list-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .voucher-list-container {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .voucher-list-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .voucher-list-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
        }

        .voucher-list-header button {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--gray-600);
            padding: 4px;
        }

        .voucher-list-body {
            max-height: 60vh;
            overflow-y: auto;
            padding: 8px;
        }

        .voucher-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .voucher-item:hover:not(.disabled) {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .voucher-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .voucher-info {
            flex: 1;
        }

        .voucher-code {
            font-weight: 600;
            color: var(--primary);
            font-size: 14px;
            margin-bottom: 4px;
        }

        .voucher-desc {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: 2px;
        }

        .voucher-min {
            font-size: 11px;
            color: var(--danger);
        }

        .voucher-action .btn-apply {
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Main Header -->
    <header class="header fixed-top" id="main-header">
        <div class="d-flex align-items-center w-100">
            <!-- Search Bar Area -->
            <div class="search-container">
                <button class="search-icon" type="button"><i class="ri-search-line"></i></button>
                <input type="text" class="search-input" placeholder="Tìm kiếm sản phẩm" aria-label="Search" id="mobile-search-input">
                <button class="search-icon camera-icon" type="button" onclick="openCamera()">
                    <i class="ri-camera-line"></i>
                </button>
                <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none" onchange="onCameraCapture(event)">
            </div>
            <!-- Right Icons -->
            <div class="d-flex align-items-center flex-shrink-0">
                <!-- Cart Icon -->
                <a href="#cart-section" class="header-icon header-icon--cart" onclick="showSection('cart-section')">
                    <i class="ri-shopping-cart-line"></i>
                    <span id="cart-count-badge-mobile" class="header-badge" style="display: none;">0</span>
                </a>
                <!-- Chat Messages Icon -->
                <a href="chat-messages.html" class="header-icon">
                    <i class="ri-message-3-line"></i>
                </a>
                <!-- Language Icon -->
                <a href="#" class="header-icon language-selector">
                    <i class="ri-global-line"></i>
                </a>
                <div class="language-dropdown">
                    <a href="#" class="language-item" data-lang="vi">
                        <span class="flag">🇻🇳</span>
                        <span class="lang-text">Tiếng Việt</span>
                        <i class="ri-check-line active-indicator"></i>
                    </a>
                    <a href="#" class="language-item" data-lang="en">
                        <span class="flag">🇺🇸</span>
                        <span class="lang-text">English</span>
                        <i class="ri-check-line active-indicator"></i>
                    </a>
                    <a href="#" class="language-item" data-lang="km">
                        <span class="flag">🇰🇭</span>
                        <span class="lang-text">ភាសាខ្មែរ</span>
                        <i class="ri-check-line active-indicator"></i>
                    </a>
                </div>
            </div>
        </div>
    </header>
    <!-- End New Mobile Header -->

    <!-- Main Content Area -->
    <main>
        <!-- Các section (Homepage, PLP, PDP, Cart, Checkout, Login...) sẽ được đặt ở đây -->
         <!-- SECTION: Login (AUTH-01) - Mobile Optimized -->
        <section id="login-section" class="section-hidden">
            <!-- Login Header -->
            <header class="header fixed-top px-3" id="login-header">
                <div class="d-flex align-items-center justify-content-between w-100">
                    <!-- Back Button -->
                    <button class="btn-back" onclick="goBack()">
                        <i class="ri-arrow-left-line"></i>
                    </button>
                    
                    <!-- Title -->
                    <h1 class="header-title mb-0" data-translate="login_title">Đăng nhập</h1>
                    
                    <!-- Empty div for flex spacing -->
                    <div style="width: 24px;"></div>
                </div>
            </header>

            <div class="auth-content">
                <div class="text-center mb-4">
                    <img src="images/car.png" alt="i-LogiCare Logo" class="mb-4" style="height: 100px;">
                    <h2 class="fs-4 mb-3">Chào mừng đến với i-LogiCare</h2>
                </div>
                
                <!-- Login Options Card (Default view) -->
                <div id="login-options-card">
                    <div class="d-grid gap-3">
                        <!-- i-SuperApp Login Button -->
                        <button type="button" class="btn btn-primary btn-lg d-flex align-items-center justify-content-center gap-2" onclick="showEmailLoginForm()">
                            <i class="ri-smartphone-line"></i>
                            <span>Đăng nhập bằng i-SuperApp@LTA</span>
                        </button>
                        
                        <!-- Register Link -->
                        <div class="text-center mt-3">
                            <p class="text-muted mb-2">Chưa có tài khoản?</p>
                            <button type="button" class="btn btn-link p-0" onclick="showSection('register-section')">
                                Đăng ký ngay
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Email/Password Login Form (Hidden by default) -->
                <div id="email-login-card" class="d-none">
                    <form id="email-login-form" onsubmit="handleEmailLogin(event)">
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label">Email hoặc Số điện thoại</label>
                            <input type="text" class="form-control form-control-lg" id="loginEmail" 
                                   placeholder="Nhập email hoặc số điện thoại" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">Mật khẩu</label>
                            <div class="input-group">
                                <input type="password" class="form-control form-control-lg" id="loginPassword" 
                                       placeholder="Nhập mật khẩu" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('loginPassword')">
                                    <i class="ri-eye-line"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">
                                Ghi nhớ đăng nhập
                            </label>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg" id="email-login-btn">
                                Đăng nhập
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="showLoginOptions()">
                                Quay lại
                            </button>
                        </div>
                    </form>
                    
                    <div class="text-center mt-3">
                        <button type="button" class="btn btn-link p-0" onclick="alert('Tính năng quên mật khẩu đang phát triển')">
                            Quên mật khẩu?
                        </button>
                    </div>
                </div>
                
                <!-- Loading Spinner (Hidden by default) -->
                <div id="login-spinner" class="text-center mt-4 d-none">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Đang xử lý...</span>
                    </div>
                    <p class="mt-2" id="login-spinner-text">Đang xác thực...</p>
                </div>
                
                <!-- Success/Error Messages -->
                <div id="login-success" class="alert alert-success mt-4 d-none" role="alert">
                    <i class="ri-check-line me-2"></i>
                    <span id="login-success-message">Đăng nhập thành công!</span>
                </div>
                
                <div id="login-error" class="alert alert-danger mt-4 d-none" role="alert">
                    <i class="ri-error-warning-line me-2"></i>
                    <span id="login-error-message">Lỗi xác thực</span>
                </div>
            </div>
        </section>
        <!-- Chỉ khác cấu trúc HTML bên trong và class CSS để tối ưu cho mobile -->
        
        <!-- SECTION: Homepage (PUB-01) - Mobile Optimized -->
        <!-- SECTION: Homepage (PUB-01) - Shopee Inspired Mobile Layout -->
        <section id="homepage-section">

            <!-- Quick Action Buttons -->
        
                <div class="header-quick-actions">
                    <a href="#" class="quick-action-btn" onclick="alert('Tính năng quét QR đang phát triển')">
                    <i class="ri-qr-scan-line"></i>
                        <span>Quét QR</span>
                </a>
                    <a href="onestop-fund.html" class="quick-action-btn">
                    <i class="ri-wallet-3-line"></i>
                    <span>Quỹ OneStop@LTA</span>
                </a>
                    <a href="#" class="quick-action-btn" onclick="alert('Tính năng nhận xu đang phát triển')">
                <i class="ri-coin-line"></i>
                        <span>Xu OneStop@LTA</span>
                </a>
            </div>
            

            <!-- 2. Shortcut Icon Grid -->
            <div class="shortcut-menu">
                <div class="shortcut-menu-scroll">
                    <!-- Mã giảm giá -->
                    <a href="vouchers.html" class="shortcut-menu-item">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_voucher.png" alt="Mã Giảm Giá">
                            </div>
                        <span class="shortcut-menu-text">Mã Giảm Giá</span>
                        </a>
                    
                    <!-- Dầu nhớt -->
                    <a href="#plp-section" class="shortcut-menu-item" onclick="loadPLP('engine_oil'); showSection('plp-section');">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_engine_oil.png" alt="Dầu Nhớt">
                            </div>
                        <span class="shortcut-menu-text">Dầu Nhớt</span>
                        </a>
                    
                    <!-- Lốp xe -->
                    <a href="#plp-section" class="shortcut-menu-item" onclick="loadPLP('tire'); showSection('plp-section');">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_tire.png" alt="Lốp Xe">
                            </div>
                        <span class="shortcut-menu-text">Lốp Xe</span>
                        </a>

                    <!-- Lọc dầu -->
                    <a href="#plp-section" class="shortcut-menu-item" onclick="loadPLP('oil_filter'); showSection('plp-section');">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_oil_filter.png" alt="Lọc Dầu">
                            </div>
                        <span class="shortcut-menu-text">Lọc Dầu</span>
                        </a>

                    <!-- Bảo hiểm -->
                    <a href="#plp-section" class="shortcut-menu-item" onclick="loadPLP('insurance'); showSection('plp-section');">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_insurance.png" alt="Bảo Hiểm">
                            </div>
                        <span class="shortcut-menu-text">Bảo Hiểm</span>
                        </a>
                    
                    <!-- Thiết bị điện - điện tử -->
                    <a href="#plp-section" class="shortcut-menu-item" onclick="loadPLP('electronics'); showSection('plp-section');">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_gps.png" alt="Thiết bị Điện">
                            </div>
                        <span class="shortcut-menu-text">Thiết bị Điện</span>
                        </a>
                    
                    <!-- Ưu đãi nhà xe -->
                    <a href="b2b-deals.html" class="shortcut-menu-item">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_b2b_deal.png" alt="Ưu đãi Nhà xe">
                            </div>
                        <span class="shortcut-menu-text">Ưu đãi Nhà xe</span>
                        </a>

                    <!-- Hỗ trợ -->
                    <a href="#contact-section" class="shortcut-menu-item" onclick="showSection('contact-section')">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_support.png" alt="Hỗ trợ">
                            </div>
                        <span class="shortcut-menu-text">Hỗ trợ</span>
                    </a>                    
                </div>
            </div>

            <!-- 3. Featured Brands (Optional - Horizontal Scroll) -->
            <div class="partner-brands">
                <h6 class="section-title">Thương Hiệu Đối Tác</h6>
                <div class="brand-scroll">
                    <a href="#" class="brand-logo" onclick="loadPLP(); showSection('plp-section');">
                        <img src="https://logos-download.com/wp-content/uploads/2016/02/Castrol_logo_2D_transparent.png" alt="Castrol">
                    </a>
                    <a href="#" class="brand-logo" onclick="loadPLP(); showSection('plp-section');">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Mobil_logo.svg/2560px-Mobil_logo.svg.png" alt="Mobil">
                    </a>
                    <a href="#" class="brand-logo" onclick="loadPLP(); showSection('plp-section');">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSCMgruq2y5dDrsrjGcJYt2ItgeROBtP7-s4w&s" alt="Shell">
                    </a>
                    <a href="#" class="brand-logo" onclick="loadPLP(); showSection('plp-section');">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/c/c3/Bosch_logo.png" alt="Bosch">
                    </a>
                    <a href="#" class="brand-logo" onclick="loadPLP(); showSection('plp-section');">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/Denso_logo.svg/2560px-Denso_logo.svg.png" alt="Denso">
                    </a>
                    <a href="#" class="brand-logo" onclick="loadPLP(); showSection('plp-section');">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS_x0J2CYPBynb5r5W8Lp4JocJNSaAKRKAqjA&s" alt="Michelin">
                    </a>
                    <a href="#" class="brand-logo" onclick="loadPLP(); showSection('plp-section');">
                        <img src="images/brand_name.png" alt="i-LogiCare">
                    </a>
                </div>
            </div>

            <!-- 4. Recommendations -->
            <div class="container recommendations-section">
                <h5 class="mb-3 fw-bold" data-lang-vi="Gợi Ý Hôm Nay" data-lang-en="Daily Discover">Gợi Ý Hôm Nay</h5>
                <div class="row row-cols-2 g-2 mobile-product-grid" id="recommendations-grid">
                    <!-- Products loaded by JS using mobile-product-card structure -->
                    <div class="col"> <div class="text-center p-3"><div class="spinner-border spinner-border-sm text-primary" role="status"></div></div> </div>
                </div>
               
            </div>
        </section>

        <!-- SECTION: Product Listing Page (PLP - PUB-02) - Mobile Optimized -->
        <section id="plp-section" class="section-hidden">
            <!-- PLP Header -->
            <div class="header sticky-top" id="plp-header" style="top: 0; z-index: 1020;">
                <div class="d-flex align-items-center w-100">
                    <a href="#" class="header-icon" onclick="showSection('homepage-section')">
                        <i class="ri-arrow-left-line"></i>
                    </a>
                    <!-- Hidden title for loadPLP function -->
                    <h5 class="d-none" id="plp-title-mobile">Sản phẩm</h5>
                    <div class="search-container">
                        <div class="search-input-group">
                            <button class="search-icon">
                                <i class="ri-search-line"></i>
                            </button>
                            <input type="search" class="search-input" placeholder="Tìm kiếm sản phẩm..." data-translate="search_placeholder">
                            <button class="search-icon camera-icon">
                                <i class="ri-camera-line"></i>
                            </button>
                        </div>
                    </div>
                    <a href="#" class="header-icon" type="button" data-bs-toggle="offcanvas" data-bs-target="#filterOffcanvas">
                        <i class="ri-filter-3-line"></i>
                    </a>
                </div>
            </div>

            <!-- Sort Bar -->
            <div id="plp-sort-bar" class="sort-bar-mobile bg-white py-2 border-bottom sticky-top" style="top: 80px; z-index: 1019;">
                <div class="d-flex justify-content-around align-items-center">
                    <button class="btn btn-sm sort-option active" onclick="handleSortClick('relevance', this)" data-translate="sort_relevance">
                        Liên quan
                    </button>
                    <button class="btn btn-sm sort-option" onclick="handleSortClick('newest', this)" data-translate="sort_newest">
                        Mới nhất
                    </button>
                    <button class="btn btn-sm sort-option" onclick="handleSortClick('popular', this)" data-translate="sort_popular">
                        Bán chạy
                    </button>
                    <button class="btn btn-sm sort-option" onclick="handleSortClick('price', this)" data-sort-direction="asc" data-translate="sort_price">
                        Giá <i class="ri-arrow-up-down-line"></i>
                    </button>
                </div>
            </div>

            <!-- Product Grid Container -->
            <div class="container-fluid py-2" id="plp-container">
                <div class="row row-cols-2 g-2" id="plp-product-grid">
                    <!-- Products will be loaded here -->
                </div>
            </div>

            <style>
            /* Payment Confirmation Popup Styles */
            .payment-popup-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.6);
                z-index: 10000;
                display: none;
                opacity: 0;
                transition: opacity 0.3s ease-out;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }

            .payment-popup-container {
                background: white;
                border-radius: 16px;
                width: 100%;
                max-width: 400px;
                max-height: 90vh;
                overflow: hidden;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                animation: popupSlideIn 0.3s ease-out;
            }

            @keyframes popupSlideIn {
                from {
                    opacity: 0;
                    transform: translateY(30px) scale(0.95);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            .payment-popup-header {
                padding: 20px;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: var(--primary);
            }

            .payment-popup-header h3 {
                margin: 0;
                font-size: 18px;
                font-weight: 600;
                color: var(--white);
            }

            .btn-close-popup {
                background: none;
                border: none;
                font-size: 24px;
                color: var(--gray-600);
                padding: 4px;
                border-radius: 50%;
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .payment-popup-body {
                padding: 20px;
                max-height: 60vh;
                overflow-y: auto;
            }

            .popup-product-info {
                display: flex;
                gap: 12px;
                margin-bottom: 20px;
                padding: 12px;
                background: var(--gray-50);
                border-radius: 8px;
            }

            .popup-product-img {
                width: 60px;
                height: 60px;
                object-fit: cover;
                border-radius: 8px;
            }

            .popup-product-details h4 {
                margin: 0 0 4px 0;
                font-size: 14px;
                font-weight: 600;
                line-height: 1.3;
            }

            .popup-product-details p {
                margin: 0;
                font-size: 12px;
                color: var(--gray-600);
            }

            .popup-price {
                font-weight: 600;
                color: var(--primary) !important;
                font-size: 14px !important;
            }

            .popup-info-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px solid var(--border-color);
            }

            .popup-info-row.total-row {
                border-bottom: none;
                font-weight: 600;
                font-size: 16px;
                color: var(--primary);
                margin-top: 8px;
                padding-top: 12px;
                border-top: 2px solid var(--primary-light);
            }

            .popup-total {
                color: var(--primary);
                font-weight: 700;
                font-size: 18px;
            }

            .payment-popup-footer {
                padding: 20px;
                border-top: 1px solid var(--border-color);
                display: flex;
                gap: 12px;
            }

            .btn-cancel, .btn-confirm {
                flex: 1;
                padding: 12px;
                border: none;
                border-radius: 8px;
                font-weight: 600;
                font-size: 14px;
                cursor: pointer;
                transition: all 0.2s;
            }

            .btn-cancel {
                background: var(--gray-100);
                color: var(--gray-600);
            }

            .btn-confirm {
                background: var(--primary);
                color: white;
            }

                /* Sort Bar Styles */
                .sort-bar-mobile {
                    background: var(--white);
                    border-bottom: 1px solid var(--border-color);
                }

                .sort-option {
                    color: var(--gray-600);
                    font-size: 13px;
                    padding: 4px 8px;
                    border: none;
                    background: none;
                    position: relative;
                    min-width: 70px;
                }

                .sort-option.active {
                    color: var(--primary);
                    font-weight: 500;
                }

                .sort-option.active::after {
                    content: '';
                    position: absolute;
                    bottom: -2px;
                    left: 8px;
                    right: 8px;
                    height: 2px;
                    background: var(--primary);
                    border-radius: 1px;
                }

                .sort-option i {
                    font-size: 16px;
                    vertical-align: middle;
                    margin-left: 2px;
                }
            </style>

            <script>
                // Sort handling function
                function handleSortClick(sortBy, element) {
                    // Remove active class from all sort options
                    document.querySelectorAll('.sort-option').forEach(btn => btn.classList.remove('active'));
                    
                    // Add active class to clicked button
                    element.classList.add('active');
                    
                    // Special handling for price sort
                    if (sortBy === 'price') {
                        const currentDirection = element.getAttribute('data-sort-direction');
                        const newDirection = currentDirection === 'asc' ? 'desc' : 'asc';
                        const icon = element.querySelector('i');
                        
                        // Update direction and icon
                        element.setAttribute('data-sort-direction', newDirection);
                        icon.className = newDirection === 'asc' ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line';
                        
                        // Update actual sort parameter
                        sortBy = `price_${newDirection}`;
                    }
                    
                    // Call loadPLP with sort parameter
                    loadPLP(null, sortBy);
                }

                // Update loadPLP function to handle sorting
                const originalLoadPLP = window.loadPLP || function() {};
                window.loadPLP = function(filterType = null, sortBy = 'relevance') {
                    // Get products
                    let filteredProducts = [...allProducts];
                    
                    // Apply filtering if needed
                    if (filterType) {
                        filteredProducts = filteredProducts.filter(product => 
                            product.category === filterType || product.tags.includes(filterType)
                        );
                    }
                    
                    // Apply sorting
                    switch(sortBy) {
                        case 'price_asc':
                            filteredProducts.sort((a, b) => a.price - b.price);
                            break;
                        case 'price_desc':
                            filteredProducts.sort((a, b) => b.price - a.price);
                            break;
                        case 'newest':
                            filteredProducts.sort((a, b) => (b.id || 0) - (a.id || 0));
                            break;
                        case 'popular':
                            filteredProducts.sort((a, b) => (b.sold_count || 0) - (a.sold_count || 0));
                            break;
                        // 'relevance' is default, no sorting needed
                    }
                    
                    // Generate and update product grid HTML
                    const productGrid = document.getElementById('plp-product-grid');
                    if (!productGrid) return;
                    
                    productGrid.innerHTML = filteredProducts.map(product => `
                        <div class="col">
                            <div class="mobile-product-card-shopee" onclick="showProductDetail('${product.id}')">
                                <!-- Product card content -->
                                <div class="product-card-img-container">
                                    <img src="${product.image}" alt="${product.name}" class="w-100 h-100 object-fit-contain">
                                </div>
                                <div class="p-2">
                                    <h6 class="product-title small mb-1">${product.name}</h6>
                                    <div class="price-container">
                                        <span class="current-price">${formatCurrency(product.price)}</span>
                                        ${product.original_price ? `
                                            <span class="original-price">${formatCurrency(product.original_price)}</span>
                                            <span class="discount-percent">-${Math.round((1 - product.price/product.original_price) * 100)}%</span>
                                        ` : ''}
                                    </div>
                                    ${product.sold_count ? `<div class="sold-count small text-secondary">Đã bán ${product.sold_count}</div>` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('');
                };
            </script>

            <!-- Rest of PLP content -->
            <!-- (Optional) Loading More Indicator -->
            <div class="loading-indicator mt-3" id="plp-loading-more" style="display: none;">
                <div class="spinner-border spinner-border-sm text-primary"></div>
                <span>Đang tải thêm...</span>
             </div>
        </section>
        <!-- End Section PLP -->

        <!-- Filter Offcanvas -->
        <div class="offcanvas offcanvas-end" id="filterOffcanvas">
          <div class="offcanvas-header">
                <h5 class="offcanvas-title">Bộ lọc</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
          </div>
          <div class="offcanvas-body">
                <!-- Vehicle Filter -->
                <div class="filter-section">
                    <h6 class="filter-title">Theo Xe</h6>
                    <select class="form-select mb-2">
                        <option>Chọn hãng xe</option>
                        <option>Toyota</option>
                        <option>Honda</option>
                        <option>Ford</option>
                    </select>
                    <select class="form-select mb-2">
                        <option>Chọn dòng xe</option>
                    </select>
                    <select class="form-select">
                        <option>Chọn năm sản xuất</option>
                    </select>
             </div>

                <!-- Brand Filter -->
                <div class="filter-section">
                    <h6 class="filter-title">Thương hiệu</h6>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="brand1">
                        <label class="form-check-label" for="brand1">Castrol</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="brand2">
                        <label class="form-check-label" for="brand2">Mobil</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="brand3">
                        <label class="form-check-label" for="brand3">Shell</label>
          </div>
        </div>

                <!-- Price Range Filter -->
                <div class="filter-section">
                    <h6 class="filter-title">Khoảng giá</h6>
                    <div class="price-range">
                        <input type="range" class="form-range" min="0" max="10000000" step="100000">
                        <div class="price-inputs">
                            <input type="number" class="form-control" placeholder="Từ">
                            <span>-</span>
                            <input type="number" class="form-control" placeholder="Đến">
            </div>
                    </div>
                </div>

                <!-- Product Attributes -->
                <div class="filter-section">
                    <h6 class="filter-title">Thông số kỹ thuật</h6>
                    <!-- Dynamic attributes based on product category -->
                     </div>
            </div>
            <div class="offcanvas-footer">
                <button class="btn btn-outline-secondary w-100 mb-2" onclick="clearFilters()">Xóa bộ lọc</button>
                <button class="btn btn-primary w-100" onclick="applyFilters()">Áp dụng</button>
            </div>
        </div>

        <!-- SECTION: Product Detail Page (PDP) -->
        <section id="pdp-section" class="section-hidden">
            <!-- PDP Header -->
            <div class="pdp-header">
                <button class="btn-icon" onclick="goBack()">
                    <i class="ri-arrow-left-line"></i>
                </button>
                <div class="pdp-header-actions">
                    <button class="btn-icon" onclick="shareProduct()">
                        <i class="ri-share-forward-line"></i>
                    </button>
                    <!-- Cart Icon -->
                    <button class="btn-icon" onclick="showSection('cart-section')">
                        <i class="ri-shopping-cart-line"></i>
                        <span id="cart-count-badge-mobile" class="header-badge" style="display: none;">0</span>
                    </button>
                    <button class="btn-icon" onclick="toggleWishlist()">
                        <i class="ri-heart-line"></i>
                    </button>
            </div>
                 </div>

            <!-- Product Gallery -->
            <div class="pdp-gallery">
                <div class="swiper-container" id="pdp-gallery-swiper">
                    <div class="swiper-wrapper">
                        <!-- Images will be loaded here by JavaScript -->
                        <div class="swiper-slide">
                            <div class="loading-spinner"></div>
                     </div>
                        </div>
                    <!-- Add Pagination -->
                    <div class="swiper-pagination"></div>
                    <!-- Add Navigation -->
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                        </div>
                        </div>

            <!-- Product Info -->
            <div class="pdp-info">
                <div class="pdp-basic-info">
                    <h1 class="product-name"></h1>
                    <div class="product-meta">
                        <span class="brand"></span>
                        <span class="separator">|</span>
                        <span class="sku"></span>
                     </div>
                    <div class="product-price">
                        <span class="current-price"></span>
                        <span class="original-price"></span>
                        <span class="discount-tag"></span>
                     </div>
                     <div class="product-tags mb-1">
                        <span class="tag-authentic" style="margin-right: 15px;">Chính hãng</span>
                        <span class="tag-deal">Deal</span>
                    </div>
                </div>

                <!-- Specifications -->
                <div class="pdp-specs">
                    <h6>Thông số kỹ thuật</h6>
                    <table class="specs-table">
                        <!-- Specs will be loaded here -->
                    </table>
                </div>

                <!-- Description -->
                <div class="pdp-description">
                    <h6>Mô tả sản phẩm</h6>
                    <div class="description-content">
                        <!-- Description will be loaded here -->
                    </div>
                </div>

                <!-- Product Reviews -->
                <div class="pdp-reviews">
                    <div class="reviews-header">
                        <h6>Đánh giá sản phẩm</h6>
                        <div class="rating-summary">
                            <div class="average-rating">
                                <span class="rating-number">4.8</span>
                                <div class="rating-stars">
                                    <i class="ri-star-fill"></i>
                                    <i class="ri-star-fill"></i>
                                    <i class="ri-star-fill"></i>
                                    <i class="ri-star-fill"></i>
                                    <i class="ri-star-half-fill"></i>
                                </div>
                                <span class="total-reviews">(128 đánh giá)</span>
                            </div>
                            <div class="rating-bars">
                                <div class="rating-bar-item">
                                    <span class="star-label">5 sao</span>
                                    <div class="progress">
                                        <div class="progress-bar" style="width: 85%"></div>
                                    </div>
                                    <span class="count">109</span>
                                </div>
                                <div class="rating-bar-item">
                                    <span class="star-label">4 sao</span>
                                    <div class="progress">
                                        <div class="progress-bar" style="width: 10%"></div>
                                    </div>
                                    <span class="count">13</span>
                                </div>
                                <div class="rating-bar-item">
                                    <span class="star-label">3 sao</span>
                                    <div class="progress">
                                        <div class="progress-bar" style="width: 3%"></div>
                                    </div>
                                    <span class="percent">3%</span>
                                </div>
                                <div class="rating-bar-item">
                                    <span class="star-label">2 sao</span>
                                    <div class="progress">
                                        <div class="progress-bar" style="width: 1%"></div>
                                    </div>
                                    <span class="percent">1%</span>
                                </div>
                                <div class="rating-bar-item">
                                    <span class="star-label">1 sao</span>
                                    <div class="progress">
                                        <div class="progress-bar" style="width: 1%"></div>
                                    </div>
                                    <span class="percent">1%</span>
                                </div>
                            </div>                           
                        </div>                                             
                    </div>

                    <!-- Review List -->
                    <div class="review-list">
                        <!-- Review Item 1 -->
                        <div class="review-item">
                            <div class="reviewer-info">
                                <img src="images/avatar-1.png" alt="User Avatar" class="reviewer-avatar">
                                <div class="reviewer-details">
                                    <div class="reviewer-name">Nguyễn Văn A</div>
                                    <div class="review-date">15/05/2024</div>
                                </div>
                            </div>
                            <div class="review-rating">
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                            </div>
                            <div class="review-content">
                                Sản phẩm chất lượng tốt, đóng gói cẩn thận. Phụ tùng chính hãng, giá cả hợp lý. Shop tư vấn nhiệt tình, giao hàng nhanh. Sẽ ủng hộ shop dài lâu!
                            </div>
                            <div class="review-images">
                                <img src="images/1.jpg" alt="Review Image">
                                <img src="images/2.jpg" alt="Review Image">
                            </div>
                        </div>

                        <!-- Review Item 2 -->
                        <div class="review-item">
                            <div class="reviewer-info">
                                <img src="images/avatar-2.png" alt="User Avatar" class="reviewer-avatar">
                                <div class="reviewer-details">
                                    <div class="reviewer-name">Trần Thị B</div>
                                    <div class="review-date">14/05/2024</div>
                                </div>
                            </div>
                            <div class="review-rating">
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                            </div>
                            <div class="review-content">
                                Lần đầu mua hàng ở shop nhưng rất hài lòng. Phụ tùng chính hãng Bosch, giá tốt hơn các shop khác. Đặc biệt là dịch vụ bảo hành rất tốt!
                            </div>
                        </div>

                        <!-- Review Item 3 -->
                        <div class="review-item">
                            <div class="reviewer-info">
                                <img src="images/avatar-3.png" alt="User Avatar" class="reviewer-avatar">
                                <div class="reviewer-details">
                                    <div class="reviewer-name">Lê Văn C</div>
                                    <div class="review-date">13/05/2024</div>
                                </div>
                            </div>
                            <div class="review-rating">
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                            </div>
                            <div class="review-content">
                                Shop tư vấn rất chuyên nghiệp, giúp mình chọn đúng phụ tùng cần thay. Giá cả phải chăng, sản phẩm chất lượng. Sẽ quay lại ủng hộ!
                            </div>
                            <div class="review-images">
                                <img src="images/3.jpg" alt="Review Image">
                            </div>
                        </div>

                        <!-- Review Item 4 -->
                        <div class="review-item">
                            <div class="reviewer-info">
                                <img src="images/avatar-4.png" alt="User Avatar" class="reviewer-avatar">
                                <div class="reviewer-details">
                                    <div class="reviewer-name">Phạm Thị D</div>
                                    <div class="review-date">12/05/2024</div>
                                </div>
                            </div>
                            <div class="review-rating">
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                            </div>
                            <div class="review-content">
                                Mua lần thứ 2 tại shop, vẫn giữ được chất lượng dịch vụ tốt. Giao hàng nhanh, đóng gói cẩn thận. Nhân viên tư vấn nhiệt tình, am hiểu sản phẩm.
                            </div>
                        </div>

                        <!-- Review Item 5 -->
                        <div class="review-item">
                            <div class="reviewer-info">
                                <img src="images/avatar-5.png" alt="User Avatar" class="reviewer-avatar">
                                <div class="reviewer-details">
                                    <div class="reviewer-name">Hoàng Văn E</div>
                                    <div class="review-date">11/05/2024</div>
                                </div>
                            </div>
                            <div class="review-rating">
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                            </div>
                            <div class="review-content">
                                Phụ tùng chính hãng, giá tốt. Shop có dịch vụ bảo hành lâu dài, rất yên tâm khi mua hàng. Nhân viên tư vấn chuyên nghiệp, nhiệt tình.
                            </div>
                            <div class="review-images">
                                <img src="images/4.jpg" alt="Review Image">
                                <img src="images/5.jpg" alt="Review Image">
                            </div>
                        </div>
                        <div class="view-all-reviews">
                            <button class="btn-view-all" onclick="alert('Tính năng đang phát triển')">
                                <span>Xem tất cả đánh giá</span>
                                <i class="ri-arrow-right-s-line"></i>
                    </button>
                        </div>
                    </div>
                 </div>

                <!-- Shop Info -->
                <div class="pdp-shop-info">
                    <div class="shop-avatar">
                        <img src="images/shop_logo.png" alt="Shop Avatar">
                        </div>
                    <div class="shop-details">
                        <h6 class="shop-name">Shope Demo LTA</h6>
                        <div class="shop-rating">
                            <span>5</span>
                            <span class="rating-stars ri-star-fill"></span>
                            <span class="rating-count">(999)</span>
                        </div>
                        </div>
                    <button class="btn btn-outline-primary btn-sm">Xem Shop</button>
                        </div>
                     </div>

            <!-- Bottom Action Bar -->
            <div class="pdp-action-bar">
                <div class="action-buttons">
                    <button class="btn-chat" onclick="chatWithShop()">
                        <i class="ri-message-3-line"></i>
                        <span>Chat</span>
                    </button>
                    <button class="btn-cart" onclick="handleAddToCartPDP()" id="pdp-add-to-cart-pdp-mobile" data-product-id="">
                        <i class="ri-shopping-cart-line"></i>
                        <span>Thêm vào giỏ</span>
                    </button>
                    <button class="btn-buy" onclick="handleBuyNowPDP()" id="pdp-buy-now-btn">
                        <span>Mua ngay</span>
                        <small class="fw-normal mt-1" id="pdp-buy-now-price" style="font-size: 1em;"></small>
                    </button>
                </div>
            </div>
        </section>

        <!-- SECTION: Cart -->
        <section id="cart-section" class="section-hidden">
            <!-- Cart Header -->
            <header class="header fixed-top px-3 d-flex" id="cart-header">
                <div class="d-flex align-items-center justify-content-between w-100">
                <!-- Back Button -->
                    <a href="#" class="header-icon pe-0" onclick="goBack()">
                    <i class="ri-arrow-left-line"></i>
                    </a>
                        
                        <!-- Title -->
                        <h5 class="header-title mb-0" data-translate="cart_title">Giỏ hàng</h5>
                        
                    <!-- Edit Button -->
                    <a href="#" class="header-icon pe-0" onclick="editCart()">
                        <i class="ri-edit-line"></i>
                    </a>
            </div>
            </header>

            <div class="cart-content">
                <div class="cart-items" id="cart-items-container">
                    <div class="cart-item">
                        
                        <!-- Cart Item 1 (Tĩnh - Cấu trúc mới cho swipe) -->
                        <div class="mobile-cart-item-swipe-wrapper position-relative mb-2" data-product-id="EO001-STATIC"> <!-- Thay ID tĩnh nếu cần -->                            
                            <div class="mobile-cart-item-content bg-white p-2 border rounded d-flex align-items-start gap-2">
                                <!-- Nội dung item-image, item-details, quantity-control giữ nguyên như trên -->
                                <div class="item-checkbox">
                                    <input type="checkbox" checked class="form-check-input">
                                </div>
                                <img src="images/1.jpg" alt="Lọc dầu Bosch" class="mobile-cart-item-img flex-shrink-0" onerror="this.src='images/placeholder.jpg'">
                                <div class="item-details flex-grow-1">
                                    <div class="item-name small fw-medium">Lọc dầu động cơ Bosch 0986AF1038</div>
                                    <div class="item-price small mt-1">185.000 ₫</div>
                                    <div class="quantity-controls mt-2">
                                        <button class="quantity-btn btn-sm border" onclick="alert('Giảm số lượng cho EO001-STATIC')"><i class="ri-subtract-line"></i></button>
                                        <input type="number" class="quantity-input mx-1 form-control form-control-sm text-center" value="1" min="1">
                                        <button class="quantity-btn btn-sm border" onclick="alert('Tăng số lượng cho EO001-STATIC')"><i class="ri-add-line"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="swipe-delete-action bg-danger text-white d-flex align-items-center justify-content-center position-absolute top-0 end-0 h-100" style="width: 70px; z-index: 0; border-radius: 0 8px 8px 0; cursor: pointer;">
                                <i class="ri-delete-bin-line fs-5"></i>
                            </div>
                        </div>
                </div>
                
                    <div class="cart-item">
                        
                        <!-- Cart Item 2 (Tĩnh - Cấu trúc mới cho swipe) -->
                        <div class="mobile-cart-item-swipe-wrapper position-relative mb-2" data-product-id="EO002-STATIC"> <!-- Thay ID tĩnh nếu cần -->
                            <div class="mobile-cart-item-content bg-white p-2 border rounded d-flex align-items-start gap-2">
                                <!-- Nội dung item-image, item-details, quantity-control giữ nguyên như trên -->
                                <div class="item-checkbox">
                                    <input type="checkbox" checked class="form-check-input">
                 </div>
                                <img src="images/2.jpg" alt="Má phanh Denso" class="mobile-cart-item-img flex-shrink-0" onerror="this.src='images/placeholder.jpg'">
                            
                                <div class="item-details flex-grow-1">
                                    <div class="item-name small fw-medium">Má phanh trước Denso 0446533492</div>
                                    <div class="item-price small mt-1">750.000 ₫</div>
                                    <div class="quantity-controls mt-2">
                                        <button class="quantity-btn btn-sm border" onclick="alert('Giảm số lượng cho EO002-STATIC')"><i class="ri-subtract-line"></i></button>
                                        <input type="number" class="quantity-input mx-1 form-control form-control-sm text-center" value="1" min="1">
                                        <button class="quantity-btn btn-sm border" onclick="alert('Tăng số lượng cho EO002-STATIC')"><i class="ri-add-line"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="swipe-delete-action bg-danger text-white d-flex align-items-center justify-content-center position-absolute top-0 end-0 h-100" style="width: 70px; z-index: 0; border-radius: 0 8px 8px 0; cursor: pointer;">
                                <i class="ri-delete-bin-line fs-5"></i>
                            </div>
                 </div>
             </div>

                    <div class="cart-item">
                        
                        <!-- Cart Item 3 (Tĩnh - Cấu trúc mới cho swipe) -->
                        <div class="mobile-cart-item-swipe-wrapper position-relative mb-2" data-product-id="EO003-STATIC"> <!-- Thay ID tĩnh nếu cần -->
                            <div class="mobile-cart-item-content bg-white p-2 border rounded d-flex align-items-start gap-2">
                                <!-- Nội dung item-image, item-details, quantity-control giữ nguyên như trên -->
                                <div class="item-checkbox">
                                    <input type="checkbox" checked class="form-check-input">
                     </div>
                                <img src="images/3.jpg" alt="Lọc gió động cơ Mann C27192" class="mobile-cart-item-img flex-shrink-0" onerror="this.src='images/placeholder.jpg'">
                                
                                <div class="item-details flex-grow-1">
                                    <div class="item-name small fw-medium">Lọc gió động cơ Mann C27192</div>
                                    <div class="item-price small mt-1">320.000 ₫</div>
                                    <div class="quantity-controls mt-2">
                                        <button class="quantity-btn btn-sm border" onclick="alert('Giảm số lượng cho EO003-STATIC')"><i class="ri-subtract-line"></i></button>
                                        <input type="number" class="quantity-input mx-1 form-control form-control-sm text-center" value="1" min="1">
                                        <button class="quantity-btn btn-sm border" onclick="alert('Tăng số lượng cho EO003-STATIC')"><i class="ri-add-line"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="swipe-delete-action bg-danger text-white d-flex align-items-center justify-content-center position-absolute top-0 end-0 h-100" style="width: 70px; z-index: 0; border-radius: 0 8px 8px 0; cursor: pointer;">
                                <i class="ri-delete-bin-line fs-5"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Tạm tính</span>
                        <span class="subtotal">2.005.000 ₫</span>
                    </div>
                    <div class="summary-row">
                        <span>Giảm giá</span>
                        <span class="discount">265.000 ₫</span>
                    </div>
                    <div class="summary-row total">
                        <span>Tổng cộng</span>
                        <span class="total-amount">1.740.000 ₫</span>
                    </div>
                </div>
            </div>

            <div class="cart-footer">
                <div class="voucher-input">
                    <input type="text" placeholder="Nhập mã giảm giá">
                    <button class="btn-apply">Áp dụng</button>
                 </div>
                <button class="btn-checkout" onclick="initializeCheckout()">
                    Thanh toán (<span class="cart-count">0</span>)
                                </button>
             </div>
        </section>

        <!-- SECTION: Checkout -->
        <section id="checkout-section" class="section-hidden">
            <div class="checkout-header">
                <button class="btn-back" onclick="goBack()">
                    <i class="ri-arrow-left-line"></i>
                                </button>
                <h1 class="header-title">Thanh toán</h1>
                    </div>

            <div class="checkout-content">
                <!-- Address -->
                <div class="checkout-address">
                    <i class="ri-map-pin-2-line address-icon"></i>
                    <div class="address-details">
                        <div class="address-name">Nguyễn Văn A</div>
                        <div class="address-phone">(+84) 999 999 999</div>
                        <div class="address-text">123 Đường A, Quận B, TP. Hồ Chí Minh</div>
                    </div>
                    <button class="btn-icon" onclick="editAddress()">
                        <i class="ri-arrow-right-s-line"></i>
                    </button>
            </div>

                <!-- Shop & Items -->
                <div class="checkout-shop">
                    <div class="shop-header">
                        <i class="ri-store-2-line"></i>
                        <h2 class="shop-name">Shop Demo LTA</h2>
                 </div>
                    <div class="checkout-items" id="checkout-items-container">
                        <!-- Items will be populated by JavaScript -->
                 </div>
                    <!-- Order Summary for instant orders -->
                    <div id="checkout-order-summary">
                        <!-- Instant order items will be populated here -->
                 </div>
                 </div>

                <!-- Shipping -->
                <div class="shipping-section">
                    <div class="shipping-header">
                        <h3 class="shipping-title">Phương thức vận chuyển</h3>
            </div>
                    <div class="shipping-options">
                        <div class="shipping-option" onclick="selectShipping('standard')">
                            <input type="radio" name="shipping" value="standard">
                            <div class="shipping-option-details">
                                <div class="shipping-name">Tiêu chuẩn</div>
                                <div class="shipping-info">Nhận hàng vào 8-9 Th05</div>
                </div>
                            <div class="shipping-fee">30.000₫</div>
                 </div>
                        <div class="shipping-option" onclick="selectShipping('express')">
                            <input type="radio" name="shipping" value="express">
                            <div class="shipping-option-details">
                                <div class="shipping-name">Hỏa tốc</div>
                                <div class="shipping-info">Nhận hàng vào hôm nay</div>
                 </div>
                            <div class="shipping-fee">50.000₫</div>
             </div>
                 </div>
            </div>

                <!-- Voucher -->
                <div class="voucher-section">
                    <div class="voucher-header">
                        <h3 class="voucher-title">
                            <i class="ri-coupon-3-line"></i>
                            Voucher của Shop
                        </h3>
                </div>
                    <div class="voucher-content" onclick="showVoucherList()">
                        <div class="voucher-input">
                            <i class="ri-price-tag-3-line"></i>
                            <span id="selected-voucher">Chọn hoặc nhập mã</span>
                 </div>
                        <i class="ri-arrow-right-s-line"></i>
                 </div>
             </div>

                <!-- Payment -->
                <div class="payment-section">
                    <div class="payment-header">
                        <h3 class="payment-title">Phương thức thanh toán</h3>
                 </div>
                    <div class="payment-methods">
                        <div class="payment-method" onclick="selectPayment('cod')">
                            <input type="radio" name="payment" value="cod">
                            <div class="payment-method-icon">
                                <i class="ri-money-dollar-box-line"></i>
                 </div>
                            <div class="payment-method-details">
                                <div class="payment-name">Thanh toán khi nhận hàng</div>
                 </div>
             </div>
                        <div class="payment-method" onclick="selectPayment('onestop')">
                            <input type="radio" name="payment" value="onestop">
                            <div class="payment-method-icon">
                                <i class="ri-wallet-3-line"></i>
                 </div>
                            <div class="payment-method-details">
                                <div class="payment-name">Quỹ OneStop@LTA</div>
                                <div class="onestop-balance">
                                    <span class="balance-amount">500.000₫</span>
                                    <button class="btn-topup" onclick="showTopupDialog()">Nạp tiền</button>
                                </div>
                            </div>
                        </div>
                        <div class="payment-method" onclick="selectPayment('bank')">
                            <input type="radio" name="payment" value="bank">
                            <div class="payment-method-icon">
                                <i class="ri-bank-card-line"></i>
                            </div>
                            <div class="payment-method-details">
                                <div class="payment-name">Thẻ ngân hàng</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Summary -->
                <div class="checkout-summary">
                    <div class="summary-row">
                        <span>Tổng tiền hàng</span>
                        <span id="checkout-subtotal">0₫</span>
                    </div>
                    <div class="summary-row">
                        <span>Phí vận chuyển</span>
                        <span id="checkout-shipping">0₫</span>
                    </div>
                    <div class="summary-row" id="voucher-discount-row" style="display: none;">
                        <span>Giảm giá</span>
                        <span id="checkout-discount" class="discount-amount">-0₫</span>
                    </div>
                    <div class="summary-row total-row">
                        <span>Tổng thanh toán</span>
                        <span id="checkout-total" class="total-amount">0₫</span>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="checkout-footer row">
                <div class="checkout-total col-7">
                    <div class="total-label">Tổng thanh toán</div>
                    <div class="total-value" id="checkout-footer-total">0₫</div>
                </div>
                <div class="col-5">
                    <button class="btn-place-order" onclick="showPaymentConfirmation()">Đặt hàng</button>
                 </div>
             </div>
        </section>

        <!-- SECTION: Order Confirmation (ORD-03) - Mobile Optimized -->
        <section id="confirmation-section" class="section-hidden text-center px-2 py-4">
             <i class="ri-checkbox-circle-line fa-3x text-success mb-2"></i>
            <h5 class="mb-2">Đặt hàng thành công!</h5>
            <p class="small">Mã đơn hàng: <strong id="conf-order-id">#LTA-DEMO-XYZ</strong></p>
            <p class="small mb-3">Cảm ơn bạn đã mua hàng.</p>
            <a href="#homepage-section" class="btn btn-primary btn-sm" onclick="showSection('homepage-section')">Về Trang chủ</a>
        </section>
        
        <!-- SECTION: Notifications -->
        <section id="notifications-section" class="section-hidden">
            <!-- Notifications Header -->
            <header class="header sticky-top py-2 px-3" id="notifications-header">
                <div class="d-flex align-items-center justify-content-between w-100">                   
                    <!-- Title -->
                    <h5 class="mb-0 flex-grow-1 text-center text-white" data-translate="notifications_title">Thông báo</h5>
                </div>
            </header>

            <!-- Notification Tabs -->
            <div class="notification-tabs">
                <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#promotions" type="button">
                            Khuyến mãi
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#system" type="button">
                            Hệ thống
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#orders" type="button">
                            Đơn hàng
                        </button>
                    </li>
                </ul>
                    </div>

            <!-- Notification Content -->
            <div class="tab-content">
                <!-- Promotions Tab -->
                <div class="tab-pane fade show active" id="promotions">
                    <div class="notification-list">
                        <a href="#" class="notification-item unread">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSCMgruq2y5dDrsrjGcJYt2ItgeROBtP7-s4w&s" alt="Shell" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">🔥 Flash Sale: Giảm 50% cho đơn dầu Shell Helix đầu tiên</div>
                                <div class="notification-time">2 giờ trước</div>
                    </div>
                            <div class="notification-badge"></div>
                        </a>
                        <a href="#" class="notification-item unread">
                            <img src="https://logos-download.com/wp-content/uploads/2016/02/Castrol_logo_2D_transparent.png" alt="Castrol" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">Castrol MAGNATEC - Mua 4 tặng 1, áp dụng đến hết tháng</div>
                                <div class="notification-time">5 giờ trước</div>
                    </div>
                            <div class="notification-badge"></div>
                        </a>
                        <a href="#" class="notification-item">
                            <img src="https://logowik.com/content/uploads/images/motul2246.logowik.com.webp" alt="Motul" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">Flash Sale Motul 8100 - Giảm đến 30% cho tất cả sản phẩm</div>
                                <div class="notification-time">1 ngày trước</div>
                    </div>
                        </a>
                    </div>
                    </div>

                <!-- System Tab -->
                <div class="tab-pane fade" id="system">
                    <div class="notification-list">
                        <a href="#" class="notification-item unread">
                            <img src="images/logo_white.png" alt="i-LogiCare" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">Chào mừng bạn đến với i-LogiCare! Nhận ngay voucher 100K</div>
                                <div class="notification-time">2 ngày trước</div>
                    </div>
                            <div class="notification-badge"></div>
                        </a>
                        <a href="#" class="notification-item">
                            <img src="images/logo_white.png" alt="i-LogiCare" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">Cập nhật chính sách bảo mật mới từ i-LogiCare</div>
                                <div class="notification-time">5 ngày trước</div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Orders Tab -->
                <div class="tab-pane fade" id="orders">
                    <div class="notification-list">
                        <a href="#" class="notification-item unread">
                            <img src="images/delivery.png" alt="Delivery" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">Đơn hàng #LTA123456 đã được giao thành công</div>
                                <div class="notification-time">3 giờ trước</div>
                    </div>
                            <div class="notification-badge"></div>
                        </a>
                        <a href="#" class="notification-item">
                            <img src="images/delivery.png" alt="Delivery" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">Đơn hàng #LTA123455 đang được vận chuyển</div>
                                <div class="notification-time">1 ngày trước</div>
                            </div>
                        </a>
                        <a href="#" class="notification-item">
                            <img src="images/delivery.png" alt="Delivery" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">Đơn hàng #LTA123454 đã được xác nhận</div>
                                <div class="notification-time">2 ngày trước</div>
                            </div>
                        </a>
                    </div>
                        </div>
                    </div>
        </section>

        <!-- SECTION: Account Dashboard -->
        <section id="account-section" class="section-hidden">
            <!-- Account Header -->
            <header class="header sticky-top py-2 px-3" id="account-header">
                <div class="d-flex align-items-center justify-content-between w-100">
                    <!-- Title -->
                    <h5 class="mb-0 flex-grow-1 text-white" data-translate="my_account_title">Tài khoản của tôi</h5>
                    <!-- Right Icons -->
                    <div class="d-flex align-items-center">
                        <!-- Setting Icon -->
                        <a href="#" class="header-icon" onclick="showSection('settings-section')">
                            <i class="ri-settings-2-line"></i>
                        </a>
                        <!-- Cart Icon -->
                        <a href="#cart-section" class="header-icon header-icon--cart" onclick="showSection('cart-section')">
                            <i class="ri-shopping-cart-line"></i>
                            <span id="cart-count-badge-mobile" class="header-badge" style="display: none;">0</span>
                        </a>
                        <!-- Chat Messages Icon -->
                        <a href="chat-messages.html" class="header-icon">
                            <i class="ri-message-3-line"></i>
                        </a>
                    </div>
                </div>
            </header>

            <!-- Logged-in Account Info (hidden by default) -->
            <div id="logged-in-account-info" class="d-none">
                <div class="account-info d-flex align-items-center">
                    <img src="https://cdn.iconscout.com/icon/free/png-256/free-avatar-icon-download-in-svg-png-gif-file-formats--user-business-man-avatars-flat-icons-pack-people-456324.png" alt="User Avatar" class="account-avatar rounded-circle me-3">
                    <div class="flex-grow-1">
                        <h5 id="account-username" class="account-username">Nguyễn Văn A</h5>
                        <span class="small">Thành viên Kim cương</span>
                        <i class="ri-vip-diamond-fill ms-1" style="font-size: 24px; color: #00C9A7;"></i>
                    </div>
                    <div>
                        <button class="btn-icon me-2" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-edit-box-line"></i>
                        </button>
                    </div>
                </div>

                <!-- Order Status -->
                <div class="order-status-grid">
                    <div class="section-title">
                        Đơn Mua
                    </div>
                    <div class="row row-cols-4 g-2">
                        <div class="col">
                            <a href="orders.html?tab=pending" class="order-status-item">
                                <i class="ri-wallet-line"></i>
                                <span class="small">Chờ xác nhận</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="pending" style="display:none;">0</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="orders.html?tab=pickup" class="order-status-item">
                                <i class="ri-box-3-line"></i>
                                <span class="small">Chờ lấy hàng</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="pickup" style="display:none;">0</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="orders.html?tab=shipping" class="order-status-item">
                                <i class="ri-truck-line"></i>
                                <span class="small">Đang giao</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="shipping" style="display:none;">0</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="orders.html?tab=review" class="order-status-item">
                                <i class="ri-star-line"></i>
                                <span class="small">Đánh giá</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="review" style="display:none;">0</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- My Utilities -->
                <div class="utilities-section">
                    <div class="section-title">Tiện ích của tôi</div>
                    <div class="row row-cols-4 g-2">
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="openVehicleFilter()">
                                <i class="ri-car-line"></i>
                                <span class="small">Xe của tôi</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="onestop-fund.html" class="order-status-item">
                                <i class="ri-wallet-3-line"></i>
                                <span class="small">Quỹ OneStop</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="onestop-fund.html" class="order-status-item">
                                <i class="ri-coin-line"></i>
                                <span class="small">Kho xu</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="voucher.html" class="order-status-item">
                                <i class="ri-coupon-3-line"></i>
                                <span class="small">Kho Voucher</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Other Utilities -->
                <div class="utilities-section">
                    <div class="section-title">
                        Tiện ích khác
                        <a href="#" onclick="alert('Đang phát triển')">Xem tất cả</a>
                    </div>
                    <div class="list-group list-group-flush utility-list">
                        <!-- Seller Registration Entry Point (Dynamic) -->
                        <div id="seller-registration-entry" class="d-none">
                            <a href="SellerOnboarding/SellerInfoBasicScreen.html" class="list-group-item list-group-item-action d-flex align-items-center seller-registration-btn">
                                <i class="ri-store-3-line me-3 text-primary"></i>
                                <div class="flex-grow-1">
                                    <span class="fw-medium">Trở thành Người bán</span>
                                    <div class="small text-muted">Mở shop và bán hàng trên i-LogiCare</div>
                                </div>
                                <i class="ri-arrow-right-s-line ms-auto"></i>
                            </a>
                        </div>
                        
                        <!-- Seller Center Entry Point (Dynamic) -->
                        <div id="seller-center-entry" class="d-none">
                            <a href="#" class="list-group-item list-group-item-action d-flex align-items-center seller-center-btn" onclick="navigateToSellerCenter()">
                                <i class="ri-dashboard-3-line me-3 text-success"></i>
                                <div class="flex-grow-1">
                                    <span class="fw-medium">Kênh Người bán</span>
                                    <div class="small text-muted">Quản lý shop và đơn hàng</div>
                                </div>
                                <i class="ri-arrow-right-s-line ms-auto"></i>
                            </a>
                        </div>
                        
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-heart-line me-3"></i>
                            <span>Đã thích</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-history-line me-3"></i>
                            <span>Mua lại</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                        <a href="orders.html?tab=review" class="list-group-item list-group-item-action d-flex align-items-center">
                            <i class="ri-message-2-line me-3"></i>
                            <span>Đánh giá của tôi</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" onclick="showSection('contact-section')">
                            <i class="ri-question-line me-3"></i>
                            <span>Trung tâm hỗ trợ</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Not logged in account info (shown by default) -->
            <div id="not-logged-in-account-info">
                <div class="account-info d-flex align-items-center">
                    <img src="https://cdn.iconscout.com/icon/free/png-256/free-avatar-icon-download-in-svg-png-gif-file-formats--user-business-man-avatars-flat-icons-pack-people-456324.png" alt="User Avatar" class="account-avatar rounded-circle me-3">
                    <button type="button" class="btn btn-outline-secondary" onclick="showSection('login-section')">
                        Đăng nhập/Đăng ký
                    </button>
                </div>
                <!-- Order Status -->
                <div class="order-status-grid">
                    <div class="section-title">
                        Đơn Mua
                    </div>
                    <div class="row row-cols-4 g-2">
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="showLoginRequiredPopup(); return false;">
                                <i class="ri-wallet-line"></i>
                                <span class="small">Chờ xác nhận</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="pending" style="display:none;">0</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="showLoginRequiredPopup(); return false;">
                                <i class="ri-box-3-line"></i>
                                <span class="small">Chờ lấy hàng</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="pickup" style="display:none;">0</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="showLoginRequiredPopup(); return false;">
                                <i class="ri-truck-line"></i>
                                <span class="small">Đang giao</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="shipping" style="display:none;">0</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="showLoginRequiredPopup(); return false;">
                                <i class="ri-star-line"></i>
                                <span class="small">Đánh giá</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="review" style="display:none;">0</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- My Utilities -->
                <div class="utilities-section">
                    <div class="section-title">Tiện ích của tôi</div>
                    <div class="row row-cols-4 g-2">
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="openVehicleFilter()">
                                <i class="ri-car-line"></i>
                                <span class="small">Xe của tôi</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="showLoginRequiredPopup(); return false;">
                                <i class="ri-wallet-3-line"></i>
                                <span class="small">Quỹ OneStop</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="showLoginRequiredPopup(); return false;">
                                <i class="ri-coin-line"></i>
                                <span class="small">Kho xu</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="showLoginRequiredPopup(); return false;">
                                <i class="ri-coupon-3-line"></i>
                                <span class="small">Kho Voucher</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Other Utilities -->
                <div class="utilities-section">
                    <div class="section-title">
                        Tiện ích khác
                        <a href="#" onclick="alert('Đang phát triển')">Xem tất cả</a>
                    </div>
                    <div class="list-group list-group-flush utility-list">
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" onclick="showLoginRequiredPopup(); return false;">
                            <i class="ri-heart-line me-3"></i>
                            <span>Đã thích</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" onclick="showLoginRequiredPopup(); return false;">
                            <i class="ri-history-line me-3"></i>
                            <span>Mua lại</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" onclick="showLoginRequiredPopup(); return false;">
                            <i class="ri-message-2-line me-3"></i>
                            <span>Đánh giá của tôi</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" onclick="showSection('contact-section')">
                            <i class="ri-question-line me-3"></i>
                            <span>Trung tâm hỗ trợ</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: Settings -->
        <section id="settings-section" class="section-hidden">
            <!-- Settings Header -->
            <header class="header fixed-top px-3 d-flex" id="settings-header">
                <div class="d-flex align-items-center justify-content-between w-100">
                    <!-- Back Button -->
                    <a href="#" class="header-icon pe-0" onclick="goBack()">
                    <i class="ri-arrow-left-line"></i>
                </a>
                    
                    <!-- Title -->
                    <h5 class="header-title mb-0">Cài đặt</h5>
                    
                    <!-- Empty div for alignment -->
                    <div style="width: 24px;"></div>
            </div>
            </header>

            <div class="settings-content" style="padding-top: 80px; padding-bottom: 80px;">
                <!-- User Info Section -->
                <div id="settings-user-info" class="bg-white m-3 p-3 rounded shadow-sm d-none">
                    <div class="d-flex align-items-center mb-3">
                        <img src="https://cdn.iconscout.com/icon/free/png-256/free-avatar-icon-download-in-svg-png-gif-file-formats--user-business-man-avatars-flat-icons-pack-people-456324.png" 
                             alt="User Avatar" class="rounded-circle me-3" style="width: 60px; height: 60px; object-fit: cover;">
                        <div class="flex-grow-1">
                            <h6 id="settings-username" class="mb-1">Người dùng</h6>
                            <p id="settings-email" class="mb-0 text-muted small">user@example.com</p>
                        </div>
                        </div>
                    </div>

                <!-- Settings Menu -->
                <div class="settings-menu bg-white m-3 rounded shadow-sm">
                    <!-- Account Settings -->
                    <div class="settings-section">
                        <div class="settings-section-title p-3 border-bottom">
                            <h6 class="mb-0 text-muted">Tài khoản</h6>
                        </div>
                        
                        <a href="#" class="settings-item d-flex align-items-center p-3 border-bottom" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-user-line me-3 text-primary"></i>
                            <div class="flex-grow-1">
                                <span>Thông tin cá nhân</span>
                                <div class="small text-muted">Quản lý thông tin tài khoản</div>
                        </div>
                            <i class="ri-arrow-right-s-line"></i>
                        </a>
                        
                        <a href="#" class="settings-item d-flex align-items-center p-3 border-bottom" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-map-pin-line me-3 text-primary"></i>
                            <div class="flex-grow-1">
                                <span>Địa chỉ giao hàng</span>
                                <div class="small text-muted">Quản lý địa chỉ nhận hàng</div>
                    </div>
                            <i class="ri-arrow-right-s-line"></i>
                        </a>
                        
                        <a href="#" class="settings-item d-flex align-items-center p-3" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-lock-line me-3 text-primary"></i>
                            <div class="flex-grow-1">
                                <span>Đổi mật khẩu</span>
                                <div class="small text-muted">Cập nhật mật khẩu bảo mật</div>
                        </div>
                            <i class="ri-arrow-right-s-line"></i>
                        </a>
                        </div>

                    <!-- App Settings -->
                    <div class="settings-section mt-3">
                        <div class="settings-section-title p-3 border-bottom">
                            <h6 class="mb-0 text-muted">Ứng dụng</h6>
                    </div>
                        
                        <div class="settings-item d-flex align-items-center justify-content-between p-3 border-bottom">
                            <div class="d-flex align-items-center">
                                <i class="ri-notification-line me-3 text-primary"></i>
                                <div>
                                    <span>Thông báo</span>
                                    <div class="small text-muted">Nhận thông báo đơn hàng, khuyến mãi</div>
                </div>
            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="notificationSwitch" checked>
            </div>
                </div>
                        
                        <div class="settings-item d-flex align-items-center justify-content-between p-3 border-bottom">
                            <div class="d-flex align-items-center">
                                <i class="ri-global-line me-3 text-primary"></i>
                                <div>
                                    <span>Ngôn ngữ</span>
                                    <div class="small text-muted">Tiếng Việt</div>
                                </div>
                            </div>
                            <i class="ri-arrow-right-s-line"></i>
            </div>

                        <div class="settings-item d-flex align-items-center justify-content-between p-3">
                            <div class="d-flex align-items-center">
                                <i class="ri-moon-line me-3 text-primary"></i>
                                <div>
                                    <span>Chế độ tối</span>
                                    <div class="small text-muted">Giao diện tối cho mắt</div>
                            </div>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="darkModeSwitch">
                            </div>
                    </div>
                </div>

                    <!-- Support -->
                    <div class="settings-section mt-3">
                        <div class="settings-section-title p-3 border-bottom">
                            <h6 class="mb-0 text-muted">Hỗ trợ</h6>
                            </div>
                        
                        <a href="#" class="settings-item d-flex align-items-center p-3 border-bottom" onclick="showSection('contact-section')">
                            <i class="ri-customer-service-line me-3 text-primary"></i>
                            <div class="flex-grow-1">
                                <span>Trung tâm hỗ trợ</span>
                                <div class="small text-muted">Liên hệ với chúng tôi</div>
                            </div>
                            <i class="ri-arrow-right-s-line"></i>
                        </a>
                        
                        <a href="#" class="settings-item d-flex align-items-center p-3 border-bottom" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-question-line me-3 text-primary"></i>
                            <div class="flex-grow-1">
                                <span>Câu hỏi thường gặp</span>
                                <div class="small text-muted">Tìm câu trả lời nhanh chóng</div>
                            </div>
                            <i class="ri-arrow-right-s-line"></i>
                        </a>
                        
                        <a href="#" class="settings-item d-flex align-items-center p-3" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-information-line me-3 text-primary"></i>
                            <div class="flex-grow-1">
                                <span>Về i-LogiCare</span>
                                <div class="small text-muted">Phiên bản 1.0.0</div>
                            </div>
                            <i class="ri-arrow-right-s-line"></i>
                        </a>
                    </div>

                    <!-- Logout Section -->
                    <div id="settings-logout-section" class="settings-section mt-3 d-none">
                        <a href="#" class="settings-item d-flex align-items-center p-3 text-danger" onclick="confirmLogout()">
                            <i class="ri-logout-box-line me-3"></i>
                            <div class="flex-grow-1">
                                <span>Đăng xuất</span>
                                <div class="small">Thoát khỏi tài khoản hiện tại</div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: Contact/Support -->
        <section id="contact-section" class="section-hidden">
            <!-- Contact Header -->
            <header class="header fixed-top px-3 d-flex" id="contact-header">
                <div class="d-flex align-items-center justify-content-between w-100">
                    <!-- Back Button -->
                    <a href="#" class="header-icon pe-0" onclick="goBack()">
                        <i class="ri-arrow-left-line"></i>
                    </a>
                    
                    <!-- Title -->
                    <h5 class="header-title mb-0">Hỗ trợ</h5>
                    
                    <!-- Empty div for alignment -->
                    <div style="width: 24px;"></div>
                </div>
            </header>

            <div class="contact-content" style="padding-top: 80px; padding-bottom: 80px;">
                <!-- Quick Actions -->
                <div class="quick-support-actions p-3">
                    <div class="row g-2">
                        <div class="col-6">
                            <div class="support-action-card p-3 text-center border rounded" onclick="alert('Chat với chúng tôi đang phát triển')">
                                <i class="ri-message-3-line fs-2 text-primary mb-2"></i>
                                <div>
                                    <h6 class="mb-0">Chat trực tiếp</h6>
                                    <small class="text-muted">24/7</small>
                </div>
                </div>
                </div>
                        <div class="col-6">
                            <div class="support-action-card p-3 text-center border rounded" onclick="window.open('tel:19001234')">
                                <i class="ri-phone-line fs-2 text-primary mb-2"></i>
                                <div>
                                    <h6 class="mb-0">Gọi hotline</h6>
                                    <small class="text-muted">1900 1234</small>
                </div>
            </div>
                    </div>
                </div>
            </div>

                <!-- Contact Information -->
                <div class="contact-info bg-white m-3 p-3 rounded shadow-sm">
                    <h6 class="mb-3">Thông tin liên hệ</h6>
                    
                    <div class="contact-item d-flex align-items-center mb-3">
                        <div class="contact-icon me-3">
                            <i class="ri-phone-line fs-4 text-primary"></i>
                </div>
                        <div class="contact-details">
                            <h6 class="mb-0">Hotline</h6>
                            <p class="mb-0 text-muted">1900 1234 (24/7)</p>
                    </div>
                </div>

                    <div class="contact-item d-flex align-items-center mb-3">
                        <div class="contact-icon me-3">
                            <i class="ri-mail-line fs-4 text-primary"></i>
                            </div>
                        <div class="contact-details">
                            <h6 class="mb-0">Email</h6>
                            <p class="mb-0 text-muted">support@i-logicare.com</p>
                    </div>
                </div>

                    <div class="contact-item d-flex align-items-center mb-3">
                        <div class="contact-icon me-3">
                            <i class="ri-map-pin-line fs-4 text-primary"></i>
                            </div>
                        <div class="contact-details">
                            <h6 class="mb-0">Địa chỉ</h6>
                            <p class="mb-0 text-muted">123 Đường ABC, Quận 1, TP. Hồ Chí Minh</p>
                            </div>
                            </div>

                    <div class="contact-item d-flex align-items-center">
                        <div class="contact-icon me-3">
                            <i class="ri-time-line fs-4 text-primary"></i>
                </div>
                        <div class="contact-details">
                            <h6 class="mb-0">Giờ làm việc</h6>
                            <p class="mb-0 text-muted">Thứ 2 - Chủ nhật: 8:00 - 22:00</p>
                </div>
                </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Bottom Navigation -->
    <nav class="navbar fixed-bottom bottom-nav" id="bottom-nav">
        <!-- Home -->
            <a class="bottom-nav-icon active" href="#homepage-section" onclick="showSection('homepage-section')">
            <i class="ri-home-5-fill"></i>
                <span>Trang chủ</span>
            </a>
        <!-- Categories -->
            <a class="bottom-nav-icon" href="#plp-section" onclick="loadPLP(); showSection('plp-section');">
            <i class="ri-dashboard-line"></i>
            <span>Danh mục</span>
        </a>
        <!-- Find by Vehicle -->
        <a class="bottom-nav-icon bottom-nav-icon--center" href="#plp-section" onclick="openVehicleFilter()">
            <div class="bottom-nav-icon-circle">
                <i class="ri-car-line"></i>
            </div>
            <span>Tìm theo xe</span>
        </a>
        <!-- Notifications -->
        <a class="bottom-nav-icon" href="#notifications-section" onclick="showSection('notifications-section')">
            <i class="ri-notification-3-line"></i>
            <span>Thông báo</span>
        </a>
        <!-- Account -->
            <a class="bottom-nav-icon" href="#account-section" onclick="showSection('account-section')">
                <i class="ri-user-line"></i>
                <span>Tài khoản</span>
            </a>

        
    </nav>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- Embedded Product Data & JS Logic (ADAPTED for Mobile) -->
    <script>
        // --- Global Variables ---
        let productData = {};
        let allProducts = [];
        let productDataLoaded = false;
        let sectionHistory = ['homepage-section'];
        let currentLang = localStorage.getItem('iLogiCareLang') || 'vi';
        let cart = [];

        // --- DOM Elements ---
        const allSections = document.querySelectorAll('main > section');
        const cartCountBadgeBottom = document.getElementById('cart-count-badge-bottom');
        const cartItemsListContainer = document.getElementById('cart-items-list');
        const cartSubtotalEl = document.getElementById('cart-subtotal');
        const cartTotalEl = document.getElementById('cart-total');
        const cartEmptyMsg = document.getElementById('cart-empty-msg');
        const cartLoading = document.getElementById('cart-loading');
        const cartSummary = document.getElementById('cart-summary');

        // Header and nav references
        const mainHeader = document.getElementById('main-header');
        const bottomNav = document.getElementById('bottom-nav');
        const notificationsHeader = document.getElementById('notifications-header');
        const contactHeader = document.getElementById('contact-header');
        const settingsHeader = document.getElementById('settings-header');
        const plpHeader = document.getElementById('plp-header');
        const pdpHeader = document.getElementById('pdp-header');
        const accountHeader = document.getElementById('account-header');
        const cartHeader = document.getElementById('cart-header');
        const checkoutHeader = document.getElementById('checkout-header');
        const pageBanner = document.getElementById('page-banner');

        // Supabase Configuration
        const SUPABASE_URL = 'https://rowpswmsgomytqrkcdlt.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvd3Bzd21zZ29teXRxcmtjZGx0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcxMjEwODYsImV4cCI6MjA2MjY5NzA4Nn0.nbR_KVbpcVpSWBdkUGTdIJ9eLPFOemALJfLaT-AQa0I';
        let supabaseClient = null;

        try {
            if (typeof window.supabase !== 'undefined' && typeof window.supabase.createClient === 'function') {
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                console.log('Supabase client initialized successfully in index.html');
            } else {
                console.error("Supabase JS library (window.supabase.createClient) is not available in index.html.");
            }
        } catch (error) {
            console.error("Error initializing Supabase client in index.html:", error);
        }

        // Utility Functions
        function safeQuerySelector(selector) {
            const element = document.querySelector(selector);
            if (!element) {
                console.warn(`Element not found: ${selector}`);
            }
            return element;
        }

        function formatCurrency(amount) {
            if (typeof amount !== 'number') amount = Number(amount) || 0;
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }

        // Load PDP Function
        async function loadPDP(productId) {
            if (!productId) return;
            
            console.log('Loading PDP for product ID:', productId);
            
            // Store current product ID in sessionStorage for fallback
            sessionStorage.setItem('currentProductId', productId);
            
            // Ensure product data is loaded
            if (!productDataLoaded) {
                console.log('Product data not loaded, loading now...');
                await loadProductData();
            }

            // Find the product
            const product = allProducts.find(p => p.id === productId);
            if (!product) {
                console.error('Product not found:', productId);
                return;
            }

            // Show loading state in key elements
            showPDPLoadingState();

            try {
                // Fetch product data from Supabase
                console.log('Loading product with ID:', productId);
                
                const { data: product, error } = await supabaseClient
                    .from('products')
                    .select(`
                        *,
                        sellers(shop_name)
                    `)
                    .eq('id', productId)
                    .eq('status', 'published')
                    .eq('visibility', 'public')
                    .single();

                if (error) {
                    console.error("Supabase error fetching product:", error);
                    throw new Error(`Database error: ${error.message}`);
                }

                if (!product) {
                    console.error("Product not found for ID:", productId);
                    throw new Error('Product not found');
                }

                console.log("Product loaded successfully from Supabase:", product);

                // Show the PDP section first
                showSection('pdp-section');

                // Render product data to UI
                renderPDPData(product);

                // Update page title
                document.title = `${product.name} - i-LogiCare`;

            } catch (error) {
                console.error("Error loading PDP:", error);
                
                // Show error in product info areas
                showPDPErrorState(error);
                
                // Show user-friendly error message
                const errorMessage = error.message.includes('not found') 
                    ? 'Sản phẩm không tồn tại hoặc đã bị xóa.'
                    : 'Có lỗi khi tải thông tin sản phẩm. Vui lòng thử lại sau.';
                    
                alert(currentLang === 'vi' ? errorMessage : 'Error loading product details. Please try again.');
                
                // Redirect to homepage after 2 seconds
                setTimeout(() => {
                    showSection('homepage-section');
                }, 2000);
            }
        }

        // Show PDP loading state (lighter version)
        function showPDPLoadingState() {
            // Show loading in product name
            const productNameEl = document.querySelector('.product-name');
            if (productNameEl) productNameEl.textContent = 'Đang tải sản phẩm...';

            // Show loading in price
            const currentPriceEl = document.querySelector('.current-price');
            if (currentPriceEl) currentPriceEl.textContent = 'Đang tải...';

            // Show loading in gallery
            const swiperWrapper = document.querySelector('#pdp-gallery-swiper .swiper-wrapper');
            if (swiperWrapper) {
                swiperWrapper.innerHTML = `
                    <div class="swiper-slide">
                        <div class="d-flex justify-content-center align-items-center" style="height: 300px; background: #f8f9fa;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Đang tải...</span>
            </div>
                    </div>
                </div>
                `;
            }

            // Show loading in description
            const descContent = document.querySelector('.description-content');
            if (descContent) descContent.innerHTML = '<p class="text-muted">Đang tải mô tả...</p>';

            // Show loading in specs
            const specsTable = document.querySelector('.specs-table');
            if (specsTable) specsTable.innerHTML = '<tr><td colspan="2" class="text-muted">Đang tải thông số...</td></tr>';

            // Disable action buttons
            const addToCartBtn = document.querySelector('#pdp-add-to-cart-pdp-mobile');
            const buyNowBtn = document.querySelector('#pdp-buy-now-btn');
            if (addToCartBtn) addToCartBtn.disabled = true;
            if (buyNowBtn) buyNowBtn.disabled = true;
        }

        // Show PDP error state (lighter version)
        function showPDPErrorState(error) {
            // Show error in product name
            const productNameEl = document.querySelector('.product-name');
            if (productNameEl) productNameEl.textContent = 'Lỗi tải sản phẩm';

            // Show error in gallery
            const swiperWrapper = document.querySelector('#pdp-gallery-swiper .swiper-wrapper');
            if (swiperWrapper) {
                swiperWrapper.innerHTML = `
                    <div class="swiper-slide">
                        <div class="d-flex flex-column justify-content-center align-items-center text-center" style="height: 300px; background: #f8f9fa;">
                            <i class="ri-error-warning-line text-danger mb-2" style="font-size: 48px;"></i>
                            <p class="text-muted">Không thể tải hình ảnh</p>
                        </div>
                    </div>
                `;
            }

            // Show error in description
            const descContent = document.querySelector('.description-content');
            if (descContent) descContent.innerHTML = '<p class="text-danger">Không thể tải mô tả sản phẩm.</p>';
        }

        // Render PDP data to UI
        function renderPDPData(product) {
            const pdpContainer = document.querySelector('#pdp-section');
            if (!pdpContainer) {
                console.error('PDP container not found');
                return;
            }

            // Get image URLs
            let productImages = [];
            if (product.image_urls && Array.isArray(product.image_urls) && product.image_urls.length > 0) {
                productImages = product.image_urls;
            } else if (product.main_image) {
                productImages = [product.main_image];
            } else {
                productImages = ['images/placeholder.jpg'];
            }

            // Calculate prices and discount
            const currentPrice = parseFloat(product.price) || 0;
            const originalPrice = parseFloat(product.base_price || product.original_price) || 0;
            let discountPercent = 0;
            if (originalPrice && originalPrice > currentPrice) {
                discountPercent = Math.round(((originalPrice - currentPrice) / originalPrice) * 100);
            }

            // Update gallery images
            const swiperWrapper = pdpContainer.querySelector('.swiper-wrapper');
            if (swiperWrapper) {
                swiperWrapper.innerHTML = productImages.map((url, index) => `
                    <div class="swiper-slide">
                        <img src="${url}" 
                             alt="${product.name} - Hình ${index + 1}" 
                             class="img-fluid w-100" 
                             style="height: 300px; object-fit: cover;"
                             loading="${index === 0 ? 'eager' : 'lazy'}"
                             onerror="this.onerror=null; this.src='images/placeholder.jpg';">
                    </div>
                `).join('');

                // Initialize Swiper for gallery
                setTimeout(() => {
                    if (typeof Swiper !== 'undefined') {
                        // Destroy existing swiper if any
                        const existingSwiper = document.querySelector('#pdp-gallery-swiper .swiper-container');
                        if (existingSwiper && existingSwiper.swiper) {
                            existingSwiper.swiper.destroy(true, true);
                        }

                        new Swiper('#pdp-gallery-swiper', {
                            slidesPerView: 1,
                            spaceBetween: 0,
                            pagination: {
                                el: '.swiper-pagination',
                                clickable: true,
                            },
                            navigation: {
                                nextEl: '.swiper-button-next',
                                prevEl: '.swiper-button-prev',
                            },
                            autoHeight: false,
                        });
                    }
                }, 100);
            }

            // Update product basic info
            const productNameEl = pdpContainer.querySelector('.product-name');
            const brandEl = pdpContainer.querySelector('.brand');
            const skuEl = pdpContainer.querySelector('.sku');
            
            if (productNameEl) productNameEl.textContent = product.name || 'Tên sản phẩm không có';
            if (brandEl) brandEl.textContent = product.brand || 'Chưa có thương hiệu';
            if (skuEl) skuEl.textContent = product.sku || 'N/A';

            // Update price
            const currentPriceEl = pdpContainer.querySelector('.current-price');
            const originalPriceEl = pdpContainer.querySelector('.original-price');
            const discountTagEl = pdpContainer.querySelector('.discount-tag');

            if (currentPriceEl) currentPriceEl.textContent = formatCurrency(currentPrice);

            if (originalPrice > currentPrice) {
                if (originalPriceEl) {
                    originalPriceEl.textContent = formatCurrency(originalPrice);
                    originalPriceEl.style.display = 'inline';
                }
                if (discountTagEl) {
                    discountTagEl.textContent = `-${discountPercent}%`;
                    discountTagEl.style.display = 'inline-block';
                }
            } else {
                if (originalPriceEl) originalPriceEl.style.display = 'none';
                if (discountTagEl) discountTagEl.style.display = 'none';
            }

            // Update specifications
            const specsTable = pdpContainer.querySelector('.specs-table');
            if (specsTable) {
                if (product.specifications) {
                    try {
                        let specs = product.specifications;
                        if (typeof specs === 'string') {
                            specs = JSON.parse(specs);
                        }
                        
                        console.log('Rendering specifications for mobile product:', product.id, specs);
                        
                        if (specs && typeof specs === 'object' && Object.keys(specs).length > 0) {
                            let specsHTML = '';
                            
                            for (const [key, spec] of Object.entries(specs)) {
                                // Handle both new format (object with label, value, type) and legacy format (direct value)
                                let displayLabel = '';
                                let displayValue = '';
                                
                                if (typeof spec === 'object' && spec.label && spec.value !== undefined) {
                                    // New format with structured data
                                    displayLabel = spec.label;
                                    displayValue = spec.value;
                                    
                                    // Don't display empty values
                                    if (!displayValue || displayValue.toString().trim() === '') {
                                        continue;
                                    }
                                } else if (typeof spec === 'string' || typeof spec === 'number') {
                                    // Legacy format - direct value
                                    displayValue = spec;
                                    
                                    // Generate readable labels for legacy format
                                    if (key === 'viscosity') { displayLabel = 'Độ nhớt SAE'; }
                                    else if (key === 'api_quality') { displayLabel = 'Cấp chất lượng API'; }
                                    else if (key === 'capacity') { displayLabel = 'Dung tích (Lít)'; }
                                    else if (key === 'oil_type') { displayLabel = 'Loại dầu'; }
                                    else if (key === 'engine_type') { displayLabel = 'Loại động cơ'; }
                                    else if (key === 'filter_type') { displayLabel = 'Loại lọc'; }
                                    else if (key === 'part_number') { displayLabel = 'Mã phụ tùng'; }
                                    else if (key === 'vehicle_compatibility') { displayLabel = 'Tương thích xe'; }
                                    else if (key === 'tire_size') { displayLabel = 'Kích thước lốp'; }
                                    else if (key === 'pattern_code') { displayLabel = 'Mã gai'; }
                                    else if (key === 'load_speed_index') { displayLabel = 'Chỉ số tải trọng/tốc độ'; }
                                    else if (key === 'insurance_type') { displayLabel = 'Loại bảo hiểm'; }
                                    else if (key === 'coverage_level') { displayLabel = 'Mức độ bảo hiểm'; }
                                    else if (key === 'duration') { displayLabel = 'Thời hạn'; }
                                    else if (key === 'service_type') { displayLabel = 'Loại dịch vụ'; }
                                    else if (key === 'device_type') { displayLabel = 'Loại thiết bị'; }
                                    else if (key === 'power_consumption') { displayLabel = 'Công suất tiêu thụ'; }
                                    else if (key === 'connectivity') { displayLabel = 'Kết nối'; }
                                    else if (key === 'installation_type') { displayLabel = 'Cách lắp đặt'; }
                                    else if (key === 'warranty_period') { displayLabel = 'Thời gian bảo hành'; }
                                    else if (key === 'compatibility') { displayLabel = 'Tương thích'; }
                                    else if (key === 'service_duration') { displayLabel = 'Thời gian thực hiện'; }
                                    else if (key === 'location_type') { displayLabel = 'Địa điểm thực hiện'; }
                                    else if (key === 'skill_level') { displayLabel = 'Trình độ yêu cầu'; }
                                    else if (key === 'certification') { displayLabel = 'Chứng chỉ'; }
                                    else if (key === 'material') { displayLabel = 'Chất liệu'; }
                                    else if (key === 'origin') { displayLabel = 'Xuất xứ'; }
                                    else if (key === 'filtration_efficiency') { displayLabel = 'Hiệu suất lọc'; }
                                    else if (key === 'replacement_interval') { displayLabel = 'Chu kỳ thay thế'; }
                                    else if (key === 'season_type') { displayLabel = 'Loại mùa'; }
                                    else if (key === 'sidewall_type') { displayLabel = 'Loại thành lốp'; }
                                    else if (key === 'coverage_amount') { displayLabel = 'Số tiền bảo hiểm'; }
                                    else if (key === 'deductible') { displayLabel = 'Mức khấu trừ'; }
                                    else if (key === 'part_category') { displayLabel = 'Danh mục phụ tùng'; }
                                    else {
                                        // Default: convert snake_case to readable format
                                        displayLabel = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                                    }
                                    
                                    // Don't display empty values
                                    if (!displayValue || displayValue.toString().trim() === '') {
                                        continue;
                                    }
                                } else {
                                    continue; // Skip invalid specification entries
                                }

                                specsHTML += `<tr><td class="fw-medium">${displayLabel}</td><td>${displayValue}</td></tr>`;
                            }
                            
                            // If no valid specifications were rendered
                            if (specsHTML === '') {
                                specsTable.innerHTML = '<tr><td colspan="2" class="text-muted">Không có thông số kỹ thuật</td></tr>';
                            } else {
                                specsTable.innerHTML = specsHTML;
                            }
                        } else {
                            specsTable.innerHTML = '<tr><td colspan="2" class="text-muted">Không có thông số kỹ thuật</td></tr>';
                        }
                    } catch (e) {
                        console.error("Error parsing specifications:", e);
                        specsTable.innerHTML = '<tr><td colspan="2" class="text-danger">Lỗi hiển thị thông số kỹ thuật</td></tr>';
                    }
                } else {
                    specsTable.innerHTML = '<tr><td colspan="2" class="text-muted">Không có thông số kỹ thuật</td></tr>';
                }
            }

            // Update description
            const descContent = pdpContainer.querySelector('.description-content');
            if (descContent) {
                const description = product.description || product.detailed_description || '';
                if (description) {
                    descContent.innerHTML = description.replace(/\n/g, '<br>');
            } else {
                    descContent.innerHTML = '<p class="text-muted">Không có mô tả chi tiết.</p>';
                }
            }

            // Update shop information
            const shopNameEl = pdpContainer.querySelector('.shop-name');
            if (shopNameEl) {
                const shopName = product.sellers?.shop_name || 'Shop Demo LTA';
                shopNameEl.textContent = shopName;
            }

            // Update action buttons
            const addToCartBtn = pdpContainer.querySelector('#pdp-add-to-cart-pdp-mobile');
            const buyNowBtn = pdpContainer.querySelector('#pdp-buy-now-btn');
            const buyNowPriceEl = pdpContainer.querySelector('#pdp-buy-now-price');

            const isInStock = product.stock_status === 'in_stock' || product.quantity > 0;
            
            if (addToCartBtn) {
                addToCartBtn.dataset.productId = product.id;
                addToCartBtn.disabled = !isInStock;
                if (!isInStock) {
                    addToCartBtn.innerHTML = '<i class="ri-shopping-cart-line"></i><span>Hết hàng</span>';
                } else {
                    addToCartBtn.innerHTML = '<i class="ri-shopping-cart-line"></i><span>Thêm vào giỏ</span>';
                }
            }
            
            if (buyNowBtn) {
                buyNowBtn.dataset.productId = product.id;
                buyNowBtn.disabled = !isInStock;
            }
            
            if (buyNowPriceEl) {
                buyNowPriceEl.textContent = formatCurrency(currentPrice);
            }

            // Update reviews section with demo data based on product
            updateReviewsWithDemoData(product);

            console.log('PDP data rendered successfully for product:', product.name);
        }

        // Update reviews section with demo data
        function updateReviewsWithDemoData(product) {
            // Generate realistic review stats based on product
            const soldCount = parseInt(product.sold_count) || 0;
            const reviewCount = Math.max(5, Math.floor(soldCount * 0.15)); // 15% of sold items have reviews
            const avgRating = 4.2 + Math.random() * 0.6; // Random between 4.2-4.8

            // Update rating summary
            const avgRatingEl = document.querySelector('.average-rating .rating-number');
            const totalReviewsEl = document.querySelector('.total-reviews');
            
            if (avgRatingEl) avgRatingEl.textContent = avgRating.toFixed(1);
            if (totalReviewsEl) totalReviewsEl.textContent = `(${reviewCount} đánh giá)`;

            // Update rating stars
            const ratingStars = document.querySelector('.rating-stars');
            if (ratingStars) {
                const fullStars = Math.floor(avgRating);
                const hasHalfStar = avgRating % 1 >= 0.5;
                
                let starsHTML = '';
                for (let i = 0; i < fullStars; i++) {
                    starsHTML += '<i class="ri-star-fill"></i>';
                }
                if (hasHalfStar) {
                    starsHTML += '<i class="ri-star-half-fill"></i>';
                }
                for (let i = fullStars + (hasHalfStar ? 1 : 0); i < 5; i++) {
                    starsHTML += '<i class="ri-star-line"></i>';
                }
                ratingStars.innerHTML = starsHTML;
            }

            // Update rating bars with realistic distribution
            const ratingBars = document.querySelectorAll('.rating-bar-item');
            const distribution = [85, 10, 3, 1, 1]; // 5,4,3,2,1 star percentages
            
            ratingBars.forEach((bar, index) => {
                const progressBar = bar.querySelector('.progress-bar');
                const countEl = bar.querySelector('.count');
                
                if (progressBar) progressBar.style.width = `${distribution[index]}%`;
                if (countEl) {
                    const count = Math.floor((reviewCount * distribution[index]) / 100);
                    countEl.textContent = count;
                }
            });
        }

        async function loadAccountData() {
            console.log("Loading account data...");
            // 1. Cập nhật thông tin người dùng (tên, avatar,...) nếu cần
            const isAuthenticated = localStorage.getItem('userAuthenticated') === 'true';
            const userName = localStorage.getItem('userName');
            const loggedInInfo = document.getElementById('logged-in-account-info');
            const notLoggedInInfo = document.getElementById('not-logged-in-account-info');
            const badgeElement = document.querySelector(`.order-status-item .badge[data-status-count="${status}"]`);

            if (isAuthenticated) {
                if (loggedInInfo) {
                    loggedInInfo.classList.remove('d-none');
                    const accountUsernameEl = document.getElementById('account-username');
                    if (accountUsernameEl && userName) {
                        accountUsernameEl.textContent = userName;
                    }
                }
                if (notLoggedInInfo) notLoggedInInfo.classList.add('d-none');
                checkSellerStatusAndUpdateUI(); // Cập nhật trạng thái seller
            } else {
                if (loggedInInfo) loggedInInfo.classList.add('d-none');
                if (notLoggedInInfo) notLoggedInInfo.classList.remove('d-none');
                hideSellerButtons();
            }


            // 2. (Tùy chọn) Lấy số lượng đơn hàng cho mỗi trạng thái để hiển thị badge
            if (supabaseClient && isAuthenticated) {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (user) {
                    const statuses = ['pending', 'pickup', 'shipping', 'review']; // Các trạng thái bạn muốn đếm
                    for (const status of statuses) {
                        try {
                            const { count, error } = await supabaseClient
                                .from('orders')
                                .select('*', { count: 'exact', head: true })
                                .eq('user_id', user.id)
                                .eq('status', status);

                            if (error) {
                                console.warn(`Error fetching count for status ${status}:`, error.message);
                            } else {
                                const badgeElement = document.querySelector(`.order-status-item[href="orders.html?tab=${status}"] .badge`);
                                
                                if (badgeElement) {
                                    if (count > 0) {
                                        badgeElement.textContent = count > 9 ? '9+' : count;
                                        badgeElement.style.display = 'inline-block';
                                    } else {
                                        badgeElement.style.display = 'none';
                                    }
                                }
                            }
                        } catch (e) {
                            console.error(`Exception fetching count for status ${status}:`, e);
                        }
                    }
                }
            }
            console.log("Account data update finished.");
        }

        // --- Enhanced show section for different headers ---
        function showSection(sectionId) {
            console.log("Attempting to show section:", sectionId);
            
            // Add to section history for back navigation
            addToSectionHistory(sectionId);
            
             allSections.forEach(section => {
                section.classList.add('section-hidden');
            });

            // Hide all headers first
            if (mainHeader) mainHeader.style.display = 'none';
            if (bottomNav) bottomNav.style.display = 'none';
            if (accountHeader) accountHeader.style.display = 'none';
            if (notificationsHeader) notificationsHeader.style.display = 'none';
            if (contactHeader) contactHeader.style.display = 'none';
            if (settingsHeader) settingsHeader.style.display = 'none';
            if (plpHeader) plpHeader.style.display = 'none';
            if (pdpHeader) pdpHeader.style.display = 'none';
            if (cartHeader) cartHeader.style.display = 'none';
            if (checkoutHeader) checkoutHeader.style.display = 'none';
            if (pageBanner) pageBanner.classList.add('section-hidden');

            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('section-hidden');
            } else {
                console.error("Target section not found:", sectionId);
                document.getElementById('homepage-section').classList.remove('section-hidden');
                if (mainHeader) mainHeader.style.display = 'flex';
                if (bottomNav) bottomNav.style.display = 'flex';
                 return;
             }

            // Show appropriate headers based on section
            switch(sectionId) {
                case 'homepage-section':
                    if (mainHeader) mainHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                    if (pageBanner) pageBanner.classList.add('section-hidden');
                    break;
                    
                case 'plp-section':
                    if (plpHeader) plpHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                    if (pageBanner) pageBanner.classList.remove('section-hidden');
                    break;
                    
                case 'pdp-section':
                    if (pdpHeader) pdpHeader.style.display = 'flex';
                    if (pageBanner) pageBanner.classList.remove('section-hidden');
                    break;
                    
                case 'account-section':
                    if (accountHeader) accountHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                    if (typeof loadAccountData === "function") {
                        loadAccountData();
                    }
                    break;
                    
                case 'notifications-section':
                    if (notificationsHeader) notificationsHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                    break;
                    
                case 'contact-section':
                    if (contactHeader) contactHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                    break;
                    
                case 'settings-section':
                    if (settingsHeader) settingsHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                    updateSettingsUI();
                    break;
                    
                case 'cart-section':
                    if (cartHeader) cartHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                    break;
                    
                case 'checkout-section':
                    if (checkoutHeader) checkoutHeader.style.display = 'flex';
                    break;
                    
                default:
                    if (mainHeader) mainHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                break;
            }

            // Update active bottom nav
            updateBottomNavActive(sectionId);
            window.scrollTo(0, 0);
         }

        function updateBottomNavActive(sectionId) {
            const navLinks = document.querySelectorAll('.bottom-nav-icon');
            navLinks.forEach(link => link.classList.remove('active'));

            let activeSelector = '';
            switch(sectionId) {
                case 'homepage-section':
                    activeSelector = 'a[href="#homepage-section"]';
                    break;
                case 'plp-section':
                    activeSelector = 'a[href="#plp-section"]';
                    break;
                case 'find-by-vehicle-section':
                case 'plp-section-vehicle-filter':
                    activeSelector = 'a[href="#plp-section"]';
                    break;
                case 'notifications-section':
                    activeSelector = 'a[href="#notifications-section"]';
                    break;
                case 'account-section':
                    activeSelector = 'a[href="#account-section"]';
                    break;
            }

            if (activeSelector) {
                const activeLink = document.querySelector(activeSelector);
                if (activeLink) activeLink.classList.add('active');
            }
        }

        // Function to open vehicle filter
        function openVehicleFilter() {
            console.log("Opening vehicle filter...");
            
            // First navigate to PLP section
            loadPLP();
            showSection('plp-section');
            
            // Wait a bit for section to load, then open filter
            setTimeout(() => {
                try {
                    // Get the filter offcanvas
                    const filterOffcanvas = document.getElementById('filterOffcanvas');
                    if (filterOffcanvas) {
                        // Use Bootstrap's offcanvas API to show the filter
                        const offcanvas = new bootstrap.Offcanvas(filterOffcanvas);
                        offcanvas.show();
                        
                        // Scroll to vehicle filter section within the offcanvas
                        setTimeout(() => {
                            const vehicleFilterSection = filterOffcanvas.querySelector('.filter-section');
                            if (vehicleFilterSection) {
                                vehicleFilterSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            }
                        }, 300);
                        
                        console.log("Vehicle filter opened successfully");
                    } else {
                        console.error("Filter offcanvas not found");
                    }
                } catch (error) {
                    console.error("Error opening vehicle filter:", error);
                }
            }, 100);
        }

        // Restore Supabase session on app start
        async function restoreSupabaseSession() {
            try {
                const storedToken = localStorage.getItem('supabase.auth.token');
                if (storedToken && supabaseClient) {
                    const session = JSON.parse(storedToken);
                    console.log('Restoring Supabase session...', session);
                    
                    // Verify if session is still valid
                    const { data: authUser, error } = await supabaseClient.auth.getUser();
                    if (authUser?.user) {
                        console.log('Session restored successfully:', authUser.user.id);
                        
                        // Update localStorage with current session data
                        localStorage.setItem('userId', authUser.user.id);
                        localStorage.setItem('userEmail', authUser.user.email);
                        localStorage.setItem('userAuthenticated', 'true');
                    } else {
                        console.log('Session expired, clearing stored session');
                        localStorage.removeItem('supabase.auth.token');
                        localStorage.setItem('userAuthenticated', 'false');
                    }
                }
            } catch (error) {
                console.error('Error restoring session:', error);
                localStorage.removeItem('supabase.auth.token');
                localStorage.setItem('userAuthenticated', 'false');
            }
        }

        // Initialization
        document.addEventListener('DOMContentLoaded', async () => {
            allSections.forEach(section => {
                if (section.id !== 'homepage-section') {
                    section.classList.add('section-hidden');
                }
            });

            const pageBanner = document.getElementById('page-banner');
            if (pageBanner) {
                pageBanner.classList.add('section-hidden');
            }

            // Restore Supabase session first
            await restoreSupabaseSession();

            // Load cart data
            loadCartFromLocalStorage();

            // Apply initial language
            applyLanguage(currentLang);
            
            // Update language dropdown active state
            updateLanguageDropdownState();

            // Initialize language dropdown functionality
            initLanguageDropdown();

            // Update authentication UI
            updateAuthenticationStatus();

            // Fetch product data on load
            fetchProductData();
        });

        // Update language dropdown active state
        function updateLanguageDropdownState() {
            const languageItems = document.querySelectorAll('.language-item');
            languageItems.forEach(item => {
                const itemLang = item.getAttribute('data-lang');
                const activeIndicator = item.querySelector('.active-indicator');
                if (activeIndicator) {
                    activeIndicator.style.display = itemLang === currentLang ? 'inline' : 'none';
                }
            });
        }

        // --- Product Loading Functions ---
        async function fetchProductData() {
            if (!supabaseClient) {
                console.error("Supabase client is not initialized. Cannot fetch products.");
                productData = { products: [] };
                allProducts = [];
                productDataLoaded = false;
                 return;
             }

            console.log("Fetching products from Supabase...");
            try {
                const { data, error } = await supabaseClient
                    .from('products')
                    .select('id, sku, category, name, brand, description, specifications, price, image_urls, stock_status, compatibility, short_description, product_type, base_price, market_price, manage_stock, stock_quantity, low_stock_threshold, weight, dimensions_cm, tags, status, visibility, average_rating, review_count, sold_count, meta_title, meta_description, published_at, seller_id')
                    .eq('status', 'published')
                    .eq('visibility', 'public')
                    .order('published_at', { ascending: false });

                if (error) {
                    console.error('Error fetching products from Supabase:', error);
                    throw error;
                }

                console.log("Data received from Supabase in fetchProductData:", data); // <<! LOG QUAN TRỌNG
                if (data && data.length > 0) {
                    console.log("First product from Supabase data:", data[0]); // Xem chi tiết sản phẩm đầu tiên
                    if (typeof data[0].seller_id === 'undefined') {
                        console.error("CRITICAL: seller_id is undefined in data from Supabase!");
                    }
                }

                allProducts = data || [];
                productData = { products: allProducts };
                productDataLoaded = true;
                console.log("Products loaded successfully from Supabase:", allProducts.length, "products");

                // Load homepage content after data is ready
                loadHomepageRecommendations();

            } catch (e) {
                console.error('Failed to fetch products from Supabase:', e);
                allProducts = [];
                productData = { products: [] };
                productDataLoaded = false;
                const plpGrid = document.getElementById('plp-product-grid');
                if (plpGrid) plpGrid.innerHTML = `<div class="col-12"><p class="text-center text-danger">Lỗi tải dữ liệu sản phẩm. Vui lòng thử lại.</p></div>`;
                const recommendationsGrid = document.getElementById('recommendations-grid');
                if (recommendationsGrid) recommendationsGrid.innerHTML = `<div class="col-12"><p class="text-center text-danger">Lỗi tải gợi ý sản phẩm.</p></div>`;
            }
        }

        // --- PLP Functions ---
        function loadPLP(filterType = null) {
            if (!productDataLoaded) {
                console.log("loadPLP called but data not ready yet, fetching...");
                fetchProductData().then(() => loadPLP(filterType));
                return;
            }

             const gridContainer = document.getElementById('plp-product-grid');
            const titleEl = document.getElementById('plp-title-mobile');

            if (!gridContainer || !titleEl) {
                console.error("PLP container or title element not found!");
                return;
            }

            gridContainer.innerHTML = '<div class="col-12"><div class="text-center p-3"><div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div></div>';
            titleEl.textContent = "Đang tải...";

             if (!allProducts || allProducts.length === 0) {
                gridContainer.innerHTML = '<div class="col-12"><p class="text-center text-muted small">Chưa có dữ liệu sản phẩm...</p></div>';
                titleEl.textContent = "Sản phẩm";
                 return;
             }

             let filteredProducts = allProducts;
             let categoryNameVi = "Tất cả Sản phẩm";
             let categoryNameEn = "All Products";

             if (filterType) {
                filteredProducts = allProducts.filter(p => p.category === filterType || p.product_type === filterType);
                switch (filterType) {
                    case 'engine_oil': categoryNameVi = "Dầu nhớt"; categoryNameEn = "Engine Oil"; break;
                    case 'oil_filter': categoryNameVi = "Lọc dầu"; categoryNameEn = "Oil Filter"; break;
                    case 'tire': categoryNameVi = "Lốp xe"; categoryNameEn = "Tires"; break;
                    case 'electronics': categoryNameVi = "Phụ tùng điện"; categoryNameEn = "Electronics"; break;
                    default: categoryNameVi = "Sản phẩm"; categoryNameEn = "Products";
                }
            }

             titleEl.textContent = currentLang === 'vi' ? categoryNameVi : categoryNameEn;
             titleEl.setAttribute('data-lang-vi', categoryNameVi);
             titleEl.setAttribute('data-lang-en', categoryNameEn);

            gridContainer.innerHTML = '';

             if (filteredProducts.length === 0) {
                gridContainer.innerHTML = `<div class="col-12"><p class="text-center text-muted small">Không tìm thấy sản phẩm.</p></div>`;
             } else {
                 gridContainer.innerHTML = filteredProducts.map(product => renderMobileProductCard(product)).join('');
             }

            applyLanguage(currentLang);
         }

        function renderMobileProductCard(product) {
            if (!product) return '';

            const isOutOfStock = product.stock_status !== 'in_stock';
            const cardAction = !isOutOfStock ? `onclick="loadPDP('${product.id}'); showSection('pdp-section');"` : '';
            const cardCursor = !isOutOfStock ? 'cursor:pointer;' : 'cursor:default;';

            const rating = parseFloat(product.average_rating) || 0;
            const soldCount = parseInt(product.sold_count) || 0;
            const reviewCount = parseInt(product.review_count) || 0;

            let discountPercent = 0;
            let displayOriginalPrice = '';
            if (product.base_price && product.base_price > product.price) {
                discountPercent = Math.round(((product.base_price - product.price) / product.base_price) * 100);
                displayOriginalPrice = formatCurrency(product.base_price);
            }

            const displayPrice = formatCurrency(product.price);
            const displaySoldCount = formatSoldCount(soldCount);

            const imageUrl = (product.image_urls && product.image_urls.length > 0) ? product.image_urls[0] : 'images/placeholder.jpg';

            let overlayBadgesHTML = '';
            if (discountPercent > 0) {
                overlayBadgesHTML += `<span class="overlay-badge overlay-badge-discount"><span class="percent">${discountPercent}%</span><span class="label">GIẢM</span></span>`;
            }

             return `
                <div class="col-6">
                    <div class="card mobile-product-card-shopee h-100 overflow-hidden" ${cardAction} style="${cardCursor}">
                        <div class="product-card-img-container position-relative">
                            <img src="${imageUrl}" class="card-img-top product-card-img" alt="${product.name}" onerror="this.onerror=null; this.src='images/placeholder.jpg';">
                            ${ overlayBadgesHTML ? `<div class="product-overlays">${overlayBadgesHTML}</div>` : '' }
                            ${isOutOfStock ? '<div class="stock-overlay"><span class="badge bg-dark bg-opacity-75">Hết hàng</span></div>' : ''}
                        </div>
                        <div class="card-body d-flex flex-column p-2">
                            <p class="product-card-title mb-1">${product.name || 'N/A'}</p>
                            <div class="price-container mt-auto mb-1">
                                <span class="shopee-price">${displayPrice}</span>
                                ${displayOriginalPrice ? `<span class="original-price">${displayOriginalPrice}</span>` : ''}
                                ${discountPercent > 0 ? `<span class="discount-percent">-${discountPercent}%</span>` : ''}
                            </div>
                            <div class="rating-sold-info d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center gap-1">
                                    ${rating > 0 ? `<i class="ri-star-fill" style="color:#FFC107;font-size:11px;"></i> <span style="font-size:11px;">${rating.toFixed(1)}</span>` : ''}
                                </div>
                                <span class="sold-count" style="font-size:11px;">${soldCount > 0 ? `Đã bán ${displaySoldCount}` : ''}</span>
                            </div>
                            <div class="location small text-muted mt-1"><i class="ri-map-pin-line me-1"></i>TP. Hồ Chí Minh</div>
                         </div>
                     </div>
                 </div>`;
        }

        function formatSoldCount(count) {
            if (count >= 1000000) {
                return (count / 1000000).toFixed(1).replace(/\.0$/, '') + 'tr';
            } else if (count >= 1000) {
                return (count / 1000).toFixed(1).replace(/\.0$/, '') + 'k';
            }
            return count.toString();
        }

        // --- Homepage Functions ---
        function loadHomepageRecommendations() {
            const container = document.getElementById('recommendations-grid');
            if (!container) return;
            container.innerHTML = '';

            if (!allProducts || allProducts.length === 0) {
                container.innerHTML = '<div class="col-12"><p class="text-center text-muted small">Loading recommendations...</p></div>';
                return;
            }

            const shuffledProducts = [...allProducts].sort(() => 0.5 - Math.random());
            const recommended = shuffledProducts.slice(0, 12);

            if (recommended.length === 0) {
                container.innerHTML = '<div class="col-12"><p class="text-center text-muted small">No recommendations available.</p></div>';
                            return;
                        }

            container.innerHTML = recommended.map(product => renderMobileProductCard(product)).join('');
            applyLanguage(currentLang);
        }

        // --- Cart Functions ---
        function loadCartFromLocalStorage() {
            const savedCart = localStorage.getItem('iLogiCareCart');
            cart = savedCart ? JSON.parse(savedCart) : [];
            updateCartUI();
        }

        function saveCartToLocalStorage() {
            localStorage.setItem('iLogiCareCart', JSON.stringify(cart));
            updateCartUI();
        }

        function updateCartUI() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartCountBadge = document.getElementById('cart-count-badge-bottom');
            if (cartCountBadge) {
                cartCountBadge.textContent = totalItems;
                cartCountBadge.style.display = totalItems > 0 ? 'block' : 'none';
            }
        }

        function addToCart(productId, quantity) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) {
                console.error("addToCart: Product not found in allProducts for ID:", productId);
                return;
            }

            // LOG QUAN TRỌNG: Kiểm tra seller_id của product
            console.log("Product found in allProducts for addToCart:", product);
            console.log("Product seller_id in addToCart:", product.seller_id, typeof product.seller_id);
            if (typeof product.seller_id === 'undefined' || product.seller_id === null) {
                console.error("CRITICAL in addToCart: product.seller_id is missing for product ID:", productId, product);
                alert('Lỗi: Sản phẩm đang được thêm vào giỏ thiếu thông tin người bán quan trọng. Vui lòng thử lại hoặc liên hệ hỗ trợ.');
                return; // Không thêm vào giỏ nếu thiếu seller_id
            }
            
            const existingItemIndex = cart.findIndex(item => item.id === productId);
            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity += quantity;
             } else {
                const imageUrl = (product.image_urls && product.image_urls.length > 0) ? product.image_urls[0] : 'images/placeholder.jpg';
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    imageUrl: imageUrl,
                    quantity: quantity,
                    seller_id: product.seller_id
                });
                
                // Debug log để kiểm tra item vừa được thêm
                console.log("Adding to cart, item:", cart[cart.length-1]);
            }
            
             saveCartToLocalStorage();
         }

        // --- Language Functions ---
         function switchLanguage(lang) {
             if (lang !== 'vi' && lang !== 'en') return;
             currentLang = lang;
             localStorage.setItem('iLogiCareLang', lang);
             applyLanguage(lang);
            
            // Update language dropdown active state
            updateLanguageDropdownState();

             // Reload content if needed
             if (!document.getElementById('plp-section').classList.contains('section-hidden')) {
                loadPLP();
              }
              if (!document.getElementById('homepage-section').classList.contains('section-hidden')) {
                loadHomepageRecommendations();
              }
         }

         function applyLanguage(lang) {
             document.querySelectorAll('[data-lang-vi], [data-lang-en]').forEach(el => {
                 const text = el.getAttribute(`data-lang-${lang}`);
                 if (text !== null) {
                      if (el.hasAttribute('data-lang-placeholder-vi') || el.hasAttribute('data-lang-placeholder-en')) {
                         const placeholderText = el.getAttribute(`data-lang-placeholder-${lang}`);
                          if (placeholderText !== null) el.placeholder = placeholderText;
                     } else {
                          el.textContent = text;
                     }
                 }
             });
         }

        // Add language dropdown event listeners
        function initLanguageDropdown() {
            const languageItems = document.querySelectorAll('.language-item');
            languageItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const lang = item.getAttribute('data-lang');
                    if (lang === 'vi' || lang === 'en') {
                        switchLanguage(lang);
                    }
                });
            });

            // Toggle dropdown on click
            const languageSelector = document.querySelector('.language-selector');
            const languageDropdown = document.querySelector('.language-dropdown');
            
            if (languageSelector && languageDropdown) {
                languageSelector.addEventListener('click', (e) => {
                    e.preventDefault();
                    languageDropdown.classList.toggle('show');
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!languageSelector.contains(e.target)) {
                        languageDropdown.classList.remove('show');
                    }
                });
            }
        }

        // --- Section navigation with authentication check ---
        function navigateToSection(sectionId, requiresAuth = false) {
            if (requiresAuth && !requireAuth(sectionId)) {
                return;
            }
            showSection(sectionId);
        }

        // --- Go back function ---
        function goBack() {
            // Check if there's history to go back to
            if (sectionHistory.length > 1) {
                // Remove current section
                sectionHistory.pop();
                // Go to previous section
                const previousSection = sectionHistory[sectionHistory.length - 1];
                showSection(previousSection);
            } else {
                // Default to homepage if no history
                showSection('homepage-section');
            }
        }

        // --- Update section history ---
        function addToSectionHistory(sectionId) {
            // Avoid adding duplicate consecutive entries
            if (sectionHistory[sectionHistory.length - 1] !== sectionId) {
                sectionHistory.push(sectionId);
                // Limit history to 10 entries
                if (sectionHistory.length > 10) {
                    sectionHistory.shift();
                }
            }
        }

        // --- Share product function ---
        function shareProduct() {
            if (navigator.share) {
                navigator.share({
                    title: document.title,
                    url: window.location.href
                }).catch(console.error);
            } else {
                // Fallback for browsers that don't support Web Share API
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('Link đã được sao chép vào clipboard!');
                }).catch(() => {
                    alert('Không thể chia sẻ. Vui lòng sao chép URL thủ công.');
                });
            }
        }

        // --- Toggle wishlist function ---
        function toggleWishlist() {
            alert('Tính năng wishlist đang được phát triển');
        }

        // --- Chat with shop function ---
        function chatWithShop() {
            alert('Tính năng chat với shop đang được phát triển');
        }

        // --- Handle cart actions ---
        function handleAddToCartPDP() {
            const productId = document.querySelector('#pdp-add-to-cart-pdp-mobile').dataset.productId;
            if (productId) {
                addToCart(productId, 1);
                alert('Đã thêm sản phẩm vào giỏ hàng!');
            }
        }

        async function handleBuyNowPDP() {
            console.log('=== DEBUG handleBuyNowPDP ===');
            
            const buyNowBtn = document.querySelector('#pdp-buy-now-btn');
            console.log('Buy now button:', buyNowBtn);
            
            let productId = buyNowBtn?.dataset.productId;
            console.log('Product ID from button:', productId);
            
            // Fallback: try to get productId from sessionStorage if button doesn't have it
            if (!productId) {
                productId = sessionStorage.getItem('currentProductId');
                console.log('ProductId from sessionStorage:', productId);
                
                // If we have productId from session, set it to button for future use
                if (productId && buyNowBtn) {
                    buyNowBtn.dataset.productId = productId;
                    console.log('Set productId to button from sessionStorage');
                }
            }
            
                if (!productId) {
                console.error('No productId found on button or sessionStorage');
                alert('Không tìm thấy thông tin sản phẩm. Vui lòng chọn sản phẩm từ danh sách.');
                    return;
                }

            // Check if user is logged in
            if (!isUserLoggedIn()) {
                if (confirm('Bạn cần đăng nhập để mua hàng. Chuyển đến trang đăng nhập?')) {
                    sessionStorage.setItem('buyNowReferrer', 'pdp-section');
                    sessionStorage.setItem('buyNowProductId', productId);
                    showSection('login-section');
                }
                    return;
                }

            // Debug allProducts and productData
            console.log('All products array:', allProducts);
            console.log('All products length:', allProducts.length);
            console.log('ProductData object:', productData);
            console.log('ProductData loaded flag:', productDataLoaded);
            console.log('Looking for product with ID:', productId); // Remove parseInt

            // Ensure products are loaded
            if (!productDataLoaded || allProducts.length === 0) {
                console.log('Products not loaded, attempting to load...');
                await loadProductData();
            }

            // Get product details - compare as strings since IDs are UUIDs
            let product = allProducts.find(p => {
                console.log('Checking product:', p.id, 'vs', productId);
                return p.id === productId; // Remove parseInt - compare as strings
            });
            
            console.log('Found product:', product);
            
                if (!product) {
                console.error('Product not found in allProducts');
                // Try alternative search by string comparison
                const productAlt = allProducts.find(p => p.id.toString() === productId.toString());
                console.log('Alternative search result:', productAlt);
                
                if (productAlt) {
                    console.log('Found product with string comparison');
                    product = productAlt;
                } else {
                    alert('Không tìm thấy thông tin sản phẩm');
                    return;
                }
            }

            // Get quantity from quantity selector (default to 1)
            const quantityEl = document.querySelector('#quantity-selector');
            const quantity = quantityEl ? parseInt(quantityEl.value) || 1 : 1;
            console.log('Quantity:', quantity);

            // Debug product properties for stock validation
            console.log('Product properties:', Object.keys(product));
            console.log('Product in_stock:', product.in_stock);
            console.log('Product stock_quantity:', product.stock_quantity);
            console.log('Product available_stock:', product.available_stock);
            console.log('Product stock:', product.stock);
            console.log('Product available:', product.available);

            // Validate stock - check multiple possible property names
            const isInStock = product.in_stock !== false && product.available !== false && product.stock !== false;
            const stockQuantity = product.stock_quantity || product.available_stock || product.stock || 999; // Default to high number if no stock info
            
            console.log('Calculated isInStock:', isInStock);
            console.log('Calculated stockQuantity:', stockQuantity);
            
            if (!isInStock || stockQuantity < quantity) {
                console.log('Stock validation failed - isInStock:', isInStock, 'stockQuantity:', stockQuantity, 'requested quantity:', quantity);
                alert('Sản phẩm hiện tại không đủ hàng');
                    return;
                }

            console.log('Stock validation passed - proceeding with order');

            // LOG QUAN TRỌNG: Kiểm tra seller_id của product trước khi tạo đơn hàng
            console.log("Product object for Buy Now (before stringify):", product);
            console.log("Product seller_id in handleBuyNowPDP:", product.seller_id, typeof product.seller_id);
            if (!product.seller_id) {
                console.error("CRITICAL: Product for Buy Now is MISSING seller_id!");
                alert('Lỗi: Sản phẩm thiếu thông tin người bán.');
                return;
            }

            try {
                // Show loading
                const originalText = buyNowBtn.innerHTML;
                buyNowBtn.disabled = true;
                buyNowBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Đang xử lý...';

                // Create instant order in Supabase
                console.log('Creating instant order...');
                const orderData = await createInstantOrder(product, quantity);
                
                if (orderData) {
                    // Store order info for checkout
                    sessionStorage.setItem('instantOrderId', orderData.id);
                    
                    // DEBUG: Log product before storing to sessionStorage
                    console.log("DEBUG: Product before storing to sessionStorage:", product);
                    console.log("DEBUG: Product seller_id before storing:", product.seller_id, typeof product.seller_id);
                    
                    const instantOrderData = {
                        orderId: orderData.id,
                        product: product,  
                        quantity: quantity,
                        totalAmount: product.discounted_price ? product.discounted_price * quantity : product.price * quantity,
                        orderNumber: orderData.order_number
                    };
                    
                    // DEBUG: Log instantOrderData before stringify
                    console.log("DEBUG: instantOrderData before stringify:", instantOrderData);
                    console.log("DEBUG: instantOrderData.product.seller_id before stringify:", instantOrderData.product.seller_id);
                    
                    const instantOrderDataString = JSON.stringify(instantOrderData);
                    console.log("DEBUG: instantOrderData stringified:", instantOrderDataString);
                    
                    sessionStorage.setItem('instantOrderData', instantOrderDataString);
                    
                    // DEBUG: Verify data stored correctly
                    const storedData = sessionStorage.getItem('instantOrderData');
                    const parsedStoredData = JSON.parse(storedData);
                    console.log("DEBUG: Parsed stored instantOrderData:", parsedStoredData);
                    console.log("DEBUG: Parsed stored product seller_id:", parsedStoredData.product.seller_id);

                    // Navigate to checkout with instant order
                    loadInstantCheckout(orderData);
                    showSection('checkout-section');
            } else {
                    throw new Error('Không thể tạo đơn hàng');
                }

            } catch (error) {
                console.error('Buy now error:', error);
                alert('Có lỗi xảy ra khi tạo đơn hàng: ' + error.message);
                
                // Restore button
                buyNowBtn.disabled = false;
                buyNowBtn.innerHTML = 'Mua ngay';
            }
        }

        // Create instant order in Supabase
        async function createInstantOrder(product, quantity) {
            try {
                if (!supabaseClient) {
                    throw new Error('Không thể kết nối đến hệ thống');
                }

                const userId = localStorage.getItem('userId');
                const userEmail = localStorage.getItem('userEmail');
                
                if (!userId) {
                    throw new Error('Không tìm thấy thông tin người dùng');
                }

                // Debug authentication context
                const { data: authUser, error: authError } = await supabaseClient.auth.getUser();
                console.log('Current Supabase auth user:', authUser);
                console.log('Auth error:', authError);
                console.log('localStorage userId:', userId);
                console.log('localStorage userEmail:', userEmail);

                // Check if user is authenticated in Supabase
                if (authError || !authUser?.user) {
                    console.log('User not authenticated in Supabase, trying to re-authenticate...');
                    
                    // Try to re-authenticate with stored credentials
                    const storedEmail = localStorage.getItem('userEmail');
                    if (storedEmail && confirm('Phiên đăng nhập đã hết hạn. Vui lòng đăng nhập lại.')) {
                        sessionStorage.setItem('buyNowReferrer', 'pdp-section');
                        sessionStorage.setItem('buyNowProductId', product.id);
                        showSection('login-section');
                    }
                    return null;
                }

                // Verify the authenticated user matches localStorage
                if (authUser.user.id !== userId) {
                    console.log('User ID mismatch:', authUser.user.id, 'vs', userId);
                    throw new Error('Phiên đăng nhập không khớp. Vui lòng đăng nhập lại.');
                }

                // Ensure we use the authenticated user ID from Supabase session
                const currentAuthUserId = authUser.user.id;

                // Calculate total
                const unitPrice = product.discounted_price || product.price;
                const totalAmount = unitPrice * quantity;
                
                // Generate order number
                const orderNumber = `LTA${Date.now()}${Math.floor(Math.random() * 1000)}`;

                // Create order with unique identifier - use authenticated user ID
                console.log('DEBUG: About to insert order with user_id:', authUser.user.id);
                console.log('DEBUG: User ID type:', typeof authUser.user.id);
                console.log('DEBUG: User ID value:', authUser.user.id);
                
                const { data: orderData, error: orderError } = await supabaseClient
                    .from('orders')
                    .insert({
                        user_id: authUser.user.id,  // Use authenticated user ID instead of localStorage
                        order_number: orderNumber,
                        total_amount: totalAmount,
                        status: 'pending',
                        created_at: new Date().toISOString()
                    })
                    .select()
                    .single();
                    
                console.log('DEBUG: Insert result - data:', orderData);
                console.log('DEBUG: Insert result - error:', orderError);

                if (orderError) throw new Error(`Lỗi tạo đơn hàng: ${orderError.message}`);

                // Create order item
                const { error: itemError } = await supabaseClient
                    .from('order_items')
                    .insert({
                        order_id: orderData.id,
                        product_id: product.id,
                        product_name: product.name,
                        quantity: quantity,
                        unit_price: unitPrice,
                        total_price: totalAmount,
                        product_image: product.main_image,
                        seller_id: product.seller_id
                    });

                if (itemError) {
                    // Rollback order if item creation fails
                    await supabaseClient
                        .from('orders')
                        .delete()
                        .eq('id', orderData.id);
                    throw new Error(`Lỗi tạo chi tiết đơn hàng: ${itemError.message}`);
                }

                console.log('Instant order created successfully:', orderData);
                return orderData;

            } catch (error) {
                console.error('Error creating instant order:', error);
                throw error;
            }
        }

        // Load instant checkout page
        function loadInstantCheckout(orderData) {
            const checkoutContainer = document.querySelector('#checkout-section');
            if (!checkoutContainer) return;

            // Get stored order data
            const instantOrderData = JSON.parse(sessionStorage.getItem('instantOrderData'));
            if (!instantOrderData) return;

            const subtotal = instantOrderData.totalAmount;
            const shippingFee = 30000; // Default to standard shipping
            const discount = 0; // No discount initially
            const total = subtotal + shippingFee - discount;

            // Update checkout UI for instant order
            const orderSummaryEl = checkoutContainer.querySelector('#checkout-order-summary');
            const subtotalEl = checkoutContainer.querySelector('#checkout-subtotal');
            const shippingEl = checkoutContainer.querySelector('#checkout-shipping');
            const discountEl = checkoutContainer.querySelector('#checkout-discount');
            const totalEl = checkoutContainer.querySelector('#checkout-total');
            const footerTotalEl = checkoutContainer.querySelector('#checkout-footer-total');
            const orderNumberEl = checkoutContainer.querySelector('#checkout-order-number');

            if (orderSummaryEl) {
                orderSummaryEl.innerHTML = `
                    <div class="order-item d-flex align-items-center p-3 border-bottom">
                        <img src="${instantOrderData.product.main_image}" alt="${instantOrderData.product.name}" class="order-item-image me-3" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;">
                        <div class="flex-grow-1">
                            <h6 class="mb-1">${instantOrderData.product.name}</h6>
                            <p class="text-muted small mb-1">SKU: ${instantOrderData.product.sku || 'N/A'}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-muted">Số lượng: ${instantOrderData.quantity}</span>
                                <span class="fw-bold">${formatCurrency(instantOrderData.totalAmount)}</span>
                                </div>
                            </div>
                        </div>
                    `;
            }

            // Update all price elements
            if (subtotalEl) subtotalEl.textContent = formatCurrency(subtotal);
            if (shippingEl) shippingEl.textContent = formatCurrency(shippingFee);
            if (discountEl) discountEl.textContent = formatCurrency(discount);
            if (totalEl) totalEl.textContent = formatCurrency(total);
            if (footerTotalEl) footerTotalEl.textContent = formatCurrency(total);
            if (orderNumberEl && instantOrderData.orderNumber) {
                orderNumberEl.textContent = instantOrderData.orderNumber;
            }

            // Set default selections
            const standardShipping = checkoutContainer.querySelector('input[name="shipping"][value="standard"]');
            const codPayment = checkoutContainer.querySelector('input[name="payment"][value="cod"]');
            if (standardShipping) standardShipping.checked = true;
            if (codPayment) codPayment.checked = true;

            // Update checkout form for instant order
            const checkoutForm = checkoutContainer.querySelector('#checkout-form');
            if (checkoutForm) {
                checkoutForm.dataset.orderType = 'instant';
                checkoutForm.dataset.orderId = instantOrderData.orderId;
            }

            // Store current checkout data in sessionStorage for easy access
            sessionStorage.setItem('checkoutData', JSON.stringify({
                subtotal: subtotal,
                shippingFee: shippingFee,
                discount: discount,
                total: total,
                selectedVoucher: null
            }));
        }

        // Payment confirmation popup functions
        function showPaymentConfirmation() {
            const checkoutData = JSON.parse(sessionStorage.getItem('checkoutData') || '{}');
            const instantOrderData = JSON.parse(sessionStorage.getItem('instantOrderData') || '{}');
            
            const selectedPayment = document.querySelector('input[name="payment"]:checked')?.value || 'cod';
            const selectedShipping = document.querySelector('input[name="shipping"]:checked')?.value || 'standard';

            const paymentNames = {
                'cod': 'Thanh toán khi nhận hàng',
                'onestop': 'Quỹ OneStop@LTA', 
                'bank': 'Thẻ ngân hàng'
            };

            const shippingNames = {
                'standard': 'Giao hàng tiêu chuẩn (30,000₫)',
                'express': 'Giao hàng hỏa tốc (50,000₫)'
            };

            // Check if this is an instant order or regular cart order
            const isInstantOrder = instantOrderData && instantOrderData.product;
            
            if (isInstantOrder) {
                // Instant order - show single product
                document.getElementById('popup-product-image').src = instantOrderData.product?.main_image || '';
                document.getElementById('popup-product-name').textContent = instantOrderData.product?.name || 'Sản phẩm';
                document.getElementById('popup-product-quantity').textContent = `Số lượng: ${instantOrderData.quantity || 1}`;
                document.getElementById('popup-product-price').textContent = formatCurrency(instantOrderData.totalAmount || 0);
            } else {
                // Regular cart order - show cart summary
                const cartItemCount = cart.reduce((sum, item) => sum + item.quantity, 0);
                const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                
                // Use first cart item for display or show summary
                if (cart.length > 0) {
                    const firstItem = cart[0];
                    document.getElementById('popup-product-image').src = firstItem.image || '';
                    if (cart.length === 1) {
                        document.getElementById('popup-product-name').textContent = firstItem.name || 'Sản phẩm';
                        document.getElementById('popup-product-quantity').textContent = `Số lượng: ${firstItem.quantity}`;
                    } else {
                        document.getElementById('popup-product-name').textContent = `${cart.length} sản phẩm`;
                        document.getElementById('popup-product-quantity').textContent = `Tổng số lượng: ${cartItemCount}`;
                    }
                    document.getElementById('popup-product-price').textContent = formatCurrency(cartTotal);
                } else {
                    // Fallback for empty cart
                    document.getElementById('popup-product-image').src = '';
                    document.getElementById('popup-product-name').textContent = 'Giỏ hàng trống';
                    document.getElementById('popup-product-quantity').textContent = 'Số lượng: 0';
                    document.getElementById('popup-product-price').textContent = formatCurrency(0);
                }
                
                // Update checkoutData if not set properly
                if (!checkoutData.total || checkoutData.total === 0) {
                    const shippingFee = selectedShipping === 'express' ? 50000 : 30000;
                    const updatedCheckoutData = {
                        subtotal: cartTotal,
                        shippingFee: shippingFee,
                        discount: 0,
                        total: cartTotal + shippingFee,
                        selectedVoucher: null
                    };
                    sessionStorage.setItem('checkoutData', JSON.stringify(updatedCheckoutData));
                    checkoutData.total = updatedCheckoutData.total;
                }
            }
            
            document.getElementById('popup-shipping-method').textContent = shippingNames[selectedShipping];
            document.getElementById('popup-payment-method').textContent = paymentNames[selectedPayment];
            document.getElementById('popup-total-amount').textContent = formatCurrency(checkoutData.total || 0);

            // Show popup immediately
            const popup = document.getElementById('payment-confirmation-popup');
            if (popup) {
                popup.style.display = 'flex'; // Hiển thị popup
                // Kích hoạt animation opacity sau một khoảng delay nhỏ để trình duyệt kịp render display:flex
                setTimeout(() => {
                    popup.style.opacity = '1';
                }, 10); // 10ms thường là đủ
            }
        }

        function hidePaymentConfirmation() {
            const popup = document.getElementById('payment-confirmation-popup');
            if (popup) {
                popup.style.opacity = '0';
                // Đợi animation opacity hoàn thành rồi mới display:none để hiệu ứng mượt
                setTimeout(() => {
                    popup.style.display = 'none';
                }, 300); // Thời gian này nên khớp với transition-duration của opacity trên popup
            }
        }

        // --- Place order function ---
        async function placeOrder(event) {
            if (event) event.preventDefault();
            
            // Show custom popup instead of confirm dialog
            showPaymentConfirmation();
        }

        async function loadUserOrders() {
            const ordersContainer = document.getElementById('my-orders-list-container'); // Giả sử bạn có một div để chứa danh sách đơn hàng
            if (!ordersContainer || !supabaseClient) return;

            ordersContainer.innerHTML = '<p>Đang tải đơn hàng của bạn...</p>'; // Loading state

            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) {
                    ordersContainer.innerHTML = '<p>Vui lòng đăng nhập để xem đơn hàng.</p>';
                    return;
                }

                const { data: orders, error } = await supabaseClient
                    .from('orders')
                    .select(`
                        id,
                        order_number,
                        total_amount,
                        status,
                        ordered_at,
                        order_items ( product_name, quantity, unit_price, image_url )
                    `)
                    .eq('user_id', user.id)
                    .order('ordered_at', { ascending: false });

                if (error) throw error;

                if (orders && orders.length > 0) {
                    ordersContainer.innerHTML = orders.map(order => `
                        <div class="user-order-item card mb-3">
                            <div class="card-header d-flex justify-content-between">
                                <span>Đơn hàng: <strong>${order.order_number}</strong></span>
                                <span>${new Date(order.ordered_at).toLocaleDateString('vi-VN')}</span>
                        </div>
                            <div class="card-body">
                                ${order.order_items.map(item => `
                                    <div class="d-flex mb-2">
                                        <img src="${item.image_url || 'images/placeholder.jpg'}" alt="${item.product_name}" style="width:50px; height:50px; object-fit:cover; margin-right:10px;">
                                        <div>
                                            <div>${item.product_name} (x${item.quantity})</div>
                                            <small>${formatCurrency(item.unit_price)}</small>
                            </div>
                                </div>
                                `).join('')}
                                <hr>
                                <p class="text-end">Trạng thái: <span class="badge bg-info">${order.status}</span></p>
                                <p class="text-end fw-bold">Tổng cộng: ${formatCurrency(order.total_amount)}</p>
                            </div>
                        </div>
                    `).join('');
                } else {
                    ordersContainer.innerHTML = '<p>Bạn chưa có đơn hàng nào.</p>';
                }

            } catch (error) {
                console.error("Error loading user orders:", error);
                ordersContainer.innerHTML = '<p class="text-danger">Lỗi tải danh sách đơn hàng.</p>';
            }
        }

        async function confirmPayment() {
            hidePaymentConfirmation(); // Ẩn popup trước

            const placeOrderBtn = document.querySelector('.btn-place-order');
            if (placeOrderBtn) {
                // Check if already processing to prevent double-click
                if (placeOrderBtn.disabled) {
                    console.log("Order already being processed, ignoring duplicate click");
                    return;
                }
                placeOrderBtn.disabled = true;
                placeOrderBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Đang xử lý...';
            }

            try {
                if (!supabaseClient) {
                    throw new Error('Kết nối đến hệ thống không thành công.');
                }

                // Lấy thông tin user hiện tại để gán cho user_id của đơn hàng
                const { data: { user: authUser }, error: authErr } = await supabaseClient.auth.getUser();
                if (authErr || !authUser) {
                    console.error('Lỗi lấy thông tin người dùng:', authErr);
                    showLoginRequiredPopup(); // Yêu cầu đăng nhập lại
                    if (placeOrderBtn) { // Reset nút nếu lỗi sớm
                        placeOrderBtn.disabled = false;
                        placeOrderBtn.innerHTML = 'Đặt hàng';
                    }
                    return;
                }
                const currentAuthUserId = authUser.id;

                // Lấy thông tin từ checkout process
                const checkoutData = JSON.parse(sessionStorage.getItem('checkoutData') || '{}');
                const selectedPayment = document.querySelector('input[name="payment"]:checked')?.value || 'cod';
                const selectedShipping = document.querySelector('input[name="shipping"]:checked')?.value || 'standard';
                // Giả sử bạn có thông tin địa chỉ giao hàng lưu trong một biến hoặc lấy từ form
                const shippingAddressDetails = { // Lấy từ form hoặc state của trang checkout
                    name: document.getElementById('checkoutName')?.value || 'N/A', // Ví dụ
                phone: document.getElementById('checkoutPhone')?.value || 'N/A',
                address: document.getElementById('checkoutAddress')?.value || 'N/A',
                ward: document.getElementById('checkoutWard')?.value || '',
                district: document.getElementById('checkoutDistrict')?.value || '',
                province: document.getElementById('checkoutProvince')?.value || ''
            };


                // 1. Check if this is an instant order (Buy Now) and get existing order ID
                const instantOrderId = sessionStorage.getItem('instantOrderId');
                let newOrder, newOrderId;

                if (instantOrderId) {
                    // UPDATE existing instant order with final details
                    console.log("Updating existing instant order:", instantOrderId);
                    const orderUpdatePayload = {
                        total_amount: checkoutData.total || 0,
                        subtotal_amount: checkoutData.subtotal || 0,
                        discount_amount: checkoutData.discount || 0,
                        shipping_fee: checkoutData.shippingFee || 0,
                        tax_amount: 0,
                        status: 'pending', // Update status
                        payment_method: selectedPayment,
                        payment_status: 'pending',
                        shipping_address: shippingAddressDetails,
                    };

                    const { data: updatedOrder, error: updateError } = await supabaseClient
                        .from('orders')
                        .update(orderUpdatePayload)
                        .eq('id', instantOrderId)
                        .eq('user_id', currentAuthUserId) // Security check
                        .select()
                        .single();

                    if (updateError || !updatedOrder) {
                        console.error('Error updating instant order:', updateError);
                        
                        // Fallback: If update fails due to RLS, just show success
                        // since the order was already created successfully
                        if (updateError?.message?.includes('row-level security policy')) {
                            console.warn('RLS prevented update, but order was created successfully');
                            // Get the existing order to show success message
                            const { data: existingOrder } = await supabaseClient
                                .from('orders')
                                .select('*')
                                .eq('id', instantOrderId)
                                .single();
                            
                            if (existingOrder) {
                                newOrder = existingOrder;
                                newOrderId = existingOrder.id;
                                console.log('Using existing order for success message:', existingOrder);
                            } else {
                                throw new Error(`Lỗi cập nhật đơn hàng: ${updateError?.message || 'Không nhận được phản hồi từ server.'}`);
                            }
                        } else {
                            throw new Error(`Lỗi cập nhật đơn hàng: ${updateError?.message || 'Không nhận được phản hồi từ server.'}`);
                        }
                    }
                    console.log('Instant order updated successfully:', updatedOrder);
                    newOrder = updatedOrder;
                    newOrderId = updatedOrder.id;

                } else {
                    // CREATE new order (for regular cart checkout)
                    console.log("Creating new order for cart checkout");
                    const orderNumber = `LTA${Date.now()}${Math.floor(Math.random() * 1000)}`;
                    const orderPayload = {
                        user_id: currentAuthUserId,
                        order_number: orderNumber,
                        total_amount: checkoutData.total || 0,
                        subtotal_amount: checkoutData.subtotal || 0,
                        discount_amount: checkoutData.discount || 0,
                        shipping_fee: checkoutData.shippingFee || 0,
                        tax_amount: 0,
                        status: 'pending',
                        payment_method: selectedPayment,
                        payment_status: 'pending',
                        shipping_address: shippingAddressDetails,
                    };

                    const { data: createdOrder, error: orderError } = await supabaseClient
                        .from('orders')
                        .insert([orderPayload])
                        .select()
                        .single();

                    if (orderError || !createdOrder) {
                        console.error('Error inserting order:', orderError);
                        throw new Error(`Lỗi tạo đơn hàng: ${orderError?.message || 'Không nhận được phản hồi từ server.'}`);
                    }
                    console.log('Order created successfully:', createdOrder);
                    newOrder = createdOrder;
                    newOrderId = createdOrder.id;
                }

                // 3. Handle order items
                if (instantOrderId) {
                    // For instant orders, items already exist - no need to create again
                    console.log("Instant order items already exist, skipping order_items creation");
                } else {
                    // For regular cart orders, create order items from cart
                    if (cart.length === 0) {
                        throw new Error('Giỏ hàng trống. Không thể tạo đơn hàng.');
                    }

                    // Validate cart items have seller_id
                    const itemsWithoutSellerId = cart.filter(item => !item.seller_id);
                    if (itemsWithoutSellerId.length > 0) {
                        console.error("CRITICAL: Cart items missing seller_id:", itemsWithoutSellerId);
                        alert('Lỗi: Một số sản phẩm trong giỏ hàng thiếu thông tin người bán.');
                        if (placeOrderBtn) {
                            placeOrderBtn.disabled = false;
                            placeOrderBtn.innerHTML = 'Đặt hàng';
                        }
                        return;
                    }

                    const orderItemsPayload = cart.map(item => ({
                        order_id: newOrderId,
                        product_id: item.id,
                        seller_id: item.seller_id,
                        product_name: item.name,
                        quantity: item.quantity,
                        unit_price: item.price,
                        total_price: item.price * item.quantity,
                        image_url: item.imageUrl
                    }));

                    console.log("Inserting order items:", orderItemsPayload);
                    const { error: itemsError } = await supabaseClient
                        .from('order_items')
                        .insert(orderItemsPayload);

                    if (itemsError) {
                        console.error('Error inserting order items:', itemsError);
                        throw new Error(`Lỗi tạo chi tiết đơn hàng: ${itemsError.message}`);
                    }
                    console.log('Order items created successfully.');
                }


                // 4. Xử lý sau khi thành công
                alert(`✅ ĐẶT HÀNG THÀNH CÔNG!\n\nMã đơn hàng: ${newOrder.order_number}\nTổng tiền: ${formatCurrency(newOrder.total_amount)}\n\nCảm ơn bạn đã mua hàng tại LTA!`);

                // Xóa giỏ hàng và dữ liệu tạm
            cart = [];
                saveCartToLocalStorage(); // Hàm này nên gọi updateCartUI() bên trong nó
                sessionStorage.removeItem('checkoutData');
                sessionStorage.removeItem('instantOrderData'); // Nếu có

                // 5. Điều hướng về màn hình tài khoản và cập nhật section đơn mua
                        showSection('account-section');
                
            } catch (error) {
                console.error('Error during payment confirmation and order creation:', error);
                alert(`❌ Có lỗi xảy ra: ${error.message}`);
            } finally {
                // Reset nút đặt hàng
                if (placeOrderBtn) {
                    placeOrderBtn.disabled = false;
                    placeOrderBtn.innerHTML = 'Đặt hàng';
                }
            }
        }

        // Update instant order with payment and shipping details
        async function updateInstantOrder(orderId, paymentMethod, shippingMethod, checkoutData) {
            try {
                if (!supabaseClient) {
                    throw new Error('Không thể kết nối đến hệ thống');
                }

                const { subtotal, shippingFee, discount, total, selectedVoucher } = checkoutData;

                // Update order with final details
                const { error: updateError } = await supabaseClient
                    .from('orders')
                    .update({
                        payment_method: paymentMethod,
                        shipping_method: shippingMethod,
                        shipping_fee: shippingFee,
                        discount_amount: discount || 0,
                        voucher_code: selectedVoucher || null,
                        final_amount: total,
                        status: 'pending'
                    })
                    .eq('id', orderId);

                if (updateError) {
                    throw new Error(`Lỗi cập nhật đơn hàng: ${updateError.message}`);
                }

                console.log('Order updated successfully with final details');

                // If payment is OneStop, deduct from balance (simulate)
                if (paymentMethod === 'onestop') {
                    // This would integrate with actual OneStop Fund system
                    console.log('OneStop payment processed for:', formatCurrency(total));
                }

            } catch (error) {
                console.error('Error updating instant order:', error);
                throw error;
            }
        }

        // --- Shipping and payment selection functions ---
        function selectShipping(method) {
            // Update radio button
            const shippingRadios = document.querySelectorAll('input[name="shipping"]');
            shippingRadios.forEach(radio => {
                radio.checked = radio.value === method;
            });

            // Update shipping fee
            const shippingFee = method === 'express' ? 50000 : 30000;
            const shippingFeeEl = document.getElementById('checkout-shipping');
            if (shippingFeeEl) {
                shippingFeeEl.textContent = formatCurrency(shippingFee);
            }

            // Update checkout data
            const checkoutData = JSON.parse(sessionStorage.getItem('checkoutData') || '{}');
            checkoutData.shippingFee = shippingFee;
            sessionStorage.setItem('checkoutData', JSON.stringify(checkoutData));
                
                // Update total
            updateCheckoutTotal();
        }

        function selectPayment(method) {
            // Update radio button
            const paymentRadios = document.querySelectorAll('input[name="payment"]');
            paymentRadios.forEach(radio => {
                radio.checked = radio.value === method;
            });
        }

        function updateCheckoutTotal() {
            const checkoutData = JSON.parse(sessionStorage.getItem('checkoutData') || '{}');
            const { subtotal = 0, shippingFee = 30000, discount = 0 } = checkoutData;
            
            const total = subtotal + shippingFee - discount;
            
            // Update total elements
            const totalEl = document.getElementById('checkout-total');
            const footerTotalEl = document.getElementById('checkout-footer-total');
            
            if (totalEl) totalEl.textContent = formatCurrency(total);
            if (footerTotalEl) footerTotalEl.textContent = formatCurrency(total);
            
            // Update stored data
            checkoutData.total = total;
            sessionStorage.setItem('checkoutData', JSON.stringify(checkoutData));
        }

        // Voucher functionality
        function showVoucherList() {
            const voucherList = [
                { code: 'NEWUSER10', discount: 10, type: 'percentage', minOrder: 100000, description: 'Giảm 10% cho đơn hàng đầu tiên' },
                { code: 'SAVE20K', discount: 20000, type: 'fixed', minOrder: 200000, description: 'Giảm 20,000₫ cho đơn hàng từ 200,000₫' },
                { code: 'FREESHIP', discount: 30000, type: 'shipping', minOrder: 0, description: 'Miễn phí vận chuyển' }
            ];

            let voucherHTML = `
                <div class="voucher-list-overlay" onclick="hideVoucherList()">
                    <div class="voucher-list-container" onclick="event.stopPropagation()">
                        <div class="voucher-list-header">
                            <h3>Chọn voucher</h3>
                            <button onclick="hideVoucherList()"><i class="ri-close-line"></i></button>
                        </div>
                        <div class="voucher-list-body">
            `;

            voucherList.forEach(voucher => {
                const checkoutData = JSON.parse(sessionStorage.getItem('checkoutData') || '{}');
                const isEligible = checkoutData.subtotal >= voucher.minOrder;
                
                voucherHTML += `
                    <div class="voucher-item ${isEligible ? '' : 'disabled'}" onclick="${isEligible ? `applyVoucher('${voucher.code}')` : ''}">
                        <div class="voucher-info">
                            <div class="voucher-code">${voucher.code}</div>
                            <div class="voucher-desc">${voucher.description}</div>
                            ${!isEligible ? `<div class="voucher-min">Đơn tối thiểu ${formatCurrency(voucher.minOrder)}</div>` : ''}
                        </div>
                        <div class="voucher-action">
                            ${isEligible ? '<button class="btn-apply">Áp dụng</button>' : '<span class="text-muted">Không đủ điều kiện</span>'}
                        </div>
                    </div>
                `;
            });

            voucherHTML += `
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', voucherHTML);
        }

        function hideVoucherList() {
            const voucherOverlay = document.querySelector('.voucher-list-overlay');
            if (voucherOverlay) {
                voucherOverlay.remove();
            }
        }

        function applyVoucher(voucherCode) {
            const vouchers = {
                'NEWUSER10': { discount: 10, type: 'percentage', minOrder: 100000 },
                'SAVE20K': { discount: 20000, type: 'fixed', minOrder: 200000 },
                'FREESHIP': { discount: 30000, type: 'shipping', minOrder: 0 }
            };

            const voucher = vouchers[voucherCode];
            if (!voucher) return;

            const checkoutData = JSON.parse(sessionStorage.getItem('checkoutData') || '{}');
            
            if (checkoutData.subtotal < voucher.minOrder) {
                alert(`Đơn hàng tối thiểu ${formatCurrency(voucher.minOrder)} để sử dụng voucher này`);
                return;
            }

            let discountAmount = 0;
            
            if (voucher.type === 'percentage') {
                discountAmount = Math.floor(checkoutData.subtotal * voucher.discount / 100);
            } else if (voucher.type === 'fixed') {
                discountAmount = voucher.discount;
            } else if (voucher.type === 'shipping') {
                discountAmount = checkoutData.shippingFee;
            }

            // Update UI
            const selectedVoucherEl = document.getElementById('selected-voucher');
            const discountRowEl = document.getElementById('voucher-discount-row');
            const discountEl = document.getElementById('checkout-discount');

            if (selectedVoucherEl) selectedVoucherEl.textContent = voucherCode;
            if (discountRowEl) discountRowEl.style.display = 'flex';
            if (discountEl) discountEl.textContent = `-${formatCurrency(discountAmount)}`;

            // Update data
            checkoutData.discount = discountAmount;
            checkoutData.selectedVoucher = voucherCode;
            sessionStorage.setItem('checkoutData', JSON.stringify(checkoutData));

            updateCheckoutTotal();
            hideVoucherList();
            
            alert(`Áp dụng voucher ${voucherCode} thành công! Giảm ${formatCurrency(discountAmount)}`);
        }
    </script>

    <!-- Payment Confirmation Popup -->
    <div id="payment-confirmation-popup" class="payment-popup-overlay" style="display: none;">
        <div class="payment-popup-container">
            <div class="payment-popup-header">
                <h3>🛒 Xác nhận thanh toán</h3>
                <button class="btn-close-popup" onclick="hidePaymentConfirmation()">
                    <i class="ri-close-line"></i>
                </button>
            </div>
            <div class="payment-popup-body">
                <div class="popup-product-info">
                    <img id="popup-product-image" src="" alt="Product" class="popup-product-img">
                    <div class="popup-product-details">
                        <h4 id="popup-product-name"></h4>
                        <p id="popup-product-quantity"></p>
                        <p id="popup-product-price" class="popup-price"></p>
                    </div>
                </div>
                
                <div class="popup-payment-info">
                    <div class="popup-info-row">
                        <span>🚚 Vận chuyển:</span>
                        <span id="popup-shipping-method"></span>
                    </div>
                    <div class="popup-info-row">
                        <span>💳 Thanh toán:</span>
                        <span id="popup-payment-method"></span>
                    </div>
                    <div class="popup-info-row total-row">
                        <span>💰 Tổng thanh toán:</span>
                        <span id="popup-total-amount" class="popup-total"></span>
                    </div>
                </div>
            </div>
            <div class="payment-popup-footer">
                <button class="btn-cancel" onclick="hidePaymentConfirmation()">Hủy</button>
                <button class="btn-confirm" onclick="confirmPayment()">Xác nhận thanh toán</button>
            </div>
        </div>
    </div>

    <!-- Authentication Script -->
    <script>
        // Authentication functions
        function isUserLoggedIn() {
            return localStorage.getItem('userAuthenticated') === 'true';
        }
        
        function showEmailLoginForm() {
            document.getElementById('login-options-card').classList.add('d-none');
            document.getElementById('email-login-card').classList.remove('d-none');
        }
        
        function showLoginOptions() {
            document.getElementById('email-login-card').classList.add('d-none');
            document.getElementById('login-options-card').classList.remove('d-none');
            document.getElementById('email-login-form').reset();
            hideLoginMessages();
        }
        
        function togglePasswordVisibility(fieldId) {
            const passwordField = document.getElementById(fieldId);
            const toggleButton = passwordField.nextElementSibling.querySelector('i');
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                toggleButton.className = 'ri-eye-off-line';
                        } else {
                passwordField.type = 'password';
                toggleButton.className = 'ri-eye-line';
            }
        }

        async function handleEmailLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            showLoginLoading(true);
            hideLoginMessages();
            
            try {
                if (!supabaseClient) {
                    throw new Error('Kết nối đến hệ thống xác thực không thành công');
                }
                
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) {
                    throw new Error(getLoginErrorMessage(error));
                }
                
                const user = data.user;
                
                localStorage.setItem('userAuthenticated', 'true');
                localStorage.setItem('userName', user.email);
                localStorage.setItem('userId', user.id);
                localStorage.setItem('userEmail', user.email);
                
                if (rememberMe) {
                    localStorage.setItem('rememberLogin', 'true');
                }
                
                // Store Supabase session for persistent authentication
                const session = data.session;
                if (session) {
                    localStorage.setItem('supabase.auth.token', JSON.stringify(session));
                }
                
                await checkUserSellerStatus(user.id);
                updateAuthenticationStatus();
                showLoginSuccess('Đăng nhập thành công!');
                
                setTimeout(async () => {
                    // Check if user came from "Buy Now" flow
                    const buyNowReferrer = sessionStorage.getItem('buyNowReferrer');
                    const buyNowProductId = sessionStorage.getItem('buyNowProductId');
                    
                    if (buyNowReferrer && buyNowProductId) {
                        // Clear the referrer data
                        sessionStorage.removeItem('buyNowReferrer');
                        sessionStorage.removeItem('buyNowProductId');
                        
                        // Navigate back to PDP first
                        showSection('pdp-section');
                        
                        // Execute buy now after a brief delay to ensure PDP is loaded
                        setTimeout(() => {
                            const buyNowBtn = document.querySelector('#pdp-buy-now-btn');
                            if (buyNowBtn && buyNowBtn.dataset.productId === buyNowProductId) {
                                handleBuyNowPDP();
                            }
                        }, 500);
                        return;
                    }
                    
                    // Normal referrer logic
                    const referrer = sessionStorage.getItem('loginReferrer');
                    if (referrer) {
                        sessionStorage.removeItem('loginReferrer');
                        showSection(referrer);
                    } else {
                        showSection('account-section');
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Login error:', error);
                showLoginError(error.message);
            } finally {
                showLoginLoading(false);
            }
        }

        function getLoginErrorMessage(error) {
            switch (error.code || error.message) {
                case 'invalid_credentials':
                    return 'Email hoặc mật khẩu không chính xác';
                case 'email_not_confirmed':
                    return 'Vui lòng xác thực email trước khi đăng nhập';
                case 'too_many_requests':
                    return 'Quá nhiều lần thử. Vui lòng thử lại sau';
                case 'user_not_found':
                    return 'Tài khoản không tồn tại';
                default:
                    return error.message || 'Đăng nhập thất bại. Vui lòng thử lại';
            }
        }

        async function checkUserSellerStatus(userId) {
            try {
                if (!supabaseClient) return;
                
                const { data, error } = await supabaseClient
                    .from('sellers')
                    .select('id, status')
                    .eq('user_id', userId)
                    .single();
                
                if (data) {
                    localStorage.setItem('isUserSeller', 'true');
                    localStorage.setItem('sellerStatus', data.status || 'pending');
                } else {
                    localStorage.setItem('isUserSeller', 'false');
                }
            } catch (error) {
                console.log('Seller status check failed (user might not be a seller):', error);
                localStorage.setItem('isUserSeller', 'false');
            }
        }

        function showLoginLoading(show) {
            const spinner = document.getElementById('login-spinner');
            const loginBtn = document.getElementById('email-login-btn');
            
            if (show) {
                if (spinner) spinner.classList.remove('d-none');
                if (loginBtn) {
                    loginBtn.disabled = true;
                    loginBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Đang đăng nhập...';
                }
            } else {
                if (spinner) spinner.classList.add('d-none');
                if (loginBtn) {
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = 'Đăng nhập';
                }
            }
        }

        function showLoginSuccess(message) {
            const successEl = document.getElementById('login-success');
            const messageEl = document.getElementById('login-success-message');
            
            if (successEl && messageEl) {
                messageEl.textContent = message;
                successEl.classList.remove('d-none');
            }
        }

        function showLoginError(message) {
            const errorEl = document.getElementById('login-error');
            const messageEl = document.getElementById('login-error-message');
            
            if (errorEl && messageEl) {
                messageEl.textContent = message;
                errorEl.classList.remove('d-none');
            }
        }

        function hideLoginMessages() {
            const successEl = document.getElementById('login-success');
            const errorEl = document.getElementById('login-error');
            
            if (successEl) successEl.classList.add('d-none');
            if (errorEl) errorEl.classList.add('d-none');
        }

        function updateAuthenticationStatus() {
            const isAuthenticated = isUserLoggedIn();
            const loggedInInfo = document.getElementById('logged-in-account-info');
            const notLoggedInInfo = document.getElementById('not-logged-in-account-info');
            
            if (isAuthenticated) {
                if (loggedInInfo) loggedInInfo.classList.remove('d-none');
                if (notLoggedInInfo) notLoggedInInfo.classList.add('d-none');
                checkSellerStatusAndUpdateUI();
            } else {
                if (loggedInInfo) loggedInInfo.classList.add('d-none');
                if (notLoggedInInfo) notLoggedInInfo.classList.remove('d-none');
                hideSellerButtons();
            }
        }

        function hideSellerButtons() {
            const sellerRegistryEntry = document.getElementById('seller-registration-entry');
            const sellerCenterEntry = document.getElementById('seller-center-entry');
            
            if (sellerRegistryEntry) sellerRegistryEntry.classList.add('d-none');
            if (sellerCenterEntry) sellerCenterEntry.classList.add('d-none');
        }

        function checkSellerStatusAndUpdateUI() {
            const isSeller = localStorage.getItem('isUserSeller') === 'true';
            const sellerStatus = localStorage.getItem('sellerStatus');
            const sellerRegistryEntry = document.getElementById('seller-registration-entry');
            const sellerCenterEntry = document.getElementById('seller-center-entry');
            
            if (isSeller) {
                // User is a seller, show seller center
                    if (sellerCenterEntry) sellerCenterEntry.classList.remove('d-none');
                if (sellerRegistryEntry) sellerRegistryEntry.classList.add('d-none');
                } else {
                // User is not a seller, show registration option
                if (sellerRegistryEntry) sellerRegistryEntry.classList.remove('d-none');
                if (sellerCenterEntry) sellerCenterEntry.classList.add('d-none');
            }
        }

        // --- Missing utility functions ---
        function requireAuth(targetSection = null) {
            if (!isUserLoggedIn()) {
                if (targetSection) {
                    sessionStorage.setItem('loginReferrer', targetSection);
                }
                alert('Vui lòng đăng nhập để sử dụng tính năng này');
                    showSection('account-section');
                    return false;
                }
            return true;
        }

        function openSellerOnboarding() {
            if (!requireAuth('seller-onboarding')) return;
            window.location.href = 'SellerOnboarding/SellerInfoBasicScreen.html';
        }

        function openSellerCenter() {
            if (!requireAuth()) return;
            const sellerStatus = localStorage.getItem('sellerStatus');
            if (sellerStatus === 'approved') {
                alert('Chuyển hướng đến Seller Center...');
                // In a real app, this would redirect to seller center
                } else {
                alert('Tài khoản seller của bạn đang được xét duyệt. Vui lòng chờ thông báo.');
            }
        }

        // --- Load search suggestions function ---
        function loadSearchSuggestions(query) {
            // Placeholder function to prevent console errors
            console.log('Search suggestions for:', query);
            return [];
        }

        // --- Section navigation with authentication check ---
        function navigateToSection(sectionId, requiresAuth = false) {
            if (requiresAuth && !requireAuth(sectionId)) {
                return;
            }
            showSection(sectionId);
        }

        // --- Logout function ---
        function logout() {
            if (supabaseClient) {
                supabaseClient.auth.signOut();
            }
            
            localStorage.removeItem('userAuthenticated');
            localStorage.removeItem('userName');
            localStorage.removeItem('userId');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('isUserSeller');
            localStorage.removeItem('sellerStatus');
            localStorage.removeItem('rememberLogin');
            localStorage.removeItem('supabase.auth.token');
            
            updateAuthenticationStatus();
            showSection('homepage-section');
            alert('Đã đăng xuất thành công');
        }
        
        // Initialize authentication on page load
        document.addEventListener('DOMContentLoaded', function() {
            const isAuthenticated = localStorage.getItem('userAuthenticated') === 'true';
            const userName = localStorage.getItem('userName');
            
            if (isAuthenticated && userName) {
                const accountUsernameEl = document.getElementById('account-username');
                if (accountUsernameEl) {
                    accountUsernameEl.textContent = userName;
                }
                }
                
                updateAuthenticationStatus();
        });

        // --- FAQ functions ---
        function toggleFAQ(element) {
            const faqItem = element.parentElement;
            const answer = faqItem.querySelector('.faq-answer');
            const icon = element.querySelector('i');
            
            // Toggle the answer visibility
            if (answer.style.display === 'block') {
                answer.style.display = 'none';
                icon.className = 'ri-arrow-down-s-line';
                    } else {
                answer.style.display = 'block';
                icon.className = 'ri-arrow-up-s-line';
            }
        }

        // --- Switch notification tabs ---
        function switchNotificationTab(type) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Filter notifications
            const notifications = document.querySelectorAll('.notification-item');
            notifications.forEach(notification => {
                if (type === 'all' || notification.dataset.type === type) {
                    notification.style.display = 'block';
                } else {
                    notification.style.display = 'none';
                }
            });
        }

        // --- Seller functions ---
        function openSellerOnboarding() {
            window.open('SellerOnboarding/index.html', '_blank');
        }

        function openSellerCenter() {
            window.open('../Web/seller_module/homepage/index.html', '_blank');
        }

        // --- Logout function ---
        function logout() {
            confirmLogout();
        }

        // --- Navigate to seller functions ---
        function navigateToSellerRegistration() {
            window.open('SellerOnboarding/index.html', '_blank');
        }

        function navigateToSellerCenter() {
            window.open('../Web/seller_module/homepage/index.html', '_blank');
        }

        // --- Show login required popup ---
        function showLoginRequiredPopup() {
            if (confirm('Bạn cần đăng nhập để sử dụng tính năng này. Chuyển đến trang đăng nhập?')) {
                showSection('login-section');
            }
        }

        // --- Settings Functions ---
        function updateSettingsUI() {
            const userInfo = document.getElementById('settings-user-info');
            const logoutSection = document.getElementById('settings-logout-section');
            const usernameEl = document.getElementById('settings-username');
            const emailEl = document.getElementById('settings-email');
            
            if (isUserLoggedIn()) {
                if (userInfo) userInfo.classList.remove('d-none');
                if (logoutSection) logoutSection.classList.remove('d-none');
                
                const userEmail = localStorage.getItem('userEmail');
                const username = userEmail ? userEmail.split('@')[0] : 'Người dùng';
                
                if (usernameEl) usernameEl.textContent = username;
                if (emailEl) emailEl.textContent = userEmail || 'user@example.com';
            } else {
                if (userInfo) userInfo.classList.add('d-none');
                if (logoutSection) logoutSection.classList.add('d-none');
            }
        }

        function confirmLogout() {
            if (confirm('Bạn có chắc chắn muốn đăng xuất?')) {
                performLogout();
            }
        }

        function performLogout() {
            try {
                // Sign out from Supabase if available
                if (supabaseClient && supabaseClient.auth) {
                    supabaseClient.auth.signOut().catch(error => {
                        console.warn('Error signing out from Supabase:', error);
                    });
                }
            } catch (error) {
                console.warn('Error during Supabase logout:', error);
            }
            
            // Clear all authentication data
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userId');
            localStorage.removeItem('iLogiCareAuth');
            localStorage.removeItem('userAuthenticated');
            localStorage.removeItem('userName');
            localStorage.removeItem('isUserSeller');
            localStorage.removeItem('sellerStatus');
            localStorage.removeItem('rememberLogin');
            localStorage.removeItem('supabase.auth.token');
            sessionStorage.removeItem('checkoutData');
            sessionStorage.removeItem('instantOrderData');
            sessionStorage.removeItem('instantOrderId');
            
            // Reset cart
            cart = [];
            saveCartToLocalStorage();
            
            // Update UI to logged out state
            updateAuthenticationState();
            updateSettingsUI();
            
            // Redirect to homepage
            showSection('homepage-section');
            
            alert('Đã đăng xuất thành công!');
        }

        // Debug functions for mobile specifications
        function debugMobileSpecifications(productId) {
            console.log(`=== DEBUG MOBILE SPECIFICATIONS FOR PRODUCT ${productId} ===`);
            
            // Find product in current products list
            let product = null;
            if (window.allProducts) {
                product = window.allProducts.find(p => p.id == productId);
            }
            
            if (product) {
                console.log('Product found:', product.name);
                console.log('Category:', product.category);
                console.log('Brand:', product.brand);
                console.log('Specifications data:', product.specifications);
                console.log('Specifications type:', typeof product.specifications);
                
                if (product.specifications && typeof product.specifications === 'object') {
                    console.log('Specifications keys:', Object.keys(product.specifications));
                    Object.keys(product.specifications).forEach(key => {
                        const spec = product.specifications[key];
                        console.log(`${key}:`, spec);
                        
                        if (typeof spec === 'object' && spec.label && spec.value !== undefined) {
                            console.log(`  - Label: ${spec.label}`);
                            console.log(`  - Value: ${spec.value}`);
                            console.log(`  - Type: ${spec.type}`);
                            console.log(`  - Required: ${spec.required}`);
                        }
                    });
                    
                    // Generate display text
                    console.log('\n=== MOBILE DISPLAY FORMAT ===');
                    Object.keys(product.specifications).forEach(key => {
                        const spec = product.specifications[key];
                        if (typeof spec === 'object' && spec.label && spec.value) {
                            console.log(`${spec.label}: ${spec.value}`);
                        }
                    });
                } else {
                    console.log('No specifications found or invalid format');
                }
            } else {
                console.log('Product not found in allProducts array');
                console.log('Available products:', window.allProducts ? window.allProducts.length : 'No products loaded');
            }
            
            console.log('=== END MOBILE DEBUG ===');
        }

        function debugMobileProductsData() {
            console.log('=== DEBUG MOBILE PRODUCTS DATA ===');
            console.log('Total products loaded:', window.allProducts ? window.allProducts.length : 'No products');
            
            if (window.allProducts && window.allProducts.length > 0) {
                console.log('=== SPECIFICATIONS DEBUG ===');
                window.allProducts.slice(0, 3).forEach((product, index) => {
                    console.log(`Product ${index + 1}: ${product.name}`);
                    console.log('Category:', product.category);
                    console.log('Brand:', product.brand);
                    console.log('Specifications:', product.specifications);
                    if (product.specifications) {
                        console.log('Specifications type:', typeof product.specifications);
                        console.log('Specifications keys:', Object.keys(product.specifications));
                    }
                    console.log('---');
                });
            }
            console.log('=== END MOBILE DEBUG ===');
        }

        // Make debug functions available globally for mobile testing
        window.debugMobileSpecifications = debugMobileSpecifications;
        window.debugMobileProductsData = debugMobileProductsData;
        
        // Add helpful debug info to console
        console.log('%c=== Mobile i-LogiCare Debug Ready ===', 'color: #5AAF4B; font-weight: bold; font-size: 14px;');
        console.log('Mobile Debug Functions Available:');
        console.log('• debugMobileSpecifications(productId) - Debug specifications for specific product');
        console.log('• debugMobileProductsData() - Debug all loaded products data');
        console.log('%cMobile Specifications Testing:', 'color: #2196F3; font-weight: bold;');
        console.log('- Navigate to any product detail page');
        console.log('- Check browser console for specifications rendering logs');
        console.log('- Use debugMobileSpecifications(productId) to inspect specific product');
        console.log('%c=== Mobile Ready for Testing ===', 'color: #5AAF4B; font-weight: bold;');
    </script>

</body>
</html>
