<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> <!-- Tối ưu viewport cho mobile -->
    <title>i-LogiCare (Mobile)</title>
    <link rel="icon" type="image/png" href="images/car.png"> <!-- Giả sử logo vẫn dùng được -->
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Google Fonts (Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Remix Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.7.0/fonts/remixicon.css" rel="stylesheet">
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <!-- Supabase CDN script -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <style>
        /* Base Styles */
        :root {
            /* Colors */
            --primary: #5AAF4B;
            --primary-dark: #4a9c3d;
            --primary-light: #7bc36e;
            --secondary: #202D4A;
            --secondary-dark: #1a2540;
            --secondary-light: #2d3f66;
            --accent: #FFC107;
            --accent-dark: #e6ae06;
            --accent-light: #ffcd38;
            --neutral-light: #F3F4F6;
            --neutral-dark: #1F2937;
            --white: #FFFFFF;
            --black: #000000;
            --danger-color: #d0011b;
            
            /* Typography */
            --font-family-base: 'Inter', sans-serif;
            --font-size-base: 14px;
            --font-size-sm: 12px;
            --font-size-lg: 16px;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-bold: 600;
            
            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            
            /* Border & Shadow */
            --border-radius-sm: 4px;
            --border-radius-md: 8px;
            --border-radius-lg: 12px;
            --border-color: #E5E7EB;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 6px rgba(0,0,0,0.1);

            /* Layout */
            --header-height: 60px;
            --bottom-nav-height: 70px;
        }

        /* Reset & Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-base);
            font-size: var(--font-size-base);
            color: var(--neutral-dark);
            background-color: var(--neutral-light);
            padding-bottom: var(--bottom-nav-height);
            line-height: 1.5;
        }

        /* Header */
        .header {
            background: var(--primary);
            color: var(--white);
            position: sticky;
            z-index: 1020;
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0 8px; /* Giảm padding để tối ưu cho màn hình nhỏ */
            min-width: 0; /* Cho phép flex shrink */
        }

        /* Specific header alignment fix */
        #plp-header {
            padding: 8px; /* Padding nhỏ hơn cho màn hình nhỏ */
        }

        #plp-header .d-flex {
            gap: 4px; /* Khoảng cách nhỏ hơn giữa các elements */
            align-items: center;
            justify-content: space-between; /* Đảm bảo phân bố đều */
        }

        .header-search {
            flex: 1;
            margin: 0 var(--spacing-sm);
            width: 100%;
            max-width: calc(100% - 120px); /* Để lại khoảng trống cho logo và các nút action */
        }

        .header-search-input {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--border-radius-sm);
            background-color: var(--color-white);
            color: var(--color-neutral-dark);
            font-size: var(--font-size-base);
        }

        .header-search-input::placeholder {
            color: var(--neutral-dark);
            opacity: 0.7;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .header-action-btn {
            color: var(--white);
            background: none;
            border: none;
            padding: var(--spacing-xs);
            cursor: pointer;
            font-size: var(--font-size-lg);
        }

        /* Bottom Navigation Bar */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--white);
            display: flex;
            justify-content: space-around;
            padding: var(--spacing-sm);
            box-shadow: var(--shadow-sm);
            z-index: 1020;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--neutral-dark);
            text-decoration: none;
            font-size: var(--font-size-sm);
        }

        .bottom-nav-item--active {
            color: var(--primary);
        }

        .bottom-nav-icon {
            font-size: 24px;
            margin-bottom: var(--spacing-xs);
            color: var(--neutral-dark);
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .bottom-nav-icon.active {
            color: var(--primary);
        }

        .bottom-nav-icon:hover {
            color: var(--primary-dark);
            text-decoration: none;
        }

        .mobile-product-card-shopee {
            border: 1px solid var(--border-color, #eee);
            border-radius: 4px; /* Ít bo góc hơn */
            background-color: var(--white);
            font-size: 12px; /* Cỡ chữ cơ bản nhỏ hơn */
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: transform 0.1s ease-in-out; /* Hiệu ứng nhẹ khi chạm */
        }

        .mobile-product-card-shopee:active {
            transform: scale(0.98); /* Thu nhỏ nhẹ khi chạm */
        }


        /* Product Card */

        .product-card-img-container {
            aspect-ratio: 1 / 1; /* Đảm bảo ảnh vuông */
            overflow: hidden;
            position: relative; /* Cho overlay badges */
            background-color: #f9f9f9; /* Nền nhạt nếu ảnh không tải được */
        }

        .product-card {
            background-color: var(--white);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .product-card-img {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: contain; /* Hoặc cover tùy ý */
        }

        /* Overlay Badges */
        .product-overlays {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 4px;
            display: flex;
            justify-content: space-between; /* Đặt Mall bên trái, Discount bên phải */
            align-items: flex-start;
            pointer-events: none; /* Để click vẫn xuyên qua được */
            z-index: 1;
        }
        .overlay-badge {
            font-size: 9px; /* Rất nhỏ */
            padding: 2px 4px;
            font-weight: bold;
            border-radius: 2px;
            text-transform: uppercase;
            line-height: 1;
        }
        .overlay-badge-mall {
            background-color: #d0011b; /* Màu đỏ Shopee Mall */
            color: white;
            margin-right: 2px;
        }
        .overlay-badge-discount {
            background-color: rgba(255, 216, 64, 0.9); /* Màu vàng nhạt có trong suốt */
            color: #d0011b; /* Màu chữ đỏ */
            border: 1px solid #d0011b; /* Viền đỏ */
            display: flex;
            flex-direction: column; /* Xếp % và chữ GIẢM theo chiều dọc */
            align-items: center;
            padding: 0; /* Reset padding */
            line-height: 1.1;
        }
        .overlay-badge-discount .percent {
            font-size: 10px; /* % to hơn */
            padding: 1px 3px;
            display: block;
        }
        .overlay-badge-discount .label {
            font-size: 7px; /* Chữ GIẢM nhỏ hơn */
            background-color: #d0011b; /* Nền đỏ */
            color: white;
            display: block;
            width: 100%;
            padding: 1px 3px;
            border-radius: 0 0 1px 1px; /* Bo góc dưới */
        }
        /* Stock Overlay */
        .stock-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255, 255, 255, 0.6); /* Lớp phủ trắng mờ */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2; /* Nằm trên ảnh */
        }

        /* Card Body */
        .mobile-product-card-shopee .card-body {
            padding: 8px; /* Padding nhỏ */
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .mobile-product-card-shopee .product-card-title {
            font-size: 13px; /* Cỡ chữ tên SP */
            font-weight: 400; /* Không quá đậm */
            line-height: 1.3;
            min-height: 2.6em; /* Tối thiểu 2 dòng */
            margin-bottom: 4px;
            color: var(--text-color);
            /* CSS ngắt dòng */
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        /* Price Area */
        .price-container {
            display: flex;
            align-items: baseline; /* Căn theo baseline */
            gap: 4px; /* Khoảng cách nhỏ */
            flex-wrap: wrap; /* Cho phép xuống dòng nếu cần */
        }
        .shopee-price {
            font-size: 16px; /* Giá chính to */
            font-weight: 500;
            color: var(--primary-dark);
        }

        /* Extra Tags (SPayLater...) */
        .extra-tags {
            margin-top: 2px; /* Khoảng cách nhỏ trên */
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        .extra-tag {
            font-size: 9px;
            padding: 1px 3px;
            border: 1px solid var(--border-color);
            border-radius: 2px;
            color: var(--text-light);
        }
        .tag-spaylater {
            border-color: #00a79d; /* Màu SPayLater */
            color: #00a79d;
        }

        /* Rating & Sold Info */
        .rating-sold-info {
            font-size: 11px; /* Cỡ chữ nhỏ */
            color: rgba(0,0,0,0.54); /* Màu xám nhạt */
            margin-top: 4px;
        }
        .rating-stars i {
            font-size: 10px; /* Sao nhỏ */
            color: #FFD700; /* Màu vàng */
            vertical-align: baseline;
        }
        .rating-stars {
            margin-right: 2px;
            font-size: 10px; /* Sao nhỏ */
            color: #FFD700; /* Màu vàng */
        }
        
        .sold-count {
            /* Có thể không cần style gì thêm */
        }
        .location {
            font-size: 10px;
        }
        /* === Hết Styling Mobile Product Card === */

        /* Category Section */
        .category-section {
            padding: var(--spacing-md);
            background-color: var(--white);
            margin-bottom: var(--spacing-md);
        }

        .category-section-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--spacing-md);
        }

        .category-item-image {
            width: 100%;
            height: auto;
            border-radius: var(--border-radius-sm);
        }

        .category-item-name {
            font-size: var(--font-size-sm);
            text-align: center;
            margin-top: var(--spacing-xs);
        }

        /* Search Suggestions */
        .suggestion-item {
            padding: var(--spacing-sm) var(--spacing-md);
            cursor: pointer;
        }

        /* Shortcut Menu */
        .shortcut-menu {
            padding: 12px 0;
            background: var(--primary);
            margin-bottom: 16px;
            position: relative;
        }

        .shortcut-menu-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, auto);
            gap: 12px 0;
            justify-items: center;
            align-items: center;
            width: 100%;
            max-width: 420px;
            margin: 0 auto;
        }

        .shortcut-menu-item {
            width: 100%;
            max-width: 90px;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .shortcut-menu-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
        }

        .shortcut-menu-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .shortcut-menu-text {
            color: white;
            font-size: 12px;
            text-align: center;
            line-height: 1.2;
             display: -webkit-box;
             -webkit-line-clamp: 2;
             -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 2.4em;
        }

        @media (max-width: 480px) {
            .shortcut-menu-grid {
                max-width: 100%;
                gap: 8px 0;
            }
            .shortcut-menu-item {
                max-width: 70px;
            }
            .shortcut-menu-icon {
                width: 32px;
                height: 32px;
                padding: 4px;
            }
            .shortcut-menu-text {
                font-size: 11px;
                min-height: 2em;
            }
        }

        /* Header Icons */
        .header-icon {
            font-size: 20px; /* Giảm size cho màn hình nhỏ */
            color: var(--white);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px; /* Giảm width cho màn hình nhỏ */
            width: 40px; /* Fixed width */
            height: 40px; /* Giảm height cho màn hình nhỏ */
            border-radius: var(--border-radius-sm);
            text-decoration: none;
            flex-shrink: 0; /* Không cho phép co lại */
            margin: 0 2px; /* Thêm margin nhỏ giữa các icon */
        }

        /* PLP Header Specific Styles */
        #plp-header .header-icon {
            margin: 0 2px; /* Thêm margin nhỏ */
            padding: 0; /* Reset padding */
        }

        #plp-header .search-container {
            flex: 1; /* Chiếm không gian còn lại */
            margin: 0 8px; /* Margin đồng nhất */
        }

        /* Search Icons */
        .search-icon {
            padding: 0.4rem; /* Giảm padding */
            color: var(--neutral-dark);
            display: flex;
            align-items: center;
            background: transparent;
            border: none;
            text-decoration: none;
            flex-shrink: 0; /* Không cho phép co lại */
        }

        .search-icon.camera-icon {
            border: none;
            background: none;
            padding-right: 0.4rem; /* Giảm padding */
            text-decoration: none;
            flex-shrink: 0; /* Không cho phép co lại */
        }

        /* Mobile Contact Icons */
        .mobile-contact-icon {
            width: 40px;
            height: 40px;
            background: var(--neutral-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            flex-shrink: 0;
            text-decoration: none;
        }

        /* Bottom Navigation Icons */
        .bottom-nav-icon {
            font-size: 24px;
            color: var(--neutral-dark);
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--spacing-xs) 0;
        }

        .bottom-nav-icon span {
            font-size: 12px;
        }

        .bottom-nav-icon.active {
            color: var(--primary);
        }

        .bottom-nav-icon.active i {
            font-weight: bold;
        }

        .bottom-nav-icon:hover {
            color: var(--primary-dark);
            text-decoration: none;
        }

        /* Cart Section Mobile Styles */
        .mobile-cart {
            padding-bottom: var(--bottom-nav-height);
        }

        .mobile-cart-header {
            position: sticky;
            top: var(--header-height);
            background-color: var(--color-white);
            z-index: 1010;
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
             display: flex;
             align-items: center;
            gap: var(--spacing-sm);
        }

        .mobile-cart-item {
            background: var(--color-white);
            padding: var(--spacing-md);
             border-bottom: 1px solid var(--border-color);
            display: grid;
            grid-template-columns: 80px 1fr auto;
            gap: var(--spacing-sm);
            align-items: start;
        }

        .mobile-cart-item-img {
            width: 80px;
            height: 80px;
             object-fit: contain;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: var(--spacing-xs);
        }

        .mobile-cart-item-details {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .mobile-cart-item-name {
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-base);
            color: var(--color-neutral-dark);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .mobile-cart-item-price {
            color: var(--color-primary);
            font-weight: var(--font-weight-bold);
        }

        .mobile-cart-quantity {
              display: flex;
              align-items: center;
            gap: var(--spacing-xs);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: var(--spacing-xs);
        }

        .mobile-cart-quantity-btn {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            color: var(--color-neutral-dark);
        }

        .mobile-cart-quantity-input {
             width: 40px;
             text-align: center;
            border: none;
            font-size: var(--font-size-base);
            -moz-appearance: textfield;
        }

        .mobile-cart-quantity-input::-webkit-outer-spin-button,
        .mobile-cart-quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .mobile-cart-remove {
            color: var(--color-neutral-dark);
             background: none;
             border: none;
            padding: var(--spacing-xs);
        }

        .mobile-cart-summary {
            position: fixed;
            bottom: var(--bottom-nav-height);
            left: 0;
            right: 0;
            background: var(--color-white);
            padding: var(--spacing-md);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1010;
        }

        .mobile-cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        /* === CSS cho Swipe to Delete Cart Item === */
        .mobile-cart-item-swipe-wrapper {
            overflow: hidden; /* Quan trọng để ẩn phần nút xóa khi chưa trượt */
            border-radius: 8px; /* Bo góc cho wrapper */
            /* box-shadow: var(--shadow-sm); */ /* Có thể bỏ nếu cart-item-content đã có */
        }

        .mobile-cart-item-content {
            transition: transform 0.3s ease-out; /* Hiệu ứng trượt mượt */
            z-index: 1; /* Nằm trên nút xóa */
            /* Các style cũ của mobile-cart-item có thể chuyển vào đây */
        }

        .mobile-cart-item-content.swiped {
            transform: translateX(-70px); /* Độ rộng của nút xóa */
        }

        .swipe-delete-action {
            opacity: 0; /* Ban đầu ẩn */
            transition: opacity 0.3s ease-out;
            /* Thêm style để đảm bảo click được */
            pointer-events: none;
        }

        .mobile-cart-item-content.swiped + .swipe-delete-action,
        .mobile-cart-item-swipe-wrapper:hover .swipe-delete-action { /* Hiện khi wrapper được hover hoặc content đã swiped */
            opacity: 1;
            pointer-events: auto; /* Cho phép click khi hiện */
            z-index: 0; /* Đưa lên trên content một chút khi hover/swipe (nếu cần) hoặc giữ nguyên */
        }

        /* CSS cho Quantity Controls (Cập nhật từ code bạn gửi) */
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 4px; /* Khoảng cách nhỏ hơn */
        }
        .quantity-btn {
            width: 28px; /* Nhỏ hơn */
            height: 28px;
            border: 1px solid var(--border-color);
            background: var(--bg-light);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--neutral-dark);
            font-size: 0.9rem; /* Icon nhỏ hơn */
            padding: 0;
        }
        .quantity-btn:active {
            background-color: var(--border-color);
        }
        .quantity-input {
            width: 35px; /* Hẹp hơn */
            height: 28px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            text-align: center;
            font-size: 0.9rem;
            padding: 0;
            -moz-appearance: textfield;
        }
        .quantity-input::-webkit-outer-spin-button,
        .quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* === Hết CSS Swipe to Delete === */

        /* === CSS cho Popup Xác nhận Xóa === */
        .delete-confirm-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6); /* Lớp phủ mờ hơn */
            display: none; /* Ban đầu ẩn */
            justify-content: center;
            align-items: center;
            z-index: 2000; /* Cao hơn các element khác */
            padding: 1rem;
        }
        .delete-confirm-popup.show {
            display: flex;
        }
        .delete-confirm-content {
            background: white;
            border-radius: var(--border-radius-lg);
            width: 90%;
            max-width: 320px; /* Kích thước popup nhỏ hơn */
            padding: 1.5rem;
            text-align: center;
            animation: popup-scale-in 0.3s ease-out;
        }
        @keyframes popup-scale-in {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .delete-confirm-content h5 {
            font-weight: 600;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }
        .delete-confirm-content p {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }
        .delete-confirm-actions {
            display: flex;
            gap: 0.75rem;
        }
        .delete-confirm-actions button {
            flex: 1;
            padding: 0.6rem;
            border-radius: var(--border-radius-md);
            font-weight: 500;
            font-size: 0.9rem;
        }
        .btn-confirm-delete {
            background: var(--danger-color);
            color: white;
            border: none;
        }
        .btn-cancel-delete {
            background: var(--neutral-light);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
        /* === Hết CSS Popup Xác nhận Xóa === */

        /* Contact Section Mobile Styles */
        .mobile-contact-card {
            background: var(--color-white);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            box-shadow: var(--shadow-sm);
        }

        .mobile-contact-info {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .mobile-contact-item {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
        }

        .mobile-contact-icon {
            width: 40px;
            height: 40px;
            background: var(--color-neutral-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-primary);
            flex-shrink: 0;
            text-decoration: none;
        }

        .mobile-contact-text {
            flex-grow: 1;
        }

        .mobile-contact-label {
            font-weight: var(--font-weight-medium);
            margin-bottom: var(--spacing-xs);
        }

        .mobile-contact-form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .mobile-contact-input {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: var(--spacing-sm);
            font-size: var(--font-size-base);
        }

        .mobile-contact-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Helper to hide sections - Single definition */
        .section-hidden {
            display: none !important;
        }
        
        /* Search Bar */
        .search-container {
            display: flex;
            align-items: center;
            background-color: var(--white);
            border-radius: var(--border-radius-md);
            border: 1px solid rgba(255, 255, 255, 0.25);
            width: 100%;
            min-width: 0; /* Cho phép shrink */
            flex: 1; /* Chiếm không gian còn lại */
            min-height: 44px; /* Đảm bảo chiều cao cố định */
            margin: 0 8px; /* Margin nhỏ hơn cho màn hình nhỏ */
        }

        .search-input-group {
            display: flex;
            align-items: center;
            width: 100%;
            background: transparent;
            height: 100%; /* Chiếm toàn bộ chiều cao container */
        }

        /* PLP Search Container Specific */
        #plp-header .search-container {
            margin: 0; /* Reset margin để tránh bị lệch */
            flex: 1; /* Chiếm toàn bộ không gian còn lại */
        }

        .search-input {
            flex: 1;
            padding: 0.5rem;
            min-width: 0; /* Cho phép shrink */
            border: none;
            background: transparent;
            font-size: var(--font-size-base);
            color: var(--neutral-dark);
        }

        .search-input:focus {
            outline: none;
        }

        .search-icon {
            padding: 0.5rem;
            color: var(--neutral-dark);
            display: flex;
            align-items: center;
            background: transparent;
            border: none;
            text-decoration: none;
        }

        .search-icon.camera-icon {
            border: none;
            background: none;
            padding-right: var(--spacing-sm);
            text-decoration: none;
        }

        /* Brand Logos */
        .brand-scroll {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding: 4px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .brand-scroll::-webkit-scrollbar {
            display: none;
        }

        .brand-logo {
            flex: 0 0 auto;
            width: 80px;
            height: 40px;
            padding: 6px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .brand-logo img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* Filter Header */
        .filter-header {
            position: sticky;
            top: 50px;
            z-index: 900;
            background: var(--neutral-light);
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            box-shadow: var(--shadow-sm);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Quantity Input */
        .quantity-input {
            width: 40px;
            text-align: center;
            border: none;
            box-shadow: none;
            -moz-appearance: textfield;
        }

        .quantity-input::-webkit-outer-spin-button,
        .quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Cart Badge */
        .cart-badge {
            display: none;
        }

        .cart-badge.visible {
            display: inline-block;
        }

        /* Add this to your existing styles */
        .shortcut-menu {
            --scroll-position: translateX(0%);
        }

        .shortcut-menu::before {
            transform: translateX(-50%) var(--scroll-position);
        }

        /* Header Quick Actions */
        .header-quick-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--primary);
            position: relative;
            padding: 8px 0;
        }

        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-color);
            transition: all 0.2s ease;
            position: relative;
            flex: 1;
        }

        .quick-action-btn i {
            font-size: 24px;
            margin-bottom: 4px;
            color: var(--primary);
        }

        .quick-action-btn span {
            font-size: 12px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .quick-action-btn:active {
            transform: scale(0.95);
        }

        /* Add new styles for bottom nav */
        .bottom-nav {
            background-color: var(--white);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            height: var(--bottom-nav-height);
            padding: 0;
        }

        .bottom-nav-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--neutral-dark);
            text-decoration: none;
            font-size: var(--font-size-sm);
            padding: 8px 0;
            flex: 1;
        }

        .bottom-nav-icon i {
            font-size: 24px;
        }

        .bottom-nav-icon span {
            font-size: 10px;
        }

        .bottom-nav-icon.active {
            color: var(--primary);
        }

        /* Center Tab Styling */
        .bottom-nav-icon--center {
            margin-top: -15px;
        }

        .bottom-nav-icon-circle {
            width: 48px;
            height: 48px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2px;
        }

        .bottom-nav-icon--center i {
            color: white;
            font-size: 24px;
            margin: 0;
        }

        .bottom-nav-icon--center span {
            color: var(--primary);
            font-weight: 500;
        }

        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            text-decoration: none;
            gap: 4px;
        }

        .quick-action-btn i {
            font-size: 24px;
        }

        .quick-action-btn span {
            font-size: 12px;
            text-align: center;
            white-space: nowrap;
        }

        .btn-outline-primary {
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-outline-secondary {
            border-color: var(--primary-dark);
            color: var(--primary-dark);
            background-color: white;
        }

        .partner-brands {
            background: white;
            padding: 16px;
            margin-bottom: 8px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--neutral-dark);
        }

        .brand-scroll {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding: 4px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .brand-scroll::-webkit-scrollbar {
            display: none;
        }

        .brand-logo {
            flex: 0 0 auto;
            width: 80px;
            height: 40px;
            padding: 6px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .brand-logo img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* Find by Vehicle Section Styles */
        .find-by-vehicle-content {
            background-color: var(--neutral-light);
            min-height: calc(100vh - var(--header-height) - var(--bottom-nav-height));
        }

        .vehicle-selection-form {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
        }

        .vehicle-selection-form h6 {
            color: var(--secondary);
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            color: var(--neutral-dark);
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .form-select {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: 0.75rem;
            font-size: var(--font-size-base);
            background-color: var(--white);
            transition: border-color 0.2s ease;
        }

        .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(90, 175, 75, 0.25);
            outline: none;
        }

        .form-select:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }

        .vehicle-specs-result {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
            margin-top: 1rem;
            width: 100%;
            margin-left: 0;
            margin-right: 0;
        }

        .vehicle-selection-form {
            width: 100%;
            margin: 0;
        }

        .find-by-vehicle-content {
            width: 100%;
            margin: 0;
        }

        .vehicle-specs-result h6 {
            color: var(--secondary);
            font-weight: 600;
        }

        .specs-content {
            background-color: #f8f9fa;
            border-radius: var(--border-radius-sm);
            padding: 1rem;
            width: 100%;
            margin-left: 0;
            margin-right: 0;
        }

        .specs-item {
            border-bottom: 1px solid var(--border-color);
        }

        .specs-item:last-child {
            border-bottom: none;
        }

        .specs-header h6 {
            color: var(--primary);
            font-weight: 600;
        }

        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
            color: var(--white);
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius-sm);
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
            color: var(--white);
        }

        .btn-primary:disabled {
            background-color: #6c757d;
            border-color: #6c757d;
            cursor: not-allowed;
        }

        .btn-success {
            background-color: #28a745;
            border-color: #28a745;
            color: var(--white);
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius-sm);
            transition: all 0.2s ease;
        }

        .btn-success:hover {
            background-color: #218838;
            border-color: #1e7e34;
            color: var(--white);
        }

        /* Progress Stepper Styles */
        .progress-stepper {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 0 auto;
            max-width: 300px;
        }

        .stepper-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
            transition: all 0.3s ease;
        }

        .stepper-step.active .step-number {
            background-color: var(--primary);
            color: white;
        }

        .stepper-step.completed .step-number {
            background-color: #28a745;
            color: white;
        }

        .step-label {
            font-size: 11px;
            color: #6c757d;
            text-align: center;
            font-weight: 500;
        }

        .stepper-step.active .step-label {
            color: var(--primary);
            font-weight: 600;
        }

        .stepper-line {
            flex: 1;
            height: 2px;
            background-color: #e9ecef;
            margin: 0 8px;
            margin-bottom: 20px;
        }

        /* Search Container Styles */
        .search-container {
            position: relative;
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            pointer-events: none;
        }

        .search-container input {
            padding-right: 40px;
            border-radius: var(--border-radius-md);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .search-container input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(90, 175, 75, 0.25);
        }

        /* Autocomplete Dropdown */
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 var(--border-radius-md) var(--border-radius-md);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: var(--shadow-md);
        }

        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f8f9fa;
            transition: background-color 0.2s ease;
        }

        .autocomplete-item:hover {
            background-color: #f8f9fa;
        }

        .autocomplete-item.selected {
            background-color: var(--primary);
            color: white;
        }

        .autocomplete-item .item-title {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .autocomplete-item .item-subtitle {
            font-size: 12px;
            color: #6c757d;
        }

        .autocomplete-item.selected .item-subtitle {
            color: rgba(255, 255, 255, 0.8);
        }

        /* Tags/Chips Styles */
        .selected-tags {
            margin-top: 16px;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            background-color: var(--primary);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            gap: 6px;
            transition: all 0.2s ease;
        }

        .tag:hover {
            background-color: var(--primary-dark);
        }

        .tag-remove {
            background: none;
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .tag-remove:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Dynamic Filters */
        .dynamic-filters {
            background-color: #f8f9fa;
            border-radius: var(--border-radius-sm);
            padding: 16px;
            margin-top: 16px;
        }

        .dynamic-filter-item {
            margin-bottom: 12px;
        }

        .dynamic-filter-item:last-child {
            margin-bottom: 0;
        }

        .filter-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--neutral-dark);
            margin-bottom: 6px;
        }

        .plp-header {
            position: sticky;
            top: 0;
            z-index: 1020;
            background: var(--primary);
            padding: 12px;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .filter-btn {
            background: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
        }

        .sort-bar {
            padding: 8px 12px;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .results-count {
            font-size: 14px;
            color: var(--neutral-dark);
        }

        .sort-dropdown {
            width: 140px;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            padding: 8px;
            background: var(--neutral-light);
        }

        .loading-indicator {
            text-align: center;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: var(--neutral-dark);
        }

        /* Filter Offcanvas Styles */
        .offcanvas {
            max-width: 85%;
        }
        .filter-section {
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .filter-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .price-range {
            padding: 0 8px;
        }

        .price-inputs {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
        }

        .price-inputs input {
            width: 100%;
            font-size: 14px;
        }

        .offcanvas-footer {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            background: white;
        }

        /* Product Card Styles */
        .product-card {
            background: white;
            border-radius: var(--border-radius-sm);
            overflow: hidden;
        }

        .product-card-img {
            width: 100%;
            aspect-ratio: 1;
            object-fit: contain;
        }

        .product-card-content {
            padding: 8px;
        }

        .product-card-title {
            font-size: 14px;
            line-height: 1.3;
            height: 2.6em;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            margin-bottom: 4px;
        }

        .product-card-price {
            color: var(--primary);
            font-weight: 600;
            font-size: 16px;
        }

        .product-card-sold {
            font-size: 12px;
            color: #666;
        }

        /* PDP Styles */
        .pdp-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1020;
            background: transparent;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-back {
            color: white;
            text-decoration: none;
            font-size: 24px;
            display: flex;
            align-items: center;

        }

        .pdp-header-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            font-size: x-large;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .pdp-gallery {
            position: relative;
            width: 100%;
            height: 350px;
            background: #f8f9fa;
            margin-bottom: 1rem;
        }

        .swiper-container {
            width: 100%;
            height: 100%;
        }

        .swiper-slide {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
        }

        .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .swiper-pagination {
            position: absolute;
            bottom: 10px !important;
        }

        .swiper-button-next,
        .swiper-button-prev {
            background: rgba(255, 255, 255, 0.9);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            color: #333;
        }

        .swiper-button-next:after,
        .swiper-button-prev:after {
            font-size: 18px;
        }

        .swiper-pagination-bullet {
            width: 8px;
            height: 8px;
            background: #fff;
            opacity: 0.5;
        }

        .swiper-pagination-bullet-active {
            opacity: 1;
            background: #007bff;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Loading Popup Styles */
        .loading-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        /* Improved Vehicle Specs Styles */
        .specs-header {
            background: var(--primary);
            color: #fff;
            padding: 1.25rem 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            width: 100%;
            margin-left: 0;
            margin-right: 0;
            box-shadow: 0 2px 8px rgba(90, 175, 75, 0.08);
        }
        .specs-header h4, .specs-header i {
            color: #fff !important;
        }

        .specs-content {
            background: #F3F4F6;
            border-radius: 12px;
            padding: 1.25rem 0.75rem;
            width: 100%;
            margin-left: 0;
            margin-right: 0;
        }

        .specs-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(31, 41, 55, 0.06);
            border: 1px solid #E5E7EB;
            margin-bottom: 1.25rem;
        }
        .specs-card-header {
            background: none;
            color: var(--secondary);
            padding: 0.75rem 1rem 0.5rem 1rem;
            border-bottom: 1px solid #E5E7EB;
        }
        .specs-card-header h5, .specs-card-header i {
            color: var(--secondary) !important;
        }

        .specs-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .specs-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .spec-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            transition: background-color 0.3s ease;
            margin-bottom: 0;
            height: 100%;
        }

        .spec-item:hover {
            background: #e9ecef;
        }

        .spec-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .spec-icon i {
            font-size: 1.2rem;
        }

        .spec-content {
            flex: 1;
        }

        .spec-label {
            font-size: 0.875rem;
            color: #6c757d;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .spec-value {
            font-size: 1rem;
            color: #212529;
            font-weight: 600;
            line-height: 1.4;
            word-break: break-word;
        }

        .specs-config-code .badge {
            font-size: 0.875rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .specs-card-body {
                padding: 1rem;
            }
            
            .specs-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .spec-item {
                flex-direction: column;
                text-align: center;
                padding: 1rem 0.75rem;
                margin-bottom: 0;
            }
            
            .spec-icon {
                margin-right: 0;
                margin-bottom: 0.75rem;
                width: 40px;
                height: 40px;
            }
            
            .spec-icon i {
                font-size: 1rem;
            }
            
            .specs-header {
                padding: 1rem;
            }
            
            .specs-header h4 {
                font-size: 1.25rem;
            }
            
            .specs-card-header h5 {
                font-size: 1rem;
            }
            
            .spec-label {
                font-size: 0.8rem;
            }
            
            .spec-value {
                font-size: 0.85rem;
            }
        }

        .loading-popup.show {
            opacity: 1;
            visibility: visible;
        }

        .loading-popup-content {
            background-color: white;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            max-width: 300px;
            width: 90%;
        }

        .loading-popup-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        .loading-popup-text {
            font-size: 16px;
            font-weight: 500;
            color: var(--neutral-dark);
            margin-bottom: 8px;
        }

        .loading-popup-subtext {
            font-size: 14px;
            color: #666;
        }

        .pdp-info {
            background: white;
            border-radius: 20px 20px 0 0;
            margin-top: -20px;
            position: relative;
            z-index: 1;
            padding: 20px 16px;
        }

        .pdp-basic-info {
            margin-bottom: 16px;
        }

        .product-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .product-meta {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }

        .separator {
            margin: 0 8px;
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .current-price {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-dark);
            font-weight: bold;
        }

        .original-price {
            font-size: 14px;
            color: #999;
            text-decoration: line-through;
        }

        .discount-tag {
            font-size: 12px;
            color: var(--primary);
            background: rgba(90, 175, 75, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .pdp-compatibility,
        .pdp-specs,
        .pdp-description,
        .pdp-shop-info {
            padding: 16px 0;
            border-top: 8px solid var(--neutral-light);
        }

        .specs-table {
            width: 100%;
            font-size: 14px;
        }

        .specs-table td {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .specs-table td:first-child {
            color: #666;
            width: 40%;
        }

        .pdp-shop-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .shop-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            overflow: hidden;
        }

        .shop-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .shop-details {
            flex: 1;
        }

        .shop-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .shop-rating {
            font-size: 13px;
            color: #666;
        }

        .pdp-action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 8px 16px;
            border-top: 1px solid var(--border-color);
            z-index: 1020;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: auto auto 1fr;
            gap: 8px;
        }

        .btn-chat,
        .btn-cart {
            display: flex;
            color: var(--primary);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            background: white;
            border: 1px solid var(--primary-light);
            border-radius: var(--border-radius-md);
            padding: 8px;
        }

        .btn-chat i,
        .btn-cart i {
            font-size: 20px;
        }

        .btn-buy {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px;
            font-weight: 500;
        }

        /* Cart Styles */
        .cart-header,
        .checkout-header {
            position: sticky;
            top: 0;
            background: var(--primary);
            z-index: 1020;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .cart-header h1,
        .checkout-header h1 {
            flex: 1;
            font-size: 14px;
            font-weight: 600;
            margin: 0;
        }

        .cart-content,
        .checkout-content {
            padding: 16px;
            padding-top: 70px; /* Account for fixed header */
        }

        .cart-items,
        .checkout-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .cart-item {
            background: white;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            padding: 12px;
            display: grid;
            grid-template-columns: 80px 1fr auto;
            gap: 12px;
            align-items: start;
        }

        .cart-item .item-image {
            width: 80px;
            height: 80px;
            border-radius: 4px;
            overflow: hidden;
        }

        .cart-item .item-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .cart-item .item-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .cart-item .item-name {
            font-size: 14px;
            font-weight: 500;
            margin: 0;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .cart-item .item-price {
            color: var(--primary);
            font-weight: 500;
            font-size: 16px;
        }

        .cart-item .item-quantity {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cart-item .quantity-btn {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: var(--gray-600);
        }

        .cart-item .quantity-input {
            width: 40px;
            height: 28px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }

        .cart-item .btn-remove {
            background: none;
            border: none;
            color: var(--gray-600);
            padding: 4px;
            font-size: 20px;
        }

        .cart-summary {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 16px;
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .summary-row.total {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            font-weight: 600;
            font-size: 16px;
        }

        .cart-footer,
        .checkout-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 16px;
            border-top: 1px solid var(--border-color);
            z-index: 1020;
        }

        .voucher-input {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .voucher-input input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
        }

        .btn-apply {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            font-weight: 500;
        }

        .btn-checkout,
        .btn-place-order {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            font-size: 16px;
        }

        /* Checkout Styles */
        .checkout-section {
            background: #f5f5f5;
            min-height: 100vh;
            padding-bottom: 80px; /* Space for bottom bar */
        }

        .checkout-header {
            background: var(--primary);
            color: white;
            padding: 12px 16px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .checkout-header .btn-back {
            background: none;
            border: none;
            color: white;
            padding: 0;
        }

        .checkout-header .header-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .checkout-address {
            background: white;
            padding: 16px;
            margin-bottom: 8px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .address-icon {
            color: var(--primary);
            font-size: 20px;
        }

        .address-details {
            flex: 1;
        }

        .address-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        .address-phone {
            color: #666;
            margin-bottom: 4px;
        }

        .address-text {
            font-size: 14px;
            line-height: 1.4;
        }

        .checkout-shop {
            background: white;
            margin-bottom: 8px;
        }

        .shop-header {
            padding: 12px 16px;
            border-bottom: 1px solid #f5f5f5;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .shop-name {
            font-weight: 600;
            margin: 0;
        }

        .checkout-items {
            padding: 0 16px;
        }

        .checkout-item {
            padding: 12px 0;
            display: flex;
            gap: 12px;
            border-bottom: 1px solid #f5f5f5;
        }

        .checkout-item:last-child {
            border-bottom: none;
        }

        .item-image {
            width: 80px;
            height: 80px;
            border: 1px solid #f5f5f5;
            border-radius: 4px;
            overflow: hidden;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .item-details {
            flex: 1;
        }

        .item-name {
            font-size: 14px;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .item-variant {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .item-price {
            color: var(--primary);
            font-weight: 500;
        }

        .item-quantity {
            font-size: 14px;
            color: #666;
        }

        .shipping-section {
            background: white;
            padding: 16px;
            margin-bottom: 8px;
        }

        .shipping-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .shipping-title {
            font-weight: 600;
            margin: 0;
        }

        .shipping-options {
            border: 1px solid #f5f5f5;
            border-radius: 4px;
        }

        .shipping-option {
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid #f5f5f5;
            cursor: pointer;
        }

        .shipping-option:last-child {
            border-bottom: none;
        }

        .shipping-option.selected {
            background: #fafafa;
        }

        .shipping-option-details {
            flex: 1;
        }

        .shipping-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .shipping-info {
            font-size: 12px;
            color: #666;
        }

        .shipping-fee {
            color: var(--primary);
            font-weight: 500;
        }

        .payment-section {
            background: white;
            padding: 16px;
            margin-bottom: 8px;
        }

        .payment-header {
            margin-bottom: 12px;
        }

        .payment-title {
            font-weight: 600;
            margin: 0;
        }

        .payment-methods {
            border: 1px solid #f5f5f5;
            border-radius: 4px;
        }

        .payment-method {
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid #f5f5f5;
            cursor: pointer;
        }

        .payment-method:last-child {
            border-bottom: none;
        }

        .payment-method.selected {
            background: #fafafa;
        }

        .payment-method-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .payment-method-details {
            flex: 1;
        }

        .payment-name {
            font-weight: 500;
        }

        .payment-info {
            font-size: 12px;
            color: #666;
        }

        .onestop-balance {
            background: #f8f8f8;
            padding: 8px 12px;
            margin-top: 8px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .balance-amount {
            font-weight: 500;
            color: var(--primary);
        }

        .btn-topup {
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
        }

        .checkout-summary {
            background: white;
            padding: 16px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .summary-row:last-child {
            margin-bottom: 0;
            padding-top: 8px;
            border-top: 1px solid #f5f5f5;
        }

        .total-amount {
            color: var(--primary);
            font-size: 16px;
            font-weight: 600;
        }

        .checkout-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 12px 16px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .checkout-total {
            text-align: right;
        }

        .total-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 2px;
        }

        .total-value {
            color: var(--primary);
            font-size: 18px;
            font-weight: 600;
        }

        .btn-place-order {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-weight: 500;
        }

        /* Notification Styles */
        .notification-tabs {
            position: sticky;
            top: 56px;
            background: white;
            z-index: 999;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-tabs {
            border: none;
            padding: 0 16px;
        }

        .nav-tabs .nav-link {
            border: none;
            color: #666;
            font-weight: 500;
            padding: 12px 16px;
            position: relative;
        }

        .nav-tabs .nav-link.active {
            color: var(--primary);
            background: none;
        }

        .nav-tabs .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 16px;
            right: 16px;
            height: 2px;
            background: var(--primary);
        }

        .notification-list {
            margin-top: 0;
            background: white;
        }

        .notification-item {
            display: flex;
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            gap: 12px;
            text-decoration: none;
            color: inherit;
        }

        .notification-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 500;
            margin-bottom: 4px;
            color: #333;
            font-size: 14px;
            line-height: 1.4;
        }

        .notification-time {
            font-size: 12px;
            color: #999;
        }

        .notification-item.unread {
            background-color: #f8f9fa;
        }

        .notification-item.unread .notification-title {
            color: #000;
            font-weight: 600;
        }

        .notification-badge {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            margin-top: 8px;
        }

        .mark-all-read {
            color: white;
            text-decoration: none;
            font-size: 14px;
            padding: 4px 8px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 4px;
        }

        /* Checkout Header Styles */
        #checkout-header {
            background: var(--primary);
            z-index: 1020;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        #checkout-header .header-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
            color: white;
            text-align: center;
        }

        #checkout-header .btn-back {
            color: white;
            text-decoration: none;
            font-size: 24px;
            display: flex;
            align-items: center;
            background: none;
            border: none;
            padding: 0;
        }

        /* Auth Headers Styles (Login & Register) */
        #login-header,
        #register-header {
            background: var(--primary);
            z-index: 1020;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        #login-header .header-title,
        #register-header .header-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
            color: white;
            text-align: center;
        }

        #login-header .btn-back,
        #register-header .btn-back {
            color: white;
            text-decoration: none;
            font-size: 24px;
            display: flex;
            align-items: center;
            background: none;
            border: none;
            padding: 0;
        }

        /* Auth Content Styles */
        .auth-content {
            padding-top: calc(var(--header-height) + 16px);
            padding-bottom: var(--bottom-nav-height);
            padding-left: 16px;
            padding-right: 16px;
        }

        /* Auth Headers Styles (Login & Register) */
        #login-header,
        #register-header {
            background: var(--primary);
            z-index: 1020;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        /* Auth Content Styles */
        .auth-content {
            padding-top: calc(var(--header-height) + 16px);
            padding-bottom: var(--bottom-nav-height);
            padding-left: 16px;
            padding-right: 16px;
        }

        /* Thêm styles cho tags */
        .product-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        .product-tag {
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 2px;
            color: #757575;
            background: #f5f5f5;
            border: 1px solid #ebebeb;
        }
        .tag-authentic {
            color: var(--primary);
            background: white;
            border-color: var(--primary-dark);
        }
        .tag-deal {
            color: #ee4d2d;
            background: #fff1f0;
            border-color: #ffccc7;
        }
        .tag-freeship {
            color: #00bfa5;
            background: #e5f6f4;
            border-color: #b4e6e2;
        }
        .tag-cashback {
            color: #f5a623;
            background: #fff8e4;
            border-color: #ffecc7;
        }
        .tag-partner {
            color: #2673dd;
            background: #e8f2ff;
            border-color: #c5d7f2;
        }
        .price-container {
            display: flex;
            align-items: baseline;
            gap: 4px;
            flex-wrap: wrap;
        }

        .original-price {
            color: #757575;
            font-size: 11px;
            text-decoration: line-through;
        }

        /* Account Section Styles */
        .account-info {
            background-color: var(--primary);
            padding: 1rem;
            color: white;
        }

        /* Settings Section Styles */
        .settings-content {
            background-color: #f8f9fa;
            min-height: 100vh;
        }

        .settings-menu {
            overflow: hidden;
        }

        .settings-item {
            text-decoration: none;
            color: inherit;
            background: white;
            transition: background-color 0.2s;
        }

        .settings-item:hover {
            background-color: #f8f9fa;
            color: inherit;
        }

        .settings-item:last-child {
            border-bottom: none !important;
        }

        .settings-section-title {
            background-color: #f8f9fa;
        }

        .form-check-input:checked {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .account-avatar {
            width: 60px;
            height: 60px;
            object-fit: cover;
        }

        .account-username {
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
            color: white;
        }

        .order-status-grid {
            background: white;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .order-status-item {
            text-decoration: none;
            color: inherit;
            text-align: center;
            position: relative;
            display: block;
        }

        .order-status-item i {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: block;
        }

        .order-status-item .badge {
            position: absolute;
            top: -8px;
            transform: translateX(50%);
            font-size: 0.8rem;
            font-weight: 700;
            min-width: 2.2em;
            min-height: 2.2em;
            border-radius: 1.1em;
            background: #dc3545; /* bg-danger */
            color: #fff;
            box-shadow: 0 2px 8px rgba(220,53,69,0.15);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
            border: 2px solid #fff;
        }

        .utilities-section {
            background: white;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title a {
            font-size: 0.875rem;
            color: var(--primary);
            text-decoration: none;
        }

        .utility-list .list-group-item {
            border: none;
            padding: 0.75rem 0;
        }

        .utility-list .list-group-item i {
            font-size: 1.25rem;
            color: var(--primary);
        }

        /* Seller Registration & Center Button Styles */
        .seller-registration-btn,
        .seller-center-btn {
            border-radius: 12px !important;
            margin-bottom: 8px;
            padding: 12px 16px !important;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .seller-registration-btn {
            background: linear-gradient(135deg, rgba(90, 175, 75, 0.1) 0%, rgba(90, 175, 75, 0.05) 100%);
            border-color: rgba(90, 175, 75, 0.2);
        }

        .seller-registration-btn:hover {
            background: linear-gradient(135deg, rgba(90, 175, 75, 0.15) 0%, rgba(90, 175, 75, 0.08) 100%);
            border-color: rgba(90, 175, 75, 0.3);
        }

        .seller-center-btn {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .seller-center-btn:hover {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(16, 185, 129, 0.08) 100%);
            border-color: rgba(16, 185, 129, 0.3);
        }

        .seller-registration-btn .ri-store-3-line,
        .seller-center-btn .ri-dashboard-3-line {
            font-size: 24px;
        }

        /* Settings Section Styles */
        .settings-content {
            padding-bottom: var(--bottom-nav-height);
        }

        .list-group-header {
            background-color: var(--light);
            font-weight: 500;
        }

        .list-group-item i {
            font-size: 20px;
            color: var(--gray);
        }

        .list-group-item:active {
            background-color: var(--light);
        }

        /* Ensure consistent icon sizes */
        .list-group-item .ri-arrow-right-s-line {
            font-size: 20px;
            color: var(--gray-400);
        }

        /* Style for the language selection */
        .list-group-item .text-secondary {
            font-size: 14px;
        }

        /* Logout button styling */
        .btn-outline-danger {
            border-width: 1px;
            font-weight: 500;
        }

        .btn-outline-danger:active {
            transform: scale(0.98);
        }

        /* Sort Bar Styles */
        .sort-bar-mobile {
            background: var(--white);
            border-bottom: 1px solid var(--border-color);
        }

        .sort-option {
            color: var(--gray-600);
            font-size: 13px;
            padding: 4px 8px;
            border: none;
            background: none;
            position: relative;
            min-width: 70px;
        }

        .sort-option.active {
            color: var(--primary);
            font-weight: 500;
        }

        .sort-option.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 8px;
            right: 8px;
            height: 2px;
            background: var(--primary);
            border-radius: 1px;
        }

        .sort-option i {
            font-size: 16px;
            vertical-align: middle;
            margin-left: 2px;
        }

        /* Price Section Styles */
        .price-container {
            display: flex;
            align-items: baseline;
            flex-wrap: wrap;
            gap: 4px;
        }

        .original-price {
            color: rgba(0,0,0,0.54);
            text-decoration: line-through;
            font-size: 12px;
        }

        .discount-percent {
            color: #EE4D2D;
            font-size: 11px;
            font-weight: 500;
            background: #fff1f0;
            border-color: #ffccc7;
            border-radius: 2px;
            padding: 2px 4px;
        }

        .sold-count {
            font-size: 14px;
        }
        /* Button Styles */
        .btn-cart {
            display: flex;
            color: var(--primary);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            background: white;
            border: 1px solid var(--primary-light);
            border-radius: var(--border-radius-md);
            padding: 8px;
        }

        .btn-primary {
            padding: 8px;
            background-color: var(--primary);
            color: white;
            border: none !important;
        }

        /* Toast Message Styles */
        .toast-message {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 24px;
            z-index: 1050;
            animation: fadeInOut 3s ease;
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toast-content i {
            font-size: 20px;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, 20px); }
            10% { opacity: 1; transform: translate(-50%, 0); }
            90% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -20px); }
        }

        /* Product Gallery Styles */
        .pdp-gallery {
            position: relative;
            width: 100%;
            height: 350px;
            background: #f8f9fa;
            margin-bottom: 1rem;
        }

        .swiper-container {
            width: 100%;
            height: 100%;
        }

        .swiper-slide {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
        }

        .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .swiper-pagination {
            position: absolute;
            bottom: 10px !important;
        }

        .swiper-button-next,
        .swiper-button-prev {
            background: rgba(255, 255, 255, 0.9);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            color: #333;
        }

        .swiper-button-next:after,
        .swiper-button-prev:after {
            font-size: 18px;
        }

        .swiper-pagination-bullet {
            width: 8px;
            height: 8px;
            background: #fff;
            opacity: 0.5;
        }

        .swiper-pagination-bullet-active {
            opacity: 1;
            background: #007bff;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .swiper-pagination-bullet {
            width: 8px;
            height: 8px;
            background: #fff;
            opacity: 0.5;
        }

        .swiper-pagination-bullet-active {
            opacity: 1;
            background: #007bff;
        }

        .swiper-container {
            width: 100%;
            height: 100%;
        }

        .swiper-slide {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
        }

        .confirm-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .confirm-popup.show {
            display: flex;
        }

        .confirm-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 360px;
            padding: 20px;
            animation: popup-in 0.3s ease-out;
        }

        @keyframes popup-in {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .confirm-header {
            text-align: center;
            margin-bottom: 16px;
        }

        .confirm-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            margin: 0;
        }

        .confirm-body {
            margin-bottom: 20px;
        }

        .confirm-amount {
            text-align: center;
            font-size: 24px;
            font-weight: 600;
            color: var(--primary);
            margin: 12px 0;
        }

        .confirm-details {
            background: #f8f8f8;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
        }

        .confirm-detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .confirm-detail-row:last-child {
            margin-bottom: 0;
        }

        .confirm-actions {
            display: flex;
            gap: 12px;
        }

        .confirm-actions button {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-cancel {
            background: #f5f5f5;
            color: #666;
        }

        .btn-confirm {
            background: var(--primary);
            color: white;
        }

        .toast-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-light);
            color: white;
            padding: 12px 4px;
            border-radius: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 2100;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .toast-notification.show {
            opacity: 0.7;
        }

        .toast-notification i {
            font-size: 18px;
            color: white;
        }

        /* Flying cart animation */
        .flying-item {
            position: fixed;
            z-index: 9999;
            pointer-events: none;
            transition: all 0.8s cubic-bezier(0.19, 1, 0.22, 1);
            width: 50px;
            height: 50px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        @keyframes addToCart {
            0% {
                transform: scale(1.5) translateY(0);
                opacity: 1;
            }
            80% {
                transform: scale(0.5) translateY(0);
                opacity: 0.8;
            }
            100% {
                transform: scale(0.3) translateY(0);
                opacity: 0;
            }
        }

        /* Voucher Section Styles */
        .voucher-section {
            background: white;
            margin-top: 8px;
            padding: 12px 16px;
        }

        .voucher-header {
            margin-bottom: 8px;
        }

        .voucher-title {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .voucher-title i {
            color: var(--primary);
            font-size: 18px;
        }

        .voucher-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            border: 1px dashed #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        .voucher-content:active {
            background: #f5f5f5;
        }

        .voucher-input {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
        }

        .voucher-input i {
            color: var(--primary);
        }

        /* Voucher Dialog Styles */
        .voucher-dialog {
            position: fixed;
            bottom: 73px;
            left: 0;
            right: 0;
            background: white;
            border-radius: 16px 16px 0 0;
            z-index: 1000;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
        }

        .voucher-dialog.show {
            transform: translateY(0);
        }

        .voucher-dialog-header {
            padding: 16px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .voucher-dialog-title {
            font-size: 16px;
            font-weight: 500;
        }

        .voucher-dialog-close {
            border: none;
            background: none;
            padding: 8px;
            color: #666;
        }

        .voucher-dialog-content {
            padding: 16px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .voucher-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .voucher-input-field {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .voucher-apply-btn {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            font-weight: 500;
        }

        .voucher-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .voucher-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 8px;
        }

        .voucher-item-icon {
            width: 40px;
            height: 40px;
            background: #f5f5f5;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        .voucher-item-details {
            flex: 1;
        }

        .voucher-item-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .voucher-item-desc {
            font-size: 12px;
            color: #666;
        }

        .voucher-item-action {
            padding: 6px 12px;
            border: 1px solid var(--primary);
            border-radius: 4px;
            color: var(--primary);
            background: white;
            font-size: 12px;
        }

        .voucher-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-out;
        }

        .voucher-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .summary-row.total-row {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #eee;
        }

        .discount-amount {
            color: #ee4d2d;
        }

        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            text-decoration: none;
            gap: 4px;
            width: 100%;
            max-width: 120px;
            padding: 4px;
        }

        .quick-action-btn i {
            font-size: 24px;
        }

        .quick-action-btn span {
            font-size: 12px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        /* PDP Gallery Styles */
        .pdp-gallery {
            position: relative;
            width: 100%;
            height: 350px;
            background: #f8f9fa;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .swiper-container {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .swiper-slide {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
            width: 100% !important;
        }

        .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Fix for swiper wrapper */
        .swiper-wrapper {
            width: 100%;
            height: 100%;
        }

        /* Ensure navigation buttons don't cause overflow */
        .swiper-button-next,
        .swiper-button-prev {
            background: rgba(255, 255, 255, 0.9);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            color: #333;
            transform: translateX(0);
        }

        .swiper-button-next {
            right: 10px;
        }

        .swiper-button-prev {
            left: 10px;
        }

        /* Language Selector Styles */
        .language-selector {
            position: relative;
            display: inline-flex;
            align-items: center;
        }

        .language-dropdown {
            position: absolute;
            right: 0; /* Căn phải để không bị tràn */
            top: 50px; /* Giảm khoảng cách */
            background: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            width: 160px; /* Giảm width cho màn hình nhỏ */
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
            display: none;
        }

        /* Responsive adjustments for very small screens */
        @media (max-width: 360px) {
            .header {
                padding: 0 4px; /* Padding rất nhỏ cho màn hình rất nhỏ */
                height: 70px; /* Giảm chiều cao header */
            }
            
            .header-icon {
                font-size: 18px; /* Icon nhỏ hơn */
                min-width: 36px;
                width: 36px;
                height: 36px;
                margin: 0 1px; /* Margin rất nhỏ */
            }
            
            .search-container {
                margin: 0 4px; /* Margin rất nhỏ */
                min-height: 36px; /* Chiều cao nhỏ hơn */
            }
            
            .search-icon {
                padding: 0.3rem; /* Padding rất nhỏ */
            }
            
            .search-icon.camera-icon {
                padding-right: 0.3rem;
            }
            
            .language-dropdown {
                width: 140px; /* Width nhỏ hơn cho màn hình rất nhỏ */
                top: 45px;
            }
            
            #plp-header {
                padding: 4px; /* Padding rất nhỏ */
            }
            
            #plp-header .d-flex {
                gap: 2px; /* Gap rất nhỏ */
            }
        }

        @media (max-width: 320px) {
            .header {
                padding: 0 2px; /* Padding cực nhỏ */
                height: 65px;
            }
            
            .header-icon {
                font-size: 16px;
                min-width: 32px;
                width: 32px;
                height: 32px;
                margin: 0;
            }
            
            .search-container {
                margin: 0 2px;
                min-height: 32px;
            }
            
            .search-icon {
                padding: 0.2rem;
            }
            
            .search-icon.camera-icon {
                padding-right: 0.2rem;
            }
            
            .language-dropdown {
                width: 120px;
                top: 40px;
            }
        }

        .language-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            display: block;
        }

        .language-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: black;
            text-decoration: none;
            transition: background-color 0.2s ease;
            width: 100%;
            box-sizing: border-box;
        }

        .language-item .flag {
            font-size: 20px;
            margin-right: 12px;
        }

        .language-item .lang-text {
            flex: 1;
        }

        .language-item .active-indicator {
            opacity: 0;
            color: var(--primary);            
            transition: opacity 0.2s ease;
        }

        .language-item[data-lang="vi"] .active-indicator {
            opacity: 1;
        }


        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: white;
            transition: all 0.2s ease;
            position: relative;
            flex: 1;
        }

        .quick-action-btn i {
            font-size: 24px;
            margin-bottom: 4px;
            color: white;
        }

        .quick-action-btn span {
            font-size: 12px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .quick-action-btn:active {
            transform: scale(0.95);
        }

        .pdp-reviews {
            padding: 16px;
            background: #fff;
            margin-top: 8px;
        }

        .reviews-header {
            margin-bottom: 20px;
        }

        .rating-summary {
            display: flex;
            gap: 24px;
            align-items: flex-start;
            padding: 16px;
            background: var(--neutral-light);
            border-radius: 8px;
        }

        .average-rating {
            text-align: center;
            min-width: 120px;
        }

        .rating-number {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
        }

        .rating-stars {
            color: var(--accent);
            font-size: 20px;
            margin: 8px 0;
        }

        .total-reviews {
            color: #666;
            font-size: 14px;
        }

        .rating-bars {
            flex: 1;
        }

        .rating-bar-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .star-label {
            width: 60px;
            font-size: 14px;
        }
        .progress {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 0 12px;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            border-radius: 4px;
        }

        .percent {
            width: 40px;
            font-size: 14px;
            text-align: right;
        }

        .review-list {
            margin-top: 20px;
        }

        .review-item {
            padding: 16px;
            border-bottom: 1px solid #eee;
        }

        .reviewer-info {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .reviewer-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            object-fit: cover;
        }

        .reviewer-details {
            flex: 1;
        }

        .reviewer-name {
            font-weight: 500;
        }

        .review-date {
            font-size: 12px;
            color: #666;
        }

        .review-rating {
            color: var(--accent);
            font-size: 16px;
            margin-bottom: 8px;
        }

        .review-content {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .review-images {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .review-images img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
        }

        .count {
            width: 40px;
            font-size: 14px;
            text-align: right;
            color: var(--primary);
            font-weight: 500;
        }

        .view-all-reviews {
            margin-top: 20px;
            text-align: center;
        }

        .btn-view-all {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 12px;
            background: var(--neutral-light);
            border: none;
            border-radius: 8px;
            color: var(--primary);
            font-weight: 500;
            gap: 8px;
            transition: background-color 0.2s;
        }

        .btn-view-all:hover {
            background: #e8e8e8;
        }

        .btn-view-all i {
            font-size: 20px;
        }

        /* Cart Styles */
        .cart-content {
            padding: 16px;
            background: #f5f5f5;
        }

        .cart-item {
            display: flex;
            padding: 16px;
            background: #fff;
            border-radius: 8px;
            margin-bottom: 12px;
            gap: 12px;
            align-items: flex-start;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .item-checkbox {
            padding-top: 8px;
        }

        .item-image {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            background: #f8f8f8;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .item-details {
            flex: 1;
        }

        .item-name {
            font-size: 14px;
            margin-bottom: 4px;
            color: var(--neutral-dark);
            font-weight: 500;
            line-height: 1.4;
        }

        .item-variant {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            display: inline-block;
            background: var(--neutral-light);
            padding: 2px 8px;
            border-radius: 4px;
        }

        .item-price {
            margin-bottom: 12px;
        }

        .current-price {
            font-weight: 600;
            color: var(--primary);
            margin-right: 8px;
            font-size: 15px;
        }

        .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 13px;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-quantity {
            width: 28px;
            height: 28px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--neutral-dark);
            transition: all 0.2s;
        }

        .btn-quantity:active {
            background: #f5f5f5;
            transform: scale(0.95);
        }

        .quantity-input {
            width: 40px;
            height: 28px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }

        .cart-summary {
            background: #fff;
            padding: 16px;
            margin-top: 16px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
            color: #666;
        }

        .summary-row.total {
            font-weight: 600;
            color: var(--primary);
            font-size: 16px;
            margin-top: 16px;
            margin-bottom: 0;
            padding-top: 12px;
            border-top: 1px solid #eee;
        }

        .cart-footer {
            padding: 16px;
            background: #fff;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .voucher-input {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .voucher-input input {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 14px;
        }

        .btn-apply {
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            font-weight: 500;
        }

        .btn-checkout {
            width: 100%;
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-weight: 500;
            font-size: 16px;
        }

        /* Voucher Popup Styles */
        .voucher-list-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .voucher-list-container {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .voucher-list-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .voucher-list-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
        }

        .voucher-list-header button {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--gray-600);
            padding: 4px;
        }

        .voucher-list-body {
            max-height: 60vh;
            overflow-y: auto;
            padding: 8px;
        }

        .voucher-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .voucher-item:hover:not(.disabled) {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .voucher-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .voucher-info {
            flex: 1;
        }

        .voucher-code {
            font-weight: 600;
            color: var(--primary);
            font-size: 14px;
            margin-bottom: 4px;
        }

        .voucher-desc {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: 2px;
        }

        .voucher-min {
            font-size: 11px;
            color: var(--danger);
        }

        .voucher-action .btn-apply {
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Main Header -->
    <header class="header fixed-top" id="main-header">
        <div class="d-flex align-items-center w-100">
            <!-- Search Bar Area -->
            <div class="search-container">
                <button class="search-icon" type="button"><i class="ri-search-line"></i></button>
                <input type="text" class="search-input" placeholder="Tìm kiếm sản phẩm" aria-label="Search" id="mobile-search-input">
                <button class="search-icon camera-icon" type="button" onclick="openCamera()">
                    <i class="ri-camera-line"></i>
                </button>
                <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none" onchange="onCameraCapture(event)">
            </div>
            <!-- Right Icons -->
            <div class="d-flex align-items-center flex-shrink-0">
                <!-- Cart Icon -->
                <a href="#cart-section" class="header-icon header-icon--cart" onclick="showSection('cart-section')">
                    <i class="ri-shopping-cart-line"></i>
                    <span id="cart-count-badge-mobile" class="header-badge" style="display: none;">0</span>
                </a>
                <!-- Chat Messages Icon -->
                <a href="chat-messages.html" class="header-icon">
                    <i class="ri-message-3-line"></i>
                </a>
                <!-- Language Icon -->
                <a href="#" class="header-icon language-selector">
                    <i class="ri-global-line"></i>
                </a>
                <div class="language-dropdown">
                    <a href="#" class="language-item" data-lang="vi">
                        <span class="flag">🇻🇳</span>
                        <span class="lang-text">Tiếng Việt</span>
                        <i class="ri-check-line active-indicator"></i>
                    </a>
                    <a href="#" class="language-item" data-lang="en">
                        <span class="flag">🇺🇸</span>
                        <span class="lang-text">English</span>
                        <i class="ri-check-line active-indicator"></i>
                    </a>
                    <a href="#" class="language-item" data-lang="km">
                        <span class="flag">🇰🇭</span>
                        <span class="lang-text">ភាសាខ្មែរ</span>
                        <i class="ri-check-line active-indicator"></i>
                    </a>
                </div>
            </div>
        </div>
    </header>
    <!-- End New Mobile Header -->

    <!-- Main Content Area -->
    <main>
        <!-- Các section (Homepage, PLP, PDP, Cart, Checkout, Login...) sẽ được đặt ở đây -->
         <!-- SECTION: Login (AUTH-01) - Mobile Optimized -->
        <section id="login-section" class="section-hidden">
            <!-- Login Header -->
            <header class="header fixed-top px-3" id="login-header">
                <div class="d-flex align-items-center justify-content-between w-100">
                    <!-- Back Button -->
                    <button class="btn-back" onclick="goBack()">
                        <i class="ri-arrow-left-line"></i>
                    </button>
                    
                    <!-- Title -->
                    <h1 class="header-title mb-0" data-translate="login_title">Đăng nhập</h1>
                    
                    <!-- Empty div for flex spacing -->
                    <div style="width: 24px;"></div>
                </div>
            </header>

            <div class="auth-content">
                <div class="text-center mb-4">
                    <img src="images/car.png" alt="i-LogiCare Logo" class="mb-4" style="height: 100px;">
                    <h2 class="fs-4 mb-3">Chào mừng đến với i-LogiCare</h2>
                </div>
                
                <!-- Login Options Card (Default view) -->
                <div id="login-options-card">
                    <div class="d-grid gap-3">
                        <!-- i-SuperApp Login Button -->
                        <button type="button" class="btn btn-primary btn-lg d-flex align-items-center justify-content-center gap-2" onclick="showEmailLoginForm()">
                            <i class="ri-smartphone-line"></i>
                            <span>Đăng nhập bằng i-SuperApp@LTA</span>
                        </button>
                        
                        <!-- Register Link -->
                        <div class="text-center mt-3">
                            <p class="text-muted mb-2">Chưa có tài khoản?</p>
                            <button type="button" class="btn btn-link p-0" onclick="showSection('register-section')">
                                Đăng ký ngay
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Email/Password Login Form (Hidden by default) -->
                <div id="email-login-card" class="d-none">
                    <form id="email-login-form" onsubmit="handleEmailLogin(event)">
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label">Email hoặc Số điện thoại</label>
                            <input type="text" class="form-control form-control-lg" id="loginEmail" 
                                   placeholder="Nhập email hoặc số điện thoại" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">Mật khẩu</label>
                            <div class="input-group">
                                <input type="password" class="form-control form-control-lg" id="loginPassword" 
                                       placeholder="Nhập mật khẩu" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('loginPassword')">
                                    <i class="ri-eye-line"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">
                                Ghi nhớ đăng nhập
                            </label>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg" id="email-login-btn">
                                Đăng nhập
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="showLoginOptions()">
                                Quay lại
                            </button>
                        </div>
                    </form>
                    
                    <div class="text-center mt-3">
                        <button type="button" class="btn btn-link p-0" onclick="alert('Tính năng quên mật khẩu đang phát triển')">
                            Quên mật khẩu?
                        </button>
                    </div>
                </div>
                
                <!-- Loading Spinner (Hidden by default) -->
                <div id="login-spinner" class="text-center mt-4 d-none">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Đang xử lý...</span>
                    </div>
                    <p class="mt-2" id="login-spinner-text">Đang xác thực...</p>
                </div>
                
                <!-- Success/Error Messages -->
                <div id="login-success" class="alert alert-success mt-4 d-none" role="alert">
                    <i class="ri-check-line me-2"></i>
                    <span id="login-success-message">Đăng nhập thành công!</span>
                </div>
                
                <div id="login-error" class="alert alert-danger mt-4 d-none" role="alert">
                    <i class="ri-error-warning-line me-2"></i>
                    <span id="login-error-message">Lỗi xác thực</span>
                </div>
            </div>
        </section>
        <!-- Chỉ khác cấu trúc HTML bên trong và class CSS để tối ưu cho mobile -->
        
        <!-- SECTION: Homepage (PUB-01) - Mobile Optimized -->
        <!-- SECTION: Homepage (PUB-01) - Shopee Inspired Mobile Layout -->
        <section id="homepage-section">

            <!-- Quick Action Buttons -->
        
                <div class="header-quick-actions">
                    <a href="#" class="quick-action-btn" onclick="alert('Tính năng quét QR đang phát triển')">
                    <i class="ri-qr-scan-line"></i>
                        <span>Quét QR</span>
                </a>
                    <a href="onestop-fund.html" class="quick-action-btn">
                    <i class="ri-wallet-3-line"></i>
                    <span>Quỹ OneStop@LTA</span>
                </a>
                    <a href="#" class="quick-action-btn" onclick="alert('Tính năng nhận xu đang phát triển')">
                <i class="ri-coin-line"></i>
                        <span>Xu OneStop@LTA</span>
                </a>
            </div>
            

            <!-- 2. Shortcut Icon Grid -->
            <div class="shortcut-menu">
                <div class="shortcut-menu-grid">
                    <!-- Mã giảm giá -->
                    <a href="vouchers.html" class="shortcut-menu-item">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_voucher.png" alt="Mã Giảm Giá">
                        </div>
                        <span class="shortcut-menu-text">Mã Giảm Giá</span>
                    </a>
                    
                    <!-- Dầu nhớt -->
                    <a href="#plp-section" class="shortcut-menu-item" onclick="loadPLP('engine_oil'); showSection('plp-section');">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_engine_oil.png" alt="Dầu Nhớt">
                        </div>
                        <span class="shortcut-menu-text">Dầu Nhớt</span>
                    </a>
                    
                    <!-- Lốp xe -->
                    <a href="#plp-section" class="shortcut-menu-item" onclick="loadPLP('tire'); showSection('plp-section');">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_tire.png" alt="Lốp Xe">
                        </div>
                        <span class="shortcut-menu-text">Lốp Xe</span>
                    </a>

                    <!-- Lọc dầu -->
                    <a href="#plp-section" class="shortcut-menu-item" onclick="loadPLP('oil_filter'); showSection('plp-section');">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_oil_filter.png" alt="Lọc Dầu">
                        </div>
                        <span class="shortcut-menu-text">Lọc Dầu</span>
                    </a>

                    <!-- Bảo hiểm -->
                    <a href="#plp-section" class="shortcut-menu-item" onclick="loadPLP('insurance'); showSection('plp-section');">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_insurance.png" alt="Bảo Hiểm">
                        </div>
                        <span class="shortcut-menu-text">Bảo Hiểm</span>
                    </a>
                    
                    <!-- Thiết bị điện - điện tử -->
                    <a href="#plp-section" class="shortcut-menu-item" onclick="loadPLP('electronics'); showSection('plp-section');">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_gps.png" alt="Thiết bị Điện">
                        </div>
                        <span class="shortcut-menu-text">Thiết bị Điện</span>
                    </a>
                    
                    <!-- Ưu đãi nhà xe -->
                    <a href="b2b-deals.html" class="shortcut-menu-item">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_b2b_deal.png" alt="Ưu đãi Nhà xe">
                        </div>
                        <span class="shortcut-menu-text">Nhà xe</span>
                    </a>

                    <!-- Hỗ trợ -->
                    <a href="#contact-section" class="shortcut-menu-item" onclick="showSection('contact-section')">
                        <div class="shortcut-menu-icon">
                            <img src="images/shortcut_support.png" alt="Hỗ trợ">
                        </div>
                        <span class="shortcut-menu-text">Hỗ trợ</span>
                    </a>
                </div>
            </div>

            <!-- 3. Featured Brands (Optional - Horizontal Scroll) -->
            <div class="partner-brands">
                <h6 class="section-title">Thương Hiệu Đối Tác</h6>
                <div class="brand-scroll">
                    <a href="#" class="brand-logo" onclick="loadPLP(); showSection('plp-section');">
                        <img src="https://logos-download.com/wp-content/uploads/2016/02/Castrol_logo_2D_transparent.png" alt="Castrol">
                    </a>
                    <a href="#" class="brand-logo" onclick="loadPLP(); showSection('plp-section');">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Mobil_logo.svg/2560px-Mobil_logo.svg.png" alt="Mobil">
                    </a>
                    <a href="#" class="brand-logo" onclick="loadPLP(); showSection('plp-section');">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSCMgruq2y5dDrsrjGcJYt2ItgeROBtP7-s4w&s" alt="Shell">
                    </a>
                    <a href="#" class="brand-logo" onclick="loadPLP(); showSection('plp-section');">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/c/c3/Bosch_logo.png" alt="Bosch">
                    </a>
                    <a href="#" class="brand-logo" onclick="loadPLP(); showSection('plp-section');">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/Denso_logo.svg/2560px-Denso_logo.svg.png" alt="Denso">
                    </a>
                    <a href="#" class="brand-logo" onclick="loadPLP(); showSection('plp-section');">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS_x0J2CYPBynb5r5W8Lp4JocJNSaAKRKAqjA&s" alt="Michelin">
                    </a>
                    <a href="#" class="brand-logo" onclick="loadPLP(); showSection('plp-section');">
                        <img src="images/brand_name.png" alt="i-LogiCare">
                    </a>
                </div>
            </div>

            <!-- 4. Recommendations -->
            <div class="container recommendations-section">
                <div class="row row-cols-2 g-2 mobile-product-grid" id="recommendations-grid">
                    <!-- Products loaded by JS using mobile-product-card structure -->
                    <div class="col"> <div class="text-center p-3"><div class="spinner-border spinner-border-sm text-primary" role="status"></div></div> </div>
                </div>
               
            </div>
        </section>

        <!-- SECTION: Product Listing Page (PLP - PUB-02) - Mobile Optimized -->
        <section id="plp-section" class="section-hidden">
            <!-- PLP Header -->
            <div class="header sticky-top" id="plp-header" style="top: 0; z-index: 1020;">
                <div class="d-flex align-items-center w-100">
                    <a href="#" class="header-icon" onclick="showSection('homepage-section')">
                        <i class="ri-arrow-left-line"></i>
                    </a>
                    <!-- Title for loadPLP function -->
                    <h5 class="header-title flex-grow-1 text-center" id="plp-title-mobile">Sản phẩm</h5>
                    <div class="search-container">
                        <div class="search-input-group">
                            <button class="search-icon">
                                <i class="ri-search-line"></i>
                            </button>
                            <input type="search" class="search-input" placeholder="Tìm kiếm sản phẩm..." data-translate="search_placeholder">
                            <button class="search-icon camera-icon">
                                <i class="ri-camera-line"></i>
                            </button>
                        </div>
                    </div>
                    <a href="#" class="header-icon" type="button" data-bs-toggle="offcanvas" data-bs-target="#filterOffcanvas">
                        <i class="ri-filter-3-line"></i>
                    </a>
                </div>
            </div>

            <!-- Sort Bar -->
            <div id="plp-sort-bar" class="sort-bar-mobile bg-white py-2 border-bottom sticky-top" style="top: 80px; z-index: 1019;">
                <div class="d-flex justify-content-around align-items-center">
                    <button class="btn btn-sm sort-option active" onclick="handleSortClick('relevance', this)" data-translate="sort_relevance">
                        Liên quan
                    </button>
                    <button class="btn btn-sm sort-option" onclick="handleSortClick('newest', this)" data-translate="sort_newest">
                        Mới nhất
                    </button>
                    <button class="btn btn-sm sort-option" onclick="handleSortClick('popular', this)" data-translate="sort_popular">
                        Bán chạy
                    </button>
                    <button class="btn btn-sm sort-option" onclick="handleSortClick('price', this)" data-sort-direction="asc" data-translate="sort_price">
                        Giá <i class="ri-arrow-up-down-line"></i>
                    </button>
                </div>
            </div>

            <!-- Product Grid Container -->
            <div class="container-fluid py-2" id="plp-container">
                <div class="row row-cols-2 g-2" id="plp-product-grid">
                    <!-- Products will be loaded here -->
                </div>
            </div>

            <style>
            /* Payment Confirmation Popup Styles */
            .payment-popup-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.6);
                z-index: 10000;
                display: none;
                opacity: 0;
                transition: opacity 0.3s ease-out;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }

            .payment-popup-container {
                background: white;
                border-radius: 16px;
                width: 100%;
                max-width: 400px;
                max-height: 90vh;
                overflow: hidden;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                animation: popupSlideIn 0.3s ease-out;
            }

            @keyframes popupSlideIn {
                from {
                    opacity: 0;
                    transform: translateY(30px) scale(0.95);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            .payment-popup-header {
                padding: 20px;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: var(--primary);
            }

            .payment-popup-header h3 {
                margin: 0;
                font-size: 18px;
                font-weight: 600;
                color: var(--white);
            }

            .btn-close-popup {
                background: none;
                border: none;
                font-size: 24px;
                color: var(--gray-600);
                padding: 4px;
                border-radius: 50%;
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .payment-popup-body {
                padding: 20px;
                max-height: 60vh;
                overflow-y: auto;
            }

            .popup-product-info {
                display: flex;
                gap: 12px;
                margin-bottom: 20px;
                padding: 12px;
                background: var(--gray-50);
                border-radius: 8px;
            }

            .popup-product-img {
                width: 60px;
                height: 60px;
                object-fit: cover;
                border-radius: 8px;
            }

            .popup-product-details h4 {
                margin: 0 0 4px 0;
                font-size: 14px;
                font-weight: 600;
                line-height: 1.3;
            }

            .popup-product-details p {
                margin: 0;
                font-size: 12px;
                color: var(--gray-600);
            }

            .popup-price {
                font-weight: 600;
                color: var(--primary) !important;
                font-size: 14px !important;
            }

            .popup-info-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px solid var(--border-color);
            }

            .popup-info-row.total-row {
                border-bottom: none;
                font-weight: 600;
                font-size: 16px;
                color: var(--primary);
                margin-top: 8px;
                padding-top: 12px;
                border-top: 2px solid var(--primary-light);
            }

            .popup-total {
                color: var(--primary);
                font-weight: 700;
                font-size: 18px;
            }

            .payment-popup-footer {
                padding: 20px;
                border-top: 1px solid var(--border-color);
                display: flex;
                gap: 12px;
            }

            .btn-cancel, .btn-confirm {
                flex: 1;
                padding: 12px;
                border: none;
                border-radius: 8px;
                font-weight: 600;
                font-size: 14px;
                cursor: pointer;
                transition: all 0.2s;
            }

            .btn-cancel {
                background: var(--gray-100);
                color: var(--gray-600);
            }

            .btn-confirm {
                background: var(--primary);
                color: white;
            }

                /* Sort Bar Styles */
                .sort-bar-mobile {
                    background: var(--white);
                    border-bottom: 1px solid var(--border-color);
                }

                .sort-option {
                    color: var(--gray-600);
                    font-size: 13px;
                    padding: 4px 8px;
                    border: none;
                    background: none;
                    position: relative;
                    min-width: 70px;
                }

                .sort-option.active {
                    color: var(--primary);
                    font-weight: 500;
                }

                .sort-option.active::after {
                    content: '';
                    position: absolute;
                    bottom: -2px;
                    left: 8px;
                    right: 8px;
                    height: 2px;
                    background: var(--primary);
                    border-radius: 1px;
                }

                .sort-option i {
                    font-size: 16px;
                    vertical-align: middle;
                    margin-left: 2px;
                }
            </style>

            <script>
                // Sort handling function
                function handleSortClick(sortBy, element) {
                    // Remove active class from all sort options
                    document.querySelectorAll('.sort-option').forEach(btn => btn.classList.remove('active'));
                    
                    // Add active class to clicked button
                    element.classList.add('active');
                    
                    // Special handling for price sort
                    if (sortBy === 'price') {
                        const currentDirection = element.getAttribute('data-sort-direction');
                        const newDirection = currentDirection === 'asc' ? 'desc' : 'asc';
                        const icon = element.querySelector('i');
                        
                        // Update direction and icon
                        element.setAttribute('data-sort-direction', newDirection);
                        icon.className = newDirection === 'asc' ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line';
                        
                        // Update actual sort parameter
                        sortBy = `price_${newDirection}`;
                    }
                    
                    // Call loadPLP with sort parameter
                    loadPLP(null, sortBy);
                }

                // Update loadPLP function to handle sorting
                const originalLoadPLP = window.loadPLP || function() {};
                window.loadPLP = function(filterType = null, sortBy = 'relevance') {
                    // Get products
                    let filteredProducts = [...allProducts];
                    
                    // Apply filtering if needed
                    if (filterType) {
                        filteredProducts = filteredProducts.filter(product => 
                            product.category === filterType || product.tags.includes(filterType)
                        );
                    }
                    
                    // Apply sorting
                    switch(sortBy) {
                        case 'price_asc':
                            filteredProducts.sort((a, b) => a.price - b.price);
                            break;
                        case 'price_desc':
                            filteredProducts.sort((a, b) => b.price - a.price);
                            break;
                        case 'newest':
                            filteredProducts.sort((a, b) => (b.id || 0) - (a.id || 0));
                            break;
                        case 'popular':
                            filteredProducts.sort((a, b) => (b.sold_count || 0) - (a.sold_count || 0));
                            break;
                        // 'relevance' is default, no sorting needed
                    }
                    
                    // Generate and update product grid HTML
                    const productGrid = document.getElementById('plp-product-grid');
                    if (!productGrid) return;
                    
                    productGrid.innerHTML = filteredProducts.map(product => `
                        <div class="col">
                            <div class="mobile-product-card-shopee" onclick="showProductDetail('${product.id}')">
                                <!-- Product card content -->
                                <div class="product-card-img-container">
                                    <img src="${product.image}" alt="${product.name}" class="w-100 h-100 object-fit-contain">
                                </div>
                                <div class="p-2">
                                    <h6 class="product-title small mb-1">${product.name}</h6>
                                    <div class="price-container">
                                        <span class="current-price">${formatCurrency(product.price)}</span>
                                        ${product.original_price ? `
                                            <span class="original-price">${formatCurrency(product.original_price)}</span>
                                            <span class="discount-percent">-${Math.round((1 - product.price/product.original_price) * 100)}%</span>
                                        ` : ''}
                                    </div>
                                    ${product.sold_count ? `<div class="sold-count small text-secondary">Đã bán ${product.sold_count}</div>` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('');
                };
            </script>

            <!-- Rest of PLP content -->
            <!-- (Optional) Loading More Indicator -->
            <div class="loading-indicator mt-3" id="plp-loading-more" style="display: none;">
                <div class="spinner-border spinner-border-sm text-primary"></div>
                <span>Đang tải thêm...</span>
             </div>
        </section>
        <!-- End Section PLP -->

        <!-- Filter Offcanvas -->
        <div class="offcanvas offcanvas-end" id="filterOffcanvas">
          <div class="offcanvas-header">
                <h5 class="offcanvas-title">Bộ lọc</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
          </div>
          <div class="offcanvas-body">
                <!-- Vehicle Filter -->
                <div class="filter-section">
                    <h6 class="filter-title">Theo Xe</h6>
                    <select class="form-select mb-2">
                        <option>Chọn hãng xe</option>
                        <option>Toyota</option>
                        <option>Honda</option>
                        <option>Ford</option>
                    </select>
                    <select class="form-select mb-2">
                        <option>Chọn dòng xe</option>
                    </select>
                    <select class="form-select">
                        <option>Chọn năm sản xuất</option>
                    </select>
             </div>

                <!-- Brand Filter -->
                <div class="filter-section">
                    <h6 class="filter-title">Thương hiệu</h6>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="brand1">
                        <label class="form-check-label" for="brand1">Castrol</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="brand2">
                        <label class="form-check-label" for="brand2">Mobil</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="brand3">
                        <label class="form-check-label" for="brand3">Shell</label>
          </div>
        </div>

                <!-- Price Range Filter -->
                <div class="filter-section">
                    <h6 class="filter-title">Khoảng giá</h6>
                    <div class="price-range">
                        <input type="range" class="form-range" min="0" max="10000000" step="100000">
                        <div class="price-inputs">
                            <input type="number" class="form-control" placeholder="Từ">
                            <span>-</span>
                            <input type="number" class="form-control" placeholder="Đến">
            </div>
                    </div>
                </div>

                <!-- Product Attributes -->
                <div class="filter-section">
                    <h6 class="filter-title">Thông số kỹ thuật</h6>
                    <!-- Dynamic attributes based on product category -->
                     </div>
            </div>
            <div class="offcanvas-footer">
                <button class="btn btn-outline-secondary w-100 mb-2" onclick="clearFilters()">Xóa bộ lọc</button>
                <button class="btn btn-primary w-100" onclick="applyFilters()">Áp dụng</button>
            </div>
        </div>
        <!-- SECTION: Product Detail Page (PDP) -->
        <section id="pdp-section" class="section-hidden">
            <!-- PDP Header -->
            <div class="pdp-header">
                <button class="btn-icon" onclick="goBack()">
                    <i class="ri-arrow-left-line"></i>
                </button>
                <div class="pdp-header-actions">
                    <button class="btn-icon" onclick="shareProduct()">
                        <i class="ri-share-forward-line"></i>
                    </button>
                    <!-- Cart Icon -->
                    <button class="btn-icon" onclick="showSection('cart-section')">
                        <i class="ri-shopping-cart-line"></i>
                        <span id="cart-count-badge-mobile" class="header-badge" style="display: none;">0</span>
                    </button>
                    <button class="btn-icon" onclick="toggleWishlist()">
                        <i class="ri-heart-line"></i>
                    </button>
            </div>
                 </div>

            <!-- Product Gallery -->
            <div class="pdp-gallery">
                <div class="swiper-container" id="pdp-gallery-swiper">
                    <div class="swiper-wrapper">
                        <!-- Images will be loaded here by JavaScript -->
                        <div class="swiper-slide">
                            <div class="loading-spinner"></div>
                     </div>
                        </div>
                    <!-- Add Pagination -->
                    <div class="swiper-pagination"></div>
                    <!-- Add Navigation -->
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                        </div>
                        </div>

            <!-- Product Info -->
            <div class="pdp-info">
                <div class="pdp-basic-info">
                    <h1 class="product-name"></h1>
                    <div class="product-meta">
                        <span class="brand"></span>
                        <span class="separator">|</span>
                        <span class="sku"></span>
                     </div>
                    <div class="product-price">
                        <span class="current-price"></span>
                        <span class="original-price"></span>
                        <span class="discount-tag"></span>
                     </div>
                     <div class="product-tags mb-1">
                        <span class="tag-authentic" style="margin-right: 15px;">Chính hãng</span>
                        <span class="tag-deal">Deal</span>
                    </div>
                </div>

                <!-- Specifications -->
                <div class="pdp-specs">
                    <h6>Thông số kỹ thuật</h6>
                    <table class="specs-table">
                        <!-- Specs will be loaded here -->
                    </table>
                </div>

                <!-- Description -->
                <div class="pdp-description">
                    <h6>Mô tả sản phẩm</h6>
                    <div class="description-content">
                        <!-- Description will be loaded here -->
                    </div>
                </div>

                <!-- Product Reviews -->
                <div class="pdp-reviews">
                    <div class="reviews-header">
                        <h6>Đánh giá sản phẩm</h6>
                        <div class="rating-summary">
                            <div class="average-rating">
                                <span class="rating-number">4.8</span>
                                <div class="rating-stars">
                                    <i class="ri-star-fill"></i>
                                    <i class="ri-star-fill"></i>
                                    <i class="ri-star-fill"></i>
                                    <i class="ri-star-fill"></i>
                                    <i class="ri-star-half-fill"></i>
                                </div>
                                <span class="total-reviews">(128 đánh giá)</span>
                            </div>
                            <div class="rating-bars">
                                <div class="rating-bar-item">
                                    <span class="star-label">5 sao</span>
                                    <div class="progress">
                                        <div class="progress-bar" style="width: 85%"></div>
                                    </div>
                                    <span class="count">109</span>
                                </div>
                                <div class="rating-bar-item">
                                    <span class="star-label">4 sao</span>
                                    <div class="progress">
                                        <div class="progress-bar" style="width: 10%"></div>
                                    </div>
                                    <span class="count">13</span>
                                </div>
                                <div class="rating-bar-item">
                                    <span class="star-label">3 sao</span>
                                    <div class="progress">
                                        <div class="progress-bar" style="width: 3%"></div>
                                    </div>
                                    <span class="percent">3%</span>
                                </div>
                                <div class="rating-bar-item">
                                    <span class="star-label">2 sao</span>
                                    <div class="progress">
                                        <div class="progress-bar" style="width: 1%"></div>
                                    </div>
                                    <span class="percent">1%</span>
                                </div>
                                <div class="rating-bar-item">
                                    <span class="star-label">1 sao</span>
                                    <div class="progress">
                                        <div class="progress-bar" style="width: 1%"></div>
                                    </div>
                                    <span class="percent">1%</span>
                                </div>
                            </div>                           
                        </div>                                             
                    </div>

                    <!-- Review List -->
                    <div class="review-list">
                        <!-- Review Item 1 -->
                        <div class="review-item">
                            <div class="reviewer-info">
                                <img src="images/avatar-1.png" alt="User Avatar" class="reviewer-avatar">
                                <div class="reviewer-details">
                                    <div class="reviewer-name">Nguyễn Văn A</div>
                                    <div class="review-date">15/05/2024</div>
                                </div>
                            </div>
                            <div class="review-rating">
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                            </div>
                            <div class="review-content">
                                Sản phẩm chất lượng tốt, đóng gói cẩn thận. Phụ tùng chính hãng, giá cả hợp lý. Shop tư vấn nhiệt tình, giao hàng nhanh. Sẽ ủng hộ shop dài lâu!
                            </div>
                            <div class="review-images">
                                <img src="images/1.jpg" alt="Review Image">
                                <img src="images/2.jpg" alt="Review Image">
                            </div>
                        </div>

                        <!-- Review Item 2 -->
                        <div class="review-item">
                            <div class="reviewer-info">
                                <img src="images/avatar-2.png" alt="User Avatar" class="reviewer-avatar">
                                <div class="reviewer-details">
                                    <div class="reviewer-name">Trần Thị B</div>
                                    <div class="review-date">14/05/2024</div>
                                </div>
                            </div>
                            <div class="review-rating">
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                            </div>
                            <div class="review-content">
                                Lần đầu mua hàng ở shop nhưng rất hài lòng. Phụ tùng chính hãng Bosch, giá tốt hơn các shop khác. Đặc biệt là dịch vụ bảo hành rất tốt!
                            </div>
                        </div>

                        <!-- Review Item 3 -->
                        <div class="review-item">
                            <div class="reviewer-info">
                                <img src="images/avatar-3.png" alt="User Avatar" class="reviewer-avatar">
                                <div class="reviewer-details">
                                    <div class="reviewer-name">Lê Văn C</div>
                                    <div class="review-date">13/05/2024</div>
                                </div>
                            </div>
                            <div class="review-rating">
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                            </div>
                            <div class="review-content">
                                Shop tư vấn rất chuyên nghiệp, giúp mình chọn đúng phụ tùng cần thay. Giá cả phải chăng, sản phẩm chất lượng. Sẽ quay lại ủng hộ!
                            </div>
                            <div class="review-images">
                                <img src="images/3.jpg" alt="Review Image">
                            </div>
                        </div>

                        <!-- Review Item 4 -->
                        <div class="review-item">
                            <div class="reviewer-info">
                                <img src="images/avatar-4.png" alt="User Avatar" class="reviewer-avatar">
                                <div class="reviewer-details">
                                    <div class="reviewer-name">Phạm Thị D</div>
                                    <div class="review-date">12/05/2024</div>
                                </div>
                            </div>
                            <div class="review-rating">
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                            </div>
                            <div class="review-content">
                                Mua lần thứ 2 tại shop, vẫn giữ được chất lượng dịch vụ tốt. Giao hàng nhanh, đóng gói cẩn thận. Nhân viên tư vấn nhiệt tình, am hiểu sản phẩm.
                            </div>
                        </div>

                        <!-- Review Item 5 -->
                        <div class="review-item">
                            <div class="reviewer-info">
                                <img src="images/avatar-5.png" alt="User Avatar" class="reviewer-avatar">
                                <div class="reviewer-details">
                                    <div class="reviewer-name">Hoàng Văn E</div>
                                    <div class="review-date">11/05/2024</div>
                                </div>
                            </div>
                            <div class="review-rating">
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                            </div>
                            <div class="review-content">
                                Phụ tùng chính hãng, giá tốt. Shop có dịch vụ bảo hành lâu dài, rất yên tâm khi mua hàng. Nhân viên tư vấn chuyên nghiệp, nhiệt tình.
                            </div>
                            <div class="review-images">
                                <img src="images/4.jpg" alt="Review Image">
                                <img src="images/5.jpg" alt="Review Image">
                            </div>
                        </div>
                        <div class="view-all-reviews">
                            <button class="btn-view-all" onclick="alert('Tính năng đang phát triển')">
                                <span>Xem tất cả đánh giá</span>
                                <i class="ri-arrow-right-s-line"></i>
                    </button>
                        </div>
                    </div>
                 </div>

                <!-- Shop Info -->
                <div class="pdp-shop-info">
                    <div class="shop-avatar">
                        <img src="images/shop_logo.png" alt="Shop Avatar">
                        </div>
                    <div class="shop-details">
                        <h6 class="shop-name">Shope Demo LTA</h6>
                        <div class="shop-rating">
                            <span>5</span>
                            <span class="rating-stars ri-star-fill"></span>
                            <span class="rating-count">(999)</span>
                        </div>
                        </div>
                    <button class="btn btn-outline-primary btn-sm">Xem Shop</button>
                        </div>
                     </div>

            <!-- Bottom Action Bar -->
            <div class="pdp-action-bar">
                <div class="action-buttons">
                    <button class="btn-chat" onclick="chatWithShop()">
                        <i class="ri-message-3-line"></i>
                        <span>Chat</span>
                    </button>
                    <button class="btn-cart" onclick="handleAddToCartPDP()" id="pdp-add-to-cart-pdp-mobile" data-product-id="">
                        <i class="ri-shopping-cart-line"></i>
                        <span>Thêm vào giỏ</span>
                    </button>
                    <button class="btn-buy" onclick="handleBuyNowPDP()" id="pdp-buy-now-btn">
                        <span>Mua ngay</span>
                        <small class="fw-normal mt-1" id="pdp-buy-now-price" style="font-size: 1em;"></small>
                    </button>
                </div>
            </div>
        </section>

        <!-- SECTION: Cart -->
        <section id="cart-section" class="section-hidden">
            <!-- Cart Header -->
            <header class="header fixed-top px-3 d-flex" id="cart-header">
                <div class="d-flex align-items-center justify-content-between w-100">
                <!-- Back Button -->
                    <a href="#" class="header-icon pe-0" onclick="goBack()">
                    <i class="ri-arrow-left-line"></i>
                    </a>
                        
                        <!-- Title -->
                        <h5 class="header-title mb-0" data-translate="cart_title">Giỏ hàng</h5>
                        
                    <!-- Edit Button -->
                    <a href="#" class="header-icon pe-0" onclick="editCart()">
                        <i class="ri-edit-line"></i>
                    </a>
            </div>
            </header>

            <div class="cart-content">
                <div class="cart-items" id="cart-items-container">
                    <div class="cart-item">
                        
                        <!-- Cart Item 1 (Tĩnh - Cấu trúc mới cho swipe) -->
                        <div class="mobile-cart-item-swipe-wrapper position-relative mb-2" data-product-id="EO001-STATIC"> <!-- Thay ID tĩnh nếu cần -->                            
                            <div class="mobile-cart-item-content bg-white p-2 border rounded d-flex align-items-start gap-2">
                                <!-- Nội dung item-image, item-details, quantity-control giữ nguyên như trên -->
                                <div class="item-checkbox">
                                    <input type="checkbox" checked class="form-check-input">
                                </div>
                                <img src="images/1.jpg" alt="Lọc dầu Bosch" class="mobile-cart-item-img flex-shrink-0" onerror="this.src='images/placeholder.jpg'">
                                <div class="item-details flex-grow-1">
                                    <div class="item-name small fw-medium">Lọc dầu động cơ Bosch 0986AF1038</div>
                                    <div class="item-price small mt-1">185.000 ₫</div>
                                    <div class="quantity-controls mt-2">
                                        <button class="quantity-btn btn-sm border" onclick="alert('Giảm số lượng cho EO001-STATIC')"><i class="ri-subtract-line"></i></button>
                                        <input type="number" class="quantity-input mx-1 form-control form-control-sm text-center" value="1" min="1">
                                        <button class="quantity-btn btn-sm border" onclick="alert('Tăng số lượng cho EO001-STATIC')"><i class="ri-add-line"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="swipe-delete-action bg-danger text-white d-flex align-items-center justify-content-center position-absolute top-0 end-0 h-100" style="width: 70px; z-index: 0; border-radius: 0 8px 8px 0; cursor: pointer;">
                                <i class="ri-delete-bin-line fs-5"></i>
                            </div>
                        </div>
                </div>
                
                    <div class="cart-item">
                        
                        <!-- Cart Item 2 (Tĩnh - Cấu trúc mới cho swipe) -->
                        <div class="mobile-cart-item-swipe-wrapper position-relative mb-2" data-product-id="EO002-STATIC"> <!-- Thay ID tĩnh nếu cần -->
                            <div class="mobile-cart-item-content bg-white p-2 border rounded d-flex align-items-start gap-2">
                                <!-- Nội dung item-image, item-details, quantity-control giữ nguyên như trên -->
                                <div class="item-checkbox">
                                    <input type="checkbox" checked class="form-check-input">
                 </div>
                                <img src="images/2.jpg" alt="Má phanh Denso" class="mobile-cart-item-img flex-shrink-0" onerror="this.src='images/placeholder.jpg'">
                            
                                <div class="item-details flex-grow-1">
                                    <div class="item-name small fw-medium">Má phanh trước Denso 0446533492</div>
                                    <div class="item-price small mt-1">750.000 ₫</div>
                                    <div class="quantity-controls mt-2">
                                        <button class="quantity-btn btn-sm border" onclick="alert('Giảm số lượng cho EO002-STATIC')"><i class="ri-subtract-line"></i></button>
                                        <input type="number" class="quantity-input mx-1 form-control form-control-sm text-center" value="1" min="1">
                                        <button class="quantity-btn btn-sm border" onclick="alert('Tăng số lượng cho EO002-STATIC')"><i class="ri-add-line"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="swipe-delete-action bg-danger text-white d-flex align-items-center justify-content-center position-absolute top-0 end-0 h-100" style="width: 70px; z-index: 0; border-radius: 0 8px 8px 0; cursor: pointer;">
                                <i class="ri-delete-bin-line fs-5"></i>
                            </div>
                 </div>
             </div>

                    <div class="cart-item">
                        
                        <!-- Cart Item 3 (Tĩnh - Cấu trúc mới cho swipe) -->
                        <div class="mobile-cart-item-swipe-wrapper position-relative mb-2" data-product-id="EO003-STATIC"> <!-- Thay ID tĩnh nếu cần -->
                            <div class="mobile-cart-item-content bg-white p-2 border rounded d-flex align-items-start gap-2">
                                <!-- Nội dung item-image, item-details, quantity-control giữ nguyên như trên -->
                                <div class="item-checkbox">
                                    <input type="checkbox" checked class="form-check-input">
                     </div>
                                <img src="images/3.jpg" alt="Lọc gió động cơ Mann C27192" class="mobile-cart-item-img flex-shrink-0" onerror="this.src='images/placeholder.jpg'">
                                
                                <div class="item-details flex-grow-1">
                                    <div class="item-name small fw-medium">Lọc gió động cơ Mann C27192</div>
                                    <div class="item-price small mt-1">320.000 ₫</div>
                                    <div class="quantity-controls mt-2">
                                        <button class="quantity-btn btn-sm border" onclick="alert('Giảm số lượng cho EO003-STATIC')"><i class="ri-subtract-line"></i></button>
                                        <input type="number" class="quantity-input mx-1 form-control form-control-sm text-center" value="1" min="1">
                                        <button class="quantity-btn btn-sm border" onclick="alert('Tăng số lượng cho EO003-STATIC')"><i class="ri-add-line"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="swipe-delete-action bg-danger text-white d-flex align-items-center justify-content-center position-absolute top-0 end-0 h-100" style="width: 70px; z-index: 0; border-radius: 0 8px 8px 0; cursor: pointer;">
                                <i class="ri-delete-bin-line fs-5"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Tạm tính</span>
                        <span class="subtotal">2.005.000 ₫</span>
                    </div>
                    <div class="summary-row">
                        <span>Giảm giá</span>
                        <span class="discount">265.000 ₫</span>
                    </div>
                    <div class="summary-row total">
                        <span>Tổng cộng</span>
                        <span class="total-amount">1.740.000 ₫</span>
                    </div>
                </div>
            </div>

            <div class="cart-footer">
                <div class="voucher-input">
                    <input type="text" placeholder="Nhập mã giảm giá">
                    <button class="btn-apply">Áp dụng</button>
                 </div>
                <button class="btn-checkout" onclick="initializeCheckout()">
                    Thanh toán (<span class="cart-count">0</span>)
                                </button>
             </div>
        </section>

        <!-- SECTION: Checkout -->
        <section id="checkout-section" class="section-hidden">
            <div class="checkout-header">
                <button class="btn-back" onclick="goBack()">
                    <i class="ri-arrow-left-line"></i>
                                </button>
                <h1 class="header-title">Thanh toán</h1>
                    </div>

            <div class="checkout-content">
                <!-- Address -->
                <div class="checkout-address">
                    <i class="ri-map-pin-2-line address-icon"></i>
                    <div class="address-details">
                        <div class="address-name">Nguyễn Văn A</div>
                        <div class="address-phone">(+84) 999 999 999</div>
                        <div class="address-text">123 Đường A, Quận B, TP. Hồ Chí Minh</div>
                    </div>
                    <button class="btn-icon" onclick="editAddress()">
                        <i class="ri-arrow-right-s-line"></i>
                    </button>
            </div>

                <!-- Shop & Items -->
                <div class="checkout-shop">
                    <div class="shop-header">
                        <i class="ri-store-2-line"></i>
                        <h2 class="shop-name">Shop Demo LTA</h2>
                 </div>
                    <div class="checkout-items" id="checkout-items-container">
                        <!-- Items will be populated by JavaScript -->
                 </div>
                    <!-- Order Summary for instant orders -->
                    <div id="checkout-order-summary">
                        <!-- Instant order items will be populated here -->
                 </div>
                 </div>

                <!-- Shipping -->
                <div class="shipping-section">
                    <div class="shipping-header">
                        <h3 class="shipping-title">Phương thức vận chuyển</h3>
            </div>
                    <div class="shipping-options">
                        <div class="shipping-option" onclick="selectShipping('standard')">
                            <input type="radio" name="shipping" value="standard">
                            <div class="shipping-option-details">
                                <div class="shipping-name">Tiêu chuẩn</div>
                                <div class="shipping-info">Nhận hàng vào 8-9 Th05</div>
                </div>
                            <div class="shipping-fee">30.000₫</div>
                 </div>
                        <div class="shipping-option" onclick="selectShipping('express')">
                            <input type="radio" name="shipping" value="express">
                            <div class="shipping-option-details">
                                <div class="shipping-name">Hỏa tốc</div>
                                <div class="shipping-info">Nhận hàng vào hôm nay</div>
                 </div>
                            <div class="shipping-fee">50.000₫</div>
             </div>
                 </div>
            </div>

                <!-- Voucher -->
                <div class="voucher-section">
                    <div class="voucher-header">
                        <h3 class="voucher-title">
                            <i class="ri-coupon-3-line"></i>
                            Voucher của Shop
                        </h3>
                </div>
                    <div class="voucher-content" onclick="showVoucherList()">
                        <div class="voucher-input">
                            <i class="ri-price-tag-3-line"></i>
                            <span id="selected-voucher">Chọn hoặc nhập mã</span>
                 </div>
                        <i class="ri-arrow-right-s-line"></i>
                 </div>
             </div>

                <!-- Payment -->
                <div class="payment-section">
                    <div class="payment-header">
                        <h3 class="payment-title">Phương thức thanh toán</h3>
                 </div>
                    <div class="payment-methods">
                        <div class="payment-method" onclick="selectPayment('cod')">
                            <input type="radio" name="payment" value="cod">
                            <div class="payment-method-icon">
                                <i class="ri-money-dollar-box-line"></i>
                 </div>
                            <div class="payment-method-details">
                                <div class="payment-name">Thanh toán khi nhận hàng</div>
                 </div>
             </div>
                        <div class="payment-method" onclick="selectPayment('onestop')">
                            <input type="radio" name="payment" value="onestop">
                            <div class="payment-method-icon">
                                <i class="ri-wallet-3-line"></i>
                 </div>
                            <div class="payment-method-details">
                                <div class="payment-name">Quỹ OneStop@LTA</div>
                                <div class="onestop-balance">
                                    <span class="balance-amount">500.000₫</span>
                                    <button class="btn-topup" onclick="showTopupDialog()">Nạp tiền</button>
                                </div>
                            </div>
                        </div>
                        <div class="payment-method" onclick="selectPayment('bank')">
                            <input type="radio" name="payment" value="bank">
                            <div class="payment-method-icon">
                                <i class="ri-bank-card-line"></i>
                            </div>
                            <div class="payment-method-details">
                                <div class="payment-name">Thẻ ngân hàng</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Summary -->
                <div class="checkout-summary">
                    <div class="summary-row">
                        <span>Tổng tiền hàng</span>
                        <span id="checkout-subtotal">0₫</span>
                    </div>
                    <div class="summary-row">
                        <span>Phí vận chuyển</span>
                        <span id="checkout-shipping">0₫</span>
                    </div>
                    <div class="summary-row" id="voucher-discount-row" style="display: none;">
                        <span>Giảm giá</span>
                        <span id="checkout-discount" class="discount-amount">-0₫</span>
                    </div>
                    <div class="summary-row total-row">
                        <span>Tổng thanh toán</span>
                        <span id="checkout-total" class="total-amount">0₫</span>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="checkout-footer row">
                <div class="checkout-total col-7">
                    <div class="total-label">Tổng thanh toán</div>
                    <div class="total-value" id="checkout-footer-total">0₫</div>
                </div>
                <div class="col-5">
                    <button class="btn-place-order" onclick="showPaymentConfirmation()">Đặt hàng</button>
                 </div>
             </div>
        </section>

        <!-- SECTION: Order Confirmation (ORD-03) - Mobile Optimized -->
        <section id="confirmation-section" class="section-hidden text-center px-2 py-4">
             <i class="ri-checkbox-circle-line fa-3x text-success mb-2"></i>
            <h5 class="mb-2">Đặt hàng thành công!</h5>
            <p class="small">Mã đơn hàng: <strong id="conf-order-id">#LTA-DEMO-XYZ</strong></p>
            <p class="small mb-3">Cảm ơn bạn đã mua hàng.</p>
            <a href="#homepage-section" class="btn btn-primary btn-sm" onclick="showSection('homepage-section')">Về Trang chủ</a>
        </section>
        
        <!-- SECTION: Notifications -->
        <section id="notifications-section" class="section-hidden">
            <!-- Notifications Header -->
            <header class="header sticky-top py-2 px-3" id="notifications-header">                   
                <!-- Title -->
                <h5 class="mb-0 flex-grow-1 text-center text-white" data-translate="notifications_title">Thông báo</h5>
            </header>

            <!-- Notification Tabs -->
            <div class="notification-tabs">
                <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#promotions" type="button">
                            Khuyến mãi
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#system" type="button">
                            Hệ thống
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#orders" type="button">
                            Đơn hàng
                        </button>
                    </li>
                </ul>
                    </div>

            <!-- Notification Content -->
            <div class="tab-content">
                <!-- Promotions Tab -->
                <div class="tab-pane fade show active" id="promotions">
                    <div class="notification-list">
                        <a href="#" class="notification-item unread">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSCMgruq2y5dDrsrjGcJYt2ItgeROBtP7-s4w&s" alt="Shell" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">🔥 Flash Sale: Giảm 50% cho đơn dầu Shell Helix đầu tiên</div>
                                <div class="notification-time">2 giờ trước</div>
                    </div>
                            <div class="notification-badge"></div>
                        </a>
                        <a href="#" class="notification-item unread">
                            <img src="https://logos-download.com/wp-content/uploads/2016/02/Castrol_logo_2D_transparent.png" alt="Castrol" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">Castrol MAGNATEC - Mua 4 tặng 1, áp dụng đến hết tháng</div>
                                <div class="notification-time">5 giờ trước</div>
                    </div>
                            <div class="notification-badge"></div>
                        </a>
                        <a href="#" class="notification-item">
                            <img src="https://logowik.com/content/uploads/images/motul2246.logowik.com.webp" alt="Motul" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">Flash Sale Motul 8100 - Giảm đến 30% cho tất cả sản phẩm</div>
                                <div class="notification-time">1 ngày trước</div>
                            </div>
                        </a>
                    </div>
                    </div>

                <!-- System Tab -->
                <div class="tab-pane fade" id="system">
                    <div class="notification-list">
                        <a href="#" class="notification-item unread">
                            <img src="images/logo_white.png" alt="i-LogiCare" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">Chào mừng bạn đến với i-LogiCare! Nhận ngay voucher 100K</div>
                                <div class="notification-time">2 ngày trước</div>
                    </div>
                            <div class="notification-badge"></div>
                        </a>
                        <a href="#" class="notification-item">
                            <img src="images/logo_white.png" alt="i-LogiCare" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">Cập nhật chính sách bảo mật mới từ i-LogiCare</div>
                                <div class="notification-time">5 ngày trước</div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Orders Tab -->
                <div class="tab-pane fade" id="orders">
                    <div class="notification-list">
                        <a href="#" class="notification-item unread">
                            <img src="images/delivery.png" alt="Delivery" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">Đơn hàng #LTA123456 đã được giao thành công</div>
                                <div class="notification-time">3 giờ trước</div>
                    </div>
                            <div class="notification-badge"></div>
                        </a>
                        <a href="#" class="notification-item">
                            <img src="images/delivery.png" alt="Delivery" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">Đơn hàng #LTA123455 đang được vận chuyển</div>
                                <div class="notification-time">1 ngày trước</div>
                            </div>
                        </a>
                        <a href="#" class="notification-item">
                            <img src="images/delivery.png" alt="Delivery" class="notification-icon">
                            <div class="notification-content">
                                <div class="notification-title">Đơn hàng #LTA123454 đã được xác nhận</div>
                                <div class="notification-time">2 ngày trước</div>
                            </div>
                        </a>
                    </div>
                        </div>
                    </div>
        </section>
        <!-- SECTION: Account Dashboard -->
        <section id="account-section" class="section-hidden">
            <!-- Account Header -->
            <header class="header sticky-top py-2 px-3" id="account-header">
                <div class="d-flex align-items-center justify-content-between w-100">
                    <!-- Title -->
                    <h5 class="mb-0 flex-grow-1 text-white" data-translate="my_account_title">Tài khoản của tôi</h5>
                    <!-- Right Icons -->
                    <div class="d-flex align-items-center">
                        <!-- Setting Icon -->
                        <a href="#" class="header-icon" onclick="showSection('settings-section')">
                            <i class="ri-settings-2-line"></i>
                        </a>
                        <!-- Cart Icon -->
                        <a href="#cart-section" class="header-icon header-icon--cart" onclick="showSection('cart-section')">
                            <i class="ri-shopping-cart-line"></i>
                            <span id="cart-count-badge-mobile" class="header-badge" style="display: none;">0</span>
                        </a>
                        <!-- Chat Messages Icon -->
                        <a href="chat-messages.html" class="header-icon">
                            <i class="ri-message-3-line"></i>
                        </a>
                    </div>
                </div>
            </header>

            <!-- Logged-in Account Info (hidden by default) -->
            <div id="logged-in-account-info" class="d-none">
                <div class="account-info d-flex align-items-center">
                    <img src="https://cdn.iconscout.com/icon/free/png-256/free-avatar-icon-download-in-svg-png-gif-file-formats--user-business-man-avatars-flat-icons-pack-people-456324.png" alt="User Avatar" class="account-avatar rounded-circle me-3">
                    <div class="flex-grow-1">
                        <h5 id="account-username" class="account-username">Nguyễn Văn A</h5>
                        <span class="small">Thành viên Kim cương</span>
                        <i class="ri-vip-diamond-fill ms-1" style="font-size: 24px; color: #00C9A7;"></i>
                    </div>
                    <div>
                        <button class="btn-icon me-2" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-edit-box-line"></i>
                        </button>
                    </div>
                </div>

                <!-- Order Status -->
                <div class="order-status-grid">
                    <div class="section-title">
                        Đơn Mua
                    </div>
                    <div class="row row-cols-4 g-2">
                        <div class="col">
                            <a href="orders.html?tab=pending" class="order-status-item">
                                <i class="ri-wallet-line"></i>
                                <span class="small">Chờ xác nhận</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="pending" style="display:none;">0</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="orders.html?tab=pickup" class="order-status-item">
                                <i class="ri-box-3-line"></i>
                                <span class="small">Chờ lấy hàng</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="pickup" style="display:none;">0</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="orders.html?tab=shipping" class="order-status-item">
                                <i class="ri-truck-line"></i>
                                <span class="small">Đang giao</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="shipping" style="display:none;">0</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="orders.html?tab=review" class="order-status-item">
                                <i class="ri-star-line"></i>
                                <span class="small">Đánh giá</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="review" style="display:none;">0</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- My Utilities -->
                <div class="utilities-section">
                    <div class="section-title">Tiện ích của tôi</div>
                    <div class="row row-cols-4 g-2">
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="openVehicleFilter()">
                                <i class="ri-car-line"></i>
                                <span class="small">Xe của tôi</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="onestop-fund.html" class="order-status-item">
                                <i class="ri-wallet-3-line"></i>
                                <span class="small">Quỹ OneStop</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="onestop-fund.html" class="order-status-item">
                                <i class="ri-coin-line"></i>
                                <span class="small">Kho xu</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="voucher.html" class="order-status-item">
                                <i class="ri-coupon-3-line"></i>
                                <span class="small">Kho Voucher</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Other Utilities -->
                <div class="utilities-section">
                    <div class="section-title">
                        Tiện ích khác
                        <a href="#" onclick="alert('Đang phát triển')">Xem tất cả</a>
                    </div>
                    <div class="list-group list-group-flush utility-list">
                        <!-- Seller Registration Entry Point (Dynamic) -->
                        <div id="seller-registration-entry" class="d-none">
                            <a href="SellerOnboarding/SellerInfoBasicScreen.html" class="list-group-item list-group-item-action d-flex align-items-center seller-registration-btn">
                                <i class="ri-store-3-line me-3 text-primary"></i>
                                <div class="flex-grow-1">
                                    <span class="fw-medium">Trở thành Người bán</span>
                                    <div class="small text-muted">Mở shop và bán hàng trên i-LogiCare</div>
                                </div>
                                <i class="ri-arrow-right-s-line ms-auto"></i>
                            </a>
                        </div>
                        
                        <!-- Seller Center Entry Point (Dynamic) -->
                        <div id="seller-center-entry" class="d-none">
                            <a href="#" class="list-group-item list-group-item-action d-flex align-items-center seller-center-btn" onclick="navigateToSellerCenter()">
                                <i class="ri-dashboard-3-line me-3 text-success"></i>
                                <div class="flex-grow-1">
                                    <span class="fw-medium">Kênh Người bán</span>
                                    <div class="small text-muted">Quản lý shop và đơn hàng</div>
                                </div>
                                <i class="ri-arrow-right-s-line ms-auto"></i>
                            </a>
                        </div>
                        
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-heart-line me-3"></i>
                            <span>Đã thích</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-history-line me-3"></i>
                            <span>Mua lại</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                        <a href="orders.html?tab=review" class="list-group-item list-group-item-action d-flex align-items-center">
                            <i class="ri-message-2-line me-3"></i>
                            <span>Đánh giá của tôi</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" onclick="showSection('contact-section')">
                            <i class="ri-question-line me-3"></i>
                            <span>Trung tâm hỗ trợ</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Not logged in account info (shown by default) -->
            <div id="not-logged-in-account-info">
                <div class="account-info d-flex align-items-center">
                    <img src="https://cdn.iconscout.com/icon/free/png-256/free-avatar-icon-download-in-svg-png-gif-file-formats--user-business-man-avatars-flat-icons-pack-people-456324.png" alt="User Avatar" class="account-avatar rounded-circle me-3">
                    <button type="button" class="btn btn-outline-secondary" onclick="showSection('login-section')">
                        Đăng nhập/Đăng ký
                    </button>
                </div>
                <!-- Order Status -->
                <div class="order-status-grid">
                    <div class="section-title">
                        Đơn Mua
                    </div>
                    <div class="row row-cols-4 g-2">
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="showLoginRequiredPopup(); return false;">
                                <i class="ri-wallet-line"></i>
                                <span class="small">Chờ xác nhận</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="pending" style="display:none;">0</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="showLoginRequiredPopup(); return false;">
                                <i class="ri-box-3-line"></i>
                                <span class="small">Chờ lấy hàng</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="pickup" style="display:none;">0</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="showLoginRequiredPopup(); return false;">
                                <i class="ri-truck-line"></i>
                                <span class="small">Đang giao</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="shipping" style="display:none;">0</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="showLoginRequiredPopup(); return false;">
                                <i class="ri-star-line"></i>
                                <span class="small">Đánh giá</span>
                                <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" data-status-count="review" style="display:none;">0</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- My Utilities -->
                <div class="utilities-section">
                    <div class="section-title">Tiện ích của tôi</div>
                    <div class="row row-cols-4 g-2">
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="openVehicleFilter()">
                                <i class="ri-car-line"></i>
                                <span class="small">Xe của tôi</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="showLoginRequiredPopup(); return false;">
                                <i class="ri-wallet-3-line"></i>
                                <span class="small">Quỹ OneStop</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="showLoginRequiredPopup(); return false;">
                                <i class="ri-coin-line"></i>
                                <span class="small">Kho xu</span>
                            </a>
                        </div>
                        <div class="col">
                            <a href="#" class="order-status-item" onclick="showLoginRequiredPopup(); return false;">
                                <i class="ri-coupon-3-line"></i>
                                <span class="small">Kho Voucher</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Other Utilities -->
                <div class="utilities-section">
                    <div class="section-title">
                        Tiện ích khác
                        <a href="#" onclick="alert('Đang phát triển')">Xem tất cả</a>
                    </div>
                    <div class="list-group list-group-flush utility-list">
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" onclick="showLoginRequiredPopup(); return false;">
                            <i class="ri-heart-line me-3"></i>
                            <span>Đã thích</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" onclick="showLoginRequiredPopup(); return false;">
                            <i class="ri-history-line me-3"></i>
                            <span>Mua lại</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" onclick="showLoginRequiredPopup(); return false;">
                            <i class="ri-message-2-line me-3"></i>
                            <span>Đánh giá của tôi</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center" onclick="showSection('contact-section')">
                            <i class="ri-question-line me-3"></i>
                            <span>Trung tâm hỗ trợ</span>
                            <i class="ri-arrow-right-s-line ms-auto"></i>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: Settings -->
        <section id="settings-section" class="section-hidden">
            <!-- Settings Header -->
            <header class="header fixed-top px-3 d-flex" id="settings-header">
                <div class="d-flex align-items-center justify-content-between w-100">
                    <!-- Back Button -->
                    <a href="#" class="header-icon pe-0" onclick="goBack()">
                    <i class="ri-arrow-left-line"></i>
                </a>
                    
                    <!-- Title -->
                    <h5 class="header-title mb-0">Cài đặt</h5>
                    
                    <!-- Empty div for alignment -->
                    <div style="width: 24px;"></div>
            </div>
            </header>

            <div class="settings-content" style="padding-top: 80px; padding-bottom: 80px;">
                <!-- User Info Section -->
                <div id="settings-user-info" class="bg-white m-3 p-3 rounded shadow-sm d-none">
                    <div class="d-flex align-items-center mb-3">
                        <img src="https://cdn.iconscout.com/icon/free/png-256/free-avatar-icon-download-in-svg-png-gif-file-formats--user-business-man-avatars-flat-icons-pack-people-456324.png" 
                             alt="User Avatar" class="rounded-circle me-3" style="width: 60px; height: 60px; object-fit: cover;">
                        <div class="flex-grow-1">
                            <h6 id="settings-username" class="mb-1">Người dùng</h6>
                            <p id="settings-email" class="mb-0 text-muted small">user@example.com</p>
                        </div>
                        </div>
                    </div>

                <!-- Settings Menu -->
                <div class="settings-menu bg-white m-3 rounded shadow-sm">
                    <!-- Account Settings -->
                    <div class="settings-section">
                        <div class="settings-section-title p-3 border-bottom">
                            <h6 class="mb-0 text-muted">Tài khoản</h6>
                        </div>
                        
                        <a href="#" class="settings-item d-flex align-items-center p-3 border-bottom" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-user-line me-3 text-primary"></i>
                            <div class="flex-grow-1">
                                <span>Thông tin cá nhân</span>
                                <div class="small text-muted">Quản lý thông tin tài khoản</div>
                        </div>
                            <i class="ri-arrow-right-s-line"></i>
                        </a>
                        
                        <a href="#" class="settings-item d-flex align-items-center p-3 border-bottom" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-map-pin-line me-3 text-primary"></i>
                            <div class="flex-grow-1">
                                <span>Địa chỉ giao hàng</span>
                                <div class="small text-muted">Quản lý địa chỉ nhận hàng</div>
                    </div>
                            <i class="ri-arrow-right-s-line"></i>
                        </a>
                        
                        <a href="#" class="settings-item d-flex align-items-center p-3" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-lock-line me-3 text-primary"></i>
                            <div class="flex-grow-1">
                                <span>Đổi mật khẩu</span>
                                <div class="small text-muted">Cập nhật mật khẩu bảo mật</div>
                        </div>
                            <i class="ri-arrow-right-s-line"></i>
                        </a>
                        </div>

                    <!-- App Settings -->
                    <div class="settings-section mt-3">
                        <div class="settings-section-title p-3 border-bottom">
                            <h6 class="mb-0 text-muted">Ứng dụng</h6>
                    </div>
                        
                        <div class="settings-item d-flex align-items-center justify-content-between p-3 border-bottom">
                            <div class="d-flex align-items-center">
                                <i class="ri-notification-line me-3 text-primary"></i>
                                <div>
                                    <span>Thông báo</span>
                                    <div class="small text-muted">Nhận thông báo đơn hàng, khuyến mãi</div>
                </div>
            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="notificationSwitch" checked>
            </div>
                </div>
                        
                        <div class="settings-item d-flex align-items-center justify-content-between p-3 border-bottom">
                            <div class="d-flex align-items-center">
                                <i class="ri-global-line me-3 text-primary"></i>
                                <div>
                                    <span>Ngôn ngữ</span>
                                    <div class="small text-muted">Tiếng Việt</div>
                                </div>
                            </div>
                            <i class="ri-arrow-right-s-line"></i>
            </div>

                        <div class="settings-item d-flex align-items-center justify-content-between p-3">
                            <div class="d-flex align-items-center">
                                <i class="ri-moon-line me-3 text-primary"></i>
                                <div>
                                    <span>Chế độ tối</span>
                                    <div class="small text-muted">Giao diện tối cho mắt</div>
                            </div>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="darkModeSwitch">
                            </div>
                    </div>
                </div>

                    <!-- Support -->
                    <div class="settings-section mt-3">
                        <div class="settings-section-title p-3 border-bottom">
                            <h6 class="mb-0 text-muted">Hỗ trợ</h6>
                            </div>
                        
                        <a href="#" class="settings-item d-flex align-items-center p-3 border-bottom" onclick="showSection('contact-section')">
                            <i class="ri-customer-service-line me-3 text-primary"></i>
                            <div class="flex-grow-1">
                                <span>Trung tâm hỗ trợ</span>
                                <div class="small text-muted">Liên hệ với chúng tôi</div>
                            </div>
                            <i class="ri-arrow-right-s-line"></i>
                        </a>
                        
                        <a href="#" class="settings-item d-flex align-items-center p-3 border-bottom" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-question-line me-3 text-primary"></i>
                            <div class="flex-grow-1">
                                <span>Câu hỏi thường gặp</span>
                                <div class="small text-muted">Tìm câu trả lời nhanh chóng</div>
                            </div>
                            <i class="ri-arrow-right-s-line"></i>
                        </a>
                        
                        <a href="#" class="settings-item d-flex align-items-center p-3" onclick="alert('Tính năng đang phát triển')">
                            <i class="ri-information-line me-3 text-primary"></i>
                            <div class="flex-grow-1">
                                <span>Về i-LogiCare</span>
                                <div class="small text-muted">Phiên bản 1.0.0</div>
                            </div>
                            <i class="ri-arrow-right-s-line"></i>
                        </a>
                    </div>

                    <!-- Logout Section -->
                    <div id="settings-logout-section" class="settings-section mt-3 d-none">
                        <a href="#" class="settings-item d-flex align-items-center p-3 text-danger" onclick="confirmLogout()">
                            <i class="ri-logout-box-line me-3"></i>
                            <div class="flex-grow-1">
                                <span>Đăng xuất</span>
                                <div class="small">Thoát khỏi tài khoản hiện tại</div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: Contact/Support -->
        <section id="contact-section" class="section-hidden">
            <!-- Contact Header -->
            <header class="header fixed-top px-3 d-flex" id="contact-header">
                <div class="d-flex align-items-center justify-content-between w-100">
                    <!-- Back Button -->
                    <a href="#" class="header-icon pe-0" onclick="goBack()">
                        <i class="ri-arrow-left-line"></i>
                    </a>
                    
                    <!-- Title -->
                    <h5 class="header-title mb-0">Hỗ trợ</h5>
                    
                    <!-- Empty div for alignment -->
                    <div style="width: 24px;"></div>
                </div>
            </header>

            <div class="contact-content" style="padding-top: 80px; padding-bottom: 80px;">
                <!-- Quick Actions -->
                <div class="quick-support-actions p-3">
                    <div class="row g-2">
                        <div class="col-6">
                            <div class="support-action-card p-3 text-center border rounded" onclick="alert('Chat với chúng tôi đang phát triển')">
                                <i class="ri-message-3-line fs-2 text-primary mb-2"></i>
                                <div>
                                    <h6 class="mb-0">Chat trực tiếp</h6>
                                    <small class="text-muted">24/7</small>
                </div>
                </div>
                </div>
                        <div class="col-6">
                            <div class="support-action-card p-3 text-center border rounded" onclick="window.open('tel:19001234')">
                                <i class="ri-phone-line fs-2 text-primary mb-2"></i>
                                <div>
                                    <h6 class="mb-0">Gọi hotline</h6>
                                    <small class="text-muted">1900 1234</small>
                </div>
            </div>
                    </div>
                </div>
            </div>

                <!-- Contact Information -->
                <div class="contact-info bg-white m-3 p-3 rounded shadow-sm">
                    <h6 class="mb-3">Thông tin liên hệ</h6>
                    
                    <div class="contact-item d-flex align-items-center mb-3">
                        <div class="contact-icon me-3">
                            <i class="ri-phone-line fs-4 text-primary"></i>
                </div>
                        <div class="contact-details">
                            <h6 class="mb-0">Hotline</h6>
                            <p class="mb-0 text-muted">1900 1234 (24/7)</p>
                    </div>
                </div>

                    <div class="contact-item d-flex align-items-center mb-3">
                        <div class="contact-icon me-3">
                            <i class="ri-mail-line fs-4 text-primary"></i>
                            </div>
                        <div class="contact-details">
                            <h6 class="mb-0">Email</h6>
                            <p class="mb-0 text-muted">support@i-logicare.com</p>
                    </div>
                </div>

                    <div class="contact-item d-flex align-items-center mb-3">
                        <div class="contact-icon me-3">
                            <i class="ri-map-pin-line fs-4 text-primary"></i>
                            </div>
                        <div class="contact-details">
                            <h6 class="mb-0">Địa chỉ</h6>
                            <p class="mb-0 text-muted">123 Đường ABC, Quận 1, TP. Hồ Chí Minh</p>
                            </div>
                            </div>

                    <div class="contact-item d-flex align-items-center">
                        <div class="contact-icon me-3">
                            <i class="ri-time-line fs-4 text-primary"></i>
                </div>
                        <div class="contact-details">
                            <h6 class="mb-0">Giờ làm việc</h6>
                            <p class="mb-0 text-muted">Thứ 2 - Chủ nhật: 8:00 - 22:00</p>
                </div>
                </div>
                </div>
            </div>
        </section>

        <!-- SECTION: Find by Vehicle -->
        <section id="find-by-vehicle-section" class="section-hidden">
            <!-- Find by Vehicle Header -->
            <header class="header fixed-top px-3 d-flex" id="find-by-vehicle-header">
                <div class="d-flex align-items-center justify-content-between w-100">
                    <!-- Back Button -->
                    <a href="#" class="header-icon pe-0" onclick="goBack()">
                        <i class="ri-arrow-left-line"></i>
                    </a>
                    
                    <!-- Title -->
                    <h5 class="header-title mb-0">Tìm Phụ Tùng Theo Xe</h5>
                    
                    <!-- Empty div for alignment -->
                    <div style="width: 24px;"></div>
                </div>
            </header>

            <div class="find-by-vehicle-content" style="padding-bottom: 80px;">
                <!-- Unified Search Form -->
                <div class="vehicle-selection-form bg-white p-3 rounded shadow-sm" style="margin: 0; width: 100%;">
                    <h6 class="mb-3 text-center">Tìm Xe Container</h6>
                    
                    <!-- Progress Stepper -->
                    <div class="progress-stepper mb-4">
                        <div class="stepper-step active" id="step-1">
                            <div class="step-number">1</div>
                            <div class="step-label">Nhập tên xe</div>
                        </div>
                        <div class="stepper-line"></div>
                        <div class="stepper-step" id="step-2">
                            <div class="step-number">2</div>
                            <div class="step-label">Chọn phiên bản</div>
                        </div>
                        <div class="stepper-line"></div>
                        <div class="stepper-step" id="step-3">
                            <div class="step-number">3</div>
                            <div class="step-label">Hoàn tất</div>
                        </div>
                    </div>

                    <!-- Unified Search Bar -->
                    <div class="form-group mb-3">
                        <label for="vehicle-search" class="form-label small fw-medium">Tìm kiếm xe:</label>
                        <div class="search-container position-relative">
                            <input 
                                type="text" 
                                class="form-control" 
                                id="vehicle-search" 
                                placeholder="Gõ tên xe, hãng, dòng xe... (VD: Hino 500, Container 20ft)"
                                autocomplete="off"
                            >
                            <div class="search-icon">
                                <i class="ri-search-line"></i>
                            </div>
                            <div class="autocomplete-dropdown" id="autocomplete-dropdown" style="display: none;">
                                <!-- Autocomplete suggestions will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Selected Tags/Chips -->
                    <div class="selected-tags mb-3" id="selected-tags" style="display: none;">
                        <div class="tags-container">
                            <!-- Tags will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Dynamic Filter Section -->
                    <div class="dynamic-filters" id="dynamic-filters" style="display: none;">
                        <!-- Additional filters will appear here when needed -->
                    </div>

                    <!-- View Specs Button -->
                    <div class="text-center mt-4">
                        <button class="btn btn-primary w-100" id="view-specs-btn" disabled>
                            <i class="ri-information-line me-2"></i>
                            Xem Thông Số & Sản Phẩm
                        </button>
                    </div>
                </div>

                <!-- Vehicle Specs Result (Hidden by default) -->
                <div id="vehicle-specs-result" class="vehicle-specs-result bg-white p-3 rounded shadow-sm" style="display: none; width: 100%; margin: 0;">                   
                    <!-- Specs Content Display -->
                    <div id="specs-content-display" class="specs-content">
                        <!-- Specs will be populated here -->
                    </div>

                    <!-- Find Compatible Products Button -->
                    <div class="text-center mt-4">
                        <button class="btn btn-success w-100" id="find-compatible-products-btn">
                            <i class="ri-search-line me-2"></i>
                            Tìm Sản Phẩm Tương Thích
                        </button>
                </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Bottom Navigation -->
    <nav class="navbar fixed-bottom bottom-nav" id="bottom-nav">
        <!-- Home -->
            <a class="bottom-nav-icon active" href="#homepage-section" onclick="showSection('homepage-section')">
            <i class="ri-home-5-fill"></i>
                <span>Trang chủ</span>
            </a>
        <!-- Categories -->
            <a class="bottom-nav-icon" href="#plp-section" onclick="loadPLP(); showSection('plp-section');">
            <i class="ri-dashboard-line"></i>
            <span>Danh mục</span>
        </a>
        <!-- Find by Vehicle -->
        <a class="bottom-nav-icon bottom-nav-icon--center" href="#find-by-vehicle-section" onclick="showFindByVehicleSection()">
            <div class="bottom-nav-icon-circle">
                <i class="ri-car-line"></i>
            </div>
            <span>Tìm theo xe</span>
        </a>
        <!-- Notifications -->
        <a class="bottom-nav-icon" href="#notifications-section" onclick="showSection('notifications-section')">
            <i class="ri-notification-3-line"></i>
            <span>Thông báo</span>
        </a>
        <!-- Account -->
            <a class="bottom-nav-icon" href="#account-section" onclick="showSection('account-section')">
                <i class="ri-user-line"></i>
                <span>Tài khoản</span>
            </a>

        
    </nav>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Embedded Product Data & JS Logic (ADAPTED for Mobile) -->
    <script>
        // --- Global Variables ---
        let productData = {};
        let allProducts = [];
        let productDataLoaded = false;
        let sectionHistory = ['homepage-section'];
        let currentLang = localStorage.getItem('iLogiCareLang') || 'vi';
        let cart = [];

        // --- DOM Elements ---
        const allSections = document.querySelectorAll('main > section');
        const cartCountBadgeBottom = document.getElementById('cart-count-badge-bottom');
        const cartItemsListContainer = document.getElementById('cart-items-list');
        const cartSubtotalEl = document.getElementById('cart-subtotal');
        const cartTotalEl = document.getElementById('cart-total');
        const cartEmptyMsg = document.getElementById('cart-empty-msg');
        const cartLoading = document.getElementById('cart-loading');
        const cartSummary = document.getElementById('cart-summary');

        // Header and nav references
        const mainHeader = document.getElementById('main-header');
        const bottomNav = document.getElementById('bottom-nav');
        const notificationsHeader = document.getElementById('notifications-header');
        const contactHeader = document.getElementById('contact-header');
        const settingsHeader = document.getElementById('settings-header');
        const plpHeader = document.getElementById('plp-header');
        const pdpHeader = document.getElementById('pdp-header');
        const accountHeader = document.getElementById('account-header');
        const cartHeader = document.getElementById('cart-header');
        const checkoutHeader = document.getElementById('checkout-header');
        const pageBanner = document.getElementById('page-banner');

        // Supabase Configuration
        const SUPABASE_URL = 'https://rowpswmsgomytqrkcdlt.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvd3Bzd21zZ29teXRxcmtjZGx0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcxMjEwODYsImV4cCI6MjA2MjY5NzA4Nn0.nbR_KVbpcVpSWBdkUGTdIJ9eLPFOemALJfLaT-AQa0I';
        let supabaseClient = null;

        try {
            if (typeof window.supabase !== 'undefined' && typeof window.supabase.createClient === 'function') {
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                console.log('Supabase client initialized successfully in index.html');
            } else {
                console.error("Supabase JS library (window.supabase.createClient) is not available in index.html.");
            }
        } catch (error) {
            console.error("Error initializing Supabase client in index.html:", error);
        }

        // Utility Functions
        function safeQuerySelector(selector) {
            const element = document.querySelector(selector);
            if (!element) {
                console.warn(`Element not found: ${selector}`);
            }
            return element;
        }

        function formatCurrency(amount) {
            if (typeof amount !== 'number') amount = Number(amount) || 0;
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }

        // Load PDP Function
        async function loadPDP(productId) {
            if (!productId) return;
            
            console.log('Loading PDP for product ID:', productId);
            
            // Store current product ID in sessionStorage for fallback
            sessionStorage.setItem('currentProductId', productId);
            
            // Ensure product data is loaded
            if (!productDataLoaded) {
                console.log('Product data not loaded, loading now...');
                await fetchProductData();
            }

            // Find the product
            const product = allProducts.find(p => p.id === productId);
            if (!product) {
                console.error('Product not found:', productId);
                return;
            }

            // Show loading state in key elements
            showPDPLoadingState();

            try {
                // Use local product data instead of fetching from Supabase
                console.log('Loading product with ID:', productId);
                
                // Find the product in local data
                const product = allProducts.find(p => p.id === productId);
                
                if (!product) {
                    console.error("Product not found for ID:", productId);
                    throw new Error('Product not found');
                }

                console.log("Product loaded successfully from local data:", product);

                // Show the PDP section first
                showSection('pdp-section');

                // Render product data to UI
                renderPDPData(product);

                // Update page title
                document.title = `${product.name} - i-LogiCare`;

            } catch (error) {
                console.error("Error loading PDP:", error);
                
                // Show error in product info areas
                showPDPErrorState(error);
                
                // Show user-friendly error message
                const errorMessage = error.message.includes('not found') 
                    ? 'Sản phẩm không tồn tại hoặc đã bị xóa.'
                    : 'Có lỗi khi tải thông tin sản phẩm. Vui lòng thử lại sau.';
                    
                alert(currentLang === 'vi' ? errorMessage : 'Error loading product details. Please try again.');
                
                // Redirect to homepage after 2 seconds
                setTimeout(() => {
                    showSection('homepage-section');
                }, 2000);
            }
        }

        // Show PDP loading state (lighter version)
        function showPDPLoadingState() {
            // Show loading in product name
            const productNameEl = document.querySelector('.product-name');
            if (productNameEl) productNameEl.textContent = 'Đang tải sản phẩm...';

            // Show loading in price
            const currentPriceEl = document.querySelector('.current-price');
            if (currentPriceEl) currentPriceEl.textContent = 'Đang tải...';

            // Show loading in gallery
            const swiperWrapper = document.querySelector('#pdp-gallery-swiper .swiper-wrapper');
            if (swiperWrapper) {
                swiperWrapper.innerHTML = `
                    <div class="swiper-slide">
                        <div class="d-flex justify-content-center align-items-center" style="height: 300px; background: #f8f9fa;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Đang tải...</span>
            </div>
                    </div>
                </div>
                `;
            }

            // Show loading in description
            const descContent = document.querySelector('.description-content');
            if (descContent) descContent.innerHTML = '<p class="text-muted">Đang tải mô tả...</p>';

            // Show loading in specs
            const specsTable = document.querySelector('.specs-table');
            if (specsTable) specsTable.innerHTML = '<tr><td colspan="2" class="text-muted">Đang tải thông số...</td></tr>';

            // Disable action buttons
            const addToCartBtn = document.querySelector('#pdp-add-to-cart-pdp-mobile');
            const buyNowBtn = document.querySelector('#pdp-buy-now-btn');
            if (addToCartBtn) addToCartBtn.disabled = true;
            if (buyNowBtn) buyNowBtn.disabled = true;
        }

        // Show PDP error state (lighter version)
        function showPDPErrorState(error) {
            // Show error in product name
            const productNameEl = document.querySelector('.product-name');
            if (productNameEl) productNameEl.textContent = 'Lỗi tải sản phẩm';

            // Show error in gallery
            const swiperWrapper = document.querySelector('#pdp-gallery-swiper .swiper-wrapper');
            if (swiperWrapper) {
                swiperWrapper.innerHTML = `
                    <div class="swiper-slide">
                        <div class="d-flex flex-column justify-content-center align-items-center text-center" style="height: 300px; background: #f8f9fa;">
                            <i class="ri-error-warning-line text-danger mb-2" style="font-size: 48px;"></i>
                            <p class="text-muted">Không thể tải hình ảnh</p>
                        </div>
                    </div>
                `;
            }

            // Show error in description
            const descContent = document.querySelector('.description-content');
            if (descContent) descContent.innerHTML = '<p class="text-danger">Không thể tải mô tả sản phẩm.</p>';
        }

        // Render PDP data to UI
        function renderPDPData(product) {
            console.log('renderPDPData called with product:', product);
            
            const pdpContainer = document.querySelector('#pdp-section');
            if (!pdpContainer) {
                console.error('PDP container not found');
                return;
            }

            // Get button elements
            const addToCartBtn = document.querySelector('#pdp-add-to-cart-pdp-mobile');
            const buyNowBtn = document.querySelector('#pdp-buy-now-btn');

            // Get image URLs
            let productImages = [];
            if (product.image_urls && Array.isArray(product.image_urls) && product.image_urls.length > 0) {
                productImages = product.image_urls;
            } else if (product.main_image) {
                productImages = [product.main_image];
            } else {
                productImages = ['images/placeholder.jpg'];
            }

            // Calculate prices and discount
            const currentPrice = parseFloat(product.price) || 0;
            const originalPrice = parseFloat(product.base_price || product.original_price) || 0;
            let discountPercent = 0;
            if (originalPrice && originalPrice > currentPrice) {
                discountPercent = Math.round(((originalPrice - currentPrice) / originalPrice) * 100);
            }

            // Update gallery images
            const swiperWrapper = document.querySelector('#pdp-gallery-swiper .swiper-wrapper');
            console.log('swiperWrapper found:', !!swiperWrapper);
            if (swiperWrapper) {
                swiperWrapper.innerHTML = productImages.map((url, index) => `
                    <div class="swiper-slide">
                        <img src="${url}" 
                             alt="${product.name} - Hình ${index + 1}" 
                             class="img-fluid w-100" 
                             style="height: 300px; object-fit: cover;"
                             loading="${index === 0 ? 'eager' : 'lazy'}"
                             onerror="this.onerror=null; this.src='images/placeholder.jpg';">
                    </div>
                `).join('');

                // Initialize Swiper for gallery
                setTimeout(() => {
                    if (typeof Swiper !== 'undefined') {
                        // Destroy existing swiper if any
                        const existingSwiper = document.querySelector('#pdp-gallery-swiper .swiper-container');
                        if (existingSwiper && existingSwiper.swiper) {
                            existingSwiper.swiper.destroy(true, true);
                        }

                        new Swiper('#pdp-gallery-swiper', {
                            slidesPerView: 1,
                            spaceBetween: 0,
                            pagination: {
                                el: '.swiper-pagination',
                                clickable: true,
                            },
                            navigation: {
                                nextEl: '.swiper-button-next',
                                prevEl: '.swiper-button-prev',
                            },
                            autoHeight: false,
                        });
                    }
                }, 100);
            }

            // Update product basic info
            const productNameEl = document.querySelector('#pdp-section .product-name');
            const brandEl = document.querySelector('#pdp-section .brand');
            const skuEl = document.querySelector('#pdp-section .sku');
            
            if (productNameEl) productNameEl.textContent = product.name || 'Tên sản phẩm không có';
            if (brandEl) brandEl.textContent = product.brand || 'Chưa có thương hiệu';
            if (skuEl) skuEl.textContent = product.sku || 'N/A';

            // Update price
            const currentPriceEl = document.querySelector('#pdp-section .current-price');
            const originalPriceEl = document.querySelector('#pdp-section .original-price');
            const discountTagEl = document.querySelector('#pdp-section .discount-tag');

            if (currentPriceEl) currentPriceEl.textContent = formatCurrency(currentPrice);

            if (originalPrice > currentPrice) {
                if (originalPriceEl) {
                    originalPriceEl.textContent = formatCurrency(originalPrice);
                    originalPriceEl.style.display = 'inline';
                }
                if (discountTagEl) {
                    discountTagEl.textContent = `-${discountPercent}%`;
                    discountTagEl.style.display = 'inline-block';
                }
            } else {
                if (originalPriceEl) originalPriceEl.style.display = 'none';
                if (discountTagEl) discountTagEl.style.display = 'none';
            }

            // Update product ID for buttons
            if (addToCartBtn) addToCartBtn.dataset.productId = product.id;
            if (buyNowBtn) buyNowBtn.dataset.productId = product.id;

            // Update specifications
            const specsTable = document.querySelector('#pdp-section .specs-table');
            if (specsTable) {
                if (product.specifications) {
                    try {
                        let specs = product.specifications;
                        if (typeof specs === 'string') {
                            specs = JSON.parse(specs);
                        }
                        
                        console.log('Rendering specifications for mobile product:', product.id, specs);
                        
                        if (specs && typeof specs === 'object' && Object.keys(specs).length > 0) {
                            let specsHTML = '';
                            
                            for (const [key, spec] of Object.entries(specs)) {
                                // Handle both new format (object with label, value, type) and legacy format (direct value)
                                let displayLabel = '';
                                let displayValue = '';
                                
                                if (typeof spec === 'object' && spec.label && spec.value !== undefined) {
                                    // New format with structured data
                                    displayLabel = spec.label;
                                    displayValue = spec.value;
                                    
                                    // Don't display empty values
                                    if (!displayValue || displayValue.toString().trim() === '') {
                                        continue;
                                    }
                                } else if (typeof spec === 'string' || typeof spec === 'number') {
                                    // Legacy format - direct value
                                    displayValue = spec;
                                    
                                    // Generate readable labels for legacy format
                                    if (key === 'viscosity') { displayLabel = 'Độ nhớt SAE'; }
                                    else if (key === 'api_quality') { displayLabel = 'Cấp chất lượng API'; }
                                    else if (key === 'capacity') { displayLabel = 'Dung tích (Lít)'; }
                                    else if (key === 'oil_type') { displayLabel = 'Loại dầu'; }
                                    else if (key === 'engine_type') { displayLabel = 'Loại động cơ'; }
                                    else if (key === 'filter_type') { displayLabel = 'Loại lọc'; }
                                    else if (key === 'part_number') { displayLabel = 'Mã phụ tùng'; }
                                    else if (key === 'vehicle_compatibility') { displayLabel = 'Tương thích xe'; }
                                    else if (key === 'tire_size') { displayLabel = 'Kích thước lốp'; }
                                    else if (key === 'pattern_code') { displayLabel = 'Mã gai'; }
                                    else if (key === 'load_speed_index') { displayLabel = 'Chỉ số tải trọng/tốc độ'; }
                                    else if (key === 'insurance_type') { displayLabel = 'Loại bảo hiểm'; }
                                    else if (key === 'coverage_level') { displayLabel = 'Mức độ bảo hiểm'; }
                                    else if (key === 'duration') { displayLabel = 'Thời hạn'; }
                                    else if (key === 'service_type') { displayLabel = 'Loại dịch vụ'; }
                                    else if (key === 'device_type') { displayLabel = 'Loại thiết bị'; }
                                    else if (key === 'power_consumption') { displayLabel = 'Công suất tiêu thụ'; }
                                    else if (key === 'connectivity') { displayLabel = 'Kết nối'; }
                                    else if (key === 'installation_type') { displayLabel = 'Cách lắp đặt'; }
                                    else if (key === 'warranty_period') { displayLabel = 'Thời gian bảo hành'; }
                                    else if (key === 'compatibility') { displayLabel = 'Tương thích'; }
                                    else if (key === 'service_duration') { displayLabel = 'Thời gian thực hiện'; }
                                    else if (key === 'location_type') { displayLabel = 'Địa điểm thực hiện'; }
                                    else if (key === 'skill_level') { displayLabel = 'Trình độ yêu cầu'; }
                                    else if (key === 'certification') { displayLabel = 'Chứng chỉ'; }
                                    else if (key === 'material') { displayLabel = 'Chất liệu'; }
                                    else if (key === 'origin') { displayLabel = 'Xuất xứ'; }
                                    else if (key === 'filtration_efficiency') { displayLabel = 'Hiệu suất lọc'; }
                                    else if (key === 'replacement_interval') { displayLabel = 'Chu kỳ thay thế'; }
                                    else if (key === 'season_type') { displayLabel = 'Loại mùa'; }
                                    else if (key === 'sidewall_type') { displayLabel = 'Loại thành lốp'; }
                                    else if (key === 'coverage_amount') { displayLabel = 'Số tiền bảo hiểm'; }
                                    else if (key === 'deductible') { displayLabel = 'Mức khấu trừ'; }
                                    else if (key === 'part_category') { displayLabel = 'Danh mục phụ tùng'; }
                                    else {
                                        // Default: convert snake_case to readable format
                                        displayLabel = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                                    }
                                    
                                    // Don't display empty values
                                    if (!displayValue || displayValue.toString().trim() === '') {
                                        continue;
                                    }
                                } else {
                                    continue; // Skip invalid specification entries
                                }

                                specsHTML += `<tr><td class="fw-medium">${displayLabel}</td><td>${displayValue}</td></tr>`;
                            }
                            
                            // If no valid specifications were rendered
                            if (specsHTML === '') {
                                specsTable.innerHTML = '<tr><td colspan="2" class="text-muted">Không có thông số kỹ thuật</td></tr>';
                            } else {
                                specsTable.innerHTML = specsHTML;
                            }
                        } else {
                            specsTable.innerHTML = '<tr><td colspan="2" class="text-muted">Không có thông số kỹ thuật</td></tr>';
                        }
                    } catch (e) {
                        console.error("Error parsing specifications:", e);
                        specsTable.innerHTML = '<tr><td colspan="2" class="text-danger">Lỗi hiển thị thông số kỹ thuật</td></tr>';
                    }
                } else {
                    specsTable.innerHTML = '<tr><td colspan="2" class="text-muted">Không có thông số kỹ thuật</td></tr>';
                }
            }

            // Update description
            const descContent = pdpContainer.querySelector('.description-content');
            if (descContent) {
                const description = product.description || product.detailed_description || '';
                if (description) {
                    descContent.innerHTML = description.replace(/\n/g, '<br>');
            } else {
                    descContent.innerHTML = '<p class="text-muted">Không có mô tả chi tiết.</p>';
                }
            }

            // Update shop information
            const shopNameEl = pdpContainer.querySelector('.shop-name');
            if (shopNameEl) {
                const shopName = product.sellers?.shop_name || 'Shop Demo LTA';
                shopNameEl.textContent = shopName;
            }

            // Update action buttons
            const buyNowPriceEl = document.querySelector('#pdp-section #pdp-buy-now-price');

            const isInStock = product.stock_status === 'in_stock' || product.quantity > 0;
            
            if (addToCartBtn) {
                addToCartBtn.dataset.productId = product.id;
                addToCartBtn.disabled = !isInStock;
                if (!isInStock) {
                    addToCartBtn.innerHTML = '<i class="ri-shopping-cart-line"></i><span>Hết hàng</span>';
                } else {
                    addToCartBtn.innerHTML = '<i class="ri-shopping-cart-line"></i><span>Thêm vào giỏ</span>';
                }
            }
            
            if (buyNowBtn) {
                buyNowBtn.dataset.productId = product.id;
                buyNowBtn.disabled = !isInStock;
            }
            
            if (buyNowPriceEl) {
                buyNowPriceEl.textContent = formatCurrency(currentPrice);
            }

            // Update reviews section with demo data based on product
            updateReviewsWithDemoData(product);

            console.log('PDP data rendered successfully for product:', product.name);
        }

        // Update reviews section with demo data
        function updateReviewsWithDemoData(product) {
            // Generate realistic review stats based on product
            const soldCount = parseInt(product.sold_count) || 0;
            const reviewCount = Math.max(5, Math.floor(soldCount * 0.15)); // 15% of sold items have reviews
            const avgRating = 4.2 + Math.random() * 0.6; // Random between 4.2-4.8

            // Update rating summary
            const avgRatingEl = document.querySelector('.average-rating .rating-number');
            const totalReviewsEl = document.querySelector('.total-reviews');
            
            if (avgRatingEl) avgRatingEl.textContent = avgRating.toFixed(1);
            if (totalReviewsEl) totalReviewsEl.textContent = `(${reviewCount} đánh giá)`;

            // Update rating stars
            const ratingStars = document.querySelector('.rating-stars');
            if (ratingStars) {
                const fullStars = Math.floor(avgRating);
                const hasHalfStar = avgRating % 1 >= 0.5;
                
                let starsHTML = '';
                for (let i = 0; i < fullStars; i++) {
                    starsHTML += '<i class="ri-star-fill"></i>';
                }
                if (hasHalfStar) {
                    starsHTML += '<i class="ri-star-half-fill"></i>';
                }
                for (let i = fullStars + (hasHalfStar ? 1 : 0); i < 5; i++) {
                    starsHTML += '<i class="ri-star-line"></i>';
                }
                ratingStars.innerHTML = starsHTML;
            }

            // Update rating bars with realistic distribution
            const ratingBars = document.querySelectorAll('.rating-bar-item');
            const distribution = [85, 10, 3, 1, 1]; // 5,4,3,2,1 star percentages
            
            ratingBars.forEach((bar, index) => {
                const progressBar = bar.querySelector('.progress-bar');
                const countEl = bar.querySelector('.count');
                
                if (progressBar) progressBar.style.width = `${distribution[index]}%`;
                if (countEl) {
                    const count = Math.floor((reviewCount * distribution[index]) / 100);
                    countEl.textContent = count;
                }
            });
        }

        async function loadAccountData() {
            console.log("Loading account data...");
            // 1. Cập nhật thông tin người dùng (tên, avatar,...) nếu cần
            const isAuthenticated = localStorage.getItem('userAuthenticated') === 'true';
            const userName = localStorage.getItem('userName');
            const loggedInInfo = document.getElementById('logged-in-account-info');
            const notLoggedInInfo = document.getElementById('not-logged-in-account-info');
            const badgeElement = document.querySelector(`.order-status-item .badge[data-status-count="${status}"]`);

            if (isAuthenticated) {
                if (loggedInInfo) {
                    loggedInInfo.classList.remove('d-none');
                    const accountUsernameEl = document.getElementById('account-username');
                    if (accountUsernameEl && userName) {
                        accountUsernameEl.textContent = userName;
                    }
                }
                if (notLoggedInInfo) notLoggedInInfo.classList.add('d-none');
                checkSellerStatusAndUpdateUI(); // Cập nhật trạng thái seller
            } else {
                if (loggedInInfo) loggedInInfo.classList.add('d-none');
                if (notLoggedInInfo) notLoggedInInfo.classList.remove('d-none');
                hideSellerButtons();
            }


            // 2. (Tùy chọn) Lấy số lượng đơn hàng cho mỗi trạng thái để hiển thị badge
            if (supabaseClient && isAuthenticated) {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (user) {
                    const statuses = ['pending', 'pickup', 'shipping', 'review']; // Các trạng thái bạn muốn đếm
                    for (const status of statuses) {
                        try {
                            const { count, error } = await supabaseClient
                                .from('orders')
                                .select('*', { count: 'exact', head: true })
                                .eq('user_id', user.id)
                                .eq('status', status);

                            if (error) {
                                console.warn(`Error fetching count for status ${status}:`, error.message);
                            } else {
                                const badgeElement = document.querySelector(`.order-status-item[href="orders.html?tab=${status}"] .badge`);
                                
                                if (badgeElement) {
                                    if (count > 0) {
                                        badgeElement.textContent = count > 9 ? '9+' : count;
                                        badgeElement.style.display = 'inline-block';
                                    } else {
                                        badgeElement.style.display = 'none';
                                    }
                                }
                            }
                        } catch (e) {
                            console.error(`Exception fetching count for status ${status}:`, e);
                        }
                    }
                }
            }
            console.log("Account data update finished.");
        }

        // --- Enhanced show section for different headers ---
        function showSection(sectionId) {
            console.log("Attempting to show section:", sectionId);
            
            // Add to section history for back navigation
            addToSectionHistory(sectionId);
            
             allSections.forEach(section => {
                section.classList.add('section-hidden');
            });

            // Hide all headers first
            if (mainHeader) mainHeader.style.display = 'none';
            if (bottomNav) bottomNav.style.display = 'none';
            if (accountHeader) accountHeader.style.display = 'none';
            if (notificationsHeader) notificationsHeader.style.display = 'none';
            if (contactHeader) contactHeader.style.display = 'none';
            if (settingsHeader) settingsHeader.style.display = 'none';
            if (plpHeader) plpHeader.style.display = 'none';
            if (pdpHeader) pdpHeader.style.display = 'none';
            if (cartHeader) cartHeader.style.display = 'none';
            if (checkoutHeader) checkoutHeader.style.display = 'none';
            if (pageBanner) pageBanner.classList.add('section-hidden');

            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('section-hidden');
            } else {
                console.error("Target section not found:", sectionId);
                document.getElementById('homepage-section').classList.remove('section-hidden');
                if (mainHeader) mainHeader.style.display = 'flex';
                if (bottomNav) bottomNav.style.display = 'flex';
                 return;
             }

            // Show appropriate headers based on section
            switch(sectionId) {
                case 'homepage-section':
                    if (mainHeader) mainHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                    if (pageBanner) pageBanner.classList.add('section-hidden');
                    break;
                    
                case 'plp-section':
                    if (plpHeader) plpHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                    if (pageBanner) pageBanner.classList.remove('section-hidden');
                    break;
                    
                case 'pdp-section':
                    if (pdpHeader) pdpHeader.style.display = 'flex';
                    if (pageBanner) pageBanner.classList.remove('section-hidden');
                    break;
                    
                case 'account-section':
                    if (accountHeader) accountHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                    if (typeof loadAccountData === "function") {
                        loadAccountData();
                    }
                    break;
                    
                case 'notifications-section':
                    if (notificationsHeader) notificationsHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                    break;
                    
                case 'contact-section':
                    if (contactHeader) contactHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                    break;
                    
                case 'settings-section':
                    if (settingsHeader) settingsHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                    updateSettingsUI();
                    break;
                    
                case 'cart-section':
                    if (cartHeader) cartHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                    break;
                    
                case 'checkout-section':
                    if (checkoutHeader) checkoutHeader.style.display = 'flex';
                    // Update checkout items when showing checkout section
                    updateCheckoutItems();
                    break;
                    
                default:
                    if (mainHeader) mainHeader.style.display = 'flex';
                    if (bottomNav) bottomNav.style.display = 'flex';
                break;
            }

            // Update active bottom nav
            updateBottomNavActive(sectionId);
            window.scrollTo(0, 0);
         }

        function updateBottomNavActive(sectionId) {
            const navLinks = document.querySelectorAll('.bottom-nav-icon');
            navLinks.forEach(link => link.classList.remove('active'));

            let activeSelector = '';
            switch(sectionId) {
                case 'homepage-section':
                    activeSelector = 'a[href="#homepage-section"]';
                    break;
                case 'plp-section':
                    activeSelector = 'a[href="#plp-section"]';
                    break;
                case 'find-by-vehicle-section':
                    activeSelector = 'a[href="#find-by-vehicle-section"]';
                    break;
                case 'plp-section-vehicle-filter':
                    activeSelector = 'a[href="#plp-section"]';
                    break;
                case 'notifications-section':
                    activeSelector = 'a[href="#notifications-section"]';
                    break;
                case 'account-section':
                    activeSelector = 'a[href="#account-section"]';
                    break;
            }

            if (activeSelector) {
                const activeLink = document.querySelector(activeSelector);
                if (activeLink) activeLink.classList.add('active');
            }
        }

        // Function to open vehicle filter
        function openVehicleFilter() {
            console.log("Opening vehicle filter...");
            
            // First navigate to PLP section
            loadPLP();
            showSection('plp-section');
            
            // Wait a bit for section to load, then open filter
            setTimeout(() => {
                try {
                    // Get the filter offcanvas
                    const filterOffcanvas = document.getElementById('filterOffcanvas');
                    if (filterOffcanvas) {
                        // Use Bootstrap's offcanvas API to show the filter
                        const offcanvas = new bootstrap.Offcanvas(filterOffcanvas);
                        offcanvas.show();
                        
                        // Scroll to vehicle filter section within the offcanvas
                        setTimeout(() => {
                            const vehicleFilterSection = filterOffcanvas.querySelector('.filter-section');
                            if (vehicleFilterSection) {
                                vehicleFilterSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            }
                        }, 300);
                        
                        console.log("Vehicle filter opened successfully");
                    } else {
                        console.error("Filter offcanvas not found");
                    }
                } catch (error) {
                    console.error("Error opening vehicle filter:", error);
                }
            }, 100);
        }

        // Restore Supabase session on app start
        async function restoreSupabaseSession() {
            try {
                const storedToken = localStorage.getItem('supabase.auth.token');
                if (storedToken && supabaseClient) {
                    const session = JSON.parse(storedToken);
                    console.log('Restoring Supabase session...', session);
                    
                    // Verify if session is still valid
                    const { data: authUser, error } = await supabaseClient.auth.getUser();
                    if (authUser?.user) {
                        console.log('Session restored successfully:', authUser.user.id);
                        
                        // Update localStorage with current session data
                        localStorage.setItem('userId', authUser.user.id);
                        localStorage.setItem('userEmail', authUser.user.email);
                        localStorage.setItem('userAuthenticated', 'true');
                    } else {
                        console.log('Session expired, clearing stored session');
                        localStorage.removeItem('supabase.auth.token');
                        localStorage.setItem('userAuthenticated', 'false');
                    }
                }
            } catch (error) {
                console.error('Error restoring session:', error);
                localStorage.removeItem('supabase.auth.token');
                localStorage.setItem('userAuthenticated', 'false');
            }
        }

        // Initialization
        document.addEventListener('DOMContentLoaded', async () => {
            allSections.forEach(section => {
                if (section.id !== 'homepage-section') {
                    section.classList.add('section-hidden');
                }
            });

            const pageBanner = document.getElementById('page-banner');
            if (pageBanner) {
                pageBanner.classList.add('section-hidden');
            }

            // Restore Supabase session first
            await restoreSupabaseSession();

            // Load cart data
            loadCartFromLocalStorage();

            // Apply initial language
            applyLanguage(currentLang);
            
            // Update language dropdown active state
            updateLanguageDropdownState();

            // Initialize language dropdown functionality
            initLanguageDropdown();

            // Update authentication UI
            updateAuthenticationStatus();

            // Fetch product data on load
            fetchProductData();
        });
        // Update language dropdown active state
        function updateLanguageDropdownState() {
            const languageItems = document.querySelectorAll('.language-item');
            languageItems.forEach(item => {
                const itemLang = item.getAttribute('data-lang');
                const activeIndicator = item.querySelector('.active-indicator');
                if (activeIndicator) {
                    activeIndicator.style.display = itemLang === currentLang ? 'inline' : 'none';
                }
            });
        }

        // Updated check for authentication status
        function updateAuthenticationStatus() {
            const isAuthenticated = isUserLoggedIn();
            const loggedInInfo = document.getElementById('logged-in-account-info');
            const notLoggedInInfo = document.getElementById('not-logged-in-account-info');
            
            if (isAuthenticated) {
                if (loggedInInfo) loggedInInfo.classList.remove('d-none');
                if (notLoggedInInfo) notLoggedInInfo.classList.add('d-none');
                
                // Check seller status after authentication
                checkSellerStatusAndUpdateUI();
            } else {
                if (loggedInInfo) loggedInInfo.classList.add('d-none');
                if (notLoggedInInfo) notLoggedInInfo.classList.remove('d-none');
                
                // Hide seller buttons when not authenticated
                hideSellerButtons();
            }
        }

        // Function to check seller status and update UI accordingly
        async function checkSellerStatusAndUpdateUI() {
            const sellerRegistryEntry = document.getElementById('seller-registration-entry');
            const sellerCenterEntry = document.getElementById('seller-center-entry');
            
            try {
                // Get current user ID (simulate with localStorage for demo)
                const currentUserId = localStorage.getItem('userId') || 'demo-user-id';
                
                // Check if user is already a seller via Supabase
                const isSellerAlready = await checkIfUserIsSeller(currentUserId);
                
                if (isSellerAlready) {
                    // User is already a seller - show seller center, hide registration
                    if (sellerRegistryEntry) sellerRegistryEntry.classList.add('d-none');
                    if (sellerCenterEntry) sellerCenterEntry.classList.remove('d-none');
                } else {
                    // User is not a seller - show registration, hide seller center
                    if (sellerRegistryEntry) sellerRegistryEntry.classList.remove('d-none');
                    if (sellerCenterEntry) sellerCenterEntry.classList.add('d-none');
                }
            } catch (error) {
                console.error('Error checking seller status:', error);
                // On error, default to showing registration button
                if (sellerRegistryEntry) sellerRegistryEntry.classList.remove('d-none');
                if (sellerCenterEntry) sellerCenterEntry.classList.add('d-none');
            }
        }

        // Function to check if user is already a seller
        async function checkIfUserIsSeller(userId) {
            if (!supabaseClient) {
                // For demo purposes, simulate with localStorage
                return localStorage.getItem('isUserSeller') === 'true';
            }

            try {
                const { data, error } = await supabaseClient
                    .from('sellers')
                    .select('id')
                    .eq('user_id', userId)
                    .maybeSingle();

                if (error) {
                    console.error('Error querying seller status:', error);
                    return false;
                }

                return data !== null;
            } catch (error) {
                console.error('Error in seller status check:', error);
                return false;
            }
        }

        // Function to hide seller buttons when user is not authenticated
        function hideSellerButtons() {
            const sellerRegistryEntry = document.getElementById('seller-registration-entry');
            const sellerCenterEntry = document.getElementById('seller-center-entry');
            
            if (sellerRegistryEntry) sellerRegistryEntry.classList.add('d-none');
            if (sellerCenterEntry) sellerCenterEntry.classList.add('d-none');
        }

        // Function to get user-friendly error messages
        function getLoginErrorMessage(error) {
            switch (error.code || error.message) {
                case 'invalid_credentials':
                    return 'Email hoặc mật khẩu không chính xác';
                case 'email_not_confirmed':
                    return 'Vui lòng xác thực email trước khi đăng nhập';
                case 'too_many_requests':
                    return 'Quá nhiều lần thử. Vui lòng thử lại sau';
                case 'user_not_found':
                    return 'Tài khoản không tồn tại';
                default:
                    return error.message || 'Đăng nhập thất bại. Vui lòng thử lại';
            }
        }

        // Function to check if user is a seller
        async function checkUserSellerStatus(userId) {
            try {
                if (!supabaseClient) return;
                
                const { data, error } = await supabaseClient
                    .from('sellers')
                    .select('id, status')
                    .eq('user_id', userId)
                    .single();
                
                if (data) {
                    localStorage.setItem('isUserSeller', 'true');
                    localStorage.setItem('sellerStatus', data.status || 'pending');
                } else {
                    localStorage.setItem('isUserSeller', 'false');
                }
            } catch (error) {
                console.log('Seller status check failed (user might not be a seller):', error);
                localStorage.setItem('isUserSeller', 'false');
            }
        }

        // Authentication functions
        function isUserLoggedIn() {
            return localStorage.getItem('userAuthenticated') === 'true';
        }

        // UI helper functions for login
        function showLoginLoading(show) {
            const spinner = document.getElementById('login-spinner');
            const loginBtn = document.getElementById('email-login-btn');
            
            if (show) {
                spinner.classList.remove('d-none');
                loginBtn.disabled = true;
                loginBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Đang đăng nhập...';
            } else {
                spinner.classList.add('d-none');
                loginBtn.disabled = false;
                loginBtn.innerHTML = 'Đăng nhập';
            }
        }
        
        function showLoginSuccess(message) {
            const successEl = document.getElementById('login-success');
            const messageEl = document.getElementById('login-success-message');
            
            if (successEl && messageEl) {
                messageEl.textContent = message;
                successEl.classList.remove('d-none');
            }
        }
        
        function showLoginError(message) {
            const errorEl = document.getElementById('login-error');
            const messageEl = document.getElementById('login-error-message');
            
            if (errorEl && messageEl) {
                messageEl.textContent = message;
                errorEl.classList.remove('d-none');
            }
        }
        
        function hideLoginMessages() {
            const successEl = document.getElementById('login-success');
            const errorEl = document.getElementById('login-error');
            
            if (successEl) successEl.classList.add('d-none');
            if (errorEl) errorEl.classList.add('d-none');
        }
        
        function showLoginRequiredPopup() {
            const popup = document.getElementById('loginRequiredPopup');
            if (popup) {
                popup.classList.add('show');
            }
        }
        
        function hideLoginRequiredPopup() {
            const popup = document.getElementById('loginRequiredPopup');
            if (popup) {
                popup.classList.remove('show');
            }
        }
        
        // Function to check login state before performing actions
        function requireLogin(action) {
            if (!isUserLoggedIn()) {
                showLoginRequiredPopup();
                return false;
            }
            return true;
        }

        // Function to handle email login form submission
        async function handleEmailLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            // Show loading state
            showLoginLoading(true);
            hideLoginMessages();
            
            try {
                // Authenticate with Supabase
                if (!supabaseClient) {
                    throw new Error('Kết nối đến hệ thống xác thực không thành công');
                }
                
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) {
                    throw new Error(getLoginErrorMessage(error));
                }
                
                // Login successful
                const user = data.user;
                
                // Store authentication data
                localStorage.setItem('userAuthenticated', 'true');
                localStorage.setItem('userName', user.email);
                localStorage.setItem('userId', user.id);
                localStorage.setItem('userEmail', user.email);
                
                if (rememberMe) {
                    localStorage.setItem('rememberLogin', 'true');
                }
                
                // Check if user is a seller
                await checkUserSellerStatus(user.id);
                
                // Update UI
                updateAuthenticationStatus();
                
                // Show success message
                showLoginSuccess('Đăng nhập thành công!');
                
                // Redirect after short delay
                setTimeout(() => {
                    const referrer = sessionStorage.getItem('loginReferrer');
                    if (referrer) {
                        sessionStorage.removeItem('loginReferrer');
                        showSection(referrer);
                    } else {
                        showSection('account-section');
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Login error:', error);
                showLoginError(error.message);
            } finally {
                showLoginLoading(false);
            }
        }

        // Function to navigate to seller registration
        function navigateToSellerRegistration() {
            // Ensure user is logged in
            if (!isUserLoggedIn()) {
                showLoginRequiredPopup();
                return;
            }

            // Navigate to seller onboarding
            window.location.href = 'SellerOnboarding/SellerInfoBasicScreen.html';
        }

        // Function to navigate to seller center
        function navigateToSellerCenter() {
            // Ensure user is logged in
            if (!isUserLoggedIn()) {
                showLoginRequiredPopup();
                return;
            }

            // Navigate to seller center (this could be a different URL in real implementation)
            alert('Chuyển đến Kênh Người bán...\n(Sẽ được triển khai trong phiên bản chính thức)');
            // window.location.href = 'SellerCenter/dashboard.html';
        }
        
        // Function to handle logout
        function logout() {
            // Sign out from Supabase
            if (supabaseClient) {
                supabaseClient.auth.signOut();
            }
            
            // Clear localStorage
            localStorage.removeItem('userAuthenticated');
            localStorage.removeItem('userName');
            localStorage.removeItem('userId');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('isUserSeller');
            localStorage.removeItem('sellerStatus');
            localStorage.removeItem('rememberLogin');
            
            // Update UI
            updateAuthenticationStatus();
            
            // Redirect to homepage
            showSection('homepage-section');
            
            // Show success message
            alert('Đã đăng xuất thành công');
        }

        // Function to toggle password visibility
        function togglePasswordVisibility(fieldId) {
            const passwordField = document.getElementById(fieldId);
            const toggleButton = passwordField.nextElementSibling.querySelector('i');
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                toggleButton.className = 'ri-eye-off-line';
            } else {
                passwordField.type = 'password';
                toggleButton.className = 'ri-eye-line';
            }
        }

        // Function to show email login form
        function showEmailLoginForm() {
            document.getElementById('login-options-card').classList.add('d-none');
            document.getElementById('email-login-card').classList.remove('d-none');
        }
        
        // Function to show login options (go back from email form)
        function showLoginOptions() {
            document.getElementById('email-login-card').classList.add('d-none');
            document.getElementById('login-options-card').classList.remove('d-none');
            
            // Clear form
            document.getElementById('email-login-form').reset();
            
            // Hide any error messages
            hideLoginMessages();
        }

        // Function to handle "Add to Cart" action
        function addToCartWithAuth(productId, quantity) {
            if (requireLogin()) {
                addToCart(productId, quantity); // Call the original addToCart function
            }
        }
        
        // Function to handle "Buy Now" action
        function buyNowWithAuth(productId) {
            if (requireLogin()) {
                buyNow(productId); // Call the original buyNow function
            }
        }

        // Function to handle "Buy Now" action
        function buyNow(productId) {
            // For now, just add to cart and show checkout
            addToCart(productId, 1);
            showSection('checkout-section');
        }

        // --- Product Loading Functions ---
        async function fetchProductData() {
            if (!supabaseClient) {
                console.error("Supabase client is not initialized. Cannot fetch products.");
                productData = { products: [] };
                allProducts = [];
                productDataLoaded = false;
                 return;
             }

            console.log("Fetching products from Supabase...");
            try {
                const { data, error } = await supabaseClient
                    .from('products')
                    .select('id, sku, category, name, brand, description, specifications, price, image_urls, stock_status, compatibility, short_description, product_type, base_price, market_price, manage_stock, stock_quantity, low_stock_threshold, weight, dimensions_cm, tags, status, visibility, average_rating, review_count, sold_count, meta_title, meta_description, published_at, seller_id')
                    .eq('status', 'published')
                    .eq('visibility', 'public')
                    .order('published_at', { ascending: false });

                if (error) {
                    console.error('Error fetching products from Supabase:', error);
                    throw error;
                }

                console.log("Data received from Supabase in fetchProductData:", data); // <<! LOG QUAN TRỌNG
                if (data && data.length > 0) {
                    console.log("First product from Supabase data:", data[0]); // Xem chi tiết sản phẩm đầu tiên
                    if (typeof data[0].seller_id === 'undefined') {
                        console.error("CRITICAL: seller_id is undefined in data from Supabase!");
                    }
                }

                allProducts = data || [];
                productData = { products: allProducts };
                productDataLoaded = true;
                console.log("Products loaded successfully from Supabase:", allProducts.length, "products");

                // Load homepage content after data is ready
                loadHomepageRecommendations();

            } catch (e) {
                console.error('Failed to fetch products from Supabase:', e);
                allProducts = [];
                productData = { products: [] };
                productDataLoaded = false;
                const plpGrid = document.getElementById('plp-product-grid');
                if (plpGrid) plpGrid.innerHTML = `<div class="col-12"><p class="text-center text-danger">Lỗi tải dữ liệu sản phẩm. Vui lòng thử lại.</p></div>`;
                const recommendationsGrid = document.getElementById('recommendations-grid');
                if (recommendationsGrid) recommendationsGrid.innerHTML = `<div class="col-12"><p class="text-center text-danger">Lỗi tải gợi ý sản phẩm.</p></div>`;
            }
        }

        // --- PLP Functions ---
        function loadPLP(filterType = null) {
            if (!productDataLoaded) {
                console.log("loadPLP called but data not ready yet, fetching...");
                fetchProductData().then(() => loadPLP(filterType));
                return;
            }

             const gridContainer = document.getElementById('plp-product-grid');
            const titleEl = document.getElementById('plp-title-mobile');

            if (!gridContainer || !titleEl) {
                console.error("PLP container or title element not found!");
                return;
            }

            gridContainer.innerHTML = '<div class="col-12"><div class="text-center p-3"><div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div></div>';
            titleEl.textContent = "Đang tải...";

             if (!allProducts || allProducts.length === 0) {
                gridContainer.innerHTML = '<div class="col-12"><p class="text-center text-muted small">Chưa có dữ liệu sản phẩm...</p></div>';
                titleEl.textContent = "Sản phẩm";
                 return;
             }

             let filteredProducts = allProducts;
             let categoryNameVi = "Tất cả Sản phẩm";
             let categoryNameEn = "All Products";

             if (filterType) {
                filteredProducts = allProducts.filter(p => p.category === filterType || p.product_type === filterType);
                switch (filterType) {
                    case 'engine_oil': categoryNameVi = "Dầu nhớt"; categoryNameEn = "Engine Oil"; break;
                    case 'oil_filter': categoryNameVi = "Lọc dầu"; categoryNameEn = "Oil Filter"; break;
                    case 'tire': categoryNameVi = "Lốp xe"; categoryNameEn = "Tires"; break;
                    case 'electronics': categoryNameVi = "Phụ tùng điện"; categoryNameEn = "Electronics"; break;
                    default: categoryNameVi = "Sản phẩm"; categoryNameEn = "Products";
                }
            }

             titleEl.textContent = currentLang === 'vi' ? categoryNameVi : categoryNameEn;
             titleEl.setAttribute('data-lang-vi', categoryNameVi);
             titleEl.setAttribute('data-lang-en', categoryNameEn);

            gridContainer.innerHTML = '';

             if (filteredProducts.length === 0) {
                gridContainer.innerHTML = `<div class="col-12"><p class="text-center text-muted small">Không tìm thấy sản phẩm.</p></div>`;
             } else {
                 gridContainer.innerHTML = filteredProducts.map(product => renderMobileProductCard(product)).join('');
             }

            applyLanguage(currentLang);
         }

        function renderMobileProductCard(product) {
            if (!product) return '';

            const isOutOfStock = product.stock_status !== 'in_stock';
            const cardAction = !isOutOfStock ? `onclick="loadPDP('${product.id}'); showSection('pdp-section');"` : '';
            const cardCursor = !isOutOfStock ? 'cursor:pointer;' : 'cursor:default;';

            const rating = parseFloat(product.average_rating) || 0;
            const soldCount = parseInt(product.sold_count) || 0;
            const reviewCount = parseInt(product.review_count) || 0;

            let discountPercent = 0;
            let displayOriginalPrice = '';
            if (product.base_price && product.base_price > product.price) {
                discountPercent = Math.round(((product.base_price - product.price) / product.base_price) * 100);
                displayOriginalPrice = formatCurrency(product.base_price);
            }

            const displayPrice = formatCurrency(product.price);
            const displaySoldCount = formatSoldCount(soldCount);

            const imageUrl = (product.image_urls && product.image_urls.length > 0) ? product.image_urls[0] : 'images/placeholder.jpg';

            let overlayBadgesHTML = '';
            if (discountPercent > 0) {
                overlayBadgesHTML += `<span class="overlay-badge overlay-badge-discount"><span class="percent">${discountPercent}%</span><span class="label">GIẢM</span></span>`;
            }

             return `
                <div class="col-6">
                    <div class="card mobile-product-card-shopee h-100 overflow-hidden" ${cardAction} style="${cardCursor}">
                        <div class="product-card-img-container position-relative">
                            <img src="${imageUrl}" class="card-img-top product-card-img" alt="${product.name}" onerror="this.onerror=null; this.src='images/placeholder.jpg';">
                            ${ overlayBadgesHTML ? `<div class="product-overlays">${overlayBadgesHTML}</div>` : '' }
                            ${isOutOfStock ? '<div class="stock-overlay"><span class="badge bg-dark bg-opacity-75">Hết hàng</span></div>' : ''}
                        </div>
                        <div class="card-body d-flex flex-column p-2">
                            <p class="product-card-title mb-1">${product.name || 'N/A'}</p>
                            <div class="price-container mt-auto mb-1">
                                <span class="shopee-price">${displayPrice}</span>
                                ${displayOriginalPrice ? `<span class="original-price">${displayOriginalPrice}</span>` : ''}
                                ${discountPercent > 0 ? `<span class="discount-percent">-${discountPercent}%</span>` : ''}
                            </div>
                            <div class="rating-sold-info d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center gap-1">
                                    ${rating > 0 ? `<i class="ri-star-fill" style="color:#FFC107;font-size:11px;"></i> <span style="font-size:11px;">${rating.toFixed(1)}</span>` : ''}
                                </div>
                                <span class="sold-count" style="font-size:11px;">${soldCount > 0 ? `Đã bán ${displaySoldCount}` : ''}</span>
                            </div>
                            <div class="location small text-muted mt-1"><i class="ri-map-pin-line me-1"></i>TP. Hồ Chí Minh</div>
                         </div>
                     </div>
                 </div>`;
        }

        function formatSoldCount(count) {
            if (count >= 1000000) {
                return (count / 1000000).toFixed(1).replace(/\.0$/, '') + 'tr';
            } else if (count >= 1000) {
                return (count / 1000).toFixed(1).replace(/\.0$/, '') + 'k';
            }
            return count.toString();
        }

        // --- Homepage Functions ---
        function loadHomepageRecommendations() {
            const container = document.getElementById('recommendations-grid');
            if (!container) return;
            container.innerHTML = '';

            if (!allProducts || allProducts.length === 0) {
                container.innerHTML = '<div class="col-12"><p class="text-center text-muted small">Loading recommendations...</p></div>';
                return;
            }

            const shuffledProducts = [...allProducts].sort(() => 0.5 - Math.random());
            const recommended = shuffledProducts.slice(0, 12);

            if (recommended.length === 0) {
                container.innerHTML = '<div class="col-12"><p class="text-center text-muted small">No recommendations available.</p></div>';
                            return;
                        }

            container.innerHTML = recommended.map(product => renderMobileProductCard(product)).join('');
            applyLanguage(currentLang);
        }

        // --- Cart Functions ---
        function loadCartFromLocalStorage() {
            const savedCart = localStorage.getItem('iLogiCareCart');
            cart = savedCart ? JSON.parse(savedCart) : [];
            updateCartUI();
        }

        function saveCartToLocalStorage() {
            localStorage.setItem('iLogiCareCart', JSON.stringify(cart));
            updateCartUI();
        }

        function updateCartUI() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartCountBadge = document.getElementById('cart-count-badge-bottom');
            if (cartCountBadge) {
                cartCountBadge.textContent = totalItems;
                cartCountBadge.style.display = totalItems > 0 ? 'block' : 'none';
            }
        }

        function addToCart(productId, quantity) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) {
                console.error("addToCart: Product not found in allProducts for ID:", productId);
                return;
            }

            // LOG QUAN TRỌNG: Kiểm tra seller_id của product
            console.log("Product found in allProducts for addToCart:", product);
            console.log("Product seller_id in addToCart:", product.seller_id, typeof product.seller_id);
            if (typeof product.seller_id === 'undefined' || product.seller_id === null) {
                console.error("CRITICAL in addToCart: product.seller_id is missing for product ID:", productId, product);
                alert('Lỗi: Sản phẩm đang được thêm vào giỏ thiếu thông tin người bán quan trọng. Vui lòng thử lại hoặc liên hệ hỗ trợ.');
                return; // Không thêm vào giỏ nếu thiếu seller_id
            }
            
            const existingItemIndex = cart.findIndex(item => item.id === productId);
            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity += quantity;
             } else {
                const imageUrl = (product.image_urls && product.image_urls.length > 0) ? product.image_urls[0] : 'images/placeholder.jpg';
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    imageUrl: imageUrl,
                    quantity: quantity,
                    seller_id: product.seller_id
                });
                
                // Debug log để kiểm tra item vừa được thêm
                console.log("Adding to cart, item:", cart[cart.length-1]);
            }
            
             saveCartToLocalStorage();
         }

        // --- Language Functions ---
         function switchLanguage(lang) {
             if (lang !== 'vi' && lang !== 'en') return;
             currentLang = lang;
             localStorage.setItem('iLogiCareLang', lang);
             applyLanguage(lang);
            
            // Update language dropdown active state
            updateLanguageDropdownState();

             // Reload content if needed
             if (!document.getElementById('plp-section').classList.contains('section-hidden')) {
                loadPLP();
              }
              if (!document.getElementById('homepage-section').classList.contains('section-hidden')) {
                loadHomepageRecommendations();
              }
         }

         function applyLanguage(lang) {
             document.querySelectorAll('[data-lang-vi], [data-lang-en]').forEach(el => {
                 const text = el.getAttribute(`data-lang-${lang}`);
                 if (text !== null) {
                      if (el.hasAttribute('data-lang-placeholder-vi') || el.hasAttribute('data-lang-placeholder-en')) {
                         const placeholderText = el.getAttribute(`data-lang-placeholder-${lang}`);
                          if (placeholderText !== null) el.placeholder = placeholderText;
                     } else {
                          el.textContent = text;
                     }
                 }
             });
         }

        // Add language dropdown event listeners
        function initLanguageDropdown() {
            const languageItems = document.querySelectorAll('.language-item');
            languageItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const lang = item.getAttribute('data-lang');
                    if (lang === 'vi' || lang === 'en') {
                        switchLanguage(lang);
                    }
                });
            });

            // Toggle dropdown on click
            const languageSelector = document.querySelector('.language-selector');
            const languageDropdown = document.querySelector('.language-dropdown');
            
            if (languageSelector && languageDropdown) {
                languageSelector.addEventListener('click', (e) => {
                    e.preventDefault();
                    languageDropdown.classList.toggle('show');
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!languageSelector.contains(e.target)) {
                        languageDropdown.classList.remove('show');
                    }
                });
            }
        }

        // --- Section navigation with authentication check ---
        function navigateToSection(sectionId, requiresAuth = false) {
            if (requiresAuth && !requireAuth(sectionId)) {
                return;
            }
            showSection(sectionId);
        }

        // --- Go back function ---
        function goBack() {
            // Check if there's history to go back to
            if (sectionHistory.length > 1) {
                // Remove current section
                sectionHistory.pop();
                // Go to previous section
                const previousSection = sectionHistory[sectionHistory.length - 1];
                showSection(previousSection);
            } else {
                // Default to homepage if no history
                showSection('homepage-section');
            }
        }

        // --- Update section history ---
        function addToSectionHistory(sectionId) {
            // Avoid adding duplicate consecutive entries
            if (sectionHistory[sectionHistory.length - 1] !== sectionId) {
                sectionHistory.push(sectionId);
                // Limit history to 10 entries
                if (sectionHistory.length > 10) {
                    sectionHistory.shift();
                }
            }
        }

        // --- Share product function ---
        function shareProduct() {
            if (navigator.share) {
                navigator.share({
                    title: document.title,
                    url: window.location.href
                }).catch(console.error);
            } else {
                // Fallback for browsers that don't support Web Share API
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('Link đã được sao chép vào clipboard!');
                }).catch(() => {
                    alert('Không thể chia sẻ. Vui lòng sao chép URL thủ công.');
                });
            }
        }

        // --- Toggle wishlist function ---
        function toggleWishlist() {
            alert('Tính năng wishlist đang được phát triển');
        }

        // --- Chat with shop function ---
        function chatWithShop() {
            alert('Tính năng chat với shop đang được phát triển');
        }

        // --- Handle cart actions ---
        function handleAddToCartPDP() {
            const productId = document.querySelector('#pdp-add-to-cart-pdp-mobile').dataset.productId;
            if (productId) {
                addToCart(productId, 1);
                alert('Đã thêm sản phẩm vào giỏ hàng!');
            }
        }

        // === UNIFIED VEHICLE SEARCH FUNCTIONALITY ===
        
        // Global variables for vehicle data
        let vehicleDataContainer = null;
        let currentVehicleSelections = {
            brand: null,
            model: null,
            year: null,
            trim: null,
            containerType: null,
            capacity: null
        };
        // Search and autocomplete variables
        let searchSuggestions = [];
        let selectedTags = [];
        let currentStep = 1;
        let searchTimeout = null;

        async function fetchVehicleDataContainer() {
            try {
                console.log('Fetching vehicle data container...');
                
                const response = await fetch('vehicles_data_container.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                vehicleDataContainer = data;
                console.log('Vehicle data loaded successfully:', data);
                return data;
            } catch (error) {
                console.error('Error fetching vehicle data:', error);
                throw error;
            }
        }

        /**
         * Generate search suggestions from vehicle data
         * @param {string} query - Search query
         * @returns {Array} Array of suggestions
         */
        function generateSearchSuggestions(query) {
            if (!vehicleDataContainer || !query || query.length < 2) return [];
            
            const suggestions = [];
            const lowerQuery = query.toLowerCase();
            
            // Search in brands
            vehicleDataContainer.brands.forEach(brand => {
                if (brand.name.toLowerCase().includes(lowerQuery)) {
                    suggestions.push({
                        type: 'brand',
                        id: brand.id,
                        title: brand.name,
                        subtitle: 'Hãng xe',
                        data: { brand: brand.id }
                    });
                }
            });
            
            // Search in models
            Object.keys(vehicleDataContainer.models).forEach(brandId => {
                vehicleDataContainer.models[brandId].forEach(model => {
                    if (model.name.toLowerCase().includes(lowerQuery)) {
                        const brandName = vehicleDataContainer.brands.find(b => b.id === brandId)?.name || '';
                        suggestions.push({
                            type: 'model',
                            id: model.id,
                            title: model.name,
                            subtitle: `${brandName} - Dòng xe`,
                            data: { brand: brandId, model: model.id }
                        });
                    }
                });
            });
            
            // Search in container types
            Object.keys(vehicleDataContainer.container_types).forEach(key => {
                vehicleDataContainer.container_types[key].forEach(containerType => {
                    if (containerType.name.toLowerCase().includes(lowerQuery)) {
                        suggestions.push({
                            type: 'container',
                            id: containerType.id,
                            title: containerType.name,
                            subtitle: 'Loại thùng',
                            data: { containerType: containerType.id, key: key }
                        });
                    }
                });
            });
            
            // Search in capacities
            Object.keys(vehicleDataContainer.capacities).forEach(key => {
                vehicleDataContainer.capacities[key].forEach(capacity => {
                    if (capacity.name.toLowerCase().includes(lowerQuery)) {
                        suggestions.push({
                            type: 'capacity',
                            id: capacity.id,
                            title: capacity.name,
                            subtitle: 'Tải trọng',
                            data: { capacity: capacity.id, key: key }
                        });
                    }
                });
            });
            
            return suggestions.slice(0, 8); // Limit to 8 suggestions
        }

        /**
         * Display search suggestions in autocomplete dropdown
         * @param {Array} suggestions - Array of suggestions
         */
        function displaySearchSuggestions(suggestions) {
            const dropdown = document.getElementById('autocomplete-dropdown');
            if (!dropdown) return;
            
            if (suggestions.length === 0) {
                dropdown.style.display = 'none';
                    return;
                }

            let html = '';
            suggestions.forEach((suggestion, index) => {
                html += `
                    <div class="autocomplete-item" data-index="${index}">
                        <div class="item-title">${suggestion.title}</div>
                        <div class="item-subtitle">${suggestion.subtitle}</div>
                    </div>
                `;
            });
            
            dropdown.innerHTML = html;
            dropdown.style.display = 'block';
        }

        /**
         * Handle search input changes
         * @param {Event} event - Input event
         */
        function handleSearchInput(event) {
            const query = event.target.value.trim();
            
            // Clear previous timeout
            if (searchTimeout) {
                clearTimeout(searchTimeout);
            }
            
            // Hide dropdown if query is too short
            if (query.length < 2) {
                const dropdown = document.getElementById('autocomplete-dropdown');
                if (dropdown) {
                    dropdown.style.display = 'none';
                }
                return;
            }
            
            // Debounce search
            searchTimeout = setTimeout(() => {
                const suggestions = generateSearchSuggestions(query);
                displaySearchSuggestions(suggestions);
            }, 300);
        }

        /**
         * Handle suggestion selection
         * @param {Object} suggestion - Selected suggestion
         */
        function handleSuggestionSelect(suggestion) {
            console.log('Selected suggestion:', suggestion);
            
            // Add tag for the selection
            addTag(suggestion.title, suggestion.type, suggestion.data);
            
            // Update vehicle selections based on suggestion type
            updateVehicleSelections(suggestion);
            
            // Hide autocomplete dropdown
            const dropdown = document.getElementById('autocomplete-dropdown');
            if (dropdown) {
                dropdown.style.display = 'none';
            }
            
            // Clear search input
            const searchInput = document.getElementById('vehicle-search');
            if (searchInput) {
                searchInput.value = '';
            }
            
            // Update step progress
            updateStepProgress();
        }

        /**
         * Add tag to selected tags
         * @param {string} label - Tag label
         * @param {string} type - Tag type
         * @param {Object} data - Tag data
         */
        function addTag(label, type, data) {
            // Remove existing tags of the same type to ensure only one selection per type
            selectedTags = selectedTags.filter(tag => tag.type !== type);
            
            const tag = {
                id: `tag_${type}_${Date.now()}`,
                label: label,
                type: type,
                data: data
            };
            
            selectedTags.push(tag);
            renderTags();
            saveSearchHistory();
        }

        /**
         * Remove tag from selected tags
         * @param {string} tagId - Tag ID to remove
         */
        function removeTag(tagId) {
            const index = selectedTags.findIndex(tag => tag.id === tagId);
            
            if (index !== -1) {
                const removedTag = selectedTags.splice(index, 1)[0];
                
                // Clear corresponding vehicle selection
                clearVehicleSelection(removedTag.type, removedTag.data);
                
                renderTags();
                updateStepProgress();
                saveSearchHistory();
            }
        }

        /**
         * Render tags in the UI
         */
        function renderTags() {
            const tagsContainer = document.querySelector('.tags-container');
            if (!tagsContainer) return;
            
            if (selectedTags.length === 0) {
                document.getElementById('selected-tags').style.display = 'none';
                return;
            }
            
            document.getElementById('selected-tags').style.display = 'block';
            
            let html = '';
            selectedTags.forEach(tag => {
                html += `
                    <div class="tag" data-tag-id="${tag.id}">
                        <span>${tag.label}</span>
                        <button class="tag-remove" data-tag-id="${tag.id}">
                            <i class="ri-close-line"></i>
                        </button>
                    </div>
                `;
            });
            
            tagsContainer.innerHTML = html;
        }

        /**
         * Update vehicle selections based on suggestion
         * @param {Object} suggestion - Selected suggestion
         */
        function updateVehicleSelections(suggestion) {
            switch (suggestion.type) {
                case 'brand':
                    currentVehicleSelections.brand = suggestion.data.brand;
                    // Clear dependent selections
                    currentVehicleSelections.model = null;
                    currentVehicleSelections.year = null;
                    currentVehicleSelections.trim = null;
                    currentVehicleSelections.containerType = null;
                    currentVehicleSelections.capacity = null;
                    // Remove dependent tags
                    selectedTags = selectedTags.filter(tag => 
                        tag.type !== 'model' && 
                        tag.type !== 'year' && 
                        tag.type !== 'trim' && 
                        tag.type !== 'container' && 
                        tag.type !== 'capacity'
                    );
                    break;
                    
                case 'model':
                    currentVehicleSelections.brand = suggestion.data.brand;
                    currentVehicleSelections.model = suggestion.data.model;
                    // Clear dependent selections
                    currentVehicleSelections.year = null;
                    currentVehicleSelections.trim = null;
                    currentVehicleSelections.containerType = null;
                    currentVehicleSelections.capacity = null;
                    // Remove dependent tags
                    selectedTags = selectedTags.filter(tag => 
                        tag.type !== 'year' && 
                        tag.type !== 'trim' && 
                        tag.type !== 'container' && 
                        tag.type !== 'capacity'
                    );
                    break;
                    
                case 'year':
                    currentVehicleSelections.year = suggestion.data.year;
                    // Clear dependent selections
                    currentVehicleSelections.trim = null;
                    currentVehicleSelections.containerType = null;
                    currentVehicleSelections.capacity = null;
                    // Remove dependent tags
                    selectedTags = selectedTags.filter(tag => 
                        tag.type !== 'trim' && 
                        tag.type !== 'container' && 
                        tag.type !== 'capacity'
                    );
                    break;
                    
                case 'trim':
                    currentVehicleSelections.trim = suggestion.data.trim;
                    // Clear dependent selections
                    currentVehicleSelections.containerType = null;
                    currentVehicleSelections.capacity = null;
                    // Remove dependent tags
                    selectedTags = selectedTags.filter(tag => 
                        tag.type !== 'container' && 
                        tag.type !== 'capacity'
                    );
                    break;
                    
                case 'container':
                    currentVehicleSelections.containerType = suggestion.data.containerType;
                    // Clear dependent selections
                    currentVehicleSelections.capacity = null;
                    // Remove dependent tags
                    selectedTags = selectedTags.filter(tag => tag.type !== 'capacity');
                    break;
                    
                case 'capacity':
                    currentVehicleSelections.capacity = suggestion.data.capacity;
                    break;
            }
            
            console.log('Updated vehicle selections:', currentVehicleSelections);
        }

        /**
         * Clear vehicle selection when tag is removed
         * @param {string} type - Tag type
         * @param {Object} data - Tag data
         */
        function clearVehicleSelection(type, data) {
            switch (type) {
                case 'brand':
                    currentVehicleSelections.brand = null;
                    currentVehicleSelections.model = null;
                    currentVehicleSelections.year = null;
                    currentVehicleSelections.trim = null;
                    currentVehicleSelections.containerType = null;
                    currentVehicleSelections.capacity = null;
                    // Remove dependent tags
                    selectedTags = selectedTags.filter(tag => 
                        tag.type !== 'model' && 
                        tag.type !== 'year' && 
                        tag.type !== 'trim' && 
                        tag.type !== 'container' && 
                        tag.type !== 'capacity'
                    );
                    break;
                    
                case 'model':
                    currentVehicleSelections.model = null;
                    currentVehicleSelections.year = null;
                    currentVehicleSelections.trim = null;
                    currentVehicleSelections.containerType = null;
                    currentVehicleSelections.capacity = null;
                    // Remove dependent tags
                    selectedTags = selectedTags.filter(tag => 
                        tag.type !== 'year' && 
                        tag.type !== 'trim' && 
                        tag.type !== 'container' && 
                        tag.type !== 'capacity'
                    );
                    break;
                    
                case 'year':
                    currentVehicleSelections.year = null;
                    currentVehicleSelections.trim = null;
                    currentVehicleSelections.containerType = null;
                    currentVehicleSelections.capacity = null;
                    // Remove dependent tags
                    selectedTags = selectedTags.filter(tag => 
                        tag.type !== 'trim' && 
                        tag.type !== 'container' && 
                        tag.type !== 'capacity'
                    );
                    break;
                    
                case 'trim':
                    currentVehicleSelections.trim = null;
                    currentVehicleSelections.containerType = null;
                    currentVehicleSelections.capacity = null;
                    // Remove dependent tags
                    selectedTags = selectedTags.filter(tag => 
                        tag.type !== 'container' && 
                        tag.type !== 'capacity'
                    );
                    break;
                    
                case 'container':
                    currentVehicleSelections.containerType = null;
                    currentVehicleSelections.capacity = null;
                    // Remove dependent tags
                    selectedTags = selectedTags.filter(tag => tag.type !== 'capacity');
                    break;
                    
                case 'capacity':
                    currentVehicleSelections.capacity = null;
                    break;
            }
        }

        /**
         * Update step progress indicator
         */
        function updateStepProgress() {
            const hasBrand = !!currentVehicleSelections.brand;
            const hasModel = !!currentVehicleSelections.model;
            const hasYear = !!currentVehicleSelections.year;
            const hasTrim = !!currentVehicleSelections.trim;
            const hasContainer = !!currentVehicleSelections.containerType;
            const hasCapacity = !!currentVehicleSelections.capacity;
            
            // Update step 1 (Nhập tên xe)
            const step1 = document.getElementById('step-1');
            if (step1) {
                if (hasBrand || hasModel) {
                    step1.classList.add('completed');
                    step1.classList.remove('active');
                    } else {
                    step1.classList.add('active');
                    step1.classList.remove('completed');
                }
            }
            
            // Update step 2 (Chọn phiên bản)
            const step2 = document.getElementById('step-2');
            if (step2) {
                if (hasContainer || hasCapacity) {
                    step2.classList.add('active');
                    step2.classList.remove('completed');
                } else if (hasBrand && hasModel) {
                    step2.classList.add('active');
                    step2.classList.remove('completed');
                } else {
                    step2.classList.remove('active', 'completed');
                }
            }
            
            // Update step 3 (Hoàn tất)
            const step3 = document.getElementById('step-3');
            if (step3) {
                if (hasBrand && hasModel && hasYear && hasTrim && hasContainer && hasCapacity) {
                    step3.classList.add('completed');
                    step3.classList.remove('active');
                    
                    // Enable view specs button
                    const viewSpecsBtn = document.getElementById('view-specs-btn');
                    if (viewSpecsBtn) {
                        viewSpecsBtn.disabled = false;
                    }
                } else {
                    step3.classList.remove('active', 'completed');
                    
                    // Disable view specs button
                    const viewSpecsBtn = document.getElementById('view-specs-btn');
                    if (viewSpecsBtn) {
                        viewSpecsBtn.disabled = true;
                    }
                }
            }
            
            // Show/hide dynamic filters based on current selections
            showDynamicFilters();
        }

        /**
         * Show dynamic filters based on current selections
         */
        function showDynamicFilters() {
            const dynamicFilters = document.getElementById('dynamic-filters');
            if (!dynamicFilters) return;
            
            const hasBrand = !!currentVehicleSelections.brand;
            const hasModel = !!currentVehicleSelections.model;
            const hasYear = !!currentVehicleSelections.year;
            const hasTrim = !!currentVehicleSelections.trim;
            const hasContainer = !!currentVehicleSelections.containerType;
            const hasCapacity = !!currentVehicleSelections.capacity;
            

            
            let filtersHTML = '';
            
            // Show year selection if we have brand and model but no year
            if (hasBrand && hasModel && !hasYear) {
                const modelId = currentVehicleSelections.model;
                const years = vehicleDataContainer.years[modelId];
                if (years && years.length > 0) {
                    filtersHTML += `
                        <div class="dynamic-filter-item">
                            <label class="filter-label">Chọn đời xe:</label>
                            <select class="form-select form-select-sm" id="dynamic-year-select">
                                <option value="">Chọn đời xe</option>
                                ${years.sort((a, b) => b - a).map(year => 
                                    `<option value="${year}">${year}</option>`
                                ).join('')}
                            </select>
                        </div>
                    `;
                }
            }
            
            // Show trim selection if we have year but no trim
            if (hasBrand && hasModel && hasYear && !hasTrim) {
                const modelId = currentVehicleSelections.model;
                const year = currentVehicleSelections.year;
                const trimKey = `${modelId}|${year}`;
                const trims = vehicleDataContainer.trims[trimKey];
                if (trims && trims.length > 0) {
                    filtersHTML += `
                        <div class="dynamic-filter-item">
                            <label class="filter-label">Chọn phiên bản:</label>
                            <select class="form-select form-select-sm" id="dynamic-trim-select">
                                <option value="">Chọn phiên bản</option>
                                ${trims.map(trim => 
                                    `<option value="${trim.id}">${trim.name}</option>`
                                ).join('')}
                            </select>
                        </div>
                    `;
                }
            }
            
            // Show container type selection if we have trim but no container
            if (hasBrand && hasModel && hasYear && hasTrim && !hasContainer) {
                const modelId = currentVehicleSelections.model;
                const year = currentVehicleSelections.year;
                const trimId = currentVehicleSelections.trim;
                const containerKey = `${modelId}|${year}|${trimId}`;
                const containers = vehicleDataContainer.container_types[containerKey];
                if (containers && containers.length > 0) {
                    filtersHTML += `
                        <div class="dynamic-filter-item">
                            <label class="filter-label">Chọn loại thùng:</label>
                            <select class="form-select form-select-sm" id="dynamic-container-select">
                                <option value="">Chọn loại thùng</option>
                                ${containers.map(container => 
                                    `<option value="${container.id}">${container.name}</option>`
                                ).join('')}
                            </select>
                        </div>
                    `;
                }
            }
            
            // Show capacity selection if we have container but no capacity
            if (hasBrand && hasModel && hasYear && hasTrim && hasContainer && !hasCapacity) {
                const modelId = currentVehicleSelections.model;
                const year = currentVehicleSelections.year;
                const trimId = currentVehicleSelections.trim;
                const containerId = currentVehicleSelections.containerType;
                const capacityKey = `${modelId}|${year}|${trimId}|${containerId}`;
                const capacities = vehicleDataContainer.capacities[capacityKey];
                if (capacities && capacities.length > 0) {
                    filtersHTML += `
                        <div class="dynamic-filter-item">
                            <label class="filter-label">Chọn tải trọng:</label>
                            <select class="form-select form-select-sm" id="dynamic-capacity-select">
                                <option value="">Chọn tải trọng</option>
                                ${capacities.map(capacity => 
                                    `<option value="${capacity.id}">${capacity.name}</option>`
                                ).join('')}
                            </select>
                        </div>
                    `;
                }
            }
            
            if (filtersHTML) {
                dynamicFilters.innerHTML = filtersHTML;
                dynamicFilters.style.display = 'block';
                
                // Add event listeners to dynamic filters
                addDynamicFilterEventListeners();
                            } else {
                dynamicFilters.style.display = 'none';
            }
        }

        /**
         * Add event listeners to dynamic filters
         */
        function addDynamicFilterEventListeners() {
            // Year select
            const yearSelect = document.getElementById('dynamic-year-select');
            if (yearSelect) {
                yearSelect.addEventListener('change', (event) => {
                    const selectedYear = event.target.value;
                    if (selectedYear) {
                        currentVehicleSelections.year = selectedYear;
                        addTag(selectedYear, 'year', { year: selectedYear });
                        updateStepProgress();
                    }
                });
            }
            
            // Trim select
            const trimSelect = document.getElementById('dynamic-trim-select');
            if (trimSelect) {
                trimSelect.addEventListener('change', (event) => {
                    const selectedTrimId = event.target.value;
                    if (selectedTrimId) {
                        const modelId = currentVehicleSelections.model;
                        const year = currentVehicleSelections.year;
                        const trimKey = `${modelId}|${year}`;
                        const trims = vehicleDataContainer.trims[trimKey];
                        const selectedTrim = trims.find(t => t.id === selectedTrimId);
                        
                        if (selectedTrim) {
                            currentVehicleSelections.trim = selectedTrimId;
                            addTag(selectedTrim.name, 'trim', { trim: selectedTrimId });
                            updateStepProgress();
                        }
                    }
                });
            }
            
            // Container select
            const containerSelect = document.getElementById('dynamic-container-select');
            if (containerSelect) {
                containerSelect.addEventListener('change', (event) => {
                    const selectedContainerId = event.target.value;
                    if (selectedContainerId) {
                        const modelId = currentVehicleSelections.model;
                        const year = currentVehicleSelections.year;
                        const trimId = currentVehicleSelections.trim;
                        const containerKey = `${modelId}|${year}|${trimId}`;
                        const containers = vehicleDataContainer.container_types[containerKey];
                        const selectedContainer = containers.find(c => c.id === selectedContainerId);
                        
                        if (selectedContainer) {
                            currentVehicleSelections.containerType = selectedContainerId;
                            addTag(selectedContainer.name, 'container', { containerType: selectedContainerId });
                            updateStepProgress();
                        }
                    }
                });
            }
            
            // Capacity select
            const capacitySelect = document.getElementById('dynamic-capacity-select');
            if (capacitySelect) {
                capacitySelect.addEventListener('change', (event) => {
                    const selectedCapacityId = event.target.value;
                    if (selectedCapacityId) {
                        const modelId = currentVehicleSelections.model;
                        const year = currentVehicleSelections.year;
                        const trimId = currentVehicleSelections.trim;
                        const containerId = currentVehicleSelections.containerType;
                        const capacityKey = `${modelId}|${year}|${trimId}|${containerId}`;
                        const capacities = vehicleDataContainer.capacities[capacityKey];
                        const selectedCapacity = capacities.find(c => c.id === selectedCapacityId);
                        
                        if (selectedCapacity) {
                            currentVehicleSelections.capacity = selectedCapacityId;
                            addTag(selectedCapacity.name, 'capacity', { capacity: selectedCapacityId });
                            updateStepProgress();
                        }
                    }
                });
            }
        }

        /**
         * Show vehicle specifications
         */
        function showVehicleSpecs() {
            const { brand, model, year, trim, containerType, capacity } = currentVehicleSelections;
            
            console.log('showVehicleSpecs - Current selections:', currentVehicleSelections);
            
            if (!brand || !model || !year || !trim || !containerType || !capacity) {
                alert('Vui lòng hoàn thành tất cả các lựa chọn trước khi xem thông số kỹ thuật.');
                return;
            }
            
            // Create spec key
            const specKey = `${model}|${year}|${trim}|${containerType}|${capacity}`;
            console.log('Looking up specs for key:', specKey);
            
            // Get specifications
            const specs = vehicleDataContainer.specs[specKey];
            if (!specs) {
                console.log('Spec not found for key:', specKey);
                console.log('Available keys that match pattern:');
                Object.keys(vehicleDataContainer.specs).forEach(key => {
                    if (key.startsWith(model + '|' + year)) {
                        console.log('  -', key);
                    }
                });
                alert('Không tìm thấy thông số kỹ thuật cho cấu hình xe đã chọn. Vui lòng thử lại với cấu hình khác.');
                        return;
                    }
                    
            // Display specifications
            displayVehicleSpecs(specs);
            
            // Show specs result section
            const specsResult = document.getElementById('vehicle-specs-result');
            if (specsResult) {
                specsResult.style.display = 'block';
                specsResult.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        /**
         * Display vehicle specifications with improved UI/UX
         * @param {Object} specs - Vehicle specifications
         */
        function displayVehicleSpecs(specs) {
            const specsDisplay = document.getElementById('specs-content-display');
            if (!specsDisplay) return;

            let specsHTML = `
                <div class="specs-header mb-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-cogs text-white me-2"></i>
                            Thông số kỹ thuật chi tiết
                        </h4>
                        </div>
                </div>
                
                <div class="specs-content">
                    <!-- Nhóm 1: Động cơ, Hộp số -->
                    <div class="specs-card mb-4">
                        <div class="specs-card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-cog text-white me-2"></i>
                                Động cơ & Hộp số
                            </h5>
                        </div>
                        <div class="specs-card-body">
                            <div class="specs-grid">
                                <div class="spec-item">
                                    <div class="spec-icon">
                                        <i class="fas fa-cog text-primary"></i>
                        </div>
                                    <div class="spec-content">
                                        <div class="spec-label">Động cơ</div>
                                        <div class="spec-value">${specs.engine || 'N/A'}</div>
                    </div>
                        </div>
                                <div class="spec-item">
                                    <div class="spec-icon">
                                        <i class="fas fa-tachometer-alt text-success"></i>
                    </div>
                                    <div class="spec-content">
                                        <div class="spec-label">Dung tích xi-lanh</div>
                                        <div class="spec-value">${specs.displacement_cc || 'N/A'} cc</div>
                </div>
                                </div>
                                <div class="spec-item">
                                    <div class="spec-icon">
                                        <i class="fas fa-bolt text-warning"></i>
                                    </div>
                                    <div class="spec-content">
                                        <div class="spec-label">Công suất tối đa</div>
                                        <div class="spec-value">${specs.max_power_ps_rpm || 'N/A'}</div>
                                    </div>
                                </div>
                                <div class="spec-item">
                                    <div class="spec-icon">
                                        <i class="fas fa-cogs text-info"></i>
                                    </div>
                                    <div class="spec-content">
                                        <div class="spec-label">Hộp số</div>
                                        <div class="spec-value">${specs.transmission || 'N/A'}</div>
                                    </div>
                                </div>
                                <div class="spec-item">
                                    <div class="spec-icon">
                                        <i class="fas fa-sync-alt text-secondary"></i>
                                    </div>
                                    <div class="spec-content">
                                        <div class="spec-label">Mô-men xoắn tối đa</div>
                                        <div class="spec-value">${specs.max_torque_nm_rpm || 'N/A'}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Nhóm 2: Kích thước, Tải trọng -->
                    <div class="specs-card mb-4">
                        <div class="specs-card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-ruler-combined text-white me-2"></i>
                                Kích thước & Tải trọng
                            </h5>
            </div>
                        <div class="specs-card-body">
                            <div class="specs-grid">
                                <div class="spec-item">
                                    <div class="spec-icon">
                                        <i class="fas fa-arrows-alt text-info"></i>
                                    </div>
                                    <div class="spec-content">
                                        <div class="spec-label">Kích thước tổng thể</div>
                                        <div class="spec-value">${specs.overall_dimensions_mm || 'N/A'} mm</div>
                                    </div>
                                </div>
                                <div class="spec-item">
                                    <div class="spec-icon">
                                        <i class="fas fa-road text-success"></i>
                                    </div>
                                    <div class="spec-content">
                                        <div class="spec-label">Chiều dài cơ sở</div>
                                        <div class="spec-value">${specs.wheelbase_mm || 'N/A'} mm</div>
                                    </div>
                                </div>
                                <div class="spec-item">
                                    <div class="spec-icon">
                                        <i class="fas fa-weight-hanging text-danger"></i>
                                    </div>
                                    <div class="spec-content">
                                        <div class="spec-label">Tải trọng</div>
                                        <div class="spec-value">${specs.gross_vehicle_weight_kg || 'N/A'}</div>
                                    </div>
                                </div>
                            </div>
                    </div>
                </div>
                
                    <!-- Nhóm 3: Dung tích, Lốp xe -->
                    <div class="specs-card mb-4">
                        <div class="specs-card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-gas-pump text-white me-2"></i>
                                Dung tích & Lốp xe
                            </h5>
                    </div>
                        <div class="specs-card-body">
                            <div class="specs-grid">
                                <div class="spec-item">
                                    <div class="spec-icon">
                                        <i class="fas fa-gas-pump text-warning"></i>
                    </div>
                                    <div class="spec-content">
                                        <div class="spec-label">Dung tích bình nhiên liệu</div>
                                        <div class="spec-value">${specs.fuel_tank_capacity_l || 'N/A'} lít</div>
                    </div>
                </div>
                                <div class="spec-item">
                                    <div class="spec-icon">
                                        <i class="fas fa-circle text-secondary"></i>
            </div>
                                    <div class="spec-content">
                                        <div class="spec-label">Kích thước lốp</div>
                                        <div class="spec-value">${specs.tire_size || 'N/A'}</div>
            </div>
        </div>
    </div>
                        </div>
                    </div>
                </div>
            `;

            specsDisplay.innerHTML = specsHTML;
        }

        /**
         * Find compatible products
         */
        function findCompatibleProducts() {
            const { brand, model, year, trim, containerType, capacity } = currentVehicleSelections;
            
            if (!brand || !model || !year || !trim || !containerType || !capacity) {
                alert('Vui lòng hoàn thành tất cả các lựa chọn trước khi tìm sản phẩm.');
                return;
            }
            
            // Create spec key to get config_code
            const specKey = `${model}|${year}|${trim}|${containerType}|${capacity}`;
            const specs = vehicleDataContainer.specs[specKey];
            
            if (!specs || !specs.config_code) {
                alert('Không tìm thấy mã cấu hình cho xe đã chọn.');
                return;
            }
            
            const configCode = specs.config_code;
            console.log('Finding compatible products for config:', configCode);
            
            // Show loading popup
            showLoadingPopup();
            
            // Simulate loading time (2-3 seconds)
                        setTimeout(() => {
                // Hide loading popup
                hideLoadingPopup();
                
                // Navigate to PLP section
                loadPLP();
                showSection('plp-section');
                
                // Show success message
                console.log(`Đã tìm thấy sản phẩm tương thích cho cấu hình: ${configCode}`);
            }, 2500);
        }

        /**
         * Show loading popup
         */
        function showLoadingPopup() {
            const loadingPopup = document.getElementById('loading-popup');
            if (loadingPopup) {
                loadingPopup.classList.add('show');
            }
        }

        /**
         * Hide loading popup
         */
        function hideLoadingPopup() {
            const loadingPopup = document.getElementById('loading-popup');
            if (loadingPopup) {
                loadingPopup.classList.remove('show');
            }
        }

        /**
         * Initialize unified vehicle search functionality
         */
        function initializeFindByVehicle() {
            console.log('Initializing unified vehicle search functionality...');
            
            // Fetch vehicle data
            fetchVehicleDataContainer()
                .then(() => {
                    // Add event listeners for unified search
                    addUnifiedSearchEventListeners();
                    
                    // Load previous search from localStorage
                    loadPreviousSearch();
                    
                    console.log('Unified vehicle search functionality initialized successfully');
                })
                .catch(error => {
                    console.error('Failed to initialize unified vehicle search:', error);
                });
        }

        /**
         * Add event listeners for unified search
         */
        function addUnifiedSearchEventListeners() {
            // Search input
            const searchInput = document.getElementById('vehicle-search');
            if (searchInput) {
                searchInput.addEventListener('input', handleSearchInput);
                searchInput.addEventListener('focus', () => {
                    const query = searchInput.value.trim();
                    if (query.length >= 2) {
                        const suggestions = generateSearchSuggestions(query);
                        displaySearchSuggestions(suggestions);
                    }
                });
            }
            
            // Autocomplete dropdown clicks
            const autocompleteDropdown = document.getElementById('autocomplete-dropdown');
            if (autocompleteDropdown) {
                autocompleteDropdown.addEventListener('click', (event) => {
                    const item = event.target.closest('.autocomplete-item');
                    if (item) {
                        const index = parseInt(item.dataset.index);
                        const suggestions = generateSearchSuggestions(searchInput.value.trim());
                        if (suggestions[index]) {
                            handleSuggestionSelect(suggestions[index]);
                        }
                    }
                });
            }
            
            // Tag remove button clicks (event delegation)
            const selectedTagsContainer = document.getElementById('selected-tags');
            if (selectedTagsContainer) {
                selectedTagsContainer.addEventListener('click', (event) => {
                    if (event.target.closest('.tag-remove')) {
                        const button = event.target.closest('.tag-remove');
                        const tagId = button.getAttribute('data-tag-id');
                        removeTag(tagId);
                }
            });
        }

            // View specs button
            const viewSpecsBtn = document.getElementById('view-specs-btn');
            if (viewSpecsBtn) {
                viewSpecsBtn.addEventListener('click', showVehicleSpecs);
            }
            
            // Find compatible products button
            const findCompatibleProductsBtn = document.getElementById('find-compatible-products-btn');
            if (findCompatibleProductsBtn) {
                findCompatibleProductsBtn.addEventListener('click', findCompatibleProducts);
            }
            
            // Click outside to hide autocomplete
            document.addEventListener('click', (event) => {
                const searchContainer = document.querySelector('.search-container');
                if (searchContainer && !searchContainer.contains(event.target)) {
                    const dropdown = document.getElementById('autocomplete-dropdown');
                    if (dropdown) {
                        dropdown.style.display = 'none';
                    }
                }
            });
        }

        /**
         * Load previous search from localStorage
         */
        function loadPreviousSearch() {
            const savedSearch = localStorage.getItem('vehicleSearchHistory');
            if (savedSearch) {
                try {
                    const history = JSON.parse(savedSearch);
                    if (history.tags && history.tags.length > 0) {
                        selectedTags = history.tags;
                        currentVehicleSelections = history.selections || {};
                        renderTags();
                        updateStepProgress();
                        console.log('Loaded previous search:', history);
                }
            } catch (error) {
                    console.error('Error loading search history:', error);
                }
            }
        }

        /**
         * Save current search to localStorage
         */
        function saveSearchHistory() {
            const history = {
                tags: selectedTags,
                selections: currentVehicleSelections,
                timestamp: Date.now()
            };
            localStorage.setItem('vehicleSearchHistory', JSON.stringify(history));
        }

        // Initialize find by vehicle when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize find by vehicle functionality
            initializeFindByVehicle();
        });

        // Re-initialize when section is shown (in case DOM elements are not ready)
        function showFindByVehicleSection() {
            showSection('find-by-vehicle-section');
            
            // Re-initialize if vehicle data is not loaded
            if (!vehicleDataContainer) {
                setTimeout(() => {
                    initializeFindByVehicle();
                }, 100);
            }
        }
        
        // Add helpful debug info to console
        console.log('%c=== Mobile i-LogiCare Debug Ready ===', 'color: #5AAF4B; font-weight: bold; font-size: 14px;');
        console.log('Mobile Debug Functions Available:');
        console.log('• debugMobileSpecifications(productId) - Debug specifications for specific product');
        console.log('• debugMobileProductsData() - Debug all loaded products data');
        console.log('%cMobile Specifications Testing:', 'color: #2196F3; font-weight: bold;');
        console.log('- Navigate to any product detail page');
        console.log('- Check browser console for specifications rendering logs');
        console.log('- Use debugMobileSpecifications(productId) to inspect specific product');
        console.log('%c=== Mobile Ready for Testing ===', 'color: #5AAF4B; font-weight: bold;');

        // --- Missing Functions Restored from Backup ---
        
        /**
         * Handle Buy Now functionality for Product Detail Page
         */
        function handleBuyNowPDP() {
            try {
                const btn = document.getElementById('pdp-buy-now-btn');
                if (!btn) {
                    console.error("Buy now button not found");
                    return;
                }

                const productId = btn.dataset.productId;
                if (!productId) {
                    console.error("Product ID not found");
                    alert(currentLang === 'vi' ? 'Lỗi: Không tìm thấy thông tin sản phẩm' : 'Error: Product information not found');
                    return;
                }

                const quantityInput = document.getElementById('pdp-quantity');
                const quantity = quantityInput ? parseInt(quantityInput.value, 10) : 1;
                
                if (isNaN(quantity) || quantity < 1) {
                    console.error("Invalid quantity:", quantity);
                    alert(currentLang === 'vi' ? 'Lỗi: Số lượng không hợp lệ' : 'Error: Invalid quantity');
                    return;
                }

                const product = allProducts.find(p => p.id === productId);
                if (!product) {
                    console.error("Product not found:", productId);
                    alert(currentLang === 'vi' ? 'Lỗi: Không tìm thấy sản phẩm' : 'Error: Product not found');
                    return;
                }

                if (product.stock_status !== 'in_stock') {
                    console.error("Product out of stock:", productId);
                    alert(currentLang === 'vi' ? 'Sản phẩm đã hết hàng' : 'Product is out of stock');
                    return;
                }

                // Clear existing cart and add only this item
                cart = [{
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    imageUrl: product.imageUrl,
                    quantity: quantity
                }];
                saveCartToLocalStorage();

                // Go to checkout
                showSection('checkout-section');
                goToCheckoutStep(1);

            } catch (error) {
                console.error("Error in handleBuyNowPDP:", error);
                alert(currentLang === 'vi' ? 'Có lỗi xảy ra khi mua ngay' : 'Error processing buy now');
            }
        }

        /**
         * Update cart display and calculations
         */
        function updateCart() {
            const container = document.getElementById('cart-items-container');
            if (!container) return;
            
            container.innerHTML = '';

            cart.forEach(item => {
                container.innerHTML += `
                    <div class="cart-item">
                        <div class="item-image">
                            <img src="${item.imageUrl}" alt="${item.name}">
                        </div>
                        <div class="item-info">
                            <h3 class="item-name">${item.name}</h3>
                            <p class="item-variant">${item.variant || ''}</p>
                            <div class="item-price">${formatCurrency(item.price)}</div>
                            <div class="item-quantity">
                                <button class="quantity-btn" onclick="updateItemQuantity('${item.id}', ${item.quantity - 1})">-</button>
                                <input type="number" class="quantity-input" value="${item.quantity}" 
                                       onchange="updateItemQuantity('${item.id}', this.value)">
                                <button class="quantity-btn" onclick="updateItemQuantity('${item.id}', ${item.quantity + 1})">+</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            // Update summary
            const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            const subtotalElement = document.querySelector('.subtotal');
            const totalElement = document.querySelector('.total-amount');
            const cartCountElement = document.querySelector('.cart-count');
            
            if (subtotalElement) subtotalElement.textContent = formatCurrency(subtotal);
            if (totalElement) totalElement.textContent = formatCurrency(subtotal);
            if (cartCountElement) cartCountElement.textContent = cart.length;

            // Update checkout items
            const checkoutContainer = document.getElementById('checkout-items-container');
            if (checkoutContainer) {
                checkoutContainer.innerHTML = '';
                cart.forEach(item => {
                    checkoutContainer.innerHTML += `
                        <div class="cart-item">
                            <div class="item-image">
                                <img src="${item.imageUrl}" alt="${item.name}">
                            </div>
                            <div class="item-info">
                                <h3 class="item-name">${item.name}</h3>
                                <p class="item-variant">${item.variant || ''}</p>
                                <div class="item-price">${formatCurrency(item.price)}</div>
                                <div class="item-quantity">
                                    <span>Số lượng: ${item.quantity}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
        }

        /**
         * Update item quantity in cart
         */
        function updateItemQuantity(itemId, newQuantity) {
            if (newQuantity < 1) {
                if (confirm('Bạn muốn xóa sản phẩm này?')) {
                    cart = cart.filter(item => item.id !== itemId);
                }
            } else {
                const item = cart.find(item => item.id === itemId);
                if (item) {
                    item.quantity = parseInt(newQuantity);
                }
            }
            updateCart();
        }

        /**
         * Toggle cart edit mode
         */
        function editCart() {
            const items = document.querySelectorAll('.cart-item');
            items.forEach(item => {
                item.classList.toggle('edit-mode');
            });
        }

        /**
         * Place order functionality
         */
        function placeOrder() {
            console.log('Placing order...');
            
            // Generate order ID
            const orderId = `#LTA-DEMO-${Math.floor(Math.random() * 90000) + 10000}`;
            
            // Update order ID in confirmation page
            const orderIdElement = document.getElementById('conf-order-id');
            if (orderIdElement) {
                orderIdElement.textContent = orderId;
            }
            
            // Clear cart
            cart = [];
            saveCartToLocalStorage();
            
            // Show confirmation page
            showSection('confirmation-section');
            
            console.log('Order placed successfully:', orderId);
        }

        /**
         * Mark all notifications as read
         */
        function markAllAsRead() {
            alert('Mark all notifications as read functionality not implemented yet.');
        }

        /**
         * Generate random rating for products
         */
        function generateRandomRating() {
            return (Math.random() * 2 + 3).toFixed(1);
        }

        /**
         * Generate random sold count
         */
        function generateRandomSoldCount() {
            return Math.floor(Math.random() * 100000);
        }

        /**
         * Generate random rating count
         */
        function generateRandomRatingCount() {
            return Math.floor(Math.random() * 1000);
        }

        /**
         * Format currency in Vietnamese format
         */
        function formatCurrency(amount) {
            if (typeof amount !== 'number') amount = Number(amount) || 0;
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }

        /**
         * Format currency in Shopee style
         */
        function formatCurrencyShopeeStyle(amount) {
            if (typeof amount !== 'number') amount = Number(amount) || 0;
            const formattedNumber = new Intl.NumberFormat('vi-VN').format(amount);
            return '₫' + formattedNumber;
        }

        /**
         * Format sold count with abbreviations
         */
        function formatSoldCount(count) {
            if (count >= 1000000) {
                return (count / 1000000).toFixed(1).replace(/\.0$/, '') + 'tr';
            } else if (count >= 1000) {
                return (count / 1000).toFixed(1).replace(/\.0$/, '') + 'k';
            }
            return count.toString();
        }

        /**
         * Generate random discount percentage
         */
        function generateRandomDiscount() {
            const discount = Math.floor(Math.random() * 14) * 5 + 5;
            return discount;
        }

        /**
         * Generate random product tags
         */
        function generateRandomTags() {
            const allTags = [
                { text: 'Chính hãng', class: 'tag-authentic' },
                { text: 'Hàng mới', class: 'tag-new' },
                { text: 'Deal sốc', class: 'tag-deal' },
                { text: 'Thương hiệu đối tác', class: 'tag-partner' },
                { text: 'Freeship', class: 'tag-freeship' },
                { text: 'Hoàn xu 20%', class: 'tag-cashback' },
                { text: 'Mua kèm deal sốc', class: 'tag-bundle' },
                { text: 'Đề xuất', class: 'tag-recommended' }
            ];
            
            const numTags = Math.floor(Math.random() * 3) + 1;
            
            return allTags
                .sort(() => 0.5 - Math.random())
                .slice(0, numTags);
        }

        /**
         * Shuffle array utility function
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        /**
         * Increase quantity in PDP
         */
        function increaseQuantityPDP() {
            const quantityInput = document.getElementById('pdp-quantity');
            if (quantityInput) {
                const currentValue = parseInt(quantityInput.value) || 1;
                quantityInput.value = currentValue + 1;
            }
        }

        /**
         * Decrease quantity in PDP
         */
        function decreaseQuantityPDP() {
            const quantityInput = document.getElementById('pdp-quantity');
            if (quantityInput) {
                const currentValue = parseInt(quantityInput.value) || 1;
                if (currentValue > 1) {
                    quantityInput.value = currentValue - 1;
                }
            }
        }

        /**
         * Load cart items display
         */
        function loadCartItems() {
            updateCart();
        }

        /**
         * Toggle wishlist functionality
         */
        function toggleWishlist() {
            alert('Wishlist functionality not implemented yet.');
        }

        /**
         * Chat with shop functionality
         */
        function chatWithShop() {
            alert('Chat with shop functionality not implemented yet.');
        }

        // --- Checkout Functions ---
        
        /**
         * Navigate to specific checkout step
         */
        function goToCheckoutStep(stepNumber) {
            // Hide all steps
            document.querySelectorAll('#checkout-section > div[id^="checkout-step-"]').forEach(step => step.classList.add('section-hidden'));
            // Show target step
            const targetStep = document.getElementById(`checkout-step-${stepNumber}`);
            if(targetStep) targetStep.classList.remove('section-hidden');
            // Update indicators if using mobile-specific ones, otherwise ignore desktop steps

            if (stepNumber === 4) populateReviewStepMobile(); // Use mobile review function
        }

        /**
         * Populate review step for mobile
         */
        function populateReviewStepMobile() {
            // Get data from Mobile form fields
            const addressElement = document.getElementById('reviewAddressMobile');
            const addressInput = document.getElementById('checkoutAddress');
            if (addressElement && addressInput) {
                addressElement.textContent = addressInput.value || 'N/A';
            }
            
            // Populate other review fields
            const reviewItemsContainerMobile = document.getElementById('reviewItemsMobile');
            if (reviewItemsContainerMobile) {
                reviewItemsContainerMobile.innerHTML = '';
                let subtotal = 0;
                
                if (cart && cart.length > 0) {
                    cart.forEach(item => {
                        reviewItemsContainerMobile.innerHTML += `
                            <div class="review-item">
                                <span>${item.name}</span>
                                <span>${formatCurrency(item.price * item.quantity)}</span>
                            </div>
                        `;
                        subtotal += item.price * item.quantity;
                    });
                }
                
                const subtotalElement = document.getElementById('reviewSubtotalMobile');
                if (subtotalElement) {
                    subtotalElement.textContent = formatCurrency(subtotal);
                }
            }
            
            applyLanguage(currentLang);
        }

        /**
         * Switch language functionality
         */
        function switchLanguage(lang) {
            if (lang !== 'vi' && lang !== 'en') return;
            currentLang = lang;
            localStorage.setItem('iLogiCareLang', lang);
            applyLanguage(lang);
            
            // Update Offcanvas language buttons active state
            const viBtn = document.getElementById('lang-btn-vi');
            const enBtn = document.getElementById('lang-btn-en');
            if (viBtn) viBtn.classList.toggle('active', lang === 'vi');
            if (enBtn) enBtn.classList.toggle('active', lang === 'en');

            // Reload content if needed
            if (!document.getElementById('plp-section').classList.contains('section-hidden')) {
                loadPLP();
            }
            if (!document.getElementById('pdp-section').classList.contains('section-hidden')) {
                const currentProductId = document.getElementById('pdp-add-to-cart-btn')?.dataset.productId;
                if(currentProductId) loadPDP(currentProductId);
            }
            if (!document.getElementById('cart-section').classList.contains('section-hidden')) {
                loadCartItems();
            }
            if (!document.getElementById('homepage-section').classList.contains('section-hidden')) {
                loadFeaturedProducts();
            }
        }

        /**
         * Apply language to UI elements
         */
        function applyLanguage(lang) {
            document.querySelectorAll('[data-lang-vi], [data-lang-en]').forEach(el => {
                const text = el.getAttribute(`data-lang-${lang}`);
                if (text !== null) {
                    if (el.hasAttribute('data-lang-placeholder-vi') || el.hasAttribute('data-lang-placeholder-en')) {
                        const placeholderText = el.getAttribute(`data-lang-placeholder-${lang}`);
                        if (placeholderText !== null) el.placeholder = placeholderText;
                    } else {
                        el.textContent = text;
                    }
                }
            });
        }

        /**
         * Load featured products for homepage
         */
        function loadFeaturedProducts() {
            const container = document.getElementById('featured-products-grid');
            if (!container) return;
            container.innerHTML = '';

            if (!allProducts || allProducts.length === 0) {
                container.innerHTML = '<div class="col-12"><p class="text-center text-muted small">Loading featured products...</p></div>';
                return;
            }

            // Get random featured products
            const shuffledProducts = [...allProducts].sort(() => 0.5 - Math.random());
            const featured = shuffledProducts.slice(0, 8);

            featured.forEach(product => {
                const tags = generateRandomTags();
                const tagsHTML = tags.map(tag => `<span class="product-tag ${tag.class}">${tag.text}</span>`).join('');
                
                container.innerHTML += `
                    <div class="product-card" onclick="loadPDP('${product.id}')">
                        <div class="product-image">
                            <img src="${product.imageUrl}" alt="${product.name}">
                            ${tagsHTML}
                        </div>
                        <div class="product-info">
                            <h3 class="product-name">${product.name}</h3>
                            <div class="product-price">
                                <span class="current-price">${formatCurrencyShopeeStyle(product.price)}</span>
                                <span class="original-price">${formatCurrencyShopeeStyle(product.price * 1.2)}</span>
                            </div>
                            <div class="product-rating">
                                <span class="rating">${generateRandomRating()}</span>
                                <span class="rating-count">(${generateRandomRatingCount()})</span>
                                <span class="sold-count">Đã bán ${formatSoldCount(generateRandomSoldCount())}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        /**
         * Load Product Listing Page - Removed duplicate function
         * The actual loadPLP function is defined earlier in the file
         */

        /**
         * Update checkout items display
         */
        function updateCheckoutItems() {
            console.log('Updating checkout items...');
            console.log('Current cart:', cart);
            
            const checkoutContainer = document.getElementById('checkout-items-container');
            if (!checkoutContainer) {
                console.error('Checkout items container not found');
                return;
            }

            if (!cart || cart.length === 0) {
                checkoutContainer.innerHTML = `
                    <div class="checkout-empty">
                        <i class="ri-shopping-cart-line"></i>
                        <p>Không có sản phẩm nào trong giỏ hàng</p>
                    </div>
                `;
                return;
            }

            let totalAmount = 0;
            let itemsHTML = '';

            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                totalAmount += itemTotal;
                
                // Get correct image URL
                const imageUrl = (item.image_urls && item.image_urls.length > 0) ? item.image_urls[0] : 
                                (item.main_image) ? item.main_image : 
                                (item.imageUrl) ? item.imageUrl : 'images/placeholder.jpg';
                
                itemsHTML += `
                    <div class="checkout-item">
                        <div class="item-image">
                            <img src="${imageUrl}" alt="${item.name}" onerror="this.src='images/placeholder.jpg'">
                        </div>
                        <div class="item-details">
                            <h4 class="item-name">${item.name}</h4>
                            <div class="item-price">${formatCurrency(item.price)}</div>
                            <div class="item-quantity">Số lượng: ${item.quantity}</div>
                        </div>
                        <div class="item-total">
                            ${formatCurrency(itemTotal)}
                        </div>
                    </div>
                `;
            });

            checkoutContainer.innerHTML = itemsHTML;

            // Update total amount
            const totalElement = document.querySelector('#checkout-total');
            if (totalElement) {
                totalElement.textContent = formatCurrency(totalAmount);
            }
            
            // Also update total-amount class elements
            const totalAmountElements = document.querySelectorAll('.total-amount');
            totalAmountElements.forEach(element => {
                element.textContent = formatCurrency(totalAmount);
            });
            
            // Update footer total (including shipping)
            const footerTotalElement = document.querySelector('#checkout-footer-total');
            if (footerTotalElement) {
                footerTotalElement.textContent = formatCurrency(totalAmount + 30000); // Add shipping fee
            }

            // Update order summary if exists
            const orderSummary = document.getElementById('checkout-order-summary');
            if (orderSummary) {
                orderSummary.innerHTML = `
                    <div class="order-summary">
                        <div class="summary-row">
                            <span>Tổng tiền hàng:</span>
                            <span>${formatCurrency(totalAmount)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Phí vận chuyển:</span>
                            <span id="shipping-fee">30.000₫</span>
                        </div>
                        <div class="summary-row total">
                            <span>Tổng thanh toán:</span>
                            <span id="final-total">${formatCurrency(totalAmount + 30000)}</span>
                        </div>
                    </div>
                `;
            }

            console.log('Checkout items updated successfully. Total:', totalAmount);
        }

        /**
         * Show payment confirmation popup
         */
        function showPaymentConfirmation() {
            console.log('Showing payment confirmation popup...');
            
            if (!cart || cart.length === 0) {
                alert('Không có sản phẩm nào trong giỏ hàng');
                return;
            }

            // Calculate total
            const totalAmount = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const finalTotal = totalAmount + 30000; // Add shipping fee

            // Update popup content
            const totalAmountEl = document.getElementById('confirm-total-amount');
            const subtotalEl = document.getElementById('confirm-subtotal');
            const finalTotalEl = document.getElementById('confirm-final-total');
            
            if (totalAmountEl) totalAmountEl.textContent = formatCurrency(totalAmount);
            if (subtotalEl) subtotalEl.textContent = formatCurrency(totalAmount);
            if (finalTotalEl) finalTotalEl.textContent = formatCurrency(finalTotal);

            // Show popup
            const popup = document.getElementById('payment-confirm-popup');
            if (popup) {
                popup.classList.add('show');
            }
        }

        /**
         * Hide payment confirmation popup
         */
        function hidePaymentConfirmPopup() {
            const popup = document.getElementById('payment-confirm-popup');
            if (popup) {
                popup.classList.remove('show');
            }
        }

        /**
         * Confirm place order from popup
         */
        function confirmPlaceOrder() {
            hidePaymentConfirmPopup();
            placeOrder();
        }
    </script>

    <!-- Loading Popup -->
    <div id="loading-popup" class="loading-popup">
        <div class="loading-popup-content">
            <div class="loading-popup-spinner"></div>
            <div class="loading-popup-text">Đang tìm kiếm sản phẩm...</div>
            <div class="loading-popup-subtext">Vui lòng chờ trong giây lát</div>
        </div>
    </div>

    <!-- Payment Confirmation Popup -->
    <div id="payment-confirm-popup" class="confirm-popup">
        <div class="confirm-content">
            <div class="confirm-header">
                <h5 class="confirm-title">Xác nhận đặt hàng</h5>
            </div>
            <div class="confirm-body">
                <div class="confirm-amount" id="confirm-total-amount">0₫</div>
                <div class="confirm-details">
                    <div class="confirm-detail-row">
                        <span>Tổng tiền hàng:</span>
                        <span id="confirm-subtotal">0₫</span>
                    </div>
                    <div class="confirm-detail-row">
                        <span>Phí vận chuyển:</span>
                        <span>30.000₫</span>
                    </div>
                    <div class="confirm-detail-row">
                        <span>Tổng thanh toán:</span>
                        <span id="confirm-final-total">0₫</span>
                    </div>
                </div>
            </div>
            <div class="confirm-actions">
                <button class="btn btn-secondary" onclick="hidePaymentConfirmPopup()">Hủy</button>
                <button class="btn btn-confirm" onclick="confirmPlaceOrder()">Xác nhận</button>
            </div>
        </div>
    </div>

    <!-- Login Required Popup -->
    <div id="loginRequiredPopup" class="confirm-popup">
        <div class="confirm-content">
            <div class="confirm-header">
                <h5 class="confirm-title">Yêu cầu đăng nhập</h5>
            </div>
            <div class="confirm-body">
                <p>Vui lòng đăng nhập để tiếp tục.</p>
            </div>
            <div class="confirm-actions">
                <button class="btn btn-secondary" onclick="hideLoginRequiredPopup()">Hủy</button>
                <button class="btn btn-confirm" onclick="showLoginOptions()">Đăng nhập</button>
            </div>
        </div>
    </div>

</body>
</html>